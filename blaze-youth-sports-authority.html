<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blaze Sports Intel | Deep South Youth Sports Authority</title>
    <meta name="description" content="Comprehensive Deep South youth sports rankings, stats, and analytics - Baseball, Football, Track & Field">

    <!-- Babylon.js 8.0 for professional 3D visualizations -->
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>

    <!-- Chart.js 4.4.0 for professional analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

    <style>
        /* Authentic Blaze Identity */
        :root {
            --color-bg: #0B0B0F;
            --color-panel: #0f172a;
            --color-text: #E5E7EB;
            --color-muted: #9CA3AF;
            --color-accent: #BF5700;  /* Burnt orange - authentic Blaze */
            --color-accent-light: #FF6B00;
            --color-cyan: #9BCBEB;
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* 3D Background Canvas */
        #babylonCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
        }

        /* Main Content Container */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
            background: linear-gradient(135deg, rgba(191, 87, 0, 0.1) 0%, rgba(15, 23, 42, 0.8) 100%);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(191, 87, 0, 0.2);
        }

        header h1 {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--color-accent-light) 0%, var(--color-cyan) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.2rem;
            color: var(--color-muted);
        }

        /* Sport Filter Navigation */
        .sport-nav {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .sport-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(191, 87, 0, 0.3);
            border-radius: 12px;
            color: var(--color-text);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .sport-btn:hover {
            background: rgba(191, 87, 0, 0.2);
            border-color: var(--color-accent);
            transform: translateY(-2px);
        }

        .sport-btn.active {
            background: var(--color-accent);
            border-color: var(--color-accent-light);
            color: white;
        }

        /* Region Filter */
        .region-filter {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .region-chip {
            padding: 0.5rem 1rem;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(155, 203, 235, 0.3);
            border-radius: 20px;
            color: var(--color-cyan);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .region-chip:hover,
        .region-chip.active {
            background: rgba(155, 203, 235, 0.2);
            border-color: var(--color-cyan);
        }

        /* Rankings Grid */
        .rankings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Ranking Card */
        .ranking-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(11, 11, 15, 0.9) 100%);
            border: 1px solid rgba(191, 87, 0, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .ranking-card:hover {
            transform: translateY(-4px);
            border-color: var(--color-accent);
            box-shadow: 0 8px 24px rgba(191, 87, 0, 0.3);
        }

        .ranking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(191, 87, 0, 0.2);
        }

        .rank-badge {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
        }

        .team-info {
            flex: 1;
            margin-left: 1rem;
        }

        .team-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 0.25rem;
        }

        .school-name {
            font-size: 0.9rem;
            color: var(--color-muted);
        }

        .location {
            font-size: 0.85rem;
            color: var(--color-cyan);
        }

        .record {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-accent-light);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-box {
            background: rgba(15, 23, 42, 0.6);
            padding: 0.75rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(191, 87, 0, 0.1);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--color-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--color-accent-light);
            margin-top: 0.25rem;
        }

        /* Composite Rating Bar */
        .rating-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(191, 87, 0, 0.1);
        }

        .rating-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--color-muted);
            margin-bottom: 0.5rem;
        }

        .rating-bar {
            height: 8px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 4px;
            overflow: hidden;
        }

        .rating-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-accent) 0%, var(--color-cyan) 100%);
            transition: width 0.5s ease;
        }

        /* Search Section */
        .search-section {
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
        }

        .search-input {
            padding: 1rem 1.5rem;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(191, 87, 0, 0.3);
            border-radius: 12px;
            color: var(--color-text);
            font-size: 1rem;
            width: 100%;
            max-width: 500px;
            backdrop-filter: blur(10px);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--color-accent);
        }

        /* Loading Indicator */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--color-muted);
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(191, 87, 0, 0.2);
            border-top-color: var(--color-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error Message */
        .error-message {
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            color: #fca5a5;
            text-align: center;
            margin: 2rem 0;
        }

        /* Analytics Section */
        .analytics-section {
            margin-top: 3rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(191, 87, 0, 0.2);
            border-radius: 16px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .analytics-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--color-accent-light);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .chart-container {
            max-width: 800px;
            margin: 0 auto;
            height: 400px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            header h1 {
                font-size: 2rem;
            }

            .rankings-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <canvas id="babylonCanvas"></canvas>

    <div class="container">
        <header>
            <h1>🔥 Blaze Sports Intel</h1>
            <p>Deep South Youth Sports Authority - League-Wide Rankings & Analytics</p>
        </header>

        <!-- Sport Navigation -->
        <nav class="sport-nav">
            <button class="sport-btn active" data-sport="football" onclick="switchSport('football')">
                🏈 Football
            </button>
            <button class="sport-btn" data-sport="baseball" onclick="switchSport('baseball')">
                ⚾ Baseball
            </button>
            <button class="sport-btn" data-sport="track" onclick="switchSport('track')">
                🏃 Track & Field
            </button>
        </nav>

        <!-- Region Filter -->
        <div class="region-filter">
            <div class="region-chip active" data-region="all" onclick="filterRegion('all')">All Deep South</div>
            <div class="region-chip" data-region="TX" onclick="filterRegion('TX')">Texas</div>
            <div class="region-chip" data-region="AL" onclick="filterRegion('AL')">Alabama</div>
            <div class="region-chip" data-region="GA" onclick="filterRegion('GA')">Georgia</div>
            <div class="region-chip" data-region="LA" onclick="filterRegion('LA')">Louisiana</div>
            <div class="region-chip" data-region="MS" onclick="filterRegion('MS')">Mississippi</div>
            <div class="region-chip" data-region="SC" onclick="filterRegion('SC')">South Carolina</div>
            <div class="region-chip" data-region="FL" onclick="filterRegion('FL')">Florida</div>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <input
                type="text"
                class="search-input"
                placeholder="Search teams, schools, or players..."
                oninput="searchTeams(this.value)"
            >
        </div>

        <!-- Rankings Grid -->
        <div id="rankingsContainer">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading league-wide rankings...</p>
            </div>
        </div>

        <!-- Analytics Section -->
        <div class="analytics-section">
            <h2 class="analytics-title">Regional Strength Analysis</h2>
            <div class="chart-container">
                <canvas id="regionalChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Global State
        let currentSport = 'football';
        let currentRegion = 'all';
        let allTeamsData = [];
        let regionalChart = null;

        // Initialize Babylon.js 3D Background
        function initBabylon() {
            const canvas = document.getElementById('babylonCanvas');
            const engine = new BABYLON.Engine(canvas, true);
            const scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color4(0, 0, 0, 0);

            // Camera
            const camera = new BABYLON.ArcRotateCamera('camera', 0, 0, 15, BABYLON.Vector3.Zero(), scene);
            camera.attachControl(canvas, false);

            // Lighting
            const light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene);
            light.intensity = 0.7;

            // Create 20 subtle floating spheres (authentic Blaze style)
            for (let i = 0; i < 20; i++) {
                const sphere = BABYLON.MeshBuilder.CreateSphere(`sphere${i}`, { diameter: Math.random() * 0.5 + 0.3 }, scene);
                sphere.position = new BABYLON.Vector3(
                    (Math.random() - 0.5) * 20,
                    (Math.random() - 0.5) * 20,
                    (Math.random() - 0.5) * 20
                );

                const material = new BABYLON.StandardMaterial(`mat${i}`, scene);
                material.diffuseColor = i % 2 === 0
                    ? new BABYLON.Color3(0.75, 0.34, 0) // Burnt orange
                    : new BABYLON.Color3(0.61, 0.8, 0.92); // Cyan
                material.emissiveColor = material.diffuseColor;
                material.alpha = 0.3;
                sphere.material = material;

                // Animation
                scene.registerBeforeRender(() => {
                    sphere.position.y += Math.sin(Date.now() * 0.001 + i) * 0.002;
                    sphere.rotation.y += 0.005;
                });
            }

            engine.runRenderLoop(() => scene.render());
            window.addEventListener('resize', () => engine.resize());
        }

        // Fetch Football Rankings (MaxPreps API)
        async function fetchFootballRankings(state = 'TX', classification = '6A') {
            try {
                const response = await fetch(`/api/sports/football/rankings?state=${state}&classification=${classification}`);
                const data = await response.json();

                if (data.success) {
                    return data.rankings;
                } else {
                    console.error('API error:', data.error);
                    return [];
                }
            } catch (error) {
                console.error('Fetch error:', error);
                return [];
            }
        }

        // Fetch Baseball Rankings (Perfect Game API)
        async function fetchBaseballRankings(state = 'TX') {
            try {
                // Using sports-data-client adapter
                const response = await fetch(`/api/sports/baseball/rankings?state=${state}`);
                const data = await response.json();

                if (data.success) {
                    return data.data;
                } else {
                    return [];
                }
            } catch (error) {
                console.error('Baseball fetch error:', error);
                return [];
            }
        }

        // Fetch Track & Field Rankings (Athletic.net API)
        async function fetchTrackRankings(state = 'TX', gender = 'boys') {
            try {
                const response = await fetch(`/api/sports/track/rankings?state=${state}&gender=${gender}`);
                const data = await response.json();

                if (data.success) {
                    return data.data;
                } else {
                    return [];
                }
            } catch (error) {
                console.error('Track fetch error:', error);
                return [];
            }
        }

        // Load All Deep South States
        async function loadAllStates(sport) {
            const states = ['TX', 'AL', 'GA', 'LA', 'MS', 'SC', 'FL'];
            const allPromises = states.map(state => {
                switch (sport) {
                    case 'football':
                        return fetchFootballRankings(state, '6A');
                    case 'baseball':
                        return fetchBaseballRankings(state);
                    case 'track':
                        return fetchTrackRankings(state, 'boys');
                }
            });

            const results = await Promise.allSettled(allPromises);
            const allTeams = [];

            results.forEach((result, index) => {
                if (result.status === 'fulfilled' && result.value) {
                    allTeams.push(...result.value.map(team => ({
                        ...team,
                        state: states[index]
                    })));
                }
            });

            return allTeams;
        }

        // Render Rankings Grid
        function renderRankings(teams) {
            const container = document.getElementById('rankingsContainer');

            if (teams.length === 0) {
                container.innerHTML = `
                    <div class="error-message">
                        <h3>No Data Available</h3>
                        <p>Rankings data is currently being loaded. Please check back soon.</p>
                    </div>
                `;
                return;
            }

            const html = `
                <div class="rankings-grid">
                    ${teams.map(team => `
                        <div class="ranking-card">
                            <div class="ranking-header">
                                <div class="rank-badge">${team.rank || '—'}</div>
                                <div class="team-info">
                                    <div class="team-name">${team.team}</div>
                                    <div class="school-name">${team.school}</div>
                                    <div class="location">${team.city}, ${team.state}</div>
                                </div>
                                <div class="record">${team.record}</div>
                            </div>

                            <div class="stats-grid">
                                <div class="stat-box">
                                    <div class="stat-label">Wins</div>
                                    <div class="stat-value">${team.wins || 0}</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-label">Losses</div>
                                    <div class="stat-value">${team.losses || 0}</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-label">Win %</div>
                                    <div class="stat-value">${team.winPct ? (team.winPct * 100).toFixed(1) : '0.0'}%</div>
                                </div>
                            </div>

                            <div class="rating-section">
                                <div class="rating-label">
                                    <span>Composite Rating</span>
                                    <span>${team.rating ? team.rating.toFixed(1) : '0.0'}/100</span>
                                </div>
                                <div class="rating-bar">
                                    <div class="rating-fill" style="width: ${team.rating || 0}%"></div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            container.innerHTML = html;
        }

        // Switch Sport
        async function switchSport(sport) {
            currentSport = sport;

            // Update active button
            document.querySelectorAll('.sport-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-sport="${sport}"]`).classList.add('active');

            // Show loading
            document.getElementById('rankingsContainer').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading ${sport} rankings...</p>
                </div>
            `;

            // Load data
            allTeamsData = await loadAllStates(sport);
            filterAndRender();
            updateRegionalChart();
        }

        // Filter by Region
        function filterRegion(region) {
            currentRegion = region;

            // Update active chip
            document.querySelectorAll('.region-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            document.querySelector(`[data-region="${region}"]`).classList.add('active');

            filterAndRender();
        }

        // Filter and Render
        function filterAndRender() {
            let filteredTeams = allTeamsData;

            if (currentRegion !== 'all') {
                filteredTeams = allTeamsData.filter(team => team.state === currentRegion);
            }

            renderRankings(filteredTeams);
        }

        // Search Teams
        function searchTeams(query) {
            if (!query) {
                filterAndRender();
                return;
            }

            const lowerQuery = query.toLowerCase();
            const filtered = allTeamsData.filter(team => {
                return team.team.toLowerCase().includes(lowerQuery) ||
                       team.school.toLowerCase().includes(lowerQuery) ||
                       team.city.toLowerCase().includes(lowerQuery);
            });

            renderRankings(filtered);
        }

        // Update Regional Chart
        function updateRegionalChart() {
            const ctx = document.getElementById('regionalChart').getContext('2d');

            // Calculate average ratings by state
            const stateRatings = {};
            allTeamsData.forEach(team => {
                if (!stateRatings[team.state]) {
                    stateRatings[team.state] = { total: 0, count: 0 };
                }
                stateRatings[team.state].total += team.rating || 0;
                stateRatings[team.state].count += 1;
            });

            const labels = Object.keys(stateRatings);
            const data = labels.map(state => {
                const avg = stateRatings[state].total / stateRatings[state].count;
                return avg.toFixed(1);
            });

            if (regionalChart) {
                regionalChart.destroy();
            }

            regionalChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Average Composite Rating',
                        data: data,
                        backgroundColor: 'rgba(191, 87, 0, 0.6)',
                        borderColor: 'rgba(255, 107, 0, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#E5E7EB' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(191, 87, 0, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(191, 87, 0, 0.1)' }
                        }
                    }
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            initBabylon();
            await switchSport('football');
        });
    </script>
</body>
</html>
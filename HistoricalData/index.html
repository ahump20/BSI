<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Historical Data Research Engine | Blaze Sports Intel</title>
  <meta name="description" content="Query decades of college baseball and football historical data with natural language. The coverage gap ESPN leaves for non-revenue college sports.">

  <!-- Blaze Brand Colors -->
  <style>
    :root {
      --blaze-orange: #ff6b00;
      --blaze-charcoal: #1a1a1a;
      --blaze-blue: #0066cc;
      --blaze-green: #28a745;
      --blaze-yellow: #ffc107;
      --blaze-red: #dc3545;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, var(--blaze-charcoal) 0%, #2d2d2d 100%);
      color: #f5f5f5;
      min-height: 100vh;
      padding: 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      padding: 40px 0;
      border-bottom: 2px solid var(--blaze-orange);
      margin-bottom: 40px;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--blaze-orange), #ff9500);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 10px;
    }

    .tagline {
      font-size: 1.1rem;
      color: #b0b0b0;
      font-weight: 400;
    }

    .search-container {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid rgba(255, 107, 0, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .search-form {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .search-input {
      flex: 1;
      padding: 16px 20px;
      font-size: 1rem;
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.08);
      color: #f5f5f5;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--blaze-orange);
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 0 0 4px rgba(255, 107, 0, 0.1);
    }

    .search-input::placeholder {
      color: #888;
    }

    .search-btn {
      padding: 16px 32px;
      font-size: 1rem;
      font-weight: 600;
      background: linear-gradient(135deg, var(--blaze-orange), #ff9500);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .search-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 107, 0, 0.4);
    }

    .search-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .examples {
      margin-top: 20px;
    }

    .examples-title {
      font-size: 0.875rem;
      color: #b0b0b0;
      font-weight: 600;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .example-btn {
      display: block;
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 8px;
      text-align: left;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 8px;
      color: #d0d0d0;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .example-btn:hover {
      background: rgba(255, 107, 0, 0.1);
      border-color: var(--blaze-orange);
      color: #f5f5f5;
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 1.1rem;
      color: var(--blaze-orange);
    }

    .spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid rgba(255, 107, 0, 0.2);
      border-top-color: var(--blaze-orange);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 12px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      background: rgba(220, 53, 69, 0.1);
      border: 1px solid var(--blaze-red);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .error-title {
      font-weight: 700;
      color: var(--blaze-red);
      margin-bottom: 8px;
    }

    .error-message {
      color: #ff8888;
      font-size: 0.95rem;
    }

    .results-container {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 30px;
      border: 1px solid rgba(255, 107, 0, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }

    .confidence-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.875rem;
    }

    .confidence-high {
      background: rgba(40, 167, 69, 0.2);
      color: var(--blaze-green);
      border: 1px solid var(--blaze-green);
    }

    .confidence-medium {
      background: rgba(255, 193, 7, 0.2);
      color: var(--blaze-yellow);
      border: 1px solid var(--blaze-yellow);
    }

    .confidence-low {
      background: rgba(220, 53, 69, 0.2);
      color: var(--blaze-red);
      border: 1px solid var(--blaze-red);
    }

    .timestamp {
      font-size: 0.875rem;
      color: #888;
    }

    .cache-badge {
      display: inline-block;
      padding: 4px 12px;
      background: rgba(255, 107, 0, 0.15);
      border: 1px solid var(--blaze-orange);
      border-radius: 12px;
      font-size: 0.75rem;
      color: var(--blaze-orange);
      font-weight: 600;
      margin-left: 12px;
    }

    .missing-data {
      background: rgba(255, 193, 7, 0.1);
      border: 1px solid var(--blaze-yellow);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      color: var(--blaze-yellow);
      font-size: 0.95rem;
    }

    .data-results {
      margin-bottom: 20px;
    }

    .data-item {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .data-content {
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 0.875rem;
      line-height: 1.8;
      color: #d0d0d0;
      white-space: pre-wrap;
      overflow-x: auto;
    }

    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: #888;
      font-size: 1.1rem;
    }

    .sources {
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sources-title {
      font-weight: 700;
      color: #f5f5f5;
      margin-bottom: 12px;
      font-size: 0.95rem;
    }

    .sources-list {
      list-style: none;
    }

    .source-item {
      color: #b0b0b0;
      font-size: 0.9rem;
      padding: 6px 0;
      padding-left: 20px;
      position: relative;
    }

    .source-item::before {
      content: 'â€¢';
      position: absolute;
      left: 0;
      color: var(--blaze-orange);
      font-weight: bold;
    }

    footer {
      text-align: center;
      padding: 40px 20px;
      margin-top: 60px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: #888;
      font-size: 0.9rem;
    }

    footer a {
      color: var(--blaze-orange);
      text-decoration: none;
      font-weight: 600;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Coverage Matrix Styles */
    .coverage-matrix-section {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid rgba(255, 107, 0, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .matrix-header {
      text-align: center;
      margin-bottom: 24px;
    }

    .matrix-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #f5f5f5;
      margin-bottom: 8px;
    }

    .matrix-subtitle {
      font-size: 1rem;
      color: #b0b0b0;
    }

    .coverage-matrix {
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .coverage-loading {
      text-align: center;
      font-size: 1rem;
      color: var(--blaze-orange);
    }

    .matrix-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 12px;
      margin-bottom: 24px;
    }

    .year-box {
      position: relative;
      aspect-ratio: 1;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      padding: 12px;
    }

    .year-box:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      border-color: var(--blaze-orange);
    }

    .year-box.status-complete {
      background: rgba(40, 167, 69, 0.2);
      border-color: var(--blaze-green);
    }

    .year-box.status-partial {
      background: rgba(255, 193, 7, 0.2);
      border-color: var(--blaze-yellow);
    }

    .year-box.status-minimal {
      background: rgba(255, 107, 0, 0.15);
      border-color: rgba(255, 107, 0, 0.4);
    }

    .year-box.status-missing {
      background: rgba(255, 255, 255, 0.02);
      border-color: rgba(255, 255, 255, 0.1);
      opacity: 0.5;
      cursor: not-allowed;
    }

    .year-label {
      font-size: 1.1rem;
      font-weight: 700;
      color: #f5f5f5;
      margin-bottom: 4px;
    }

    .game-count {
      font-size: 0.8rem;
      color: #b0b0b0;
    }

    .year-box.status-missing .year-label,
    .year-box.status-missing .game-count {
      opacity: 0.5;
    }

    .matrix-legend {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      color: #d0d0d0;
    }

    .legend-box {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 2px solid;
    }

    .legend-complete {
      background: rgba(40, 167, 69, 0.2);
      border-color: var(--blaze-green);
    }

    .legend-partial {
      background: rgba(255, 193, 7, 0.2);
      border-color: var(--blaze-yellow);
    }

    .legend-minimal {
      background: rgba(255, 107, 0, 0.15);
      border-color: rgba(255, 107, 0, 0.4);
    }

    .legend-missing {
      background: rgba(255, 255, 255, 0.02);
      border-color: rgba(255, 255, 255, 0.1);
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }

      .search-form {
        flex-direction: column;
      }

      .search-btn {
        width: 100%;
      }

      .results-header {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Navigation Bar -->
    <nav style="padding: 20px 0; margin-bottom: 20px;">
      <a href="/" style="display: inline-flex; align-items: center; gap: 12px; color: var(--blaze-orange); text-decoration: none; font-weight: 600; font-size: 1.1rem; transition: all 0.3s ease;">
        <span style="font-size: 1.5rem;">ðŸ”¥</span>
        <span>Back to Blaze Sports Intel</span>
      </a>
    </nav>

    <header>
      <h1>Historical Research Engine</h1>
      <p class="tagline">Decades of college baseball and football data. Ask anything.</p>
    </header>

    <!-- Coverage Matrix Widget -->
    <div class="coverage-matrix-section">
      <div class="matrix-header">
        <h2 class="matrix-title">Data Coverage</h2>
        <p class="matrix-subtitle">Complete historical data by season and sport</p>
      </div>
      <div id="coverageMatrix" class="coverage-matrix">
        <div class="coverage-loading">
          <span class="spinner"></span>
          Loading coverage data...
        </div>
      </div>
      <div class="matrix-legend">
        <div class="legend-item">
          <span class="legend-box legend-complete"></span>
          <span>Complete (14+ games)</span>
        </div>
        <div class="legend-item">
          <span class="legend-box legend-partial"></span>
          <span>Partial (5-13 games)</span>
        </div>
        <div class="legend-item">
          <span class="legend-box legend-minimal"></span>
          <span>Minimal (&lt;5 games)</span>
        </div>
        <div class="legend-item">
          <span class="legend-box legend-missing"></span>
          <span>No data</span>
        </div>
      </div>
    </div>

    <div class="search-container">
      <form class="search-form" id="searchForm">
        <input
          type="text"
          class="search-input"
          id="queryInput"
          placeholder="When has Texas beaten LSU at the CWS?"
          autocomplete="off"
        />
        <button type="submit" class="search-btn" id="searchBtn">
          Search
        </button>
      </form>

      <div class="examples">
        <div class="examples-title">Example Queries:</div>
        <button class="example-btn" data-query="When has Texas beaten LSU at the College World Series?">
          When has Texas beaten LSU at the College World Series?
        </button>
        <button class="example-btn" data-query="What is Kumar Rocker's ERA in 2021?">
          What is Kumar Rocker's ERA in 2021?
        </button>
        <button class="example-btn" data-query="Compare Coach Saban's 4th down decisions to FBS average">
          Compare Coach Saban's 4th down decisions to FBS average
        </button>
        <button class="example-btn" data-query="Show me Vanderbilt's elimination game wins at the CWS">
          Show me Vanderbilt's elimination game wins at the CWS
        </button>
        <button class="example-btn" data-query="What is umpire Ted Barrett's strike call accuracy?">
          What is umpire Ted Barrett's strike call accuracy?
        </button>
      </div>
    </div>

    <div id="loadingContainer" style="display: none;">
      <div class="loading">
        <span class="spinner"></span>
        Searching historical archives...
      </div>
    </div>

    <div id="errorContainer" style="display: none;"></div>
    <div id="resultsContainer" style="display: none;"></div>

    <footer>
      <p>
        Built in Boerne, Texas by <a href="https://blazesportsintel.com">Blaze Sports Intel</a>
        <br>
        Filling the coverage gap ESPN leaves for college baseball and football
      </p>
    </footer>
  </div>

  <script>
    const form = document.getElementById('searchForm');
    const queryInput = document.getElementById('queryInput');
    const searchBtn = document.getElementById('searchBtn');
    const loadingContainer = document.getElementById('loadingContainer');
    const errorContainer = document.getElementById('errorContainer');
    const resultsContainer = document.getElementById('resultsContainer');
    const exampleButtons = document.querySelectorAll('.example-btn');

    // Example query click handlers
    exampleButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        queryInput.value = btn.dataset.query;
        queryInput.focus();
      });
    });

    // Form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      await executeQuery();
    });

    async function executeQuery() {
      const query = queryInput.value.trim();
      if (!query) return;

      // Reset UI
      loadingContainer.style.display = 'block';
      errorContainer.style.display = 'none';
      resultsContainer.style.display = 'none';
      searchBtn.disabled = true;
      searchBtn.textContent = 'Searching...';

      try {
        const response = await fetch('/api/historical/query', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query })
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const result = await response.json();
        displayResults(result);
      } catch (error) {
        displayError(error);
      } finally {
        loadingContainer.style.display = 'none';
        searchBtn.disabled = false;
        searchBtn.textContent = 'Search';
      }
    }

    function displayResults(result) {
      const { data, sources, timestamp, confidence, missing_data, cached, cache_age_seconds } = result;

      const confidenceClass = confidence >= 0.9 ? 'confidence-high' :
                             confidence >= 0.7 ? 'confidence-medium' : 'confidence-low';
      const confidenceLabel = confidence >= 0.9 ? 'High' :
                             confidence >= 0.7 ? 'Medium' : 'Low';

      let html = `
        <div class="results-container">
          <div class="results-header">
            <div>
              <span class="confidence-badge ${confidenceClass}">
                Confidence: ${confidenceLabel} (${(confidence * 100).toFixed(0)}%)
              </span>
              ${cached ? `<span class="cache-badge">Cached ${cache_age_seconds}s ago</span>` : ''}
            </div>
            <div class="timestamp">${timestamp}</div>
          </div>
      `;

      if (missing_data) {
        html += `
          <div class="missing-data">
            ${missing_data}
          </div>
        `;
      }

      if (data.length > 0) {
        html += '<div class="data-results">';
        data.forEach(item => {
          html += `
            <div class="data-item">
              <pre class="data-content">${JSON.stringify(item, null, 2)}</pre>
            </div>
          `;
        });
        html += '</div>';
      } else {
        html += '<div class="no-results">No results found</div>';
      }

      if (sources.length > 0) {
        html += `
          <div class="sources">
            <div class="sources-title">Sources:</div>
            <ul class="sources-list">
              ${sources.map(source => `<li class="source-item">${source}</li>`).join('')}
            </ul>
          </div>
        `;
      }

      html += '</div>';

      resultsContainer.innerHTML = html;
      resultsContainer.style.display = 'block';
    }

    function displayError(error) {
      errorContainer.innerHTML = `
        <div class="error">
          <div class="error-title">Error</div>
          <div class="error-message">${error.message || 'Query failed. Please try again.'}</div>
        </div>
      `;
      errorContainer.style.display = 'block';
    }

    // Coverage Matrix Loading
    async function loadCoverageMatrix() {
      const matrixContainer = document.getElementById('coverageMatrix');

      try {
        const response = await fetch('/api/coverage-matrix');
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();

        // Extract CWS data
        const cwsData = data.sports?.baseball?.cws || {};
        const years = Object.keys(cwsData).sort((a, b) => b - a); // Sort descending

        if (years.length === 0) {
          matrixContainer.innerHTML = `
            <div style="text-align: center; color: #b0b0b0; padding: 40px;">
              No coverage data available yet
            </div>
          `;
          return;
        }

        // Build the grid
        let gridHTML = '<div class="matrix-grid">';

        years.forEach(year => {
          const yearData = cwsData[year];
          const games = yearData.games || 0;
          const status = yearData.status || 'missing';

          gridHTML += `
            <div class="year-box status-${status}"
                 data-year="${year}"
                 data-games="${games}"
                 title="${year}: ${games} games (${status})">
              <div class="year-label">${year}</div>
              <div class="game-count">${games} games</div>
            </div>
          `;
        });

        gridHTML += '</div>';

        matrixContainer.innerHTML = gridHTML;

        // Add click handlers for year boxes
        document.querySelectorAll('.year-box').forEach(box => {
          if (!box.classList.contains('status-missing')) {
            box.addEventListener('click', () => {
              const year = box.dataset.year;
              const games = box.dataset.games;
              alert(`${year} CWS Data:\n${games} games available\n\nClick "Search" above to query specific games.`);
            });
          }
        });

      } catch (error) {
        console.error('Coverage matrix load error:', error);
        matrixContainer.innerHTML = `
          <div style="text-align: center; color: var(--blaze-red); padding: 40px;">
            Failed to load coverage data
          </div>
        `;
      }
    }

    // Load coverage matrix on page load
    document.addEventListener('DOMContentLoaded', loadCoverageMatrix);
  </script>
</body>
</html>

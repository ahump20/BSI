<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Details | NFL | Blaze Sports Intel</title>
    <meta name="description" content="Live NFL game details including box score, lineups, odds, and head-to-head history.">
    <meta property="og:title" content="NFL Game Details | Blaze Sports Intel">
    <meta property="og:description" content="Live box scores, starting lineups, betting odds, and matchup history.">
    <meta property="og:image" content="https://blazesportsintel.com/images/texas-soil.jpg">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#BF5700">

    <link rel="manifest" href="/manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="/images/bsi-logo-nav.png">

    <style>
        :root {
            --bsi-burnt-orange: #BF5700;
            --bsi-ember: #FF6B35;
            --bsi-charcoal: #1A1A1A;
            --bsi-midnight: #0D0D0D;
            --bsi-cream: #FAF8F5;
            --bsi-gold: #C9A227;
            --bsi-success: #10B981;
            --bsi-error: #EF4444;
            --bsi-muted: #6B7280;
            --sport-primary: #013369;
            --sport-secondary: #D50A0A;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Oswald', sans-serif;
            background: var(--bsi-midnight);
            color: var(--bsi-cream);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }

        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 0.75rem 0;
            background: rgba(13, 13, 13, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(191, 87, 0, 0.15);
        }

        .nav-inner { display: flex; justify-content: space-between; align-items: center; }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: var(--bsi-cream);
            font-weight: 700;
            font-size: 1.125rem;
        }

        .logo span { color: var(--bsi-ember); }
        .logo-img { height: 44px; width: auto; }

        .nav-links { display: flex; gap: 1.5rem; list-style: none; font-size: 0.875rem; font-weight: 500; }
        .nav-links a { color: var(--bsi-cream); text-decoration: none; opacity: 0.8; transition: opacity 0.2s; }
        .nav-links a:hover { opacity: 1; }
        .nav-links a.active { color: var(--bsi-ember); opacity: 1; }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--bsi-muted);
            text-decoration: none;
            font-size: 0.875rem;
            margin-bottom: 1rem;
            transition: color 0.2s;
        }
        .back-link:hover { color: var(--bsi-cream); }

        .game-header {
            padding: 7rem 0 2rem;
            background: linear-gradient(135deg, rgba(1, 51, 105, 0.2), rgba(213, 10, 10, 0.15));
        }

        .matchup {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 3rem;
            margin-bottom: 1.5rem;
        }

        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }

        .team-logo {
            width: 80px;
            height: 80px;
            object-fit: contain;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
        }

        .team-name {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .team-record {
            color: var(--bsi-muted);
            font-size: 0.875rem;
        }

        .score {
            font-size: 3.5rem;
            font-weight: 700;
        }

        .score-vs {
            font-size: 1.5rem;
            color: var(--bsi-muted);
            font-weight: 400;
        }

        .game-status {
            text-align: center;
            color: var(--bsi-muted);
            font-size: 0.9rem;
        }

        .game-status .live {
            color: var(--bsi-error);
            font-weight: 600;
        }

        .tabs-container {
            padding: 2rem 0 4rem;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 0;
            overflow-x: auto;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--bsi-muted);
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            position: relative;
            white-space: nowrap;
            transition: color 0.2s;
        }

        .tab:hover { color: var(--bsi-cream); }

        .tab.active {
            color: var(--bsi-ember);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--bsi-ember);
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .panel-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .pro-badge {
            background: linear-gradient(135deg, var(--bsi-burnt-orange), var(--bsi-ember));
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--bsi-muted);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--bsi-ember);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 1rem;
            border-radius: 8px;
            color: var(--bsi-error);
            text-align: center;
        }

        /* Gamecast Styles */
        .gamecast-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        @media (max-width: 768px) {
            .gamecast-grid { grid-template-columns: 1fr; }
        }
        .gamecast-section-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--bsi-cream);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .gamecast-scoring, .gamecast-stats {
            background: var(--bsi-charcoal);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .quarter-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .quarter-row:last-child { border-bottom: none; }
        .quarter-label {
            font-weight: 600;
            color: var(--bsi-muted);
            min-width: 80px;
        }
        .quarter-scores {
            display: flex;
            gap: 2rem;
        }
        .quarter-score {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
        }
        .stat-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem 0;
        }
        .stat-label {
            flex: 1;
            text-align: center;
            font-size: 0.75rem;
            color: var(--bsi-muted);
            text-transform: uppercase;
        }
        .stat-value {
            min-width: 50px;
            text-align: center;
            font-weight: 600;
        }
        .stat-bar {
            flex: 2;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            display: flex;
        }
        .stat-bar-away {
            background: var(--sport-primary);
            height: 100%;
        }
        .stat-bar-home {
            background: var(--sport-secondary);
            height: 100%;
        }

        /* Play-by-Play Styles */
        .pbp-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .pbp-filter {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--bsi-muted);
            font-family: 'Oswald', sans-serif;
            font-size: 0.8125rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .pbp-filter:hover {
            border-color: var(--bsi-ember);
            color: var(--bsi-cream);
        }
        .pbp-filter.active {
            background: var(--bsi-ember);
            border-color: var(--bsi-ember);
            color: white;
        }
        .pbp-quarter {
            margin-bottom: 2rem;
        }
        .pbp-quarter-header {
            font-size: 1rem;
            font-weight: 600;
            color: var(--bsi-ember);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .pbp-play {
            display: flex;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .pbp-play:last-child { border-bottom: none; }
        .pbp-play.scoring {
            background: rgba(191, 87, 0, 0.1);
            margin: 0 -1rem;
            padding: 0.75rem 1rem;
            border-radius: 6px;
        }
        .pbp-time {
            min-width: 50px;
            font-size: 0.75rem;
            color: var(--bsi-muted);
            font-weight: 600;
        }
        .pbp-team-logo {
            width: 20px;
            height: 20px;
            object-fit: contain;
        }
        .pbp-desc {
            flex: 1;
            font-size: 0.875rem;
            color: rgba(250, 248, 245, 0.9);
        }
        .pbp-score {
            font-weight: 700;
            font-size: 0.875rem;
            color: var(--bsi-gold);
            min-width: 60px;
            text-align: right;
        }

        /* Box Score Styles */
        .box-score-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
        }

        .box-score-table th,
        .box-score-table td {
            padding: 0.75rem 1rem;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .box-score-table th {
            background: var(--bsi-charcoal);
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .box-score-table td.team-col {
            text-align: left;
            font-weight: 600;
        }

        .box-score-table tr:hover {
            background: rgba(191, 87, 0, 0.05);
        }

        /* Lineups Styles */
        .lineups-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 768px) {
            .lineups-grid { grid-template-columns: 1fr; }
        }

        .lineup-card {
            background: var(--bsi-charcoal);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .lineup-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .lineup-team-logo {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .lineup-team-name {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .player-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .player-row:last-child { border-bottom: none; }

        .player-name {
            font-weight: 500;
        }

        .player-link {
            color: inherit;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }
        .player-link:hover {
            color: var(--bsi-primary);
            text-decoration: underline;
        }

        .player-position {
            color: var(--bsi-muted);
            font-size: 0.875rem;
        }

        /* Odds Styles - Table Format */
        .odds-table-wrapper {
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        .odds-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bsi-charcoal);
            border-radius: 12px;
            overflow: hidden;
            font-size: 0.9rem;
        }

        .odds-table th,
        .odds-table td {
            padding: 12px 16px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .odds-table th {
            background: rgba(0, 0, 0, 0.3);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--bsi-muted);
        }

        .odds-table th:first-child {
            text-align: left;
        }

        .odds-table td:first-child {
            text-align: left;
            font-weight: 500;
            color: var(--bsi-muted);
        }

        .odds-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .odds-table tr:last-child td {
            border-bottom: none;
        }

        .odds-cell {
            font-weight: 600;
        }

        .odds-cell.best-line {
            color: #2E7D32;
            background: rgba(46, 125, 50, 0.15);
            border-radius: 4px;
            padding: 6px 10px;
        }

        .odds-positive {
            color: #4CAF50;
        }

        .odds-negative {
            color: var(--bsi-ember);
        }

        .best-odds-badge {
            display: inline-block;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 2px 6px;
            background: rgba(46, 125, 50, 0.2);
            color: #4CAF50;
            border-radius: 3px;
            margin-left: 6px;
        }

        /* Fallback grid for older layout */
        .odds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .odds-card {
            background: var(--bsi-charcoal);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .odds-book {
            font-size: 0.875rem;
            color: var(--bsi-muted);
            margin-bottom: 1rem;
        }

        .odds-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .odds-row:last-child { border-bottom: none; }

        .odds-label {
            font-weight: 500;
        }

        .odds-value {
            font-weight: 700;
            color: var(--bsi-ember);
        }

        /* H2H Styles */
        .h2h-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .h2h-stat {
            background: var(--bsi-charcoal);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .h2h-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--bsi-ember);
        }

        .h2h-label {
            color: var(--bsi-muted);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .h2h-games {
            margin-top: 2rem;
        }

        .h2h-game {
            background: var(--bsi-charcoal);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .h2h-date {
            color: var(--bsi-muted);
            font-size: 0.875rem;
        }

        .h2h-result {
            font-weight: 600;
        }

        .h2h-winner { color: var(--bsi-success); }
        .h2h-loser { color: var(--bsi-error); }

        .footer {
            background: var(--bsi-charcoal);
            border-top: 1px solid rgba(191, 87, 0, 0.1);
            padding: 2rem 0;
            text-align: center;
        }

        .footer-text {
            color: var(--bsi-muted);
            font-size: 0.875rem;
        }

        .data-source {
            margin-top: 1rem;
            font-size: 0.75rem;
            color: var(--bsi-muted);
            text-align: right;
        }

        /* Highlights Styles */
        .highlights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .highlight-card {
            background: var(--bsi-charcoal);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s;
        }

        .highlight-card:hover {
            transform: translateY(-4px);
        }

        .highlight-video {
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
        }

        .highlight-thumb {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover;
            background: #000;
        }

        .highlight-info {
            padding: 1rem;
        }

        .highlight-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .highlight-desc {
            font-size: 0.875rem;
            color: var(--bsi-muted);
            line-height: 1.4;
        }

        .highlight-meta {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 0.75rem;
            font-size: 0.8rem;
            color: var(--bsi-muted);
        }

        .highlight-duration {
            background: rgba(255,255,255,0.1);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .no-highlights {
            text-align: center;
            padding: 3rem;
            color: var(--bsi-muted);
        }

        .no-highlights p {
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .matchup { gap: 1.5rem; }
            .score { font-size: 2.5rem; }
            .team-logo { width: 60px; height: 60px; }
            .team-name { font-size: 1rem; }
            .h2h-summary { grid-template-columns: 1fr; }
            .highlights-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="container nav-inner">
            <a href="/" class="logo">
                <img src="/images/bsi-logo-nav.png" alt="BSI" class="logo-img">
                Blaze Sports <span>Intel</span>
            </a>
            <ul class="nav-links">
                <li><a href="/nfl/" class="active">NFL</a></li>
                <li><a href="/nba/">NBA</a></li>
                <li><a href="/mlb/">MLB</a></li>
                <li><a href="/college-baseball/">College Baseball</a></li>
                <li><a href="/tools">Tools</a></li>
            </ul>
        </div>
    </nav>

    <header class="game-header">
        <div class="container">
            <a href="/nfl/scores.html" class="back-link">
                ← Back to Scores
            </a>
            <div id="matchup-container">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading game details...</p>
                </div>
            </div>
        </div>
    </header>

    <main class="tabs-container">
        <div class="container">
            <div class="tabs">
                <button class="tab active" data-tab="gamecast">Gamecast</button>
                <button class="tab" data-tab="boxscore">Box Score</button>
                <button class="tab" data-tab="playbyplay">Play-by-Play</button>
                <button class="tab" data-tab="lineups">Lineups <span class="pro-badge">Pro</span></button>
                <button class="tab" data-tab="highlights">Highlights <span class="pro-badge">Pro</span></button>
                <button class="tab" data-tab="odds">Odds <span class="pro-badge">Pro</span></button>
                <button class="tab" data-tab="h2h">Head-to-Head <span class="pro-badge">Pro</span></button>
            </div>

            <!-- Gamecast Tab -->
            <div id="gamecast" class="tab-panel active">
                <div id="gamecast-content">
                    <div class="gamecast-grid">
                        <div class="gamecast-scoring" id="scoring-summary">
                            <h3 class="gamecast-section-title">Scoring Summary</h3>
                            <div class="scoring-quarters" id="scoring-by-quarter">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <p>Loading scoring...</p>
                                </div>
                            </div>
                        </div>
                        <div class="gamecast-stats" id="team-stats-summary">
                            <h3 class="gamecast-section-title">Team Stats</h3>
                            <div id="stats-comparison">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <p>Loading stats...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Play-by-Play Tab -->
            <div id="playbyplay" class="tab-panel">
                <h2 class="panel-title">Play-by-Play</h2>
                <div class="pbp-controls">
                    <button class="pbp-filter active" data-filter="all">All Plays</button>
                    <button class="pbp-filter" data-filter="scoring">Scoring Plays</button>
                </div>
                <div id="playbyplay-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading play-by-play...</p>
                    </div>
                </div>
            </div>

            <div id="boxscore" class="tab-panel">
                <h2 class="panel-title">Box Score</h2>
                <div id="boxscore-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading box score...</p>
                    </div>
                </div>
            </div>

            <div id="lineups" class="tab-panel">
                <h2 class="panel-title">Starting Lineups <span class="pro-badge">Pro</span></h2>
                <div id="lineups-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading lineups...</p>
                    </div>
                </div>
            </div>

            <div id="highlights" class="tab-panel">
                <h2 class="panel-title">Video Highlights <span class="pro-badge">Pro</span></h2>
                <div id="highlights-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading highlights...</p>
                    </div>
                </div>
            </div>

            <div id="odds" class="tab-panel">
                <h2 class="panel-title">Betting Odds <span class="pro-badge">Pro</span></h2>
                <div id="odds-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading odds...</p>
                    </div>
                </div>
            </div>

            <div id="h2h" class="tab-panel">
                <h2 class="panel-title">Head-to-Head History <span class="pro-badge">Pro</span></h2>
                <div id="h2h-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading matchup history...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p class="footer-text">&copy; 2025 Blaze Sports Intel. Born to Blaze the Path Less Beaten.</p>
        </div>
    </footer>

    <script>
        // Get match ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const matchId = urlParams.get('id');

        // Utility: Escape HTML to prevent XSS
        function escapeHtml(text) {
            if (text === null || text === undefined) return '';
            const div = document.createElement('div');
            div.textContent = String(text);
            return div.innerHTML;
        }

        if (!matchId) {
            document.getElementById('matchup-container').textContent = 'No game ID provided.';
        }

        // Game state
        let gameData = {
            match: null,
            boxScore: null,
            lineups: null,
            odds: null,
            h2h: null
        };

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Safe DOM building helper
        function createElement(tag, attrs = {}, children = []) {
            const el = document.createElement(tag);
            Object.entries(attrs).forEach(([key, val]) => {
                if (key === 'className') el.className = val;
                else if (key === 'textContent') el.textContent = val;
                else if (key.startsWith('data')) el.setAttribute(key.replace(/([A-Z])/g, '-$1').toLowerCase(), val);
                else el.setAttribute(key, val);
            });
            children.forEach(child => {
                if (typeof child === 'string') el.appendChild(document.createTextNode(child));
                else if (child) el.appendChild(child);
            });
            return el;
        }

        // Fetch all game data
        async function loadGameData() {
            if (!matchId) return;

            try {
                const [matchRes, boxScoreRes] = await Promise.all([
                    fetch('/api/nfl/match/' + encodeURIComponent(matchId)),
                    fetch('/api/nfl/box-score/' + encodeURIComponent(matchId))
                ]);

                const matchData = await matchRes.json();
                const boxScoreData = await boxScoreRes.json();

                gameData.match = matchData;
                gameData.boxScore = boxScoreData;

                renderMatchup(matchData);
                renderBoxScore(boxScoreData);
                loadProFeatures(matchData);

            } catch (error) {
                console.error('Error loading game data:', error);
                const container = document.getElementById('matchup-container');
                container.textContent = '';
                const errDiv = createElement('div', { className: 'error-message', textContent: 'Failed to load game data. Please try again.' });
                container.appendChild(errDiv);
            }
        }

        async function loadProFeatures(matchData) {
            // Lineups
            try {
                const lineupsRes = await fetch('/api/nfl/lineups/' + encodeURIComponent(matchId));
                const lineupsData = await lineupsRes.json();
                gameData.lineups = lineupsData;
                renderLineups(lineupsData, matchData);
            } catch (e) {
                document.getElementById('lineups-content').textContent = 'Lineups not available for this game.';
            }

            // Odds
            try {
                const oddsRes = await fetch('/api/nfl/odds/' + encodeURIComponent(matchId));
                const oddsData = await oddsRes.json();
                gameData.odds = oddsData;
                renderOdds(oddsData);
            } catch (e) {
                document.getElementById('odds-content').textContent = 'Odds not available for this game.';
            }

            // H2H
            if (matchData.homeTeam?.id && matchData.awayTeam?.id) {
                try {
                    const h2hRes = await fetch('/api/nfl/h2h?teamOne=' + encodeURIComponent(matchData.awayTeam.id) + '&teamTwo=' + encodeURIComponent(matchData.homeTeam.id));
                    const h2hData = await h2hRes.json();
                    gameData.h2h = h2hData;
                    renderH2H(h2hData, matchData);
                } catch (e) {
                    document.getElementById('h2h-content').textContent = 'Head-to-head data not available.';
                }
            }

            // Highlights
            try {
                const highlightsRes = await fetch('/api/nfl/highlights?matchId=' + encodeURIComponent(matchId));
                const highlightsData = await highlightsRes.json();
                gameData.highlights = highlightsData;
                renderHighlights(highlightsData, matchData);
            } catch (e) {
                document.getElementById('highlights-content').textContent = 'Highlights not available for this game.';
            }
        }

        function renderMatchup(data) {
            const homeTeam = data.homeTeam || {};
            const awayTeam = data.awayTeam || {};
            const homeScore = data.homeScore !== undefined ? data.homeScore : '-';
            const awayScore = data.awayScore !== undefined ? data.awayScore : '-';
            const status = data.status || data.state || 'Scheduled';
            const isLive = (status || '').toLowerCase().includes('live') || (status || '').toLowerCase().includes('progress');

            const container = document.getElementById('matchup-container');
            container.textContent = '';

            const matchup = createElement('div', { className: 'matchup' });

            // Away team
            const awayDiv = createElement('div', { className: 'team' });
            const awayLogo = createElement('img', { className: 'team-logo', src: awayTeam.logo || '/images/placeholder-team.png', alt: escapeHtml(awayTeam.name || 'Away') });
            const awayName = createElement('div', { className: 'team-name', textContent: awayTeam.name || awayTeam.abbreviation || 'Away' });
            const awayRecord = createElement('div', { className: 'team-record', textContent: awayTeam.record || '' });
            awayDiv.appendChild(awayLogo);
            awayDiv.appendChild(awayName);
            awayDiv.appendChild(awayRecord);

            // Score
            const scoreDiv = createElement('div', { className: 'score' });
            scoreDiv.appendChild(createElement('span', { textContent: String(awayScore) }));
            scoreDiv.appendChild(createElement('span', { className: 'score-vs', textContent: ' - ' }));
            scoreDiv.appendChild(createElement('span', { textContent: String(homeScore) }));

            // Home team
            const homeDiv = createElement('div', { className: 'team' });
            const homeLogo = createElement('img', { className: 'team-logo', src: homeTeam.logo || '/images/placeholder-team.png', alt: escapeHtml(homeTeam.name || 'Home') });
            const homeName = createElement('div', { className: 'team-name', textContent: homeTeam.name || homeTeam.abbreviation || 'Home' });
            const homeRecord = createElement('div', { className: 'team-record', textContent: homeTeam.record || '' });
            homeDiv.appendChild(homeLogo);
            homeDiv.appendChild(homeName);
            homeDiv.appendChild(homeRecord);

            matchup.appendChild(awayDiv);
            matchup.appendChild(scoreDiv);
            matchup.appendChild(homeDiv);
            container.appendChild(matchup);

            // Status
            const statusDiv = createElement('div', { className: 'game-status' });
            if (isLive) {
                statusDiv.appendChild(createElement('span', { className: 'live', textContent: 'LIVE' }));
                statusDiv.appendChild(document.createTextNode(' - '));
            }
            let statusText = data.venue || '';
            if (data.dateTime) {
                statusText += ' • ' + new Date(data.dateTime).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            }
            statusDiv.appendChild(document.createTextNode(statusText));
            container.appendChild(statusDiv);
        }

        function renderBoxScore(data) {
            const container = document.getElementById('boxscore-content');
            container.textContent = '';

            if (data.error) {
                container.appendChild(createElement('div', { className: 'error-message', textContent: data.error }));
                return;
            }

            const quarters = data.quarters || data.periods || [];
            const homeTeam = data.homeTeam || {};
            const awayTeam = data.awayTeam || {};

            const table = createElement('table', { className: 'box-score-table' });
            const thead = createElement('thead');
            const headerRow = createElement('tr');
            headerRow.appendChild(createElement('th', { textContent: 'Team' }));
            const numQuarters = quarters.length || 4;
            for (let i = 1; i <= numQuarters; i++) {
                headerRow.appendChild(createElement('th', { textContent: 'Q' + i }));
            }
            headerRow.appendChild(createElement('th', { textContent: 'Total' }));
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = createElement('tbody');

            // Away row
            const awayRow = createElement('tr');
            const awayTeamCell = createElement('td', { className: 'team-col', textContent: awayTeam.abbreviation || awayTeam.name || 'Away' });
            awayRow.appendChild(awayTeamCell);
            if (quarters.length) {
                quarters.forEach(q => awayRow.appendChild(createElement('td', { textContent: q.awayScore !== undefined ? String(q.awayScore) : '-' })));
            } else {
                for (let i = 0; i < 4; i++) awayRow.appendChild(createElement('td', { textContent: '-' }));
            }
            const awayTotal = createElement('td');
            awayTotal.appendChild(createElement('strong', { textContent: data.awayScore !== undefined ? String(data.awayScore) : '-' }));
            awayRow.appendChild(awayTotal);
            tbody.appendChild(awayRow);

            // Home row
            const homeRow = createElement('tr');
            const homeTeamCell = createElement('td', { className: 'team-col', textContent: homeTeam.abbreviation || homeTeam.name || 'Home' });
            homeRow.appendChild(homeTeamCell);
            if (quarters.length) {
                quarters.forEach(q => homeRow.appendChild(createElement('td', { textContent: q.homeScore !== undefined ? String(q.homeScore) : '-' })));
            } else {
                for (let i = 0; i < 4; i++) homeRow.appendChild(createElement('td', { textContent: '-' }));
            }
            const homeTotal = createElement('td');
            homeTotal.appendChild(createElement('strong', { textContent: data.homeScore !== undefined ? String(data.homeScore) : '-' }));
            homeRow.appendChild(homeTotal);
            tbody.appendChild(homeRow);

            table.appendChild(tbody);
            container.appendChild(table);

            // Data source
            const sourceDiv = createElement('div', { className: 'data-source', textContent: 'Source: ' + (data.source || 'Highlightly') + ' • ' + (data.fetchedAt || new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' })) });
            container.appendChild(sourceDiv);
        }

        function renderLineups(data, matchData) {
            const container = document.getElementById('lineups-content');
            container.textContent = '';

            if (data.error) {
                container.appendChild(createElement('div', { className: 'error-message', textContent: data.error }));
                return;
            }

            const homeLineup = data.homeLineup || data.home || [];
            const awayLineup = data.awayLineup || data.away || [];
            const homeTeam = matchData?.homeTeam || {};
            const awayTeam = matchData?.awayTeam || {};

            const grid = createElement('div', { className: 'lineups-grid' });

            // Away lineup
            const awayCard = createElement('div', { className: 'lineup-card' });
            const awayHeader = createElement('div', { className: 'lineup-header' });
            awayHeader.appendChild(createElement('img', { className: 'lineup-team-logo', src: awayTeam.logo || '/images/placeholder-team.png', alt: escapeHtml(awayTeam.name) }));
            awayHeader.appendChild(createElement('span', { className: 'lineup-team-name', textContent: awayTeam.name || 'Away' }));
            awayCard.appendChild(awayHeader);

            if (awayLineup.length === 0) {
                awayCard.appendChild(createElement('p', { style: 'color: var(--bsi-muted)', textContent: 'Lineup not yet announced' }));
            } else {
                awayLineup.slice(0, 22).forEach(p => {
                    const row = createElement('div', { className: 'player-row' });
                    const playerName = p.name || p.fullName || 'Unknown';
                    if (p.id || p.playerId) {
                        const link = createElement('a', { className: 'player-link', href: '/nfl/player.html?id=' + (p.id || p.playerId), textContent: playerName });
                        row.appendChild(link);
                    } else {
                        row.appendChild(createElement('span', { className: 'player-name', textContent: playerName }));
                    }
                    row.appendChild(createElement('span', { className: 'player-position', textContent: p.position || '' }));
                    awayCard.appendChild(row);
                });
            }
            grid.appendChild(awayCard);

            // Home lineup
            const homeCard = createElement('div', { className: 'lineup-card' });
            const homeHeader = createElement('div', { className: 'lineup-header' });
            homeHeader.appendChild(createElement('img', { className: 'lineup-team-logo', src: homeTeam.logo || '/images/placeholder-team.png', alt: escapeHtml(homeTeam.name) }));
            homeHeader.appendChild(createElement('span', { className: 'lineup-team-name', textContent: homeTeam.name || 'Home' }));
            homeCard.appendChild(homeHeader);

            if (homeLineup.length === 0) {
                homeCard.appendChild(createElement('p', { style: 'color: var(--bsi-muted)', textContent: 'Lineup not yet announced' }));
            } else {
                homeLineup.slice(0, 22).forEach(p => {
                    const row = createElement('div', { className: 'player-row' });
                    const playerName = p.name || p.fullName || 'Unknown';
                    if (p.id || p.playerId) {
                        const link = createElement('a', { className: 'player-link', href: '/nfl/player.html?id=' + (p.id || p.playerId), textContent: playerName });
                        row.appendChild(link);
                    } else {
                        row.appendChild(createElement('span', { className: 'player-name', textContent: playerName }));
                    }
                    row.appendChild(createElement('span', { className: 'player-position', textContent: p.position || '' }));
                    homeCard.appendChild(row);
                });
            }
            grid.appendChild(homeCard);

            container.appendChild(grid);
            container.appendChild(createElement('div', { className: 'data-source', textContent: 'Source: ' + (data.source || 'Highlightly') + ' • ' + (data.fetchedAt || new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' })) }));
        }

        function renderOdds(data) {
            const container = document.getElementById('odds-content');
            container.textContent = '';

            if (data.error) {
                container.appendChild(createElement('div', { className: 'error-message', textContent: data.error }));
                return;
            }

            const books = data.bookmakers || data.odds || [];

            if (!books.length) {
                container.appendChild(createElement('div', { className: 'error-message', textContent: 'No odds available for this game.' }));
                return;
            }

            // Find best lines across all sportsbooks
            let bestSpread = null, bestML = null, bestTotal = null;
            books.forEach(book => {
                const spread = parseFloat(book.spread);
                const ml = parseFloat(book.moneyline || book.homeMoneyline);
                const total = parseFloat(book.total || book.overUnder);

                if (!isNaN(spread) && (bestSpread === null || spread < bestSpread)) bestSpread = spread;
                if (!isNaN(ml) && (bestML === null || ml > bestML)) bestML = ml;
                if (!isNaN(total) && (bestTotal === null || total > bestTotal)) bestTotal = total;
            });

            // Table wrapper
            const wrapper = createElement('div', { className: 'odds-table-wrapper' });
            const table = createElement('table', { className: 'odds-table' });

            // Header
            const thead = createElement('thead');
            const headerRow = createElement('tr');
            headerRow.appendChild(createElement('th', { textContent: 'Sportsbook' }));
            headerRow.appendChild(createElement('th', { textContent: 'Spread' }));
            headerRow.appendChild(createElement('th', { textContent: 'Moneyline' }));
            headerRow.appendChild(createElement('th', { textContent: 'O/U Total' }));
            thead.appendChild(headerRow);
            table.appendChild(thead);

            // Body
            const tbody = createElement('tbody');
            books.slice(0, 8).forEach(book => {
                const row = createElement('tr');

                // Sportsbook name
                row.appendChild(createElement('td', { textContent: book.name || book.bookmaker || 'Sportsbook' }));

                // Spread
                const spreadVal = book.spread;
                const spreadNum = parseFloat(spreadVal);
                const spreadCell = createElement('td');
                if (spreadVal !== undefined && spreadVal !== null) {
                    const spreadText = spreadNum > 0 ? '+' + spreadVal : String(spreadVal);
                    const isBestSpread = !isNaN(spreadNum) && spreadNum === bestSpread;
                    const spanClass = 'odds-cell' + (isBestSpread ? ' best-line' : '');
                    const span = createElement('span', { className: spanClass, textContent: spreadText });
                    spreadCell.appendChild(span);
                    if (isBestSpread) {
                        spreadCell.appendChild(createElement('span', { className: 'best-odds-badge', textContent: 'Best' }));
                    }
                } else {
                    spreadCell.textContent = '-';
                }
                row.appendChild(spreadCell);

                // Moneyline
                const mlVal = book.moneyline || book.homeMoneyline;
                const mlNum = parseFloat(mlVal);
                const mlCell = createElement('td');
                if (mlVal !== undefined && mlVal !== null) {
                    const mlText = mlNum > 0 ? '+' + mlVal : String(mlVal);
                    const isBestML = !isNaN(mlNum) && mlNum === bestML;
                    const spanClass = 'odds-cell' + (isBestML ? ' best-line' : '') + (mlNum > 0 ? ' odds-positive' : ' odds-negative');
                    const span = createElement('span', { className: spanClass, textContent: mlText });
                    mlCell.appendChild(span);
                    if (isBestML) {
                        mlCell.appendChild(createElement('span', { className: 'best-odds-badge', textContent: 'Best' }));
                    }
                } else {
                    mlCell.textContent = '-';
                }
                row.appendChild(mlCell);

                // Total
                const totalVal = book.total || book.overUnder;
                const totalNum = parseFloat(totalVal);
                const totalCell = createElement('td');
                if (totalVal !== undefined && totalVal !== null) {
                    const isBestTotal = !isNaN(totalNum) && totalNum === bestTotal;
                    const spanClass = 'odds-cell' + (isBestTotal ? ' best-line' : '');
                    const span = createElement('span', { className: spanClass, textContent: 'O/U ' + totalVal });
                    totalCell.appendChild(span);
                    if (isBestTotal) {
                        totalCell.appendChild(createElement('span', { className: 'best-odds-badge', textContent: 'Best' }));
                    }
                } else {
                    totalCell.textContent = '-';
                }
                row.appendChild(totalCell);

                tbody.appendChild(row);
            });
            table.appendChild(tbody);

            wrapper.appendChild(table);
            container.appendChild(wrapper);
            container.appendChild(createElement('div', { className: 'data-source', textContent: 'Source: ' + (data.source || 'Highlightly') + ' • ' + (data.fetchedAt || new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' })) }));
        }

        function renderH2H(data, matchData) {
            const container = document.getElementById('h2h-content');
            container.textContent = '';

            if (data.error) {
                container.appendChild(createElement('div', { className: 'error-message', textContent: data.error }));
                return;
            }

            const games = data.games || data.matches || [];
            const homeTeam = matchData?.homeTeam || {};
            const awayTeam = matchData?.awayTeam || {};

            let homeWins = 0, awayWins = 0, draws = 0;
            games.forEach(g => {
                const hScore = g.homeScore !== undefined ? g.homeScore : (g.home?.score || 0);
                const aScore = g.awayScore !== undefined ? g.awayScore : (g.away?.score || 0);
                if (hScore > aScore) homeWins++;
                else if (aScore > hScore) awayWins++;
                else draws++;
            });

            const summary = createElement('div', { className: 'h2h-summary' });
            const awayStat = createElement('div', { className: 'h2h-stat' });
            awayStat.appendChild(createElement('div', { className: 'h2h-value', textContent: String(awayWins) }));
            awayStat.appendChild(createElement('div', { className: 'h2h-label', textContent: (awayTeam.name || 'Away') + ' Wins' }));
            summary.appendChild(awayStat);

            const drawStat = createElement('div', { className: 'h2h-stat' });
            drawStat.appendChild(createElement('div', { className: 'h2h-value', textContent: String(draws) }));
            drawStat.appendChild(createElement('div', { className: 'h2h-label', textContent: 'Draws' }));
            summary.appendChild(drawStat);

            const homeStat = createElement('div', { className: 'h2h-stat' });
            homeStat.appendChild(createElement('div', { className: 'h2h-value', textContent: String(homeWins) }));
            homeStat.appendChild(createElement('div', { className: 'h2h-label', textContent: (homeTeam.name || 'Home') + ' Wins' }));
            summary.appendChild(homeStat);

            container.appendChild(summary);

            // Games list
            const gamesDiv = createElement('div', { className: 'h2h-games' });
            gamesDiv.appendChild(createElement('h3', { style: 'margin-bottom: 1rem', textContent: 'Last ' + games.length + ' Meetings' }));

            games.slice(0, 10).forEach(g => {
                const hScore = g.homeScore !== undefined ? g.homeScore : (g.home?.score || 0);
                const aScore = g.awayScore !== undefined ? g.awayScore : (g.away?.score || 0);
                const winner = hScore > aScore ? 'home' : (aScore > hScore ? 'away' : 'draw');
                const dateStr = g.date ? new Date(g.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '';

                const gameRow = createElement('div', { className: 'h2h-game' });
                gameRow.appendChild(createElement('span', { className: 'h2h-date', textContent: dateStr }));

                const result = createElement('span', { className: 'h2h-result' });
                const awaySpan = createElement('span', { className: winner === 'away' ? 'h2h-winner' : 'h2h-loser', textContent: (g.away?.name || awayTeam.abbreviation || 'Away') + ' ' + aScore });
                result.appendChild(awaySpan);
                result.appendChild(createElement('span', { style: 'color: var(--bsi-muted)', textContent: ' @ ' }));
                const homeSpan = createElement('span', { className: winner === 'home' ? 'h2h-winner' : 'h2h-loser', textContent: (g.home?.name || homeTeam.abbreviation || 'Home') + ' ' + hScore });
                result.appendChild(homeSpan);

                gameRow.appendChild(result);
                gamesDiv.appendChild(gameRow);
            });

            container.appendChild(gamesDiv);
            container.appendChild(createElement('div', { className: 'data-source', textContent: 'Source: ' + (data.source || 'Highlightly') + ' • ' + (data.fetchedAt || new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' })) }));
        }

        function renderHighlights(data, matchData) {
            const container = document.getElementById('highlights-content');
            container.textContent = '';

            if (data.error) {
                container.appendChild(createElement('div', { className: 'error-message', textContent: data.error }));
                return;
            }

            const highlights = data.highlights || [];

            if (!highlights.length) {
                const noHighlights = createElement('div', { className: 'no-highlights' });
                noHighlights.appendChild(createElement('p', { textContent: 'No highlights available for this game yet.' }));
                noHighlights.appendChild(createElement('p', { style: 'font-size: 0.9rem', textContent: 'Highlights are added during and after live games.' }));
                container.appendChild(noHighlights);
                return;
            }

            const grid = createElement('div', { className: 'highlights-grid' });

            highlights.slice(0, 12).forEach(highlight => {
                const card = createElement('div', { className: 'highlight-card' });

                // Video or thumbnail
                const videoUrl = highlight.video || highlight.videoUrl || highlight.url;
                const thumbUrl = highlight.thumbnail || highlight.image;

                if (videoUrl && videoUrl.endsWith('.mp4')) {
                    // Native video
                    const video = createElement('video', { className: 'highlight-video', controls: 'controls' });
                    video.setAttribute('poster', thumbUrl || '');
                    const source = createElement('source', { src: videoUrl, type: 'video/mp4' });
                    video.appendChild(source);
                    card.appendChild(video);
                } else if (thumbUrl) {
                    // Thumbnail with external link
                    if (videoUrl) {
                        const link = createElement('a', { href: videoUrl, target: '_blank', rel: 'noopener noreferrer' });
                        link.appendChild(createElement('img', { className: 'highlight-thumb', src: thumbUrl, alt: highlight.title || 'Highlight' }));
                        card.appendChild(link);
                    } else {
                        card.appendChild(createElement('img', { className: 'highlight-thumb', src: thumbUrl, alt: highlight.title || 'Highlight' }));
                    }
                }

                // Info section
                const info = createElement('div', { className: 'highlight-info' });

                if (highlight.title) {
                    info.appendChild(createElement('div', { className: 'highlight-title', textContent: highlight.title }));
                }

                if (highlight.description) {
                    const desc = createElement('div', { className: 'highlight-desc', textContent: highlight.description });
                    info.appendChild(desc);
                }

                const meta = createElement('div', { className: 'highlight-meta' });
                if (highlight.duration) {
                    meta.appendChild(createElement('span', { className: 'highlight-duration', textContent: highlight.duration }));
                }
                if (highlight.time || highlight.timestamp) {
                    meta.appendChild(createElement('span', { textContent: highlight.time || highlight.timestamp }));
                }
                if (meta.children.length > 0) {
                    info.appendChild(meta);
                }

                card.appendChild(info);
                grid.appendChild(card);
            });

            container.appendChild(grid);
            container.appendChild(createElement('div', { className: 'data-source', textContent: 'Source: ' + (data.source || 'Highlightly') + ' • ' + (data.fetchedAt || new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' })) }));
        }

        // Initialize
        loadGameData();
    </script>
<script>if("serviceWorker" in navigator){navigator.serviceWorker.register("/sw.js").catch(console.error);}</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Conference Transfer Analytics - See where college baseball talent is flowing. Track conference-level portal entries, commits, and net transfer balance.">
  <meta name="keywords" content="college baseball conference transfers, SEC transfers, Big 12 baseball, ACC recruiting, conference analytics">
  <meta name="author" content="Blaze Sports Intel">
  <meta property="og:title" content="Conference Transfer Analytics | Blaze Sports Intel">
  <meta property="og:description" content="See where the talent is flowing. Conference-level transfer portal analytics for D1 college baseball.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://blazesportsintel.com/conference-analytics">
  <meta property="og:image" content="https://blazesportsintel.com/images/og-conference-analytics.png">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="canonical" href="https://blazesportsintel.com/conference-analytics">
  <title>Conference Transfer Analytics | Blaze Sports Intel</title>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Conference Transfer Analytics",
    "url": "https://blazesportsintel.com/conference-analytics",
    "description": "Conference-level transfer portal analytics for D1 college baseball. Track entries, commits, and net transfer balance by conference.",
    "applicationCategory": "SportsApplication",
    "operatingSystem": "All",
    "creator": {
      "@type": "Organization",
      "name": "Blaze Sports Intel",
      "url": "https://blazesportsintel.com"
    }
  }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Source+Serif+4:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">

  <style>
    :root {
      --bsi-burnt-orange: #BF5700;
      --bsi-texas-soil: #8B4513;
      --bsi-charcoal: #1A1A1A;
      --bsi-midnight: #0D0D0D;
      --bsi-cream: #FAF8F5;
      --bsi-warm-white: #FAFAFA;
      --bsi-ember: #FF6B35;
      --bsi-gold: #C9A227;
      --bsi-success: #2E7D32;
      --bsi-warning: #F9A825;
      --bsi-error: #C62828;
      --bsi-info: #1976D2;
      --font-display: 'Playfair Display', Georgia, serif;
      --font-body: 'Source Serif 4', Georgia, serif;
      --font-ui: 'IBM Plex Sans', 'Helvetica Neue', sans-serif;
      --font-mono: 'IBM Plex Mono', monospace;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: var(--font-body);
      font-size: 1rem;
      line-height: 1.6;
      color: var(--bsi-warm-white);
      background: var(--bsi-midnight);
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }
    a { color: inherit; text-decoration: none; }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      padding: 1rem 2rem;
      background: rgba(13, 13, 13, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(191, 87, 0, 0.2);
    }
    .header-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .logo {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--bsi-burnt-orange), var(--bsi-ember));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .nav { display: flex; gap: 2rem; align-items: center; }
    .nav a {
      font-family: var(--font-ui);
      font-size: 0.875rem;
      font-weight: 500;
      color: rgba(250, 248, 245, 0.8);
      transition: color 0.2s;
    }
    .nav a:hover { color: var(--bsi-burnt-orange); }
    .nav a.active { color: var(--bsi-burnt-orange); }

    /* Page Header */
    .page-header {
      padding: 7rem 2rem 2rem;
      background: linear-gradient(180deg, var(--bsi-midnight) 0%, var(--bsi-charcoal) 100%);
    }
    .page-header-inner {
      max-width: 1400px;
      margin: 0 auto;
    }
    .page-header h1 {
      font-family: var(--font-display);
      font-size: clamp(1.75rem, 4vw, 2.5rem);
      margin-bottom: 0.5rem;
    }
    .page-header p {
      color: rgba(250, 248, 245, 0.7);
      font-size: 1rem;
      max-width: 600px;
    }

    /* Summary Stats */
    .stats-bar {
      display: flex;
      gap: 2rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }
    .stat-item {
      display: flex;
      flex-direction: column;
    }
    .stat-value {
      font-family: var(--font-display);
      font-size: 2rem;
      font-weight: 700;
      color: var(--bsi-gold);
    }
    .stat-label {
      font-family: var(--font-ui);
      font-size: 0.75rem;
      color: rgba(250, 248, 245, 0.6);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Main Content */
    .main-content {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Time Filter */
    .time-filter {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    .time-btn {
      font-family: var(--font-ui);
      font-size: 0.875rem;
      font-weight: 500;
      padding: 0.5rem 1rem;
      background: var(--bsi-charcoal);
      border: 1px solid rgba(191, 87, 0, 0.3);
      border-radius: 6px;
      color: rgba(250, 248, 245, 0.7);
      cursor: pointer;
      transition: all 0.2s;
    }
    .time-btn:hover {
      border-color: var(--bsi-burnt-orange);
      color: var(--bsi-burnt-orange);
    }
    .time-btn.active {
      background: var(--bsi-burnt-orange);
      border-color: var(--bsi-burnt-orange);
      color: white;
    }

    /* Section Title */
    .section-title {
      font-family: var(--font-display);
      font-size: 1.5rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .section-title svg {
      width: 24px;
      height: 24px;
      color: var(--bsi-burnt-orange);
    }

    /* Bar Chart */
    .chart-section {
      margin-bottom: 3rem;
    }
    .bar-chart {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .bar-row {
      display: grid;
      grid-template-columns: 100px 1fr 60px;
      gap: 1rem;
      align-items: center;
    }
    .bar-label {
      font-family: var(--font-ui);
      font-size: 0.875rem;
      font-weight: 500;
      color: rgba(250, 248, 245, 0.9);
      text-align: right;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .bar-track {
      height: 28px;
      background: var(--bsi-charcoal);
      border-radius: 4px;
      position: relative;
      overflow: hidden;
    }
    .bar-fill {
      position: absolute;
      top: 0;
      height: 100%;
      border-radius: 4px;
      transition: width 0.5s ease-out;
    }
    .bar-fill.positive {
      left: 50%;
      background: linear-gradient(90deg, var(--bsi-success), #4CAF50);
    }
    .bar-fill.negative {
      right: 50%;
      background: linear-gradient(270deg, var(--bsi-error), #EF5350);
    }
    .bar-center-line {
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 2px;
      background: rgba(250, 248, 245, 0.3);
      transform: translateX(-50%);
    }
    .bar-value {
      font-family: var(--font-mono);
      font-size: 0.875rem;
      font-weight: 500;
      text-align: left;
    }
    .bar-value.positive { color: var(--bsi-success); }
    .bar-value.negative { color: var(--bsi-error); }
    .bar-value.neutral { color: rgba(250, 248, 245, 0.6); }

    /* Conference Table */
    .table-section {
      margin-bottom: 3rem;
    }
    .conference-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--bsi-charcoal);
      border-radius: 12px;
      overflow: hidden;
    }
    .conference-table th {
      font-family: var(--font-ui);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: rgba(250, 248, 245, 0.6);
      background: rgba(0, 0, 0, 0.3);
      padding: 1rem;
      text-align: left;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      transition: color 0.2s;
    }
    .conference-table th:hover {
      color: var(--bsi-burnt-orange);
    }
    .conference-table th.sorted {
      color: var(--bsi-burnt-orange);
    }
    .conference-table th .sort-icon {
      display: inline-block;
      margin-left: 0.25rem;
      opacity: 0.5;
    }
    .conference-table th.sorted .sort-icon {
      opacity: 1;
    }
    .conference-table td {
      font-family: var(--font-ui);
      font-size: 0.875rem;
      padding: 1rem;
      border-top: 1px solid rgba(191, 87, 0, 0.1);
    }
    .conference-table tbody tr {
      transition: background 0.2s;
    }
    .conference-table tbody tr:hover {
      background: rgba(191, 87, 0, 0.1);
    }
    .conf-name {
      font-weight: 600;
      color: var(--bsi-warm-white);
    }
    .conf-name a {
      color: inherit;
      text-decoration: none;
      transition: color 0.2s;
    }
    .conf-name a:hover {
      color: var(--bsi-burnt-orange);
    }
    .conf-badge {
      display: inline-block;
      font-size: 0.65rem;
      font-weight: 600;
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      margin-left: 0.5rem;
      text-transform: uppercase;
    }
    .conf-badge.power5 {
      background: rgba(201, 162, 39, 0.2);
      color: var(--bsi-gold);
    }
    .stat-positive {
      color: var(--bsi-success);
      font-weight: 600;
    }
    .stat-negative {
      color: var(--bsi-error);
      font-weight: 600;
    }
    .stat-neutral {
      color: rgba(250, 248, 245, 0.6);
    }
    .top-school {
      font-size: 0.8rem;
      color: rgba(250, 248, 245, 0.7);
    }
    .school-stat {
      margin-left: 0.25rem;
    }

    /* Responsive */
    @media (max-width: 900px) {
      .bar-row {
        grid-template-columns: 80px 1fr 50px;
      }
      .conference-table {
        display: block;
        overflow-x: auto;
      }
    }
    @media (max-width: 640px) {
      .header { padding: 1rem; }
      .nav { gap: 1rem; }
      .nav a { font-size: 0.75rem; }
      .page-header { padding: 6rem 1rem 1.5rem; }
      .main-content { padding: 1rem; }
      .stats-bar { gap: 1rem; }
      .stat-value { font-size: 1.5rem; }
      .bar-row {
        grid-template-columns: 60px 1fr 40px;
        gap: 0.5rem;
      }
      .bar-label { font-size: 0.75rem; }
    }

    /* Loading State */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 4rem 2rem;
      color: rgba(250, 248, 245, 0.6);
    }
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(191, 87, 0, 0.2);
      border-top-color: var(--bsi-burnt-orange);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .error-message {
      color: var(--bsi-error);
      text-align: center;
      padding: 2rem;
    }

    /* Footer Link */
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-family: var(--font-ui);
      font-size: 0.875rem;
      color: var(--bsi-burnt-orange);
      margin-top: 2rem;
      transition: opacity 0.2s;
    }
    .back-link:hover {
      opacity: 0.8;
    }
    .back-link svg {
      width: 16px;
      height: 16px;
    }
  </style>
  <!-- BSI Premium Enhancements - Micro-interactions & Visual Polish -->
  <link rel="stylesheet" href="../css/bsi-enhancements.css">
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="/" class="logo">Blaze Sports Intel</a>
      <nav class="nav">
        <a href="/college-baseball">College Baseball</a>
        <a href="/transfer-portal">Transfer Portal</a>
        <a href="/conference-analytics" class="active">Conference Analytics</a>
        <a href="/nil-valuation">NIL Calculator</a>
      </nav>
    </div>
  </header>

  <section class="page-header">
    <div class="page-header-inner">
      <h1>Conference Transfer Analytics</h1>
      <p>Where is the talent flowing? Track conference-level portal movement and see who's winning the transfer game.</p>
      <div class="stats-bar" id="summaryStats">
        <div class="stat-item">
          <span class="stat-value" id="totalEntries">--</span>
          <span class="stat-label">Total Entries</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="totalCommits">--</span>
          <span class="stat-label">Total Commits</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="activePortal">--</span>
          <span class="stat-label">Active in Portal</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="conferenceCount">--</span>
          <span class="stat-label">Conferences</span>
        </div>
      </div>
    </div>
  </section>

  <main class="main-content">
    <!-- Time Filter -->
    <div class="time-filter" id="timeFilter">
      <button class="time-btn" data-days="7">Last 7 Days</button>
      <button class="time-btn" data-days="30">Last 30 Days</button>
      <button class="time-btn active" data-days="all">All Time</button>
    </div>

    <!-- Bar Chart -->
    <section class="chart-section">
      <h2 class="section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="9" y1="9" x2="15" y2="9"></line>
          <line x1="9" y1="15" x2="15" y2="15"></line>
        </svg>
        Net Transfer Balance by Conference
      </h2>
      <div id="barChart" class="bar-chart">
        <div class="loading">
          <div class="loading-spinner"></div>
          <span>Loading conference data...</span>
        </div>
      </div>
    </section>

    <!-- Conference Table -->
    <section class="table-section">
      <h2 class="section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
          <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
          <line x1="12" y1="22.08" x2="12" y2="12"></line>
        </svg>
        Conference Breakdown
      </h2>
      <table class="conference-table" id="conferenceTable">
        <thead>
          <tr>
            <th data-sort="conference">Conference <span class="sort-icon">↕</span></th>
            <th data-sort="entries">Entries <span class="sort-icon">↕</span></th>
            <th data-sort="commitsIn">Commits In <span class="sort-icon">↕</span></th>
            <th data-sort="commitsOut">Commits Out <span class="sort-icon">↕</span></th>
            <th data-sort="net" class="sorted">Net <span class="sort-icon">↓</span></th>
            <th data-sort="topGainer">Top Gainer <span class="sort-icon">↕</span></th>
            <th data-sort="topLoser">Top Loser <span class="sort-icon">↕</span></th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <tr>
            <td colspan="7" class="loading">
              <div class="loading-spinner"></div>
              <span>Loading conference data...</span>
            </td>
          </tr>
        </tbody>
      </table>
    </section>

    <a href="/transfer-portal" class="back-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      Back to Transfer Portal Tracker
    </a>
  </main>

  <script>
    // Configuration
    const POWER_5_CONFERENCES = ['SEC', 'Big 12', 'ACC', 'Big Ten', 'Pac-12'];
    const API_URL = '/api/college-baseball/conference-flow';

    // State
    let conferenceData = [];
    let summaryData = {};
    let currentSort = { field: 'net', direction: 'desc' };
    let currentTimePeriod = 'all';

    // Safe DOM helpers
    function createElement(tag, className, textContent) {
      const el = document.createElement(tag);
      if (className) el.className = className;
      if (textContent !== undefined) el.textContent = textContent;
      return el;
    }

    function clearElement(el) {
      while (el.firstChild) {
        el.removeChild(el.firstChild);
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      loadConferenceData();
      setupTimeFilter();
      setupTableSort();
    });

    // Load conference flow data from server-side API
    async function loadConferenceData() {
      try {
        // Build URL with time filter
        let url = API_URL;
        if (currentTimePeriod !== 'all') {
          url += '?days=' + currentTimePeriod;
        }

        const response = await fetch(url);
        if (!response.ok) throw new Error('Failed to load conference data');
        const data = await response.json();

        // Store summary stats
        summaryData = data.summary || {};

        // Transform API response to UI format
        conferenceData = (data.conferences || []).map(function(conf) {
          return {
            conference: conf.conference,
            entries: conf.entries_out || 0,
            commitsIn: conf.commits_in || 0,
            commitsOut: conf.entries_out || 0,  // entries_out = players who left
            net: conf.net_flow || 0,
            topGainer: {
              name: conf.top_gainer_school || '-',
              count: conf.top_gainer_count || 0
            },
            topLoser: {
              name: conf.top_loser_school || '-',
              count: conf.top_loser_count || 0
            },
            isPower5: POWER_5_CONFERENCES.includes(conf.conference)
          };
        });

        // Filter out empty/unknown conferences
        conferenceData = conferenceData.filter(function(c) {
          return c.conference && c.conference !== 'Unknown' && c.conference !== '';
        });

        // Sort by current sort settings
        sortData();

        // Update UI
        updateSummaryStats();
        renderBarChart();
        renderTable();
      } catch (error) {
        console.error('Error loading conference data:', error);
        // Show error state
        const chartEl = document.getElementById('barChart');
        clearElement(chartEl);
        const errorP = createElement('p', 'error-message', 'Failed to load data. Please try again later.');
        chartEl.appendChild(errorP);

        const tableBody = document.getElementById('tableBody');
        clearElement(tableBody);
        const errorRow = createElement('tr');
        const errorCell = createElement('td', 'error-message', 'Failed to load data.');
        errorCell.setAttribute('colspan', '7');
        errorRow.appendChild(errorCell);
        tableBody.appendChild(errorRow);
      }
    }

    // Update summary statistics from server response
    function updateSummaryStats() {
      const totalEntries = summaryData.totalEntries || conferenceData.reduce(function(sum, c) { return sum + c.entries; }, 0);
      const totalCommits = summaryData.totalCommits || conferenceData.reduce(function(sum, c) { return sum + c.commitsIn; }, 0);
      const activePortal = summaryData.activeInPortal || (totalEntries - totalCommits);

      document.getElementById('totalEntries').textContent = totalEntries.toLocaleString();
      document.getElementById('totalCommits').textContent = totalCommits.toLocaleString();
      document.getElementById('activePortal').textContent = activePortal.toLocaleString();
      document.getElementById('conferenceCount').textContent = conferenceData.length;
    }

    // Render bar chart
    function renderBarChart() {
      const container = document.getElementById('barChart');
      clearElement(container);

      // Sort by net for chart
      const chartData = conferenceData.slice().sort(function(a, b) {
        return b.net - a.net;
      });
      const maxAbsNet = Math.max.apply(null, chartData.map(function(c) {
        return Math.abs(c.net);
      }).concat([1]));

      chartData.forEach(function(conf) {
        const row = createElement('div', 'bar-row');

        // Label
        const label = createElement('div', 'bar-label', conf.conference);
        row.appendChild(label);

        // Bar track
        const track = createElement('div', 'bar-track');

        // Center line
        const centerLine = createElement('div', 'bar-center-line');
        track.appendChild(centerLine);

        // Bar fill
        const fill = createElement('div', 'bar-fill');
        const widthPercent = (Math.abs(conf.net) / maxAbsNet) * 50;

        if (conf.net > 0) {
          fill.classList.add('positive');
          fill.style.width = widthPercent + '%';
        } else if (conf.net < 0) {
          fill.classList.add('negative');
          fill.style.width = widthPercent + '%';
        } else {
          fill.style.width = '0%';
        }
        track.appendChild(fill);
        row.appendChild(track);

        // Value
        const value = createElement('div', 'bar-value');
        if (conf.net > 0) {
          value.classList.add('positive');
          value.textContent = '+' + conf.net;
        } else if (conf.net < 0) {
          value.classList.add('negative');
          value.textContent = conf.net;
        } else {
          value.classList.add('neutral');
          value.textContent = '0';
        }
        row.appendChild(value);

        container.appendChild(row);
      });
    }

    // Render table
    function renderTable() {
      const tbody = document.getElementById('tableBody');
      clearElement(tbody);

      conferenceData.forEach(function(conf) {
        const row = createElement('tr');

        // Conference name
        const confCell = createElement('td', 'conf-name');
        const confLink = createElement('a');
        confLink.href = '/transfer-portal?conference=' + encodeURIComponent(conf.conference);
        confLink.textContent = conf.conference;
        confCell.appendChild(confLink);

        if (conf.isPower5) {
          const badge = createElement('span', 'conf-badge power5', 'P5');
          confCell.appendChild(badge);
        }
        row.appendChild(confCell);

        // Entries
        const entriesCell = createElement('td', '', conf.entries.toString());
        row.appendChild(entriesCell);

        // Commits In
        const inCell = createElement('td', '', conf.commitsIn.toString());
        if (conf.commitsIn > 0) inCell.classList.add('stat-positive');
        row.appendChild(inCell);

        // Commits Out
        const outCell = createElement('td', '', conf.commitsOut.toString());
        if (conf.commitsOut > 0) outCell.classList.add('stat-negative');
        row.appendChild(outCell);

        // Net
        const netCell = createElement('td');
        if (conf.net > 0) {
          netCell.textContent = '+' + conf.net;
          netCell.classList.add('stat-positive');
        } else if (conf.net < 0) {
          netCell.textContent = conf.net.toString();
          netCell.classList.add('stat-negative');
        } else {
          netCell.textContent = '0';
          netCell.classList.add('stat-neutral');
        }
        row.appendChild(netCell);

        // Top Gainer
        const gainerCell = createElement('td', 'top-school');
        if (conf.topGainer.count > 0) {
          gainerCell.appendChild(document.createTextNode(conf.topGainer.name + ' '));
          const gainerStat = createElement('span', 'school-stat stat-positive', '(+' + conf.topGainer.count + ')');
          gainerCell.appendChild(gainerStat);
        } else {
          gainerCell.textContent = '-';
        }
        row.appendChild(gainerCell);

        // Top Loser
        const loserCell = createElement('td', 'top-school');
        if (conf.topLoser.count > 0) {
          loserCell.appendChild(document.createTextNode(conf.topLoser.name + ' '));
          const loserStat = createElement('span', 'school-stat stat-negative', '(-' + conf.topLoser.count + ')');
          loserCell.appendChild(loserStat);
        } else {
          loserCell.textContent = '-';
        }
        row.appendChild(loserCell);

        tbody.appendChild(row);
      });
    }

    // Sort data
    function sortData() {
      conferenceData.sort(function(a, b) {
        var aVal, bVal;

        switch (currentSort.field) {
          case 'conference':
            aVal = a.conference;
            bVal = b.conference;
            break;
          case 'entries':
            aVal = a.entries;
            bVal = b.entries;
            break;
          case 'commitsIn':
            aVal = a.commitsIn;
            bVal = b.commitsIn;
            break;
          case 'commitsOut':
            aVal = a.commitsOut;
            bVal = b.commitsOut;
            break;
          case 'net':
            aVal = a.net;
            bVal = b.net;
            break;
          case 'topGainer':
            aVal = a.topGainer.count;
            bVal = b.topGainer.count;
            break;
          case 'topLoser':
            aVal = a.topLoser.count;
            bVal = b.topLoser.count;
            break;
          default:
            aVal = a.net;
            bVal = b.net;
        }

        if (typeof aVal === 'string') {
          var cmp = aVal.localeCompare(bVal);
          return currentSort.direction === 'asc' ? cmp : -cmp;
        }

        return currentSort.direction === 'asc' ? aVal - bVal : bVal - aVal;
      });
    }

    // Setup time filter
    function setupTimeFilter() {
      var buttons = document.querySelectorAll('.time-btn');
      buttons.forEach(function(btn) {
        btn.addEventListener('click', function() {
          buttons.forEach(function(b) { b.classList.remove('active'); });
          this.classList.add('active');
          currentTimePeriod = this.dataset.days;
          loadConferenceData();  // Re-fetch with new time filter
        });
      });
    }

    // Setup table sorting
    function setupTableSort() {
      var headers = document.querySelectorAll('.conference-table th[data-sort]');
      headers.forEach(function(th) {
        th.addEventListener('click', function() {
          var field = this.dataset.sort;

          // Update sort direction
          if (currentSort.field === field) {
            currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
          } else {
            currentSort.field = field;
            currentSort.direction = 'desc';
          }

          // Update header styling
          headers.forEach(function(h) {
            h.classList.remove('sorted');
            h.querySelector('.sort-icon').textContent = '↕';
          });
          this.classList.add('sorted');
          this.querySelector('.sort-icon').textContent = currentSort.direction === 'asc' ? '↑' : '↓';

          // Re-sort and render
          sortData();
          renderTable();
        });
      });
    }
  </script>
</body>
</html>

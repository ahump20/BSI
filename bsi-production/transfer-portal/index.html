<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="College Baseball Transfer Portal Tracker - Track portal entries, commitments, and player movements across D1 baseball.">
  <meta name="keywords" content="college baseball transfer portal, D1 baseball transfers, NCAA baseball portal, player commitments, baseball recruiting">
  <meta name="author" content="Blaze Sports Intel">
  <meta property="og:title" content="College Baseball Transfer Portal Tracker | Blaze Sports Intel">
  <meta property="og:description" content="Track portal entries, commitments, and player movements across D1 college baseball in real-time.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://blazesportsintel.com/transfer-portal">
  <meta property="og:image" content="https://blazesportsintel.com/images/og-transfer-portal.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="College Baseball Transfer Portal">
  <meta name="twitter:description" content="Real-time tracker for D1 baseball transfer portal entries and commitments">
  <link rel="canonical" href="https://blazesportsintel.com/transfer-portal">
  <title>Transfer Portal Tracker | Blaze Sports Intel</title>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "College Baseball Transfer Portal Tracker",
    "url": "https://blazesportsintel.com/transfer-portal",
    "description": "Real-time tracker for D1 college baseball transfer portal entries, commitments, and withdrawals. Filter by position, conference, and status.",
    "applicationCategory": "SportsApplication",
    "operatingSystem": "All",
    "browserRequirements": "Requires JavaScript",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "creator": {
      "@type": "Organization",
      "name": "Blaze Sports Intel",
      "url": "https://blazesportsintel.com",
      "logo": "https://blazesportsintel.com/images/bsi-logo.png"
    },
    "featureList": [
      "Real-time portal entry updates",
      "Commitment tracking",
      "Conference filtering (SEC, Big 12, ACC, etc.)",
      "Position filtering",
      "Status filtering (In Portal, Committed, Withdrawn)",
      "Previous stats display",
      "Source school and destination tracking",
      "Last 24 hours activity count"
    ],
    "about": {
      "@type": "Thing",
      "name": "NCAA Division I Baseball Transfer Portal"
    }
  }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Source+Serif+4:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">

  <style>
    :root {
      --bsi-burnt-orange: #BF5700;
      --bsi-texas-soil: #8B4513;
      --bsi-charcoal: #1A1A1A;
      --bsi-midnight: #0D0D0D;
      --bsi-cream: #FAF8F5;
      --bsi-warm-white: #FAFAFA;
      --bsi-ember: #FF6B35;
      --bsi-gold: #C9A227;
      --bsi-success: #2E7D32;
      --bsi-warning: #F9A825;
      --bsi-info: #1976D2;
      --font-display: 'Playfair Display', Georgia, serif;
      --font-body: 'Source Serif 4', Georgia, serif;
      --font-ui: 'IBM Plex Sans', 'Helvetica Neue', sans-serif;
      --font-mono: 'IBM Plex Mono', monospace;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: var(--font-body);
      font-size: 1rem;
      line-height: 1.6;
      color: var(--bsi-warm-white);
      background: var(--bsi-midnight);
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }
    a { color: inherit; text-decoration: none; }

    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      padding: 1rem 2rem;
      background: rgba(13, 13, 13, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(191, 87, 0, 0.2);
    }
    .header-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .logo {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--bsi-burnt-orange), var(--bsi-ember));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .nav { display: flex; gap: 2rem; align-items: center; }
    .nav a {
      font-family: var(--font-ui);
      font-size: 0.875rem;
      font-weight: 500;
      color: rgba(250, 248, 245, 0.8);
      transition: color 0.2s;
    }
    .nav a:hover { color: var(--bsi-burnt-orange); }

    .page-header {
      padding: 7rem 2rem 2rem;
      background: linear-gradient(180deg, var(--bsi-midnight) 0%, var(--bsi-charcoal) 100%);
    }
    .page-header-inner {
      max-width: 1400px;
      margin: 0 auto;
    }
    .page-header h1 {
      font-family: var(--font-display);
      font-size: clamp(1.75rem, 4vw, 2.5rem);
      margin-bottom: 0.5rem;
    }
    .page-header p {
      color: rgba(250, 248, 245, 0.7);
      font-size: 1rem;
      max-width: 600px;
    }

    .stats-bar {
      display: flex;
      gap: 2rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }
    .stat-item {
      display: flex;
      flex-direction: column;
    }
    .stat-value {
      font-family: var(--font-display);
      font-size: 2rem;
      font-weight: 700;
      color: var(--bsi-gold);
    }
    .stat-label {
      font-family: var(--font-ui);
      font-size: 0.75rem;
      color: rgba(250, 248, 245, 0.6);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .main-content {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    .filters-bar {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .search-box {
      flex: 1;
      min-width: 200px;
      position: relative;
    }
    .search-box input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      background: var(--bsi-charcoal);
      border: 1px solid rgba(191, 87, 0, 0.3);
      border-radius: 8px;
      color: var(--bsi-warm-white);
      font-family: var(--font-ui);
      font-size: 0.9375rem;
    }
    .search-box input:focus {
      outline: none;
      border-color: var(--bsi-burnt-orange);
    }
    .search-box::before {
      content: '';
      position: absolute;
      left: 0.875rem;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      background: rgba(250, 248, 245, 0.5);
      border-radius: 50%;
      border: 2px solid rgba(250, 248, 245, 0.5);
    }

    .filter-select {
      padding: 0.75rem 1rem;
      background: var(--bsi-charcoal);
      border: 1px solid rgba(191, 87, 0, 0.3);
      border-radius: 8px;
      color: var(--bsi-warm-white);
      font-family: var(--font-ui);
      font-size: 0.875rem;
      cursor: pointer;
      min-width: 150px;
    }
    .filter-select:focus {
      outline: none;
      border-color: var(--bsi-burnt-orange);
    }
    .clear-filters-btn {
      padding: 0.75rem 1rem;
      background: transparent;
      border: 1px solid rgba(198, 40, 40, 0.4);
      border-radius: 8px;
      color: #ef5350;
      font-family: var(--font-ui);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .clear-filters-btn:hover {
      background: rgba(198, 40, 40, 0.1);
      border-color: #ef5350;
    }
    .filter-count {
      font-family: var(--font-ui);
      font-size: 0.875rem;
      color: var(--bsi-gold);
      display: none;
      align-items: center;
    }
    .filter-count.active {
      display: flex;
    }

    .portal-table-container {
      background: var(--bsi-charcoal);
      border: 1px solid rgba(191, 87, 0, 0.2);
      border-radius: 16px;
      overflow: hidden;
    }

    .portal-table {
      width: 100%;
      border-collapse: collapse;
    }
    .portal-table th {
      padding: 1rem;
      text-align: left;
      font-family: var(--font-ui);
      font-size: 0.75rem;
      font-weight: 600;
      color: rgba(250, 248, 245, 0.6);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      background: rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(191, 87, 0, 0.2);
      cursor: pointer;
      user-select: none;
      transition: color 0.2s;
    }
    .portal-table th:hover {
      color: var(--bsi-burnt-orange);
    }
    .portal-table th.sorted {
      color: var(--bsi-burnt-orange);
    }
    .portal-table th .sort-arrow {
      margin-left: 0.25rem;
      opacity: 0.5;
    }
    .portal-table th.sorted .sort-arrow {
      opacity: 1;
    }

    .portal-table td {
      padding: 1rem;
      font-family: var(--font-ui);
      font-size: 0.875rem;
      border-bottom: 1px solid rgba(250, 248, 245, 0.05);
      vertical-align: middle;
    }
    .portal-table tbody tr {
      cursor: pointer;
      transition: background-color 0.15s ease;
    }
    .portal-table tbody tr:hover td {
      background: rgba(191, 87, 0, 0.1);
    }
    .portal-table tbody tr:active td {
      background: rgba(191, 87, 0, 0.15);
    }
    .portal-table tr:last-child td {
      border-bottom: none;
    }

    .player-cell {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .player-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--bsi-burnt-orange), var(--bsi-ember));
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-ui);
      font-size: 0.875rem;
      font-weight: 600;
      color: white;
      flex-shrink: 0;
    }
    .player-info {
      display: flex;
      flex-direction: column;
    }
    .player-name {
      font-weight: 600;
      color: var(--bsi-warm-white);
    }
    .player-meta {
      font-size: 0.75rem;
      color: rgba(250, 248, 245, 0.5);
    }
    .player-name {
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }
    .verified-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      background: var(--bsi-success);
      border-radius: 50%;
      color: white;
      flex-shrink: 0;
    }
    .verified-badge svg {
      width: 12px;
      height: 12px;
    }

    .position-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      background: rgba(191, 87, 0, 0.2);
      border-radius: 4px;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: var(--bsi-ember);
    }

    .school-cell {
      display: flex;
      flex-direction: column;
    }
    .school-name {
      font-weight: 500;
      color: var(--bsi-warm-white);
    }
    .school-conf {
      font-size: 0.75rem;
      color: rgba(250, 248, 245, 0.5);
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      border-radius: 20px;
      font-family: var(--font-ui);
      font-size: 0.75rem;
      font-weight: 500;
    }
    .status-badge.in-portal {
      background: rgba(249, 168, 37, 0.2);
      color: var(--bsi-warning);
    }
    .status-badge.committed {
      background: rgba(46, 125, 50, 0.2);
      color: var(--bsi-success);
    }
    .status-badge.withdrawn {
      background: rgba(198, 40, 40, 0.2);
      color: #ef5350;
    }
    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    .stats-cell {
      font-family: var(--font-mono);
      font-size: 0.8125rem;
      color: rgba(250, 248, 245, 0.8);
    }

    .date-cell {
      font-family: var(--font-mono);
      font-size: 0.8125rem;
      color: rgba(250, 248, 245, 0.6);
    }

    .destination-cell {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .destination-cell .arrow {
      color: var(--bsi-gold);
    }
    .school-logo {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      object-fit: contain;
      background: rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }
    .school-with-logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .pagination {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.2);
    }
    .pagination-info {
      font-family: var(--font-ui);
      font-size: 0.875rem;
      color: rgba(250, 248, 245, 0.6);
    }
    .pagination-buttons {
      display: flex;
      gap: 0.5rem;
    }
    .pagination-btn {
      padding: 0.5rem 1rem;
      background: rgba(191, 87, 0, 0.2);
      border: 1px solid rgba(191, 87, 0, 0.3);
      border-radius: 6px;
      color: var(--bsi-warm-white);
      font-family: var(--font-ui);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .pagination-btn:hover:not(:disabled) {
      background: var(--bsi-burnt-orange);
      border-color: var(--bsi-burnt-orange);
    }
    .pagination-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .empty-state {
      padding: 4rem 2rem;
      text-align: center;
    }
    .empty-state-title {
      font-family: var(--font-display);
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
    }
    .empty-state-text {
      color: rgba(250, 248, 245, 0.6);
      font-size: 0.9375rem;
    }

    .footer {
      padding: 2rem;
      text-align: center;
      border-top: 1px solid rgba(191, 87, 0, 0.2);
      margin-top: 3rem;
    }
    .footer p {
      color: rgba(250, 248, 245, 0.5);
      font-size: 0.875rem;
    }
    .footer .tagline {
      font-family: var(--font-display);
      font-style: italic;
      color: var(--bsi-burnt-orange);
      margin-top: 0.5rem;
    }

    .update-notice {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: rgba(25, 118, 210, 0.1);
      border: 1px solid rgba(25, 118, 210, 0.3);
      border-radius: 8px;
      margin-bottom: 1.5rem;
      font-family: var(--font-ui);
      font-size: 0.875rem;
      color: var(--bsi-info);
    }

    @media (max-width: 1024px) {
      .portal-table {
        display: block;
        overflow-x: auto;
      }
    }

    @media (max-width: 768px) {
      .nav { display: none; }
      .page-header { padding: 6rem 1rem 1.5rem; }
      .main-content { padding: 1rem; }
      .filters-bar { flex-direction: column; }
      .search-box { width: 100%; }
      .filter-select { width: 100%; }
      .stats-bar { gap: 1rem; }
      .stat-value { font-size: 1.5rem; }
    }

    /* Notification Subscribe Form */
    .subscribe-section {
      background: linear-gradient(135deg, rgba(191, 87, 0, 0.1), rgba(201, 162, 39, 0.05));
      border: 1px solid rgba(191, 87, 0, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    .subscribe-content {
      flex: 1;
      min-width: 250px;
    }
    .subscribe-title {
      font-family: var(--font-display);
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: var(--bsi-cream);
    }
    .subscribe-desc {
      font-family: var(--font-ui);
      font-size: 0.875rem;
      color: rgba(250, 248, 245, 0.7);
    }
    .subscribe-form {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-wrap: wrap;
    }
    .subscribe-input {
      padding: 0.75rem 1rem;
      background: var(--bsi-charcoal);
      border: 1px solid rgba(191, 87, 0, 0.3);
      border-radius: 8px;
      color: var(--bsi-warm-white);
      font-family: var(--font-ui);
      font-size: 0.9375rem;
      min-width: 250px;
    }
    .subscribe-input:focus {
      outline: none;
      border-color: var(--bsi-burnt-orange);
    }
    .subscribe-btn {
      padding: 0.75rem 1.5rem;
      background: var(--bsi-burnt-orange);
      color: white;
      border: none;
      border-radius: 8px;
      font-family: var(--font-ui);
      font-size: 0.9375rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    .subscribe-btn:hover {
      background: var(--bsi-ember);
    }
    .subscribe-btn:disabled {
      background: rgba(191, 87, 0, 0.5);
      cursor: not-allowed;
    }
    .subscribe-success {
      display: none;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: rgba(46, 125, 50, 0.1);
      border: 1px solid rgba(46, 125, 50, 0.3);
      border-radius: 8px;
      color: var(--bsi-success);
      font-family: var(--font-ui);
      font-size: 0.875rem;
    }
    .subscribe-success.show {
      display: flex;
    }
    .subscribe-error {
      display: none;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: rgba(198, 40, 40, 0.1);
      border: 1px solid rgba(198, 40, 40, 0.3);
      border-radius: 8px;
      color: #ef5350;
      font-family: var(--font-ui);
      font-size: 0.875rem;
    }
    .subscribe-error.show {
      display: flex;
    }

    @media (max-width: 768px) {
      .subscribe-section { flex-direction: column; align-items: stretch; }
      .subscribe-form { flex-direction: column; width: 100%; }
      .subscribe-input { width: 100%; min-width: 100%; }
      .subscribe-btn { width: 100%; }
    }

    /* Player Detail Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(4px);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    .modal-overlay.show {
      display: flex;
    }
    .modal {
      background: var(--bsi-charcoal);
      border: 1px solid rgba(191, 87, 0, 0.3);
      border-radius: 16px;
      width: 100%;
      max-width: 700px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 36px;
      height: 36px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 50%;
      color: var(--bsi-cream);
      font-size: 1.25rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
      z-index: 10;
    }
    .modal-close:hover {
      background: rgba(191, 87, 0, 0.3);
    }
    .modal-header {
      padding: 2rem 2rem 1rem;
      border-bottom: 1px solid rgba(191, 87, 0, 0.2);
    }
    .modal-player-info {
      display: flex;
      gap: 1.5rem;
      align-items: flex-start;
    }
    .modal-avatar {
      width: 80px;
      height: 80px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--bsi-burnt-orange), var(--bsi-ember));
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-display);
      font-size: 1.75rem;
      font-weight: 700;
      color: white;
      flex-shrink: 0;
    }
    .modal-player-details {
      flex: 1;
    }
    .modal-player-name {
      font-family: var(--font-display);
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }
    .modal-player-meta {
      font-family: var(--font-ui);
      font-size: 0.9375rem;
      color: rgba(250, 248, 245, 0.7);
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem 1rem;
    }
    .modal-player-meta span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    .modal-status-badge {
      display: inline-block;
      padding: 0.375rem 0.75rem;
      border-radius: 20px;
      font-family: var(--font-ui);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: 0.75rem;
    }
    .modal-status-badge.in-portal {
      background: rgba(249, 168, 37, 0.15);
      color: var(--bsi-warning);
    }
    .modal-status-badge.committed {
      background: rgba(46, 125, 50, 0.15);
      color: var(--bsi-success);
    }
    .modal-status-badge.withdrawn {
      background: rgba(158, 158, 158, 0.15);
      color: #9e9e9e;
    }
    .modal-body {
      padding: 1.5rem 2rem 2rem;
    }
    .modal-section {
      margin-bottom: 1.5rem;
    }
    .modal-section:last-child {
      margin-bottom: 0;
    }
    .modal-section-title {
      font-family: var(--font-ui);
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--bsi-burnt-orange);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 0.75rem;
    }
    .modal-transfer-flow {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
    }
    .modal-school {
      flex: 1;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }
    .modal-school-logo {
      width: 48px;
      height: 48px;
      object-fit: contain;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
    }
    .modal-school-name {
      font-family: var(--font-display);
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    .modal-school-conf {
      font-family: var(--font-ui);
      font-size: 0.8125rem;
      color: rgba(250, 248, 245, 0.6);
    }
    .modal-arrow {
      color: var(--bsi-burnt-orange);
      font-size: 1.5rem;
    }
    .modal-school-pending {
      color: rgba(250, 248, 245, 0.4);
      font-style: italic;
    }
    .modal-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
    }
    .modal-stat-item {
      padding: 1rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      text-align: center;
    }
    .modal-stat-value {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--bsi-gold);
    }
    .modal-stat-label {
      font-family: var(--font-ui);
      font-size: 0.75rem;
      color: rgba(250, 248, 245, 0.6);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .modal-bio-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem 2rem;
    }
    .modal-bio-item {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(191, 87, 0, 0.1);
    }
    .modal-bio-label {
      font-family: var(--font-ui);
      font-size: 0.875rem;
      color: rgba(250, 248, 245, 0.6);
    }
    .modal-bio-value {
      font-family: var(--font-ui);
      font-size: 0.875rem;
      font-weight: 500;
    }
    .modal-source {
      font-family: var(--font-ui);
      font-size: 0.8125rem;
      color: rgba(250, 248, 245, 0.5);
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(191, 87, 0, 0.1);
    }
    .modal-source a {
      color: var(--bsi-burnt-orange);
      text-decoration: underline;
    }
    @media (max-width: 600px) {
      .modal-header { padding: 1.5rem 1.5rem 1rem; }
      .modal-body { padding: 1rem 1.5rem 1.5rem; }
      .modal-player-info { flex-direction: column; align-items: center; text-align: center; }
      .modal-avatar { width: 64px; height: 64px; font-size: 1.5rem; }
      .modal-player-name { font-size: 1.5rem; }
      .modal-player-meta { justify-content: center; }
      .modal-transfer-flow { flex-direction: column; gap: 0.75rem; }
      .modal-arrow { transform: rotate(90deg); }
      .modal-bio-grid { grid-template-columns: 1fr; }
    }

    /* ========== ENHANCED FEATURES ========== */

    /* Watchlist Button */
    .watchlist-btn {
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0.25rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .watchlist-btn svg {
      width: 20px;
      height: 20px;
      fill: none;
      stroke: rgba(250, 248, 245, 0.4);
      stroke-width: 2;
      transition: all 0.2s;
    }
    .watchlist-btn:hover svg {
      stroke: var(--bsi-gold);
    }
    .watchlist-btn.active svg {
      fill: var(--bsi-gold);
      stroke: var(--bsi-gold);
    }
    .watchlist-count {
      background: var(--bsi-burnt-orange);
      color: white;
      font-size: 0.75rem;
      padding: 0.125rem 0.5rem;
      border-radius: 10px;
      margin-left: 0.5rem;
    }

    /* Quick Actions Bar */
    .quick-actions {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    .quick-action-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 1rem;
      background: rgba(191, 87, 0, 0.1);
      border: 1px solid rgba(191, 87, 0, 0.3);
      border-radius: 8px;
      color: var(--bsi-cream);
      font-family: var(--font-ui);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .quick-action-btn:hover {
      background: rgba(191, 87, 0, 0.2);
      border-color: var(--bsi-burnt-orange);
    }
    .quick-action-btn.active {
      background: var(--bsi-burnt-orange);
      color: white;
    }
    .quick-action-btn svg {
      width: 18px;
      height: 18px;
    }

    /* Player Image */
    .player-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--bsi-charcoal), var(--bsi-midnight));
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-ui);
      font-weight: 600;
      font-size: 0.875rem;
      color: var(--bsi-burnt-orange);
      flex-shrink: 0;
      overflow: hidden;
    }
    .player-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .modal-avatar-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }

    /* Trending Section */
    .trending-section {
      background: linear-gradient(135deg, rgba(191, 87, 0, 0.08) 0%, rgba(201, 162, 39, 0.05) 100%);
      border: 1px solid rgba(191, 87, 0, 0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    .trending-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .trending-title {
      font-family: var(--font-display);
      font-size: 1.25rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .trending-title .fire { color: var(--bsi-ember); }
    .trending-tabs {
      display: flex;
      gap: 0.5rem;
    }
    .trending-tab {
      padding: 0.375rem 0.75rem;
      border-radius: 6px;
      font-family: var(--font-ui);
      font-size: 0.8125rem;
      font-weight: 500;
      background: transparent;
      border: 1px solid rgba(191, 87, 0, 0.3);
      color: rgba(250, 248, 245, 0.7);
      cursor: pointer;
      transition: all 0.2s;
    }
    .trending-tab:hover { border-color: var(--bsi-burnt-orange); color: var(--bsi-cream); }
    .trending-tab.active { background: var(--bsi-burnt-orange); color: white; border-color: var(--bsi-burnt-orange); }
    .trending-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
    }
    .trending-card {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(191, 87, 0, 0.15);
      border-radius: 10px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    .trending-card:hover { border-color: var(--bsi-burnt-orange); transform: translateY(-2px); }
    .trending-rank {
      position: absolute;
      top: -8px;
      left: -8px;
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, var(--bsi-gold), var(--bsi-burnt-orange));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-ui);
      font-size: 0.75rem;
      font-weight: 700;
      color: white;
    }
    .trending-card-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .trending-card-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--bsi-charcoal);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: var(--bsi-burnt-orange);
      overflow: hidden;
    }
    .trending-card-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .trending-card-info { flex: 1; }
    .trending-card-name {
      font-family: var(--font-ui);
      font-weight: 600;
      font-size: 0.9375rem;
      margin-bottom: 0.125rem;
    }
    .trending-card-meta {
      font-family: var(--font-ui);
      font-size: 0.75rem;
      color: rgba(250, 248, 245, 0.6);
    }
    .trending-card-stats {
      display: flex;
      gap: 1rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(191, 87, 0, 0.1);
    }
    .trending-stat {
      text-align: center;
      flex: 1;
    }
    .trending-stat-value {
      font-family: var(--font-display);
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--bsi-gold);
    }
    .trending-stat-label {
      font-family: var(--font-ui);
      font-size: 0.6875rem;
      color: rgba(250, 248, 245, 0.5);
      text-transform: uppercase;
    }
    .trending-best-fit {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.75rem;
      padding: 0.5rem;
      background: rgba(46, 125, 50, 0.15);
      border-radius: 6px;
      font-size: 0.75rem;
    }
    .trending-best-fit-label { color: rgba(250, 248, 245, 0.6); }
    .trending-best-fit-school { color: #4CAF50; font-weight: 600; }
    .trending-best-fit-score { color: var(--bsi-gold); margin-left: auto; }

    /* Twitter/X Intelligence Feed */
    .intel-section {
      background: var(--bsi-charcoal);
      border: 1px solid rgba(191, 87, 0, 0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    .intel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .intel-title {
      font-family: var(--font-display);
      font-size: 1.25rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .intel-feed {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      max-height: 300px;
      overflow-y: auto;
    }
    .intel-item {
      display: flex;
      gap: 0.75rem;
      padding: 0.75rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      border-left: 3px solid var(--bsi-burnt-orange);
    }
    .intel-item.breaking { border-left-color: var(--bsi-gold); background: rgba(201, 162, 39, 0.1); }
    .intel-source {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--bsi-midnight);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .intel-content { flex: 1; }
    .intel-text {
      font-family: var(--font-ui);
      font-size: 0.875rem;
      line-height: 1.4;
      margin-bottom: 0.25rem;
    }
    .intel-text strong { color: var(--bsi-burnt-orange); }
    .intel-meta {
      font-family: var(--font-ui);
      font-size: 0.75rem;
      color: rgba(250, 248, 245, 0.5);
    }

    /* Portal Momentum Section */
    .momentum-section {
      background: linear-gradient(135deg, rgba(25, 118, 210, 0.08) 0%, rgba(191, 87, 0, 0.05) 100%);
      border: 1px solid rgba(25, 118, 210, 0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    .momentum-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .momentum-title {
      font-family: var(--font-display);
      font-size: 1.25rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--bsi-info);
    }
    .momentum-subtitle {
      font-family: var(--font-ui);
      font-size: 0.75rem;
      color: rgba(250, 248, 245, 0.5);
    }
    .momentum-content {
      display: grid;
      grid-template-columns: 1fr 200px;
      gap: 1.5rem;
    }
    .momentum-chart {
      display: flex;
      align-items: flex-end;
      gap: 4px;
      height: 80px;
      padding: 0.5rem 0;
    }
    .momentum-bar {
      flex: 1;
      background: linear-gradient(180deg, var(--bsi-info) 0%, rgba(25, 118, 210, 0.4) 100%);
      border-radius: 4px 4px 0 0;
      min-width: 20px;
      position: relative;
      transition: height 0.3s ease;
    }
    .momentum-bar.commits {
      background: linear-gradient(180deg, var(--bsi-success) 0%, rgba(46, 125, 50, 0.4) 100%);
    }
    .momentum-bar-label {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.625rem;
      color: rgba(250, 248, 245, 0.4);
      white-space: nowrap;
    }
    .momentum-stats {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .momentum-stat {
      display: flex;
      flex-direction: column;
      gap: 0.125rem;
    }
    .momentum-stat-label {
      font-family: var(--font-ui);
      font-size: 0.75rem;
      color: rgba(250, 248, 245, 0.5);
    }
    .momentum-stat-value {
      font-family: var(--font-mono);
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--bsi-warm-white);
    }
    .momentum-stat-trend {
      font-family: var(--font-ui);
      font-size: 0.75rem;
      font-weight: 500;
    }
    .momentum-stat-trend.up { color: var(--bsi-success); }
    .momentum-stat-trend.down { color: #C62828; }
    .momentum-stat-trend.flat { color: rgba(250, 248, 245, 0.5); }

    @media (max-width: 640px) {
      .momentum-content {
        grid-template-columns: 1fr;
      }
      .momentum-stats {
        flex-direction: row;
        justify-content: space-between;
      }
    }

    /* Best-Fit Analysis */
    .bestfit-modal {
      position: fixed;
      inset: 0;
      z-index: 1001;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.85);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }
    .bestfit-modal.show { opacity: 1; visibility: visible; }
    .bestfit-content {
      background: var(--bsi-charcoal);
      border: 1px solid rgba(191, 87, 0, 0.3);
      border-radius: 16px;
      width: 90%;
      max-width: 900px;
      max-height: 85vh;
      overflow-y: auto;
    }
    .bestfit-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(191, 87, 0, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .bestfit-title {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 600;
    }
    .bestfit-body { padding: 1.5rem; }
    .bestfit-player-summary {
      display: flex;
      gap: 1.5rem;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }
    .bestfit-matches {
      display: grid;
      gap: 1rem;
    }
    .bestfit-match {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(191, 87, 0, 0.15);
      border-radius: 10px;
      transition: all 0.2s;
    }
    .bestfit-match:hover { border-color: var(--bsi-burnt-orange); }
    .bestfit-match-rank {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--bsi-burnt-orange), var(--bsi-ember));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.125rem;
      flex-shrink: 0;
    }
    .bestfit-match-school {
      flex: 1;
    }
    .bestfit-match-name {
      font-family: var(--font-ui);
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.25rem;
    }
    .bestfit-match-reasons {
      font-family: var(--font-ui);
      font-size: 0.8125rem;
      color: rgba(250, 248, 245, 0.7);
    }
    .bestfit-match-score {
      text-align: right;
    }
    .bestfit-score-value {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--bsi-gold);
    }
    .bestfit-score-label {
      font-family: var(--font-ui);
      font-size: 0.6875rem;
      color: rgba(250, 248, 245, 0.5);
      text-transform: uppercase;
    }

    /* Share Link Toast */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--bsi-charcoal);
      border: 1px solid var(--bsi-burnt-orange);
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      font-family: var(--font-ui);
      font-size: 0.875rem;
      color: var(--bsi-cream);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      z-index: 9999;
    }
    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
      visibility: visible;
    }
  </style>
  <!-- BSI Premium Enhancements - Micro-interactions & Visual Polish -->
  <link rel="stylesheet" href="../css/bsi-enhancements.css">
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="/" class="logo">Blaze Sports Intel</a>
      <nav class="nav">
        <a href="/college-baseball">College Baseball</a>
        <a href="/mlb">MLB</a>
        <a href="/nfl">NFL</a>
        <a href="/tools">Tools</a>
        <a href="/login">Sign In</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="page-header">
      <div class="page-header-inner">
        <h1>Transfer Portal Tracker</h1>
        <p>Track D1 college baseball portal entries, commitments, and player movements in real-time.</p>

        <div class="stats-bar">
          <div class="stat-item">
            <span class="stat-value" id="totalInPortal">847</span>
            <span class="stat-label">In Portal</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="totalCommitted">412</span>
            <span class="stat-label">Committed</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="totalWithdrawn">63</span>
            <span class="stat-label">Withdrawn</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="last24Hours">28</span>
            <span class="stat-label">Last 24 Hours</span>
          </div>
        </div>
      </div>
    </section>

    <section class="main-content">
      <div class="update-notice">
        <span>i</span>
        <span>Data refreshes every 15 minutes. Last update: <span id="lastUpdate">Jan 8, 2025 2:45 PM CT</span></span>
      </div>

      <!-- Notification Subscribe Section -->
      <div class="subscribe-section" id="subscribeSection">
        <div class="subscribe-content">
          <h3 class="subscribe-title">Get Portal Alerts</h3>
          <p class="subscribe-desc">Be the first to know when new players enter the portal.</p>
        </div>
        <form class="subscribe-form" id="subscribeForm" onsubmit="handleSubscribe(event)">
          <input type="email" class="subscribe-input" id="subscribeEmail" placeholder="Enter your email" required>
          <button type="submit" class="subscribe-btn" id="subscribeBtn">Subscribe</button>
        </form>
        <div class="subscribe-success" id="subscribeSuccess">
          <span>&#10003;</span>
          <span>You're subscribed! Check your inbox for confirmation.</span>
        </div>
        <div class="subscribe-error" id="subscribeError">
          <span>!</span>
          <span id="subscribeErrorMsg">Something went wrong. Please try again.</span>
        </div>
      </div>

      <!-- Quick Actions Bar -->
      <div class="quick-actions" id="quickActions">
        <button class="quick-action-btn" id="watchlistToggle" onclick="toggleWatchlistView()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <span>My Watchlist</span>
          <span class="watchlist-count" id="watchlistCount">0</span>
        </button>
        <button class="quick-action-btn" id="shareFiltersBtn" onclick="shareCurrentFilters()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
            <polyline points="16 6 12 2 8 6"/>
            <line x1="12" y1="2" x2="12" y2="15"/>
          </svg>
          <span>Share Filters</span>
        </button>
        <a href="/conference-analytics" class="quick-action-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="20" x2="18" y2="10"/>
            <line x1="12" y1="20" x2="12" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="14"/>
          </svg>
          <span>Conference Analytics</span>
        </a>
        <a href="/nil-calculator" class="quick-action-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="1" x2="12" y2="23"/>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
          </svg>
          <span>NIL Calculator</span>
        </a>
      </div>

      <!-- Trending Portal Players Section -->
      <div class="trending-section" id="trendingSection">
        <div class="trending-header">
          <h2 class="trending-title"><span class="fire">ðŸ”¥</span> Trending Underdogs</h2>
          <div class="trending-tabs">
            <button class="trending-tab active" data-filter="all" onclick="filterTrending('all')">All</button>
            <button class="trending-tab" data-filter="pitchers" onclick="filterTrending('pitchers')">Pitchers</button>
            <button class="trending-tab" data-filter="hitters" onclick="filterTrending('hitters')">Hitters</button>
          </div>
        </div>
        <div class="trending-grid" id="trendingGrid">
          <!-- Populated by JavaScript -->
        </div>
      </div>

      <!-- Intel Feed Section -->
      <div class="intel-section" id="intelSection">
        <div class="intel-header">
          <h2 class="intel-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
            </svg>
            Portal Intelligence
          </h2>
        </div>
        <div class="intel-feed" id="intelFeed">
          <!-- Populated by JavaScript -->
        </div>
      </div>

      <!-- Portal Momentum Section -->
      <div class="momentum-section" id="momentumSection" style="display:none;">
        <div class="momentum-header">
          <h2 class="momentum-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
              <polyline points="17 6 23 6 23 12"/>
            </svg>
            Portal Momentum
          </h2>
          <span class="momentum-subtitle">7-Day Activity Trend</span>
        </div>
        <div class="momentum-content">
          <div class="momentum-chart" id="momentumChart">
            <!-- Populated by JavaScript -->
          </div>
          <div class="momentum-stats" id="momentumStats">
            <div class="momentum-stat">
              <span class="momentum-stat-label">Entries this week</span>
              <span class="momentum-stat-value" id="momentumEntries">--</span>
              <span class="momentum-stat-trend" id="momentumEntriesTrend"></span>
            </div>
            <div class="momentum-stat">
              <span class="momentum-stat-label">Commits this week</span>
              <span class="momentum-stat-value" id="momentumCommits">--</span>
              <span class="momentum-stat-trend" id="momentumCommitsTrend"></span>
            </div>
            <div class="momentum-stat">
              <span class="momentum-stat-label">Avg. days to commit</span>
              <span class="momentum-stat-value" id="momentumAvgDays">--</span>
            </div>
          </div>
        </div>
      </div>

      <div class="filters-bar">
        <div class="search-box">
          <input type="text" id="searchInput" placeholder="Search players, schools, or positions..." oninput="filterTable(); updateUrlParams();">
        </div>
        <select class="filter-select" id="statusFilter" onchange="filterTable(); updateUrlParams();">
          <option value="all">All Status</option>
          <option value="in-portal">In Portal</option>
          <option value="committed">Committed</option>
          <option value="withdrawn">Withdrawn</option>
        </select>
        <select class="filter-select" id="positionFilter" onchange="filterTable(); updateUrlParams();">
          <option value="all">All Positions</option>
          <optgroup label="Pitchers">
            <option value="RHP">RHP</option>
            <option value="LHP">LHP</option>
            <option value="CLS">Closer</option>
          </optgroup>
          <optgroup label="Infielders">
            <option value="C">Catcher</option>
            <option value="1B">First Base</option>
            <option value="2B">Second Base</option>
            <option value="SS">Shortstop</option>
            <option value="3B">Third Base</option>
          </optgroup>
          <optgroup label="Outfielders">
            <option value="OF">Outfielder</option>
            <option value="LF">Left Field</option>
            <option value="CF">Center Field</option>
            <option value="RF">Right Field</option>
          </optgroup>
          <optgroup label="Other">
            <option value="UTL">Utility</option>
            <option value="DH">DH</option>
          </optgroup>
        </select>
        <select class="filter-select" id="conferenceFilter" onchange="filterTable(); updateUrlParams();">
          <option value="all">All Conferences</option>
          <option value="SEC">SEC</option>
          <option value="ACC">ACC</option>
          <option value="Big 12">Big 12</option>
          <option value="Big Ten">Big Ten</option>
          <option value="Pac-12">Pac-12</option>
          <option value="AAC">AAC</option>
          <option value="Sun Belt">Sun Belt</option>
          <option value="C-USA">C-USA</option>
          <option value="MWC">Mountain West</option>
          <option value="WCC">WCC</option>
          <option value="A-10">Atlantic 10</option>
        </select>
        <button class="clear-filters-btn" id="clearFiltersBtn" onclick="clearFilters()">Clear</button>
        <span class="filter-count" id="filterCount"></span>
      </div>

      <div class="portal-table-container">
        <table class="portal-table">
          <thead>
            <tr>
              <th onclick="sortTable('name')">Player <span class="sort-arrow">â†•</span></th>
              <th onclick="sortTable('position')">Pos <span class="sort-arrow">â†•</span></th>
              <th onclick="sortTable('fromSchool')">From <span class="sort-arrow">â†•</span></th>
              <th onclick="sortTable('destination')">Destination <span class="sort-arrow">â†•</span></th>
              <th onclick="sortTable('status')">Status <span class="sort-arrow">â†•</span></th>
              <th onclick="sortTable('stats')">2024 Stats <span class="sort-arrow">â†•</span></th>
              <th onclick="sortTable('date')">Date <span class="sort-arrow">â†•</span></th>
            </tr>
          </thead>
          <tbody id="portalTableBody">
          </tbody>
        </table>
        <div class="pagination">
          <span class="pagination-info" id="paginationInfo">Showing 1-25 of 847 players</span>
          <div class="pagination-buttons">
            <button class="pagination-btn" id="prevBtn" onclick="prevPage()" disabled>Previous</button>
            <button class="pagination-btn" id="nextBtn" onclick="nextPage()">Next</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Player Detail Modal -->
  <div class="modal-overlay" id="playerModal" onclick="closeModalOnBackdrop(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeModal()">&times;</button>
      <div class="modal-header">
        <div class="modal-player-info">
          <div class="modal-avatar" id="modalAvatar">JD</div>
          <div class="modal-player-details">
            <h2 class="modal-player-name" id="modalName">Player Name</h2>
            <div class="modal-player-meta">
              <span id="modalPosition">RHP</span>
              <span id="modalYear">Sr.</span>
              <span id="modalHometown">Austin, TX</span>
            </div>
            <span class="modal-status-badge in-portal" id="modalStatus">In Portal</span>
          </div>
        </div>
      </div>
      <div class="modal-body">
        <div class="modal-section">
          <h3 class="modal-section-title">Transfer</h3>
          <div class="modal-transfer-flow">
            <div class="modal-school">
              <img class="modal-school-logo" id="modalFromLogo" alt="" style="display:none;">
              <div class="modal-school-name" id="modalFromSchool">Texas</div>
              <div class="modal-school-conf" id="modalFromConf">SEC</div>
            </div>
            <div class="modal-arrow">â†’</div>
            <div class="modal-school">
              <img class="modal-school-logo" id="modalToLogo" alt="" style="display:none;">
              <div class="modal-school-name modal-school-pending" id="modalToSchool">TBD</div>
              <div class="modal-school-conf" id="modalToConf"></div>
            </div>
          </div>
        </div>
        <div class="modal-section" id="modalStatsSection">
          <h3 class="modal-section-title">2024 Stats</h3>
          <div class="modal-stats-grid" id="modalStats"></div>
        </div>
        <div class="modal-section" id="modalBioSection">
          <h3 class="modal-section-title">Bio</h3>
          <div class="modal-bio-grid" id="modalBio"></div>
        </div>
        <div class="modal-source" id="modalSource"></div>
      </div>
    </div>
  </div>

  <!-- Best-Fit Analysis Modal -->
  <div class="bestfit-modal" id="bestfitModal" onclick="closeBestfitModal(event)">
    <div class="bestfit-content" onclick="event.stopPropagation()">
      <div class="bestfit-header">
        <h2 class="bestfit-title">Best-Fit Analysis</h2>
        <button class="modal-close" onclick="closeBestfitModal()">&times;</button>
      </div>
      <div class="bestfit-body">
        <div class="bestfit-player-summary" id="bestfitPlayerSummary">
          <!-- Player summary populated by JS -->
        </div>
        <h3 style="margin-bottom: 1rem; font-family: var(--font-ui); font-size: 0.875rem; color: var(--bsi-burnt-orange); text-transform: uppercase; letter-spacing: 0.1em;">Top University Matches</h3>
        <div class="bestfit-matches" id="bestfitMatches">
          <!-- Matches populated by JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast">Link copied to clipboard!</div>

  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-brand">
          <a href="/" class="logo">
            <img src="/images/bsi-logo-nav.png" alt="Blaze Sports Intel" class="logo-img">
          </a>
          <p>Born in Memphis. Rooted in Texas soil. Built for fans who care.</p>
          <div class="footer-values">
            <span>Courage</span>
            <span>â€¢</span>
            <span>Grit</span>
            <span>â€¢</span>
            <span>Leadership</span>
          </div>
        </div>
        <div class="footer-links">
          <h4>Platform</h4>
          <ul>
            <li><a href="/analytics">Live Analytics</a></li>
            <li><a href="/scores">Live Scores</a></li>
            <li><a href="/college-baseball">College Baseball</a></li>
            <li><a href="/tools">Tools</a></li>
          </ul>
        </div>
        <div class="footer-links">
          <h4>Coverage</h4>
          <ul>
            <li><a href="/college-baseball">College Baseball</a></li>
            <li><a href="/mlb">MLB</a></li>
            <li><a href="/nfl">NFL</a></li>
            <li><a href="/nba">NBA</a></li>
          </ul>
        </div>
        <div class="footer-links">
          <h4>Company</h4>
          <ul>
            <li><a href="/about">About</a></li>
            <li><a href="/pricing">Pricing</a></li>
            <li><a href="/contact">Contact</a></li>
            <li><a href="mailto:austin@blazesportsintel.com">Email Us</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2026 Blaze Sports Intel. Built on Cloudflare.</p>
        <p class="footer-tagline">Born to Blaze the Path Less Beaten</p>
        <div class="footer-legal">
          <a href="/privacy">Privacy</a>
          <a href="/terms">Terms</a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // Portal data loaded from API
    var portalData = [];
    var portalSummary = { total: 0, inPortal: 0, committed: 0, withdrawn: 0, last24Hours: 0 };
    var isLoading = true;

    // ESPN Team ID mapping for school logos
    var schoolLogoIds = {
      // SEC
      'Texas': 251, 'Texas A&M': 245, 'LSU': 99, 'Florida': 57, 'Georgia': 61, 'Tennessee': 2633,
      'Alabama': 333, 'Auburn': 2, 'Ole Miss': 145, 'Mississippi State': 344, 'Arkansas': 8,
      'Missouri': 142, 'South Carolina': 2579, 'Kentucky': 96, 'Vanderbilt': 238, 'Oklahoma': 201,
      // Big 12
      'TCU': 2628, 'Texas Tech': 2641, 'Baylor': 239, 'Oklahoma State': 197, 'West Virginia': 277,
      'Kansas': 2305, 'Kansas State': 2306, 'BYU': 252, 'UCF': 2116, 'Cincinnati': 2132,
      'Houston': 248, 'Arizona': 12, 'Arizona State': 9, 'Colorado': 38, 'Utah': 254,
      'Iowa State': 66,
      // ACC
      'Florida State': 52, 'Miami': 2390, 'Clemson': 228, 'North Carolina': 153, 'NC State': 152,
      'Duke': 150, 'Virginia': 258, 'Virginia Tech': 259, 'Wake Forest': 154, 'Louisville': 97,
      'Pittsburgh': 221, 'Georgia Tech': 59, 'Notre Dame': 87, 'Boston College': 103, 'Syracuse': 183,
      'Stanford': 24, 'California': 25, 'SMU': 2567,
      // Big Ten
      'Michigan': 130, 'Ohio State': 194, 'Penn State': 213, 'Maryland': 120, 'Rutgers': 164,
      'Indiana': 84, 'Illinois': 356, 'Northwestern': 77, 'Purdue': 2509, 'Michigan State': 127,
      'Iowa': 2294, 'Minnesota': 135, 'Nebraska': 158, 'Wisconsin': 275, 'Oregon': 2483,
      'Oregon State': 204, 'Washington': 264, 'UCLA': 26, 'USC': 30,
      // Pac-12 (remaining)
      'Washington State': 265,
      // AAC
      'Tulane': 2655, 'Memphis': 235, 'East Carolina': 151, 'Wichita State': 2724, 'USF': 58,
      'Charlotte': 2429, 'Rice': 242, 'UTSA': 2636, 'FAU': 2226, 'UAB': 5,
      // Sun Belt
      'Coastal Carolina': 324, 'Louisiana': 309, 'South Alabama': 6, 'Troy': 2653,
      'Arkansas State': 2032, 'Texas State': 326, 'Georgia Southern': 290, 'Georgia State': 2247,
      'Louisiana-Monroe': 2433, 'Southern Miss': 2572, 'Old Dominion': 295, 'Marshall': 276,
      'James Madison': 256, 'Appalachian State': 2026,
      // C-USA
      'Liberty': 2335, 'UTEP': 2638, 'New Mexico State': 166, 'Jacksonville State': 55,
      'Sam Houston': 2534, 'FIU': 2229, 'Middle Tennessee': 2393, 'Kennesaw State': 338,
      'Western Kentucky': 98, 'Louisiana Tech': 2348,
      // MWC
      'San Diego State': 21, 'UNLV': 2439, 'Fresno State': 278, 'Nevada': 2440, 'New Mexico': 167,
      'Air Force': 2005, 'San Jose State': 23,
      // WCC
      'Gonzaga': 2250, 'San Diego': 301, 'Santa Clara': 2541, 'Pepperdine': 2492, 'Loyola Marymount': 2350,
      'San Francisco': 2539, 'Portland': 2504, 'Pacific': 279,
      // A-10
      'VCU': 2670, 'Richmond': 257, 'George Mason': 2244, 'Dayton': 2168, 'Saint Louis': 139,
      "St. Joseph's": 2603, 'UMass': 113, 'Rhode Island': 227, 'George Washington': 45,
      'Davidson': 2166, 'La Salle': 2325, 'Fordham': 2230, 'Duquesne': 2184,
      // SEC/Big 12 overlap
      // Other notable programs
      'Dallas Baptist': 2167, 'Oregon': 2483, 'Cal State Fullerton': 2239, 'Long Beach State': 299,
      'UC Irvine': 300, 'UC Santa Barbara': 2540, 'Hawaii': 62, 'Connecticut': 41, 'Creighton': 156,
      'Xavier': 2752, 'Seton Hall': 2550, 'St. Johns': 2599, 'Villanova': 222, 'Butler': 2086,
      'Evansville': 339, 'Indiana State': 282, 'Southern Illinois': 2565, 'Bradley': 71,
      'Missouri State': 2623, 'Northern Illinois': 2459, 'Ball State': 2050, 'Central Michigan': 2117,
      'Eastern Michigan': 2199, 'Kent State': 2309, 'Ohio': 195, 'Toledo': 2649, 'Western Michigan': 2711,
      'Akron': 2006, 'Bowling Green': 189
    };

    function getSchoolLogoUrl(schoolName) {
      var teamId = schoolLogoIds[schoolName];
      if (teamId) {
        return 'https://a.espncdn.com/combiner/i?img=/i/teamlogos/ncaa/500/' + teamId + '.png&h=32&w=32';
      }
      return null;
    }

    var currentPage = 1;
    var itemsPerPage = 25;
    var filteredData = portalData.slice();
    var sortColumn = 'date';
    var sortDirection = 'desc';

    function getInitials(name) {
      var parts = name.split(' ');
      if (parts.length >= 2) {
        return parts[0].charAt(0) + parts[parts.length - 1].charAt(0);
      }
      return name.charAt(0);
    }

    function formatDate(dateStr) {
      var date = new Date(dateStr);
      var options = { month: 'short', day: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    }

    function getStatusClass(status) {
      if (status === 'in-portal') return 'in-portal';
      if (status === 'committed') return 'committed';
      if (status === 'withdrawn') return 'withdrawn';
      return '';
    }

    function getStatusLabel(status) {
      if (status === 'in-portal') return 'In Portal';
      if (status === 'committed') return 'Committed';
      if (status === 'withdrawn') return 'Withdrawn';
      return status;
    }

    function clearElement(el) {
      while (el.firstChild) {
        el.removeChild(el.firstChild);
      }
    }

    function renderTable() {
      var tbody = document.getElementById('portalTableBody');
      clearElement(tbody);

      var start = (currentPage - 1) * itemsPerPage;
      var end = Math.min(start + itemsPerPage, filteredData.length);
      var pageData = filteredData.slice(start, end);

      if (pageData.length === 0) {
        var emptyRow = document.createElement('tr');
        var emptyCell = document.createElement('td');
        emptyCell.colSpan = 7;

        var emptyDiv = document.createElement('div');
        emptyDiv.className = 'empty-state';

        var emptyTitle = document.createElement('h3');
        emptyTitle.className = 'empty-state-title';
        emptyTitle.textContent = 'No players found';

        var emptyText = document.createElement('p');
        emptyText.className = 'empty-state-text';
        emptyText.textContent = 'Try adjusting your filters or search terms.';

        emptyDiv.appendChild(emptyTitle);
        emptyDiv.appendChild(emptyText);
        emptyCell.appendChild(emptyDiv);
        emptyRow.appendChild(emptyCell);
        tbody.appendChild(emptyRow);
        return;
      }

      for (var i = 0; i < pageData.length; i++) {
        var player = pageData[i];
        var row = document.createElement('tr');
        row.style.cursor = 'pointer';
        row.setAttribute('data-player-index', i);
        (function(p) {
          row.addEventListener('click', function() {
            openModal(p);
          });
        })(player);

        // Player cell with school-colored avatar
        var playerCell = document.createElement('td');
        var playerDiv = document.createElement('div');
        playerDiv.className = 'player-cell';

        var avatar = document.createElement('div');
        avatar.className = 'player-avatar';

        // Apply school colors from API response
        if (player.avatar && player.avatar.fromColors) {
          var primaryColor = player.avatar.fromColors.primary || '#6B7280';
          var secondaryColor = player.avatar.fromColors.secondary || '#FFFFFF';
          avatar.style.background = primaryColor;
          avatar.style.color = secondaryColor;
          avatar.style.border = '2px solid ' + secondaryColor;
        }

        // Show headshot image if available, otherwise initials
        if (player.headshotUrl) {
          var headshotImg = document.createElement('img');
          headshotImg.src = player.headshotUrl;
          headshotImg.alt = player.name;
          headshotImg.onerror = function() {
            this.style.display = 'none';
            avatar.textContent = getInitials(player.name);
          };
          avatar.appendChild(headshotImg);
        } else {
          avatar.textContent = getInitials(player.name);
        }

        var info = document.createElement('div');
        info.className = 'player-info';

        var nameSpan = document.createElement('span');
        nameSpan.className = 'player-name';
        nameSpan.textContent = player.name;

        // Add verified badge if roster is verified
        if (player.verifiedRoster) {
          var verifiedBadge = document.createElement('span');
          verifiedBadge.className = 'verified-badge';
          verifiedBadge.title = 'Verified on official roster' + (player.verificationDate ? ' (' + player.verificationDate + ')' : '');
          verifiedBadge.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>';
          nameSpan.appendChild(verifiedBadge);
        }

        var metaSpan = document.createElement('span');
        metaSpan.className = 'player-meta';
        metaSpan.textContent = player.year;

        info.appendChild(nameSpan);
        info.appendChild(metaSpan);
        playerDiv.appendChild(avatar);
        playerDiv.appendChild(info);
        playerCell.appendChild(playerDiv);
        row.appendChild(playerCell);

        // Position cell
        var posCell = document.createElement('td');
        var posBadge = document.createElement('span');
        posBadge.className = 'position-badge';
        posBadge.textContent = player.position;
        posCell.appendChild(posBadge);
        row.appendChild(posCell);

        // From school cell
        var fromCell = document.createElement('td');
        var fromDiv = document.createElement('div');
        fromDiv.className = 'school-cell';

        var fromName = document.createElement('span');
        fromName.className = 'school-name';
        fromName.textContent = player.fromSchool;

        var fromConf = document.createElement('span');
        fromConf.className = 'school-conf';
        fromConf.textContent = player.fromConf;

        fromDiv.appendChild(fromName);
        fromDiv.appendChild(fromConf);
        fromCell.appendChild(fromDiv);
        row.appendChild(fromCell);

        // Destination cell
        var destCell = document.createElement('td');
        if (player.destination) {
          var destDiv = document.createElement('div');
          destDiv.className = 'destination-cell';

          var arrow = document.createElement('span');
          arrow.className = 'arrow';
          arrow.textContent = String.fromCharCode(8594); // â†’

          var destSchool = document.createElement('div');
          destSchool.className = 'school-cell school-with-logo';

          // Add school logo if available
          var logoUrl = getSchoolLogoUrl(player.destination);
          if (logoUrl) {
            var logo = document.createElement('img');
            logo.className = 'school-logo';
            logo.src = logoUrl;
            logo.alt = player.destination;
            logo.onerror = function() { this.style.display = 'none'; };
            destSchool.appendChild(logo);
          }

          var destInfo = document.createElement('div');
          destInfo.className = 'school-cell';

          var destName = document.createElement('span');
          destName.className = 'school-name';
          destName.textContent = player.destination;

          var destConf = document.createElement('span');
          destConf.className = 'school-conf';
          destConf.textContent = player.destConf;

          destInfo.appendChild(destName);
          destInfo.appendChild(destConf);
          destSchool.appendChild(destInfo);
          destDiv.appendChild(arrow);
          destDiv.appendChild(destSchool);
          destCell.appendChild(destDiv);
        } else {
          destCell.textContent = String.fromCharCode(8212); // â€”
          destCell.style.color = 'rgba(250, 248, 245, 0.4)';
        }
        row.appendChild(destCell);

        // Status cell
        var statusCell = document.createElement('td');
        var statusBadge = document.createElement('span');
        statusBadge.className = 'status-badge ' + getStatusClass(player.status);

        var statusDot = document.createElement('span');
        statusDot.className = 'status-dot';

        var statusText = document.createTextNode(getStatusLabel(player.status));

        statusBadge.appendChild(statusDot);
        statusBadge.appendChild(statusText);
        statusCell.appendChild(statusBadge);
        row.appendChild(statusCell);

        // Stats cell
        var statsCell = document.createElement('td');
        statsCell.className = 'stats-cell';
        statsCell.textContent = player.stats;
        row.appendChild(statsCell);

        // Date cell
        var dateCell = document.createElement('td');
        dateCell.className = 'date-cell';
        dateCell.textContent = formatDate(player.date);
        row.appendChild(dateCell);

        tbody.appendChild(row);
      }

      // Update pagination info
      document.getElementById('paginationInfo').textContent =
        'Showing ' + (start + 1) + '-' + end + ' of ' + filteredData.length + ' players';

      document.getElementById('prevBtn').disabled = currentPage === 1;
      document.getElementById('nextBtn').disabled = end >= filteredData.length;
    }

    function filterTable() {
      var search = document.getElementById('searchInput').value.toLowerCase();
      var statusFilter = document.getElementById('statusFilter').value;
      var positionFilter = document.getElementById('positionFilter').value;
      var conferenceFilter = document.getElementById('conferenceFilter').value;

      filteredData = portalData.filter(function(player) {
        // Search filter
        var matchesSearch = search === '' ||
          player.name.toLowerCase().indexOf(search) !== -1 ||
          player.fromSchool.toLowerCase().indexOf(search) !== -1 ||
          (player.destination && player.destination.toLowerCase().indexOf(search) !== -1) ||
          player.position.toLowerCase().indexOf(search) !== -1;

        // Status filter
        var matchesStatus = statusFilter === 'all' || player.status === statusFilter;

        // Position filter (handles combo positions like "1B/OF")
        var matchesPosition = positionFilter === 'all' ||
          player.position === positionFilter ||
          player.position.indexOf(positionFilter) !== -1;

        // Conference filter
        var matchesConference = conferenceFilter === 'all' ||
          player.fromConf === conferenceFilter ||
          player.destConf === conferenceFilter;

        return matchesSearch && matchesStatus && matchesPosition && matchesConference;
      });

      // Apply current sort
      sortData();

      currentPage = 1;
      renderTable();

      // Update stats
      updateStats();

      // Update filter count
      updateFilterCount();
    }

    function clearFilters() {
      document.getElementById('searchInput').value = '';
      document.getElementById('statusFilter').value = 'all';
      document.getElementById('positionFilter').value = 'all';
      document.getElementById('conferenceFilter').value = 'all';
      filterTable();
    }

    function updateFilterCount() {
      var filterCount = document.getElementById('filterCount');
      var search = document.getElementById('searchInput').value;
      var status = document.getElementById('statusFilter').value;
      var position = document.getElementById('positionFilter').value;
      var conference = document.getElementById('conferenceFilter').value;

      var activeFilters = 0;
      if (search !== '') activeFilters++;
      if (status !== 'all') activeFilters++;
      if (position !== 'all') activeFilters++;
      if (conference !== 'all') activeFilters++;

      if (activeFilters > 0 && filteredData.length !== portalData.length) {
        filterCount.textContent = filteredData.length + ' of ' + portalData.length + ' players';
        filterCount.classList.add('active');
      } else {
        filterCount.classList.remove('active');
      }
    }

    // Handle notification subscription
    async function handleSubscribe(event) {
      event.preventDefault();

      var emailInput = document.getElementById('subscribeEmail');
      var submitBtn = document.getElementById('subscribeBtn');
      var form = document.getElementById('subscribeForm');
      var successEl = document.getElementById('subscribeSuccess');
      var errorEl = document.getElementById('subscribeError');
      var errorMsg = document.getElementById('subscribeErrorMsg');

      var email = emailInput.value.trim();
      if (!email) return;

      // Disable button and show loading state
      submitBtn.disabled = true;
      submitBtn.textContent = 'Subscribing...';
      errorEl.classList.remove('show');
      successEl.classList.remove('show');

      try {
        var response = await fetch('/api/transfer-portal/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: email, frequency: 'instant' })
        });

        var data = await response.json();

        if (response.ok && data.success) {
          // Show success message
          form.style.display = 'none';
          successEl.classList.add('show');

          // Save to localStorage so we don't show form again
          localStorage.setItem('bsi_portal_subscribed', 'true');
        } else {
          throw new Error(data.message || 'Failed to subscribe');
        }
      } catch (err) {
        errorMsg.textContent = err.message || 'Something went wrong. Please try again.';
        errorEl.classList.add('show');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Subscribe';
      }
    }

    // Check if already subscribed
    function checkSubscriptionStatus() {
      if (localStorage.getItem('bsi_portal_subscribed') === 'true') {
        var section = document.getElementById('subscribeSection');
        if (section) {
          section.style.display = 'none';
        }
      }
    }

    // Check subscription status on load
    checkSubscriptionStatus();

    function sortTable(column) {
      if (sortColumn === column) {
        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        sortColumn = column;
        sortDirection = 'asc';
      }

      // Update header styles
      var headers = document.querySelectorAll('.portal-table th');
      for (var i = 0; i < headers.length; i++) {
        headers[i].classList.remove('sorted');
      }
      event.target.closest('th').classList.add('sorted');

      sortData();
      renderTable();
    }

    function sortData() {
      filteredData.sort(function(a, b) {
        var valA, valB;

        switch (sortColumn) {
          case 'name':
            valA = a.name.toLowerCase();
            valB = b.name.toLowerCase();
            break;
          case 'position':
            valA = a.position;
            valB = b.position;
            break;
          case 'fromSchool':
            valA = a.fromSchool.toLowerCase();
            valB = b.fromSchool.toLowerCase();
            break;
          case 'destination':
            valA = (a.destination || 'zzz').toLowerCase();
            valB = (b.destination || 'zzz').toLowerCase();
            break;
          case 'status':
            valA = a.status;
            valB = b.status;
            break;
          case 'stats':
            valA = a.stats;
            valB = b.stats;
            break;
          case 'date':
            valA = new Date(a.date).getTime();
            valB = new Date(b.date).getTime();
            break;
          default:
            return 0;
        }

        if (valA < valB) return sortDirection === 'asc' ? -1 : 1;
        if (valA > valB) return sortDirection === 'asc' ? 1 : -1;
        return 0;
      });
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        renderTable();
      }
    }

    function nextPage() {
      var maxPage = Math.ceil(filteredData.length / itemsPerPage);
      if (currentPage < maxPage) {
        currentPage++;
        renderTable();
      }
    }

    function updateStats() {
      // Use summary from API response
      document.getElementById('totalInPortal').textContent = portalSummary.inPortal;
      document.getElementById('totalCommitted').textContent = portalSummary.committed;
      document.getElementById('totalWithdrawn').textContent = portalSummary.withdrawn;
      document.getElementById('last24Hours').textContent = portalSummary.last24Hours;
    }

    // Update last update time
    function updateTimestamp(fetchedAt) {
      if (fetchedAt) {
        document.getElementById('lastUpdate').textContent = fetchedAt;
      } else {
        var now = new Date();
        var options = { month: 'short', day: 'numeric', year: 'numeric', hour: 'numeric', minute: '2-digit', timeZoneName: 'short' };
        document.getElementById('lastUpdate').textContent = now.toLocaleDateString('en-US', options);
      }
    }

    // Load portal data from API
    function loadPortalData() {
      isLoading = true;

      fetch('/api/college-baseball/transfer-portal')
        .then(function(response) {
          if (!response.ok) {
            throw new Error('Failed to load portal data');
          }
          return response.json();
        })
        .then(function(data) {
          portalData = data.players || [];
          portalSummary = data.summary || portalSummary;
          filteredData = portalData.slice();
          isLoading = false;

          updateTimestamp(data.fetchedAt);
          updateStats();
          sortData();
          renderTable();
        })
        .catch(function(error) {
          console.error('Error loading portal data:', error);
          isLoading = false;
          // Show error state in table
          var tbody = document.getElementById('portalTableBody');
          clearElement(tbody);
          var errorRow = document.createElement('tr');
          var errorCell = document.createElement('td');
          errorCell.colSpan = 7;
          var errorDiv = document.createElement('div');
          errorDiv.className = 'empty-state';
          var errorTitle = document.createElement('h3');
          errorTitle.className = 'empty-state-title';
          errorTitle.textContent = 'Unable to load data';
          var errorText = document.createElement('p');
          errorText.className = 'empty-state-text';
          errorText.textContent = 'Please refresh the page to try again.';
          errorDiv.appendChild(errorTitle);
          errorDiv.appendChild(errorText);
          errorCell.appendChild(errorDiv);
          errorRow.appendChild(errorCell);
          tbody.appendChild(errorRow);
        });
    }

    // Initialize - load data from API
    loadPortalData();

    // Load momentum/trend data
    loadMomentumData();

    function loadMomentumData() {
      fetch('/api/college-baseball/portal-momentum?days=7')
        .then(function(response) {
          if (!response.ok) {
            throw new Error('Failed to load momentum data');
          }
          return response.json();
        })
        .then(function(data) {
          if (data.snapshots && data.snapshots.length > 0) {
            renderMomentum(data);
          }
        })
        .catch(function(error) {
          console.error('Error loading momentum data:', error);
          // Keep momentum section hidden on error
        });
    }

    function renderMomentum(data) {
      var section = document.getElementById('momentumSection');
      var chart = document.getElementById('momentumChart');
      var snapshots = data.snapshots || [];

      if (snapshots.length === 0) {
        return; // Keep hidden if no data
      }

      // Show the section
      section.style.display = 'block';

      // Clear chart
      clearElement(chart);

      // Find max for scaling
      var maxEntries = Math.max.apply(null, snapshots.map(function(s) { return s.entries24h || 0; })) || 1;

      // Render bars for each day
      for (var i = 0; i < snapshots.length; i++) {
        var snapshot = snapshots[i];
        var entries = snapshot.entries24h || 0;
        var height = Math.max(4, (entries / maxEntries) * 100);

        var bar = document.createElement('div');
        bar.className = 'momentum-bar';
        bar.style.height = height + '%';
        bar.title = snapshot.date + ': ' + entries + ' entries';

        var label = document.createElement('span');
        label.className = 'momentum-bar-label';
        // Show abbreviated day
        var date = new Date(snapshot.date + 'T12:00:00');
        label.textContent = date.toLocaleDateString('en-US', { weekday: 'short' }).substring(0, 2);
        bar.appendChild(label);

        chart.appendChild(bar);
      }

      // Calculate weekly totals
      var weeklyEntries = snapshots.reduce(function(sum, s) { return sum + (s.entries24h || 0); }, 0);
      var weeklyCommits = snapshots.reduce(function(sum, s) { return sum + (s.commits24h || 0); }, 0);
      var lastAvgDays = snapshots.length > 0 && snapshots[snapshots.length - 1].avgDaysToCommit
        ? snapshots[snapshots.length - 1].avgDaysToCommit.toFixed(1)
        : '--';

      // Update stats
      document.getElementById('momentumEntries').textContent = weeklyEntries;
      document.getElementById('momentumCommits').textContent = weeklyCommits;
      document.getElementById('momentumAvgDays').textContent = lastAvgDays;

      // Update trends if available
      if (data.trends) {
        var entriesTrend = document.getElementById('momentumEntriesTrend');
        var commitsTrend = document.getElementById('momentumCommitsTrend');

        if (data.trends.entriesDirection) {
          entriesTrend.className = 'momentum-stat-trend ' + data.trends.entriesDirection;
          if (data.trends.entriesChange) {
            var prefix = data.trends.entriesDirection === 'up' ? '+' : '';
            entriesTrend.textContent = prefix + data.trends.entriesChange + '% vs prior week';
          }
        }

        if (data.trends.commitsDirection) {
          commitsTrend.className = 'momentum-stat-trend ' + data.trends.commitsDirection;
          if (data.trends.commitsChange) {
            var prefix = data.trends.commitsDirection === 'up' ? '+' : '';
            commitsTrend.textContent = prefix + data.trends.commitsChange + '% vs prior week';
          }
        }
      }
    }

    // ========== Modal Functions ==========

    function openModal(player) {
      var modal = document.getElementById('playerModal');

      // Set avatar with school colors
      var avatarEl = document.getElementById('modalAvatar');
      avatarEl.textContent = getInitials(player.name);

      // Apply school colors to modal avatar
      if (player.avatar && player.avatar.fromColors) {
        var primaryColor = player.avatar.fromColors.primary || '#6B7280';
        var secondaryColor = player.avatar.fromColors.secondary || '#FFFFFF';
        avatarEl.style.background = primaryColor;
        avatarEl.style.color = secondaryColor;
        avatarEl.style.border = '3px solid ' + secondaryColor;
      } else {
        // Reset to default
        avatarEl.style.background = '';
        avatarEl.style.color = '';
        avatarEl.style.border = '';
      }

      // Set player name and meta info
      document.getElementById('modalName').textContent = player.name;
      document.getElementById('modalPosition').textContent = player.position;
      document.getElementById('modalYear').textContent = player.year || '';
      document.getElementById('modalHometown').textContent = player.hometown || '';

      // Set status badge
      var statusBadge = document.getElementById('modalStatus');
      statusBadge.className = 'modal-status-badge ' + getStatusClass(player.status);
      statusBadge.textContent = getStatusLabel(player.status);

      // Set transfer flow with logos
      var fromSchoolEl = document.getElementById('modalFromSchool');
      fromSchoolEl.textContent = player.fromSchool;
      document.getElementById('modalFromConf').textContent = player.fromConf || '';

      // Add from school logo
      var fromLogoContainer = document.getElementById('modalFromLogo');
      if (fromLogoContainer) {
        var fromLogoUrl = getSchoolLogoUrl(player.fromSchool);
        if (fromLogoUrl) {
          fromLogoContainer.src = fromLogoUrl;
          fromLogoContainer.style.display = 'block';
        } else {
          fromLogoContainer.style.display = 'none';
        }
      }

      var toSchool = document.getElementById('modalToSchool');
      var toConf = document.getElementById('modalToConf');
      var toLogoContainer = document.getElementById('modalToLogo');

      if (player.destination) {
        toSchool.textContent = player.destination;
        toSchool.classList.remove('modal-school-pending');
        toConf.textContent = player.destConf || '';

        // Add destination school logo
        if (toLogoContainer) {
          var toLogoUrl = getSchoolLogoUrl(player.destination);
          if (toLogoUrl) {
            toLogoContainer.src = toLogoUrl;
            toLogoContainer.style.display = 'block';
          } else {
            toLogoContainer.style.display = 'none';
          }
        }
      } else {
        toSchool.textContent = 'TBD';
        toSchool.classList.add('modal-school-pending');
        toConf.textContent = '';
        if (toLogoContainer) {
          toLogoContainer.style.display = 'none';
        }
      }

      // Populate stats section
      var statsSection = document.getElementById('modalStatsSection');
      var statsGrid = document.getElementById('modalStats');
      clearElement(statsGrid);

      // Parse stats string to display meaningful data
      if (player.stats && player.stats !== 'â€”') {
        statsSection.style.display = 'block';
        var statParts = parseStatsString(player.stats, player.position);

        for (var i = 0; i < statParts.length; i++) {
          var statItem = document.createElement('div');
          statItem.className = 'modal-stat-item';

          var statValue = document.createElement('div');
          statValue.className = 'modal-stat-value';
          statValue.textContent = statParts[i].value;

          var statLabel = document.createElement('div');
          statLabel.className = 'modal-stat-label';
          statLabel.textContent = statParts[i].label;

          statItem.appendChild(statValue);
          statItem.appendChild(statLabel);
          statsGrid.appendChild(statItem);
        }
      } else {
        statsSection.style.display = 'none';
      }

      // Populate bio section
      var bioSection = document.getElementById('modalBioSection');
      var bioGrid = document.getElementById('modalBio');
      clearElement(bioGrid);

      var bioItems = [];
      if (player.position) bioItems.push({ label: 'Position', value: player.position });
      if (player.year) bioItems.push({ label: 'Year', value: player.year });
      if (player.height) bioItems.push({ label: 'Height', value: player.height });
      if (player.weight) bioItems.push({ label: 'Weight', value: player.weight + ' lbs' });
      if (player.hometown) bioItems.push({ label: 'Hometown', value: player.hometown });
      if (player.bats) bioItems.push({ label: 'Bats', value: player.bats });
      if (player.throws) bioItems.push({ label: 'Throws', value: player.throws });
      if (player.date) bioItems.push({ label: 'Portal Entry', value: formatDate(player.date) });

      if (bioItems.length > 0) {
        bioSection.style.display = 'block';
        for (var j = 0; j < bioItems.length; j++) {
          var bioItem = document.createElement('div');
          bioItem.className = 'modal-bio-item';

          var bioLabel = document.createElement('span');
          bioLabel.className = 'modal-bio-label';
          bioLabel.textContent = bioItems[j].label;

          var bioValue = document.createElement('span');
          bioValue.className = 'modal-bio-value';
          bioValue.textContent = bioItems[j].value;

          bioItem.appendChild(bioLabel);
          bioItem.appendChild(bioValue);
          bioGrid.appendChild(bioItem);
        }
      } else {
        bioSection.style.display = 'none';
      }

      // Set source info
      var sourceEl = document.getElementById('modalSource');
      if (player.source) {
        sourceEl.style.display = 'block';
        sourceEl.textContent = 'Source: ' + player.source;
      } else {
        sourceEl.style.display = 'none';
      }

      // Show modal
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      var modal = document.getElementById('playerModal');
      modal.classList.remove('show');
      document.body.style.overflow = '';
    }

    function closeModalOnBackdrop(event) {
      if (event.target.classList.contains('modal-overlay')) {
        closeModal();
      }
    }

    // Parse stats string into structured data based on position
    function parseStatsString(statsStr, position) {
      var stats = [];
      if (!statsStr || statsStr === 'â€”') return stats;

      // Check if pitcher or position player based on common patterns
      var isPitcher = position && (position.indexOf('HP') !== -1 || position.indexOf('P') !== -1 && position.length <= 3);

      // Common pattern: ".298/.412/.489" for hitters or "3.24 ERA, 89 K" for pitchers
      if (statsStr.indexOf('/') !== -1 && statsStr.split('/').length === 3) {
        // Slash line format: AVG/OBP/SLG
        var parts = statsStr.split('/');
        stats.push({ label: 'AVG', value: parts[0] });
        stats.push({ label: 'OBP', value: parts[1] });
        stats.push({ label: 'SLG', value: parts[2] });
      } else if (statsStr.indexOf('ERA') !== -1) {
        // Pitcher format
        var eraMatch = statsStr.match(/(\d+\.\d+)\s*ERA/);
        if (eraMatch) stats.push({ label: 'ERA', value: eraMatch[1] });

        var kMatch = statsStr.match(/(\d+)\s*K/);
        if (kMatch) stats.push({ label: 'K', value: kMatch[1] });

        var wlMatch = statsStr.match(/(\d+-\d+)/);
        if (wlMatch) stats.push({ label: 'W-L', value: wlMatch[1] });

        var ipMatch = statsStr.match(/(\d+\.?\d*)\s*IP/);
        if (ipMatch) stats.push({ label: 'IP', value: ipMatch[1] });
      } else if (statsStr.indexOf('HR') !== -1 || statsStr.indexOf('RBI') !== -1) {
        // Power hitter format
        var hrMatch = statsStr.match(/(\d+)\s*HR/);
        if (hrMatch) stats.push({ label: 'HR', value: hrMatch[1] });

        var rbiMatch = statsStr.match(/(\d+)\s*RBI/);
        if (rbiMatch) stats.push({ label: 'RBI', value: rbiMatch[1] });

        var avgMatch = statsStr.match(/\.(\d{3})/);
        if (avgMatch) stats.push({ label: 'AVG', value: '.' + avgMatch[1] });
      } else {
        // Just show the raw stats
        stats.push({ label: '2024', value: statsStr });
      }

      return stats;
    }

    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal();
        closeBestfitModal();
      }
    });

    // ========== URL PARAMETER PERSISTENCE ==========

    function updateUrlParams() {
      var params = new URLSearchParams();

      var search = document.getElementById('searchInput').value;
      var status = document.getElementById('statusFilter').value;
      var position = document.getElementById('positionFilter').value;
      var conference = document.getElementById('conferenceFilter').value;

      if (search) params.set('q', search);
      if (status !== 'all') params.set('status', status);
      if (position !== 'all') params.set('pos', position);
      if (conference !== 'all') params.set('conf', conference);

      var newUrl = window.location.pathname;
      if (params.toString()) {
        newUrl += '?' + params.toString();
      }
      window.history.replaceState({}, '', newUrl);
    }

    function loadUrlParams() {
      var params = new URLSearchParams(window.location.search);

      var search = params.get('q');
      var status = params.get('status');
      var position = params.get('pos');
      var conference = params.get('conf');

      if (search) document.getElementById('searchInput').value = search;
      if (status) document.getElementById('statusFilter').value = status;
      if (position) document.getElementById('positionFilter').value = position;
      if (conference) document.getElementById('conferenceFilter').value = conference;

      // Apply filters if any params were set
      if (search || status || position || conference) {
        setTimeout(filterTable, 100);
      }
    }

    function shareCurrentFilters() {
      var url = window.location.href;
      navigator.clipboard.writeText(url).then(function() {
        showToast('Link copied to clipboard!');
      }).catch(function() {
        showToast('Failed to copy link');
      });
    }

    function showToast(message) {
      var toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(function() {
        toast.classList.remove('show');
      }, 3000);
    }

    // ========== WATCHLIST FEATURE ==========

    var watchlist = [];
    var watchlistViewActive = false;

    function loadWatchlist() {
      try {
        var saved = localStorage.getItem('bsi_portal_watchlist');
        if (saved) {
          watchlist = JSON.parse(saved);
        }
      } catch (e) {
        watchlist = [];
      }
      updateWatchlistCount();
    }

    function saveWatchlist() {
      localStorage.setItem('bsi_portal_watchlist', JSON.stringify(watchlist));
      updateWatchlistCount();
    }

    function updateWatchlistCount() {
      var countEl = document.getElementById('watchlistCount');
      if (countEl) {
        countEl.textContent = watchlist.length;
        countEl.style.display = watchlist.length > 0 ? 'inline' : 'none';
      }
    }

    function isInWatchlist(playerName) {
      return watchlist.indexOf(playerName) !== -1;
    }

    function toggleWatchlist(playerName, event) {
      if (event) {
        event.stopPropagation();
      }

      var index = watchlist.indexOf(playerName);
      if (index === -1) {
        watchlist.push(playerName);
        showToast('Added to watchlist');
      } else {
        watchlist.splice(index, 1);
        showToast('Removed from watchlist');
      }
      saveWatchlist();

      // Re-render if in watchlist view
      if (watchlistViewActive) {
        filterTable();
      }

      // Update button state
      updateWatchlistButtons();
    }

    function updateWatchlistButtons() {
      var buttons = document.querySelectorAll('.watchlist-btn');
      buttons.forEach(function(btn) {
        var playerName = btn.getAttribute('data-player');
        if (playerName && isInWatchlist(playerName)) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }

    function toggleWatchlistView() {
      watchlistViewActive = !watchlistViewActive;
      var btn = document.getElementById('watchlistToggle');

      if (watchlistViewActive) {
        btn.classList.add('active');
        // Filter to show only watchlist players
        var originalFilter = filterTable;
        filteredData = portalData.filter(function(player) {
          return isInWatchlist(player.name);
        });
        currentPage = 1;
        renderTable();
        updateFilterCount();
      } else {
        btn.classList.remove('active');
        filterTable();
      }
    }

    // ========== PLAYER IMAGES FROM ESPN CDN ==========

    function getPlayerImageUrl(playerName, school) {
      // For now, use ESPN team logos as fallback since player headshots require roster IDs
      // In production, this would integrate with an athlete API
      var teamId = schoolLogoIds[school];
      if (teamId) {
        return 'https://a.espncdn.com/combiner/i?img=/i/teamlogos/ncaa/500/' + teamId + '.png&h=40&w=40';
      }
      return null;
    }

    // ========== TRENDING UNDERDOGS ALGORITHM ==========

    var trendingPlayers = [];
    var trendingFilter = 'all';

    function calculateTrendingScore(player) {
      var score = 0;

      // Recent entry bonus (within last 7 days)
      var daysSinceEntry = (Date.now() - new Date(player.date).getTime()) / (1000 * 60 * 60 * 24);
      if (daysSinceEntry <= 7) score += 30;
      else if (daysSinceEntry <= 14) score += 20;
      else if (daysSinceEntry <= 30) score += 10;

      // Non-Power 5 school = underdog bonus
      var power5 = ['SEC', 'ACC', 'Big 12', 'Big Ten', 'Pac-12'];
      if (power5.indexOf(player.fromConf) === -1) {
        score += 25;
      }

      // In Portal status = actively available
      if (player.status === 'in-portal') score += 20;

      // Good stats bonus
      if (player.stats && player.stats !== 'â€”') {
        // Pitcher with good ERA
        if (player.stats.indexOf('ERA') !== -1) {
          var eraMatch = player.stats.match(/(\d+\.\d+)\s*ERA/);
          if (eraMatch && parseFloat(eraMatch[1]) < 3.5) score += 15;
        }
        // Hitter with good average
        if (player.stats.indexOf('/') !== -1) {
          var avg = parseFloat(player.stats.split('/')[0]);
          if (avg >= 0.300) score += 15;
        }
      }

      return score;
    }

    function generateBestFit(player) {
      // Generate top university matches based on position needs and conference
      var fits = [];
      var needPositions = {
        'Texas': { needs: ['RHP', 'LHP', 'SS'], conf: 'SEC', prestige: 95 },
        'LSU': { needs: ['C', 'OF', 'RHP'], conf: 'SEC', prestige: 95 },
        'Vanderbilt': { needs: ['LHP', '1B', 'OF'], conf: 'SEC', prestige: 92 },
        'Texas A&M': { needs: ['SS', 'RHP', '3B'], conf: 'SEC', prestige: 90 },
        'Florida': { needs: ['RHP', 'OF', 'C'], conf: 'SEC', prestige: 88 },
        'TCU': { needs: ['LHP', 'SS', 'OF'], conf: 'Big 12', prestige: 85 },
        'Virginia': { needs: ['RHP', '2B', 'OF'], conf: 'ACC', prestige: 87 },
        'Clemson': { needs: ['OF', 'RHP', '1B'], conf: 'ACC', prestige: 82 },
        'Oregon State': { needs: ['C', 'RHP', 'SS'], conf: 'Pac-12', prestige: 84 },
        'Texas Tech': { needs: ['LHP', 'OF', '3B'], conf: 'Big 12', prestige: 80 }
      };

      for (var school in needPositions) {
        var schoolData = needPositions[school];
        var fitScore = schoolData.prestige;
        var reasons = [];

        // Position match bonus
        if (schoolData.needs.indexOf(player.position) !== -1) {
          fitScore += 15;
          reasons.push('Position need: ' + player.position);
        }

        // Conference familiarity bonus
        if (player.fromConf === schoolData.conf) {
          fitScore += 5;
          reasons.push('Conference experience');
        }

        // Power 5 to Power 5 transition
        var power5 = ['SEC', 'ACC', 'Big 12', 'Big Ten', 'Pac-12'];
        if (power5.indexOf(player.fromConf) !== -1 && power5.indexOf(schoolData.conf) !== -1) {
          fitScore += 5;
          reasons.push('Power 5 ready');
        }

        fits.push({
          school: school,
          conference: schoolData.conf,
          score: fitScore,
          reasons: reasons.length > 0 ? reasons.join(', ') : 'General fit'
        });
      }

      // Sort by score descending
      fits.sort(function(a, b) { return b.score - a.score; });

      // Return top 5
      return fits.slice(0, 5);
    }

    function renderTrending() {
      var grid = document.getElementById('trendingGrid');
      if (!grid) return;

      clearElement(grid);

      // Calculate trending scores for all in-portal players
      trendingPlayers = portalData
        .filter(function(p) { return p.status === 'in-portal'; })
        .map(function(p) {
          return {
            player: p,
            score: calculateTrendingScore(p),
            bestFit: generateBestFit(p)
          };
        })
        .sort(function(a, b) { return b.score - a.score; })
        .slice(0, 10);

      // Filter by position type
      var filtered = trendingPlayers;
      if (trendingFilter === 'pitchers') {
        filtered = trendingPlayers.filter(function(t) {
          return t.player.position.indexOf('HP') !== -1 || t.player.position === 'P';
        });
      } else if (trendingFilter === 'hitters') {
        filtered = trendingPlayers.filter(function(t) {
          return t.player.position.indexOf('HP') === -1 && t.player.position !== 'P';
        });
      }

      filtered.forEach(function(item, index) {
        var player = item.player;
        var card = document.createElement('div');
        card.className = 'trending-card';
        card.onclick = function() { openModal(player); };

        // Rank badge
        var rank = document.createElement('div');
        rank.className = 'trending-rank';
        rank.textContent = index + 1;
        card.appendChild(rank);

        // Header with avatar
        var header = document.createElement('div');
        header.className = 'trending-card-header';

        var avatar = document.createElement('div');
        avatar.className = 'trending-card-avatar';
        avatar.textContent = getInitials(player.name);

        var info = document.createElement('div');
        info.className = 'trending-card-info';

        var name = document.createElement('div');
        name.className = 'trending-card-name';
        name.textContent = player.name;

        var meta = document.createElement('div');
        meta.className = 'trending-card-meta';
        meta.textContent = player.position + ' â€¢ ' + player.fromSchool;

        info.appendChild(name);
        info.appendChild(meta);
        header.appendChild(avatar);
        header.appendChild(info);
        card.appendChild(header);

        // Stats
        var stats = document.createElement('div');
        stats.className = 'trending-card-stats';

        var stat1 = document.createElement('div');
        stat1.className = 'trending-stat';
        stat1.innerHTML = '<div class="trending-stat-value">' + player.fromConf + '</div><div class="trending-stat-label">From</div>';

        var stat2 = document.createElement('div');
        stat2.className = 'trending-stat';
        stat2.innerHTML = '<div class="trending-stat-value">' + (player.year || 'Jr') + '</div><div class="trending-stat-label">Year</div>';

        stats.appendChild(stat1);
        stats.appendChild(stat2);
        card.appendChild(stats);

        // Best fit recommendation
        if (item.bestFit && item.bestFit.length > 0) {
          var bestFit = document.createElement('div');
          bestFit.className = 'trending-best-fit';
          bestFit.innerHTML = '<span class="trending-best-fit-label">Best fit:</span> ' +
            '<span class="trending-best-fit-school">' + item.bestFit[0].school + '</span>' +
            '<span class="trending-best-fit-score">' + item.bestFit[0].score + '%</span>';
          bestFit.onclick = function(e) {
            e.stopPropagation();
            openBestfitModal(player, item.bestFit);
          };
          card.appendChild(bestFit);
        }

        grid.appendChild(card);
      });

      if (filtered.length === 0) {
        var empty = document.createElement('div');
        empty.style.cssText = 'text-align: center; padding: 2rem; color: rgba(250,248,245,0.5);';
        empty.textContent = 'No trending players in this category';
        grid.appendChild(empty);
      }
    }

    function filterTrending(type) {
      trendingFilter = type;

      // Update tab styles
      var tabs = document.querySelectorAll('.trending-tab');
      tabs.forEach(function(tab) {
        tab.classList.remove('active');
        if (tab.getAttribute('data-filter') === type) {
          tab.classList.add('active');
        }
      });

      renderTrending();
    }

    // ========== BEST-FIT MODAL ==========

    function openBestfitModal(player, fits) {
      var modal = document.getElementById('bestfitModal');
      var summary = document.getElementById('bestfitPlayerSummary');
      var matches = document.getElementById('bestfitMatches');

      // Populate player summary
      clearElement(summary);
      summary.innerHTML = '<div class="player-avatar">' + getInitials(player.name) + '</div>' +
        '<div style="flex:1">' +
        '<div style="font-weight:600; font-size:1.125rem; margin-bottom:0.25rem">' + player.name + '</div>' +
        '<div style="color:rgba(250,248,245,0.7)">' + player.position + ' â€¢ ' + player.fromSchool + ' (' + player.fromConf + ')</div>' +
        '</div>';

      // Populate matches
      clearElement(matches);
      fits.forEach(function(fit, index) {
        var match = document.createElement('div');
        match.className = 'bestfit-match';

        var logoUrl = getSchoolLogoUrl(fit.school);
        var logoHtml = logoUrl ? '<img src="' + logoUrl + '" alt="" style="width:32px;height:32px;border-radius:4px;margin-right:0.75rem;">' : '';

        match.innerHTML = '<div class="bestfit-match-rank">' + (index + 1) + '</div>' +
          '<div class="bestfit-match-school" style="display:flex;align-items:center">' +
          logoHtml +
          '<div><div class="bestfit-match-name">' + fit.school + '</div>' +
          '<div class="bestfit-match-reasons">' + fit.conference + ' â€¢ ' + fit.reasons + '</div></div></div>' +
          '<div class="bestfit-match-score"><div class="bestfit-score-value">' + fit.score + '</div>' +
          '<div class="bestfit-score-label">Match %</div></div>';

        matches.appendChild(match);
      });

      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    function closeBestfitModal(event) {
      if (event && event.target !== event.currentTarget) return;
      var modal = document.getElementById('bestfitModal');
      modal.classList.remove('show');
      document.body.style.overflow = '';
    }

    // ========== INTEL FEED (Real RSS from /api/intel/feed) ==========

    var intelFeedLoaded = false;

    function renderIntelFeed() {
      var feed = document.getElementById('intelFeed');
      if (!feed) return;

      // Show loading state
      clearElement(feed);
      var loadingEl = document.createElement('div');
      loadingEl.style.cssText = 'text-align: center; padding: 1.5rem; color: rgba(250,248,245,0.5);';
      loadingEl.textContent = 'Loading intel feed...';
      feed.appendChild(loadingEl);

      // Fetch from Intel Feed API
      fetch('/api/intel/feed?limit=8&category=portal')
        .then(function(response) {
          if (!response.ok) throw new Error('Failed to load intel feed');
          return response.json();
        })
        .then(function(data) {
          clearElement(feed);
          intelFeedLoaded = true;

          if (!data.items || data.items.length === 0) {
            var empty = document.createElement('div');
            empty.style.cssText = 'text-align: center; padding: 1rem; color: rgba(250,248,245,0.5);';
            empty.textContent = 'No recent portal intel available';
            feed.appendChild(empty);
            return;
          }

          data.items.forEach(function(item) {
            var el = document.createElement('div');
            el.className = 'intel-item';

            // Check if recent (last 24 hours)
            var pubDate = new Date(item.pubDate);
            var isRecent = (Date.now() - pubDate.getTime()) < 24 * 60 * 60 * 1000;
            if (isRecent) {
              el.classList.add('breaking');
            }

            // Source icon
            var iconEl = document.createElement('div');
            iconEl.className = 'intel-source';
            iconEl.textContent = item.sourceIcon || 'ðŸ“°';
            el.appendChild(iconEl);

            // Content container
            var contentEl = document.createElement('div');
            contentEl.className = 'intel-content';

            // Title as link
            var titleLink = document.createElement('a');
            titleLink.href = item.link;
            titleLink.target = '_blank';
            titleLink.rel = 'noopener noreferrer';
            titleLink.className = 'intel-text';
            titleLink.textContent = item.title;
            titleLink.style.cssText = 'color: inherit; text-decoration: none;';
            titleLink.onmouseover = function() { this.style.color = 'var(--ember)'; };
            titleLink.onmouseout = function() { this.style.color = 'inherit'; };
            contentEl.appendChild(titleLink);

            // Meta info
            var metaEl = document.createElement('div');
            metaEl.className = 'intel-meta';
            var timeAgo = getTimeAgo(pubDate);
            metaEl.textContent = item.source + ' â€¢ ' + timeAgo;
            if (isRecent) {
              var breakingSpan = document.createElement('span');
              breakingSpan.style.cssText = 'color: var(--ember); font-weight: 600;';
              breakingSpan.textContent = ' â€¢ NEW';
              metaEl.appendChild(breakingSpan);
            }
            contentEl.appendChild(metaEl);

            el.appendChild(contentEl);
            feed.appendChild(el);
          });

          // Add "Powered by" footer
          var footer = document.createElement('div');
          footer.style.cssText = 'text-align: center; padding: 0.5rem; font-size: 10px; color: rgba(250,248,245,0.3); margin-top: 0.5rem;';
          footer.textContent = 'Aggregated from D1Baseball, Baseball America, Perfect Game, NCAA';
          feed.appendChild(footer);
        })
        .catch(function(err) {
          console.error('[Intel Feed] Error:', err);
          clearElement(feed);
          // Fallback to portal-based items if API fails
          renderFallbackIntelFeed(feed);
        });
    }

    // Time ago helper
    function getTimeAgo(date) {
      var seconds = Math.floor((Date.now() - date.getTime()) / 1000);
      if (seconds < 60) return 'just now';
      var minutes = Math.floor(seconds / 60);
      if (minutes < 60) return minutes + 'm ago';
      var hours = Math.floor(minutes / 60);
      if (hours < 24) return hours + 'h ago';
      var days = Math.floor(hours / 24);
      if (days === 1) return 'yesterday';
      if (days < 7) return days + 'd ago';
      return date.toLocaleDateString();
    }

    // Fallback if API fails - use portal data
    function renderFallbackIntelFeed(feed) {
      var intelItems = [];

      // Get recent committed players
      var recentCommits = portalData
        .filter(function(p) { return p.status === 'committed'; })
        .slice(0, 3);

      recentCommits.forEach(function(p) {
        intelItems.push({
          type: 'commit',
          name: p.name,
          position: p.position,
          destination: p.destination,
          fromSchool: p.fromSchool,
          date: p.date,
          breaking: false
        });
      });

      // Get recent entries
      var recentEntries = portalData
        .filter(function(p) { return p.status === 'in-portal'; })
        .slice(0, 3);

      recentEntries.forEach(function(p) {
        var isRecent = (Date.now() - new Date(p.date).getTime()) < 48 * 60 * 60 * 1000;
        intelItems.push({
          type: 'entry',
          name: p.name,
          position: p.position,
          fromSchool: p.fromSchool,
          date: p.date,
          breaking: isRecent
        });
      });

      intelItems = intelItems.slice(0, 5);

      if (intelItems.length === 0) {
        var empty = document.createElement('div');
        empty.style.cssText = 'text-align: center; padding: 1rem; color: rgba(250,248,245,0.5);';
        empty.textContent = 'No recent intel available';
        feed.appendChild(empty);
        return;
      }

      intelItems.forEach(function(item) {
        var el = document.createElement('div');
        el.className = 'intel-item' + (item.breaking ? ' breaking' : '');

        var iconEl = document.createElement('div');
        iconEl.className = 'intel-source';
        iconEl.textContent = item.type === 'commit' ? 'âœ“' : 'â†’';
        el.appendChild(iconEl);

        var contentEl = document.createElement('div');
        contentEl.className = 'intel-content';

        var textEl = document.createElement('div');
        textEl.className = 'intel-text';
        if (item.type === 'commit') {
          var strong1 = document.createElement('strong');
          strong1.textContent = item.name;
          textEl.appendChild(strong1);
          textEl.appendChild(document.createTextNode(' (' + item.position + ') committed to '));
          var strong2 = document.createElement('strong');
          strong2.textContent = item.destination;
          textEl.appendChild(strong2);
          textEl.appendChild(document.createTextNode(' from ' + item.fromSchool));
        } else {
          var strong1 = document.createElement('strong');
          strong1.textContent = item.name;
          textEl.appendChild(strong1);
          textEl.appendChild(document.createTextNode(' (' + item.position + ') from ' + item.fromSchool + ' entered portal'));
        }
        contentEl.appendChild(textEl);

        var metaEl = document.createElement('div');
        metaEl.className = 'intel-meta';
        metaEl.textContent = formatDate(item.date);
        if (item.breaking) {
          var breakingSpan = document.createElement('span');
          breakingSpan.style.cssText = 'color: var(--ember); font-weight: 600;';
          breakingSpan.textContent = ' â€¢ BREAKING';
          metaEl.appendChild(breakingSpan);
        }
        contentEl.appendChild(metaEl);

        el.appendChild(contentEl);
        feed.appendChild(el);
      });
    }

    // ========== ENHANCED TABLE RENDERING WITH WATCHLIST ==========

    // Override renderTable to add watchlist buttons
    var originalRenderTable = renderTable;
    renderTable = function() {
      originalRenderTable();

      // Add watchlist buttons to each row after render
      var rows = document.querySelectorAll('#portalTableBody tr');
      rows.forEach(function(row) {
        var nameCell = row.querySelector('.player-name');
        if (nameCell && !row.querySelector('.watchlist-btn')) {
          var playerName = nameCell.textContent;

          var btn = document.createElement('button');
          btn.className = 'watchlist-btn' + (isInWatchlist(playerName) ? ' active' : '');
          btn.setAttribute('data-player', playerName);
          btn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';
          btn.onclick = function(e) {
            toggleWatchlist(playerName, e);
            btn.classList.toggle('active');
          };

          var playerCell = row.querySelector('.player-cell');
          if (playerCell) {
            playerCell.appendChild(btn);
          }
        }
      });
    };

    // ========== INITIALIZATION ==========

    // Load URL params on page load
    loadUrlParams();

    // Load watchlist
    loadWatchlist();

    // Render trending and intel after data loads
    var originalLoadPortalData = loadPortalData;
    loadPortalData = function() {
      isLoading = true;

      fetch('/api/college-baseball/transfer-portal')
        .then(function(response) {
          if (!response.ok) {
            throw new Error('Failed to load portal data');
          }
          return response.json();
        })
        .then(function(data) {
          portalData = data.players || [];
          portalSummary = data.summary || portalSummary;
          filteredData = portalData.slice();
          isLoading = false;

          updateTimestamp(data.fetchedAt);
          updateStats();
          sortData();
          renderTable();

          // Render new sections after data loads
          renderTrending();
          renderIntelFeed();
        })
        .catch(function(error) {
          console.error('Error loading portal data:', error);
          isLoading = false;
          var tbody = document.getElementById('portalTableBody');
          clearElement(tbody);
          var errorRow = document.createElement('tr');
          var errorCell = document.createElement('td');
          errorCell.colSpan = 7;
          var errorDiv = document.createElement('div');
          errorDiv.className = 'empty-state';
          var errorTitle = document.createElement('h3');
          errorTitle.className = 'empty-state-title';
          errorTitle.textContent = 'Unable to load data';
          var errorText = document.createElement('p');
          errorText.className = 'empty-state-text';
          errorText.textContent = 'Please refresh the page to try again.';
          errorDiv.appendChild(errorTitle);
          errorDiv.appendChild(errorText);
          errorCell.appendChild(errorDiv);
          errorRow.appendChild(errorCell);
          tbody.appendChild(errorRow);
        });
    };

    // Re-run initialization
    loadPortalData();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Box Score | College Baseball | Blaze Sports Intel</title>
    <meta name="description" content="Complete box score with batting and pitching statistics for NCAA college baseball games.">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --burnt-orange: #BF5700;
            --texas-soil: #8B4513;
            --ember: #FF6B35;
            --charcoal: #1A1A1A;
            --midnight: #0D0D0D;
            --cream: #FAF8F5;
            --gold: #C9A227;
            --success: #2E7D32;
            --error: #C62828;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Cormorant Garamond', Georgia, serif;
            background: var(--midnight);
            color: var(--cream);
            min-height: 100vh;
            line-height: 1.6;
        }

        .nav {
            background: var(--charcoal);
            border-bottom: 2px solid var(--burnt-orange);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            font-family: 'Oswald', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--burnt-orange);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
        }

        .nav-links a {
            color: var(--cream);
            text-decoration: none;
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: color 0.2s;
        }

        .nav-links a:hover { color: var(--ember); }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--burnt-orange);
            text-decoration: none;
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            text-transform: uppercase;
            margin-bottom: 1.5rem;
            transition: color 0.2s;
        }

        .back-link:hover { color: var(--ember); }

        .game-header {
            background: var(--charcoal);
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            border-left: 4px solid var(--burnt-orange);
        }

        .game-status {
            font-family: 'Oswald', sans-serif;
            font-size: 0.85rem;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 1rem;
        }

        .matchup {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin-bottom: 1rem;
        }

        .team {
            text-align: center;
            flex: 1;
            max-width: 200px;
        }

        .team-logo {
            width: 80px;
            height: 80px;
            background: var(--midnight);
            border-radius: 50%;
            margin: 0 auto 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Oswald', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--burnt-orange);
        }

        .team-name {
            font-family: 'Oswald', sans-serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--cream);
            margin-bottom: 0.25rem;
        }

        .team-record {
            font-size: 0.9rem;
            color: rgba(250, 248, 245, 0.6);
        }

        .score-display {
            font-family: 'Oswald', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            color: var(--cream);
            text-align: center;
        }

        .game-info {
            text-align: center;
            color: rgba(250, 248, 245, 0.7);
            font-size: 0.95rem;
            margin-top: 1rem;
        }

        .line-score {
            background: var(--charcoal);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .line-score-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            text-transform: uppercase;
            padding: 1rem 1.5rem;
            background: var(--midnight);
            border-bottom: 1px solid rgba(191, 87, 0, 0.3);
        }

        .line-score-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Oswald', sans-serif;
        }

        .line-score-table th,
        .line-score-table td {
            padding: 0.75rem 0.5rem;
            text-align: center;
            border-bottom: 1px solid rgba(250, 248, 245, 0.1);
        }

        .line-score-table th {
            background: rgba(191, 87, 0, 0.1);
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--burnt-orange);
        }

        .line-score-table td:first-child {
            text-align: left;
            padding-left: 1rem;
            font-weight: 600;
        }

        .line-score-table .totals {
            background: rgba(191, 87, 0, 0.15);
            font-weight: 700;
        }

        .stats-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .stats-tab {
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            text-transform: uppercase;
            padding: 0.75rem 1.5rem;
            background: var(--charcoal);
            border: 1px solid rgba(191, 87, 0, 0.3);
            border-radius: 4px;
            color: var(--cream);
            cursor: pointer;
            transition: all 0.2s;
        }

        .stats-tab:hover { border-color: var(--burnt-orange); }

        .stats-tab.active {
            background: var(--burnt-orange);
            border-color: var(--burnt-orange);
        }

        .stats-section {
            display: none;
        }

        .stats-section.active {
            display: block;
        }

        .team-stats {
            background: var(--charcoal);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .team-stats-header {
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            text-transform: uppercase;
            padding: 1rem 1.5rem;
            background: var(--midnight);
            border-bottom: 1px solid rgba(191, 87, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .stats-table th,
        .stats-table td {
            padding: 0.6rem 0.75rem;
            text-align: right;
            border-bottom: 1px solid rgba(250, 248, 245, 0.1);
        }

        .stats-table th {
            background: rgba(191, 87, 0, 0.1);
            font-family: 'Oswald', sans-serif;
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--burnt-orange);
            text-transform: uppercase;
        }

        .stats-table td:first-child,
        .stats-table th:first-child {
            text-align: left;
            padding-left: 1rem;
        }

        .stats-table tbody tr:hover {
            background: rgba(191, 87, 0, 0.05);
        }

        .player-link {
            color: var(--cream);
            text-decoration: none;
            transition: color 0.2s;
        }

        .player-link:hover { color: var(--ember); }

        .loading {
            text-align: center;
            padding: 4rem 2rem;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--charcoal);
            border-top-color: var(--burnt-orange);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--error);
        }

        .source-citation {
            text-align: center;
            padding: 1.5rem;
            color: rgba(250, 248, 245, 0.5);
            font-size: 0.85rem;
            border-top: 1px solid rgba(250, 248, 245, 0.1);
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .nav { padding: 1rem; }
            .nav-links { gap: 1rem; }
            .container { padding: 1rem; }
            .game-header { padding: 1.5rem; }
            .matchup { gap: 1rem; }
            .team-logo { width: 60px; height: 60px; font-size: 1.25rem; }
            .team-name { font-size: 1rem; }
            .score-display { font-size: 2rem; }
            .stats-table { font-size: 0.8rem; }
            .stats-table th, .stats-table td { padding: 0.5rem; }
            .line-score-table { font-size: 0.85rem; }
            .line-score-table th, .line-score-table td { padding: 0.5rem 0.25rem; }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <a href="/" class="nav-logo">BLAZE SPORTS INTEL</a>
        <div class="nav-links">
            <a href="/college-baseball/">Baseball</a>
            <a href="/college-baseball/scores">Scores</a>
            <a href="/college-baseball/standings">Standings</a>
            <a href="/college-baseball/rankings">Rankings</a>
        </div>
    </nav>

    <main class="container">
        <a href="/college-baseball/scores" class="back-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            Back to Scores
        </a>

        <div id="boxScoreContent">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading box score...</p>
            </div>
        </div>
    </main>

    <script>
        // Safe DOM helper functions
        function createElement(tag, className, textContent) {
            const el = document.createElement(tag);
            if (className) el.className = className;
            if (textContent !== undefined) el.textContent = textContent;
            return el;
        }

        function createLink(href, className, textContent) {
            const a = document.createElement('a');
            a.href = href;
            if (className) a.className = className;
            if (textContent) a.textContent = textContent;
            return a;
        }

        // Get game ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const gameId = urlParams.get('id');

        if (!gameId) {
            showError('No game ID provided');
        } else {
            loadBoxScore(gameId);
        }

        async function loadBoxScore(gameId) {
            try {
                const response = await fetch('/api/college-baseball/box-score/' + encodeURIComponent(gameId));
                if (!response.ok) throw new Error('Failed to load box score');

                const data = await response.json();
                renderBoxScore(data);
            } catch (error) {
                console.error('Error loading box score:', error);
                showError('Unable to load box score. Please try again.');
            }
        }

        function showError(message) {
            const content = document.getElementById('boxScoreContent');
            content.textContent = '';
            const errorDiv = createElement('div', 'error-message', message);
            content.appendChild(errorDiv);
        }

        function renderBoxScore(data) {
            const content = document.getElementById('boxScoreContent');
            content.textContent = '';

            // Game Header
            const header = createElement('div', 'game-header');

            const status = createElement('div', 'game-status', data.status || 'Final');
            header.appendChild(status);

            const matchup = createElement('div', 'matchup');

            // Away team
            const awayTeam = createElement('div', 'team');
            const awayLogo = createElement('div', 'team-logo', getTeamAbbrev(data.awayTeam));
            awayTeam.appendChild(awayLogo);
            const awayName = createElement('div', 'team-name', data.awayTeam || 'Away');
            awayTeam.appendChild(awayName);
            if (data.awayRecord) {
                const awayRecord = createElement('div', 'team-record', data.awayRecord);
                awayTeam.appendChild(awayRecord);
            }
            matchup.appendChild(awayTeam);

            // Score
            const scoreDisplay = createElement('div', 'score-display');
            scoreDisplay.textContent = (data.awayScore || 0) + ' - ' + (data.homeScore || 0);
            matchup.appendChild(scoreDisplay);

            // Home team
            const homeTeam = createElement('div', 'team');
            const homeLogo = createElement('div', 'team-logo', getTeamAbbrev(data.homeTeam));
            homeTeam.appendChild(homeLogo);
            const homeName = createElement('div', 'team-name', data.homeTeam || 'Home');
            homeTeam.appendChild(homeName);
            if (data.homeRecord) {
                const homeRecord = createElement('div', 'team-record', data.homeRecord);
                homeTeam.appendChild(homeRecord);
            }
            matchup.appendChild(homeTeam);

            header.appendChild(matchup);

            // Game info
            if (data.venue || data.date) {
                const gameInfo = createElement('div', 'game-info');
                const infoParts = [];
                if (data.venue) infoParts.push(data.venue);
                if (data.date) infoParts.push(formatDate(data.date));
                gameInfo.textContent = infoParts.join(' • ');
                header.appendChild(gameInfo);
            }

            content.appendChild(header);

            // Line Score
            if (data.lineScore) {
                const lineScoreDiv = createElement('div', 'line-score');
                const lineScoreTitle = createElement('div', 'line-score-title', 'Line Score');
                lineScoreDiv.appendChild(lineScoreTitle);

                const lineTable = document.createElement('table');
                lineTable.className = 'line-score-table';

                // Header row
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                const teamHeader = document.createElement('th');
                teamHeader.textContent = 'Team';
                headerRow.appendChild(teamHeader);

                const innings = data.lineScore.innings || 9;
                for (let i = 1; i <= innings; i++) {
                    const th = document.createElement('th');
                    th.textContent = i.toString();
                    headerRow.appendChild(th);
                }
                ['R', 'H', 'E'].forEach(label => {
                    const th = document.createElement('th');
                    th.className = 'totals';
                    th.textContent = label;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                lineTable.appendChild(thead);

                // Body rows
                const tbody = document.createElement('tbody');

                // Away row
                const awayRow = document.createElement('tr');
                const awayCell = document.createElement('td');
                awayCell.textContent = data.awayTeam || 'Away';
                awayRow.appendChild(awayCell);

                const awayInnings = data.lineScore.away || [];
                for (let i = 0; i < innings; i++) {
                    const td = document.createElement('td');
                    td.textContent = awayInnings[i] !== undefined ? awayInnings[i].toString() : '-';
                    awayRow.appendChild(td);
                }
                const awayTotals = [data.awayScore || 0, data.lineScore.awayHits || 0, data.lineScore.awayErrors || 0];
                awayTotals.forEach(val => {
                    const td = document.createElement('td');
                    td.className = 'totals';
                    td.textContent = val.toString();
                    awayRow.appendChild(td);
                });
                tbody.appendChild(awayRow);

                // Home row
                const homeRow = document.createElement('tr');
                const homeCell = document.createElement('td');
                homeCell.textContent = data.homeTeam || 'Home';
                homeRow.appendChild(homeCell);

                const homeInnings = data.lineScore.home || [];
                for (let i = 0; i < innings; i++) {
                    const td = document.createElement('td');
                    td.textContent = homeInnings[i] !== undefined ? homeInnings[i].toString() : '-';
                    homeRow.appendChild(td);
                }
                const homeTotals = [data.homeScore || 0, data.lineScore.homeHits || 0, data.lineScore.homeErrors || 0];
                homeTotals.forEach(val => {
                    const td = document.createElement('td');
                    td.className = 'totals';
                    td.textContent = val.toString();
                    homeRow.appendChild(td);
                });
                tbody.appendChild(homeRow);

                lineTable.appendChild(tbody);
                lineScoreDiv.appendChild(lineTable);
                content.appendChild(lineScoreDiv);
            }

            // Stats Tabs
            const tabsDiv = createElement('div', 'stats-tabs');

            const battingTab = createElement('button', 'stats-tab active', 'Batting');
            battingTab.dataset.tab = 'batting';
            tabsDiv.appendChild(battingTab);

            const pitchingTab = createElement('button', 'stats-tab', 'Pitching');
            pitchingTab.dataset.tab = 'pitching';
            tabsDiv.appendChild(pitchingTab);

            content.appendChild(tabsDiv);

            // Batting Section
            const battingSection = createElement('div', 'stats-section active');
            battingSection.id = 'batting-stats';

            if (data.batting) {
                // Away batting
                if (data.batting.away) {
                    battingSection.appendChild(createBattingTable(data.awayTeam, data.batting.away));
                }
                // Home batting
                if (data.batting.home) {
                    battingSection.appendChild(createBattingTable(data.homeTeam, data.batting.home));
                }
            }
            content.appendChild(battingSection);

            // Pitching Section
            const pitchingSection = createElement('div', 'stats-section');
            pitchingSection.id = 'pitching-stats';

            if (data.pitching) {
                // Away pitching
                if (data.pitching.away) {
                    pitchingSection.appendChild(createPitchingTable(data.awayTeam, data.pitching.away));
                }
                // Home pitching
                if (data.pitching.home) {
                    pitchingSection.appendChild(createPitchingTable(data.homeTeam, data.pitching.home));
                }
            }
            content.appendChild(pitchingSection);

            // Tab switching
            document.querySelectorAll('.stats-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.stats-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.stats-section').forEach(s => s.classList.remove('active'));

                    this.classList.add('active');
                    const sectionId = this.dataset.tab + '-stats';
                    document.getElementById(sectionId).classList.add('active');
                });
            });

            // Source citation
            const citation = createElement('div', 'source-citation');
            citation.textContent = 'Data provided by ESPN • Updated ' + new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' });
            content.appendChild(citation);
        }

        function createBattingTable(teamName, players) {
            const container = createElement('div', 'team-stats');

            const header = createElement('div', 'team-stats-header', teamName + ' Batting');
            container.appendChild(header);

            const table = document.createElement('table');
            table.className = 'stats-table';

            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            ['Player', 'AB', 'R', 'H', 'RBI', 'BB', 'SO', 'AVG'].forEach(col => {
                const th = document.createElement('th');
                th.textContent = col;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            players.forEach(player => {
                const row = document.createElement('tr');

                const nameCell = document.createElement('td');
                if (player.id) {
                    const link = createLink('/college-baseball/player-detail.html?id=' + player.id, 'player-link', player.name || 'Unknown');
                    nameCell.appendChild(link);
                } else {
                    nameCell.textContent = player.name || 'Unknown';
                }
                row.appendChild(nameCell);

                [player.ab, player.r, player.h, player.rbi, player.bb, player.so, player.avg].forEach(val => {
                    const td = document.createElement('td');
                    td.textContent = val !== undefined ? val.toString() : '-';
                    row.appendChild(td);
                });

                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            container.appendChild(table);

            return container;
        }

        function createPitchingTable(teamName, pitchers) {
            const container = createElement('div', 'team-stats');

            const header = createElement('div', 'team-stats-header', teamName + ' Pitching');
            container.appendChild(header);

            const table = document.createElement('table');
            table.className = 'stats-table';

            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            ['Pitcher', 'IP', 'H', 'R', 'ER', 'BB', 'SO', 'ERA'].forEach(col => {
                const th = document.createElement('th');
                th.textContent = col;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            pitchers.forEach(pitcher => {
                const row = document.createElement('tr');

                const nameCell = document.createElement('td');
                if (pitcher.id) {
                    const link = createLink('/college-baseball/player-detail.html?id=' + pitcher.id, 'player-link', pitcher.name || 'Unknown');
                    nameCell.appendChild(link);
                } else {
                    nameCell.textContent = pitcher.name || 'Unknown';
                }
                row.appendChild(nameCell);

                [pitcher.ip, pitcher.h, pitcher.r, pitcher.er, pitcher.bb, pitcher.so, pitcher.era].forEach(val => {
                    const td = document.createElement('td');
                    td.textContent = val !== undefined ? val.toString() : '-';
                    row.appendChild(td);
                });

                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            container.appendChild(table);

            return container;
        }

        function getTeamAbbrev(teamName) {
            if (!teamName) return '?';
            const words = teamName.split(' ');
            if (words.length === 1) return teamName.substring(0, 3).toUpperCase();
            return words.map(w => w[0]).join('').toUpperCase().substring(0, 3);
        }

        function formatDate(dateStr) {
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    timeZone: 'America/Chicago'
                });
            } catch {
                return dateStr;
            }
        }
    </script>
<script>if("serviceWorker" in navigator){navigator.serviceWorker.register("/sw.js").catch(console.error);}</script>
</body>
</html>

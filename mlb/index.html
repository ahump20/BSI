<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‚öæ MLB Analytics | Blaze Sports Intel</title>
    <meta
      name="description"
      content="Practice to Play. Blaze Data Wins the Day. Real-time MLB standings, player statistics, and advanced analytics powered by SportsDataIO."
    />

    <!-- Design Tokens (Canonical) -->
    <link rel="stylesheet" href="/css/bsi-tokens.css" />

    <!-- Fonts & Icons -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Three.js for 3D Graphics -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Postprocessing Library (pmndrs/postprocessing) -->
    <script src="https://cdn.jsdelivr.net/npm/postprocessing@6.35.3/build/postprocessing.umd.min.js"></script>

    <!-- Blaze Graphics Modules V4 - WebGL2 Rendering Engine -->
    <script src="/lib/graphics/blaze-particle-engine-v4.js"></script>
    <script src="/lib/graphics/blaze-postprocessing.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', system-ui, sans-serif;
        background: linear-gradient(135deg, #0d0d12 0%, #161620 50%, #0d0d12 100%);
        color: var(--text-primary);
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
      }

      #particle-field {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none;
      }

      .header {
        background: rgba(31, 31, 46, 0.7);
        border-bottom: 2px solid var(--blaze-burnt-orange);
        padding: 20px 40px;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        box-shadow: 0 8px 32px 0 rgba(191, 87, 0, 0.1);
      }

      .header-content {
        max-width: 1400px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--blaze-ember);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .nav-links {
        display: flex;
        gap: 30px;
        align-items: center;
      }

      .nav-link {
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s;
      }

      .nav-link:hover {
        color: var(--blaze-ember);
      }

      .nav-link.active {
        color: var(--blaze-ember);
        border-bottom: 2px solid var(--blaze-ember);
        padding-bottom: 4px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
      }

      .hero {
        text-align: center;
        margin-bottom: 60px;
        padding: 60px 20px;
        background: rgba(191, 87, 0, 0.05);
        border-radius: 24px;
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(16px) saturate(180%);
        -webkit-backdrop-filter: blur(16px) saturate(180%);
        border: 1px solid rgba(191, 87, 0, 0.18);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      }

      .hero::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(191, 87, 0, 0.1) 0%, transparent 70%);
        animation: heroGlow 8s ease-in-out infinite;
      }

      @keyframes heroGlow {
        0%,
        100% {
          transform: translate(0, 0);
        }
        50% {
          transform: translate(10%, 10%);
        }
      }

      .hero h1 {
        font-size: 3.5rem;
        font-weight: 900;
        background: linear-gradient(135deg, var(--blaze-burnt-orange), var(--blaze-copper));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 20px;
        position: relative;
        z-index: 1;
      }

      .hero-subtitle {
        font-size: 1.3rem;
        color: var(--text-tertiary);
        max-width: 800px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
      }

      .tabs {
        display: flex;
        gap: 20px;
        margin-bottom: 40px;
        border-bottom: 2px solid var(--glass-border);
        overflow-x: auto;
      }

      .tab {
        padding: 15px 30px;
        background: transparent;
        border: none;
        color: var(--text-tertiary);
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        border-bottom: 3px solid transparent;
        white-space: nowrap;
      }

      .tab:hover {
        color: var(--text-primary);
      }

      .tab.active {
        color: var(--blaze-ember);
        border-bottom-color: var(--blaze-ember);
      }

      .card {
        background: rgba(191, 87, 0, 0.03);
        border: 1px solid rgba(191, 87, 0, 0.2);
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        backdrop-filter: blur(16px) saturate(180%);
        -webkit-backdrop-filter: blur(16px) saturate(180%);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 48px 0 rgba(191, 87, 0, 0.15);
        border-color: rgba(191, 87, 0, 0.4);
      }

      .card-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--blaze-ember);
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .standings-table {
        width: 100%;
        border-collapse: collapse;
      }

      .standings-table th {
        background: var(--dark-graphite);
        padding: 15px;
        text-align: left;
        font-weight: 600;
        color: var(--blaze-copper);
        border-bottom: 2px solid var(--blaze-burnt-orange);
      }

      .standings-table td {
        padding: 15px;
        border-bottom: 1px solid var(--glass-border);
        color: var(--text-secondary);
      }

      .standings-table tr:hover {
        background: var(--glass-light);
      }

      .team-name {
        font-weight: 600;
        color: var(--text-primary);
      }

      .stat-highlight {
        color: var(--blaze-ember);
        font-weight: 700;
      }

      .loading {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-tertiary);
      }

      .loading i {
        font-size: 3rem;
        color: var(--blaze-burnt-orange);
        animation: spin 2s linear infinite;
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      .error {
        background: rgba(220, 38, 38, 0.1);
        border: 1px solid rgba(220, 38, 38, 0.3);
        color: #fca5a5;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }

      .data-source {
        font-size: 0.9rem;
        color: var(--text-tertiary);
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid var(--glass-border);
      }

      /* Tooltip styles */
      [title] {
        position: relative;
        cursor: help;
      }

      .tooltip {
        position: relative;
        display: inline-block;
      }

      .tooltip:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.85rem;
        white-space: nowrap;
        z-index: 1000;
        pointer-events: none;
      }

      .metric-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        background: rgba(191, 87, 0, 0.1);
        border-radius: 4px;
        font-size: 0.85rem;
        font-weight: 600;
      }

      .info-icon {
        opacity: 0.6;
        transition: opacity 0.2s;
      }

      .info-icon:hover {
        opacity: 1;
      }

      @media (max-width: 768px) {
        .hero h1 {
          font-size: 2.5rem;
        }
        .header {
          padding: 15px 20px;
        }
        .nav-links {
          gap: 15px;
        }
        .standings-table {
          font-size: 0.9rem;
        }
        .standings-table th,
        .standings-table td {
          padding: 10px;
        }
        .tabs {
          overflow-x: scroll;
        }
        .tab {
          font-size: 0.95rem;
          padding: 12px 20px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Three.js Particle Background -->
    <canvas id="particle-field"></canvas>

    <header class="header">
      <div class="header-content">
        <a href="/" class="logo">
          <i class="fas fa-fire"></i>
          BLAZE SPORTS INTEL
        </a>
        <nav class="nav-links">
          <a href="/mlb" class="nav-link active">‚öæ MLB</a>
          <a href="/nfl" class="nav-link">üèà NFL</a>
          <a href="/cfb" class="nav-link">üéì CFB</a>
          <a href="/cbb" class="nav-link">üèÄ CBB</a>
          <a href="/analytics.html" class="nav-link">üìä Analytics</a>
        </nav>
      </div>
    </header>

    <div class="container">
      <div class="hero">
        <h1>‚öæ MLB Intelligence</h1>
        <p
          style="
            font-size: 1.1rem;
            color: var(--blaze-copper);
            font-weight: 600;
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
          "
        >
          Practice to Play. Blaze Data Wins the Day.
        </p>
        <p class="hero-subtitle">
          Real-time MLB standings, player statistics, and advanced analytics powered by SportsDataIO
        </p>
      </div>

      <div id="root"></div>
    </div>

    <!-- Advanced Analytics Module -->
    <script type="module">
      // Import advanced analytics (ES6 module)
      import MLBAnalytics from '/lib/analytics/baseball/mlb-advanced-analytics.js';
      window.MLBAnalytics = MLBAnalytics;
    </script>

    <script type="text/babel">
      const { useState, useEffect } = React;

      function MLBDashboard() {
        const [activeTab, setActiveTab] = useState('standings');
        const [standings, setStandings] = useState([]);
        const [advancedAnalytics, setAdvancedAnalytics] = useState([]);
        const [teams, setTeams] = useState([]);
        const [selectedTeam, setSelectedTeam] = useState(null);
        const [teamRoster, setTeamRoster] = useState([]);
        const [schedule, setSchedule] = useState([]);
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);

        useEffect(() => {
          fetchMLBData();
        }, []);

        useEffect(() => {
          if (activeTab === 'teams' && teams.length === 0) {
            fetchTeams();
          } else if (activeTab === 'schedule' && schedule.length === 0) {
            fetchSchedule();
          }
        }, [activeTab]);

        const fetchMLBData = async () => {
          setLoading(true);
          setError(null);

          try {
            const standingsRes = await fetch('/api/mlb/standings?season=2025');
            if (!standingsRes.ok) throw new Error('Failed to fetch standings');
            const standingsData = await standingsRes.json();

            // Parse the actual API structure: { records: [{ division, teams: [...] }] }
            const teams = [];
            if (standingsData.records) {
              standingsData.records.forEach((record) => {
                if (record.teams) {
                  record.teams.forEach((teamData) => {
                    teams.push({
                      TeamID: teamData.team?.id,
                      City: teamData.team?.name?.split(' ').slice(0, -1).join(' ') || '',
                      Name: teamData.team?.name?.split(' ').slice(-1)[0] || teamData.team?.name,
                      Division: record.division?.name || 'Unknown',
                      Wins: teamData.wins || 0,
                      Losses: teamData.losses || 0,
                      Percentage: parseFloat(teamData.winningPercentage) || 0,
                      GamesBack: teamData.gamesBack || '-',
                      // Extract run data for advanced analytics
                      runsScored: teamData.runsScored || 0,
                      runsAllowed: teamData.runsAllowed || 0,
                      gamesPlayed: (teamData.wins || 0) + (teamData.losses || 0),
                      // Split records
                      HomeWins: teamData.records?.splitRecords?.find((r) => r.type === 'home')?.wins || 0,
                      HomeLosses: teamData.records?.splitRecords?.find((r) => r.type === 'home')?.losses || 0,
                      AwayWins: teamData.records?.splitRecords?.find((r) => r.type === 'away')?.wins || 0,
                      AwayLosses: teamData.records?.splitRecords?.find((r) => r.type === 'away')?.losses || 0,
                      Last10Wins: teamData.records?.splitRecords?.find((r) => r.type === 'lastTen')?.wins || 0,
                      Last10Losses: teamData.records?.splitRecords?.find((r) => r.type === 'lastTen')?.losses || 0,
                      Streak: teamData.streak?.streakCode || '-',
                      // Additional fields for analytics
                      id: teamData.team?.id,
                      name: teamData.team?.name,
                      division: record.division?.name,
                      wins: teamData.wins || 0,
                      losses: teamData.losses || 0,
                      percentage: parseFloat(teamData.winningPercentage) || 0,
                    });
                  });
                }
              });
            }

            setStandings(teams);

            // Calculate advanced analytics if module is available
            if (window.MLBAnalytics && teams.length > 0) {
              try {
                const analytics = window.MLBAnalytics.generateLeagueAdvancedAnalytics(teams);
                console.log('üìä Advanced Analytics Generated:', analytics);
                setAdvancedAnalytics(analytics.teams || []);
              } catch (analyticsError) {
                console.warn('‚ö†Ô∏è Advanced analytics calculation failed:', analyticsError);
                setAdvancedAnalytics([]);
              }
            }

            setLoading(false);
          } catch (err) {
            console.error('Error fetching MLB data:', err);
            setError(err.message);
            setLoading(false);
          }
        };

        const fetchTeams = async () => {
          setLoading(true);
          setError(null);
          try {
            const response = await fetch('/api/mlb/teams');
            if (!response.ok) throw new Error('Failed to fetch teams');
            const data = await response.json();
            setTeams(data.teams || []);
            setLoading(false);
          } catch (err) {
            console.error('Error fetching teams:', err);
            setError(err.message);
            setLoading(false);
          }
        };

        const fetchTeamRoster = async (teamId) => {
          try {
            const response = await fetch(`/api/mlb/teams/${teamId}`);
            if (!response.ok) throw new Error('Failed to fetch roster');
            const data = await response.json();
            setTeamRoster(data.roster || []);
            setSelectedTeam(data.team);
          } catch (err) {
            console.error('Error fetching roster:', err);
            setTeamRoster([]);
          }
        };

        const fetchSchedule = async () => {
          setLoading(true);
          setError(null);
          try {
            // Fetch last 3 days and next 3 days of games
            const dates = [];
            for (let i = -3; i <= 3; i++) {
              const date = new Date();
              date.setDate(date.getDate() + i);
              dates.push(date.toISOString().split('T')[0]);
            }

            const responses = await Promise.all(
              dates.map((date) => fetch(`/api/mlb/scoreboard?date=${date}`).then((r) => r.json()))
            );

            const allGames = [];
            responses.forEach((data) => {
              if (data.games) {
                allGames.push(...data.games.map((game) => ({ ...game, date: data.date })));
              }
            });

            allGames.sort((a, b) => new Date(b.gameDate) - new Date(a.gameDate));
            setSchedule(allGames);
            setLoading(false);
          } catch (err) {
            console.error('Error fetching schedule:', err);
            setError(err.message);
            setLoading(false);
          }
        };

        const renderStandings = () => {
          if (loading) {
            return (
              <div className="loading">
                <i className="fas fa-baseball-ball"></i>
                <p style={{ marginTop: '20px' }}>Loading MLB standings...</p>
              </div>
            );
          }

          if (error) {
            return (
              <div className="error">
                <strong>‚ö†Ô∏è Data Unavailable</strong>
                <p>{error}</p>
              </div>
            );
          }

          const divisions = {};
          standings.forEach((team) => {
            const div = team.Division || 'Unknown';
            if (!divisions[div]) divisions[div] = [];
            divisions[div].push(team);
          });

          Object.keys(divisions).forEach((div) => {
            divisions[div].sort((a, b) => (b.Wins || 0) - (a.Wins || 0));
          });

          return (
            <div>
              {Object.keys(divisions)
                .sort()
                .map((division) => (
                  <div key={division} className="card">
                    <h2 className="card-title">
                      <i className="fas fa-trophy"></i>
                      {division}
                    </h2>
                    <table className="standings-table">
                      <thead>
                        <tr>
                          <th>Rank</th>
                          <th>Team</th>
                          <th>W</th>
                          <th>L</th>
                          <th>PCT</th>
                          <th>GB</th>
                          <th>Home</th>
                          <th>Away</th>
                          <th>L10</th>
                          <th>Streak</th>
                        </tr>
                      </thead>
                      <tbody>
                        {divisions[division].map((team, idx) => (
                          <tr key={team.TeamID || idx}>
                            <td className="stat-highlight">{idx + 1}</td>
                            <td className="team-name">
                              {team.City} {team.Name}
                            </td>
                            <td>{team.Wins || 0}</td>
                            <td>{team.Losses || 0}</td>
                            <td>{team.Percentage ? team.Percentage.toFixed(3) : '.000'}</td>
                            <td>{team.GamesBack || '-'}</td>
                            <td>
                              {team.HomeWins || 0}-{team.HomeLosses || 0}
                            </td>
                            <td>
                              {team.AwayWins || 0}-{team.AwayLosses || 0}
                            </td>
                            <td>
                              {team.Last10Wins || 0}-{team.Last10Losses || 0}
                            </td>
                            <td>{team.Streak || '-'}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                    <div className="data-source">
                      <i className="fas fa-database"></i> Data Source: MLB Stats API via blazesportsintel.com/api ‚Ä¢ Last
                      Updated: {new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' })} CDT
                    </div>
                  </div>
                ))}
            </div>
          );
        };

        const renderTeams = () => {
          if (loading) {
            return (
              <div className="loading">
                <i className="fas fa-baseball-ball"></i>
                <p style={{ marginTop: '20px' }}>Loading MLB teams...</p>
              </div>
            );
          }

          if (error) {
            return (
              <div className="error">
                <strong>‚ö†Ô∏è Data Unavailable</strong>
                <p>{error}</p>
              </div>
            );
          }

          // Group teams by division
          const divisions = {};
          teams.forEach((team) => {
            const div = team.division || 'Unknown';
            if (!divisions[div]) divisions[div] = [];
            divisions[div].push(team);
          });

          return (
            <div>
              {selectedTeam && teamRoster.length > 0 ? (
                <div className="card">
                  <h2 className="card-title">
                    <button
                      onClick={() => {
                        setSelectedTeam(null);
                        setTeamRoster([]);
                      }}
                      style={{
                        background: 'transparent',
                        border: 'none',
                        color: 'var(--blaze-ember)',
                        cursor: 'pointer',
                        marginRight: '10px',
                      }}
                    >
                      <i className="fas fa-arrow-left"></i>
                    </button>
                    {selectedTeam.name} Roster
                  </h2>
                  <table className="standings-table">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Player</th>
                        <th>Position</th>
                        <th>Status</th>
                      </tr>
                    </thead>
                    <tbody>
                      {teamRoster
                        .sort((a, b) => {
                          const posOrder = {
                            P: 1,
                            C: 2,
                            '1B': 3,
                            '2B': 4,
                            '3B': 5,
                            SS: 6,
                            LF: 7,
                            CF: 8,
                            RF: 9,
                            OF: 7,
                            DH: 10,
                          };
                          return (posOrder[a.position] || 99) - (posOrder[b.position] || 99);
                        })
                        .map((player, idx) => (
                          <tr key={player.id || idx}>
                            <td className="stat-highlight">{player.jerseyNumber || '-'}</td>
                            <td className="team-name">{player.name}</td>
                            <td>{player.position || '-'}</td>
                            <td style={{ color: player.status === 'Active' ? '#10b981' : '#f59e0b' }}>
                              {player.status || 'Unknown'}
                            </td>
                          </tr>
                        ))}
                    </tbody>
                  </table>
                  <div className="data-source">
                    <i className="fas fa-database"></i> Data Source: MLB Stats API via blazesportsintel.com/api ‚Ä¢ Last
                    Updated: {new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' })} CDT
                  </div>
                </div>
              ) : (
                Object.keys(divisions)
                  .sort()
                  .map((division) => (
                    <div key={division} className="card">
                      <h2 className="card-title">
                        <i className="fas fa-baseball-ball"></i>
                        {division}
                      </h2>
                      <div
                        style={{
                          display: 'grid',
                          gridTemplateColumns: 'repeat(auto-fill, minmax(250px, 1fr))',
                          gap: '15px',
                        }}
                      >
                        {divisions[division]
                          .sort((a, b) => a.name.localeCompare(b.name))
                          .map((team) => (
                            <div
                              key={team.id}
                              onClick={() => fetchTeamRoster(team.id)}
                              style={{
                                background: 'var(--dark-slate)',
                                padding: '20px',
                                borderRadius: '8px',
                                border: '1px solid var(--glass-border)',
                                cursor: 'pointer',
                                transition: 'all 0.2s',
                              }}
                              onMouseOver={(e) => (e.currentTarget.style.borderColor = 'var(--blaze-ember)')}
                              onMouseOut={(e) => (e.currentTarget.style.borderColor = 'var(--glass-border)')}
                            >
                              <div className="team-name" style={{ fontSize: '1.1rem', marginBottom: '5px' }}>
                                {team.name}
                              </div>
                              <div style={{ color: 'var(--text-tertiary)', fontSize: '0.9rem' }}>
                                {team.abbreviation} ‚Ä¢ {team.venue}
                              </div>
                            </div>
                          ))}
                      </div>
                    </div>
                  ))
              )}
            </div>
          );
        };

        const renderPlayers = () => {
          return (
            <div className="card">
              <h2 className="card-title">
                <i className="fas fa-star"></i>
                Player Statistics
              </h2>
              <p style={{ color: 'var(--text-tertiary)', marginBottom: '20px' }}>
                View player rosters by clicking on teams in the <strong>Teams</strong> tab
              </p>
              <div
                style={{ background: 'var(--dark-slate)', padding: '30px', borderRadius: '8px', textAlign: 'center' }}
              >
                <i
                  className="fas fa-users"
                  style={{ fontSize: '3rem', color: 'var(--blaze-ember)', marginBottom: '15px' }}
                ></i>
                <p style={{ color: 'var(--text-secondary)' }}>
                  Advanced player statistics and performance metrics coming soon
                </p>
              </div>
            </div>
          );
        };

        const renderSchedule = () => {
          if (loading) {
            return (
              <div className="loading">
                <i className="fas fa-calendar"></i>
                <p style={{ marginTop: '20px' }}>Loading MLB schedule...</p>
              </div>
            );
          }

          if (error) {
            return (
              <div className="error">
                <strong>‚ö†Ô∏è Data Unavailable</strong>
                <p>{error}</p>
              </div>
            );
          }

          // Group games by date
          const gamesByDate = {};
          schedule.forEach((game) => {
            if (!gamesByDate[game.date]) gamesByDate[game.date] = [];
            gamesByDate[game.date].push(game);
          });

          return (
            <div>
              {Object.keys(gamesByDate)
                .sort((a, b) => new Date(b) - new Date(a))
                .map((date) => (
                  <div key={date} className="card">
                    <h2 className="card-title">
                      <i className="fas fa-calendar-day"></i>
                      {new Date(date + 'T00:00:00').toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        timeZone: 'UTC',
                      })}
                    </h2>
                    <div style={{ display: 'grid', gap: '15px' }}>
                      {gamesByDate[date].map((game, idx) => {
                        const isComplete = game.status?.abstractGameState === 'Final';
                        const isLive = game.status?.abstractGameState === 'Live';

                        return (
                          <div
                            key={game.id || idx}
                            style={{
                              background: 'var(--dark-slate)',
                              padding: '20px',
                              borderRadius: '8px',
                              border: `1px solid ${isLive ? '#10b981' : 'var(--glass-border)'}`,
                              display: 'flex',
                              justifyContent: 'space-between',
                              alignItems: 'center',
                            }}
                          >
                            <div style={{ flex: 1 }}>
                              <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px' }}>
                                <span className="team-name">{game.teams.away.team.name}</span>
                                {isComplete && game.teams.away.isWinner && (
                                  <i className="fas fa-check-circle" style={{ color: '#10b981' }}></i>
                                )}
                                <span className="stat-highlight" style={{ marginLeft: 'auto' }}>
                                  {game.teams.away.score ?? '-'}
                                </span>
                              </div>
                              <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                                <span className="team-name">{game.teams.home.team.name}</span>
                                {isComplete && game.teams.home.isWinner && (
                                  <i className="fas fa-check-circle" style={{ color: '#10b981' }}></i>
                                )}
                                <span className="stat-highlight" style={{ marginLeft: 'auto' }}>
                                  {game.teams.home.score ?? '-'}
                                </span>
                              </div>
                            </div>
                            <div style={{ marginLeft: '30px', textAlign: 'right' }}>
                              <div
                                style={{
                                  color: isLive
                                    ? '#10b981'
                                    : isComplete
                                      ? 'var(--text-tertiary)'
                                      : 'var(--blaze-ember)',
                                  fontWeight: '600',
                                  marginBottom: '5px',
                                }}
                              >
                                {game.status?.detailedState || 'Scheduled'}
                              </div>
                              <div style={{ color: 'var(--text-tertiary)', fontSize: '0.9rem' }}>
                                {game.venue?.name || 'TBD'}
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                    <div className="data-source">
                      <i className="fas fa-database"></i> Data Source: MLB Stats API via blazesportsintel.com/api ‚Ä¢ Last
                      Updated: {new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' })} CDT
                    </div>
                  </div>
                ))}
            </div>
          );
        };

        const renderAdvancedAnalytics = () => {
          if (loading) {
            return (
              <div className="loading">
                <i className="fas fa-chart-line"></i>
                <p style={{ marginTop: '20px' }}>Calculating advanced analytics...</p>
              </div>
            );
          }

          if (error) {
            return (
              <div className="error">
                <strong>‚ö†Ô∏è Data Unavailable</strong>
                <p>{error}</p>
              </div>
            );
          }

          if (!advancedAnalytics || advancedAnalytics.length === 0) {
            return (
              <div className="card">
                <h2 className="card-title">
                  <i className="fas fa-chart-line"></i>
                  Advanced Analytics
                </h2>
                <div
                  style={{ background: 'var(--dark-slate)', padding: '30px', borderRadius: '8px', textAlign: 'center' }}
                >
                  <i
                    className="fas fa-calculator"
                    style={{ fontSize: '3rem', color: 'var(--blaze-ember)', marginBottom: '15px' }}
                  ></i>
                  <p style={{ color: 'var(--text-secondary)' }}>
                    Advanced analytics will be available once run data is populated.
                  </p>
                </div>
              </div>
            );
          }

          // Group by division
          const divisions = {};
          advancedAnalytics.forEach((teamAnalytics) => {
            const div = teamAnalytics.team?.division || 'Unknown';
            if (!divisions[div]) divisions[div] = [];
            divisions[div].push(teamAnalytics);
          });

          return (
            <div>
              <div className="card" style={{ marginBottom: '30px', background: 'rgba(191, 87, 0, 0.05)' }}>
                <h2 className="card-title">
                  <i className="fas fa-info-circle"></i>
                  Advanced Analytics Overview
                </h2>
                <div
                  style={{
                    display: 'grid',
                    gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                    gap: '20px',
                    marginBottom: '20px',
                  }}
                >
                  <div
                    style={{
                      background: 'var(--dark-slate)',
                      padding: '15px',
                      borderRadius: '8px',
                      border: '1px solid var(--glass-border)',
                    }}
                  >
                    <div style={{ fontSize: '0.9rem', color: 'var(--text-tertiary)', marginBottom: '5px' }}>
                      Pythagorean Win %
                    </div>
                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: 'var(--blaze-ember)' }}>
                      <i className="fas fa-percentage" style={{ fontSize: '1rem', marginRight: '5px' }}></i>
                      Based on Runs
                    </div>
                    <div style={{ fontSize: '0.8rem', color: 'var(--text-tertiary)', marginTop: '5px' }}>
                      Bill James Formula (1.83 exponent)
                    </div>
                  </div>
                  <div
                    style={{
                      background: 'var(--dark-slate)',
                      padding: '15px',
                      borderRadius: '8px',
                      border: '1px solid var(--glass-border)',
                    }}
                  >
                    <div style={{ fontSize: '0.9rem', color: 'var(--text-tertiary)', marginBottom: '5px' }}>
                      Run Differential
                    </div>
                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: 'var(--blaze-ember)' }}>
                      <i className="fas fa-chart-bar" style={{ fontSize: '1rem', marginRight: '5px' }}></i>
                      Per Game
                    </div>
                    <div style={{ fontSize: '0.8rem', color: 'var(--text-tertiary)', marginTop: '5px' }}>
                      Normalized by games played
                    </div>
                  </div>
                  <div
                    style={{
                      background: 'var(--dark-slate)',
                      padding: '15px',
                      borderRadius: '8px',
                      border: '1px solid var(--glass-border)',
                    }}
                  >
                    <div style={{ fontSize: '0.9rem', color: 'var(--text-tertiary)', marginBottom: '5px' }}>
                      Luck Factor
                    </div>
                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: 'var(--blaze-ember)' }}>
                      <i className="fas fa-dice" style={{ fontSize: '1rem', marginRight: '5px' }}></i>
                      Wins vs Expected
                    </div>
                    <div style={{ fontSize: '0.8rem', color: 'var(--text-tertiary)', marginTop: '5px' }}>
                      Actual wins minus Pythagorean wins
                    </div>
                  </div>
                  <div
                    style={{
                      background: 'var(--dark-slate)',
                      padding: '15px',
                      borderRadius: '8px',
                      border: '1px solid var(--glass-border)',
                    }}
                  >
                    <div style={{ fontSize: '0.9rem', color: 'var(--text-tertiary)', marginBottom: '5px' }}>
                      Strength of Schedule
                    </div>
                    <div style={{ fontSize: '1.5rem', fontWeight: '700', color: 'var(--blaze-ember)' }}>
                      <i className="fas fa-shield-alt" style={{ fontSize: '1rem', marginRight: '5px' }}></i>
                      Division-Based
                    </div>
                    <div style={{ fontSize: '0.8rem', color: 'var(--text-tertiary)', marginTop: '5px' }}>
                      Opponent win percentage proxy
                    </div>
                  </div>
                </div>
                <div
                  style={{
                    fontSize: '0.85rem',
                    color: 'var(--text-tertiary)',
                    padding: '15px',
                    background: 'var(--dark-slate)',
                    borderRadius: '8px',
                  }}
                >
                  <i className="fas fa-lightbulb" style={{ color: 'var(--blaze-ember)', marginRight: '8px' }}></i>
                  <strong>Methodology:</strong> Pythagorean expectation uses runs scored and allowed to estimate "true"
                  team quality. Luck Factor shows teams over/underperforming their run differential. Positive luck often
                  regresses to the mean.
                </div>
              </div>

              {Object.keys(divisions)
                .sort()
                .map((division) => (
                  <div key={division} className="card">
                    <h2 className="card-title">
                      <i className="fas fa-trophy"></i>
                      {division}
                    </h2>
                    <div style={{ overflowX: 'auto' }}>
                      <table className="standings-table">
                        <thead>
                          <tr>
                            <th>Rank</th>
                            <th>Team</th>
                            <th>W-L</th>
                            <th title="Pythagorean Expected Wins">Pyth W</th>
                            <th title="Luck Factor: Actual Wins - Expected Wins" style={{ cursor: 'help' }}>
                              Luck <i className="fas fa-info-circle" style={{ fontSize: '0.8rem', opacity: 0.6 }}></i>
                            </th>
                            <th title="Run Differential per Game">Run Diff/G</th>
                            <th title="Strength of Schedule Rating (50 = average)">SOS</th>
                            <th title="Playoff Probability (if available)">Playoff %</th>
                          </tr>
                        </thead>
                        <tbody>
                          {divisions[division].map((analytics, idx) => {
                            const team = analytics.team;
                            const pythag = analytics.pythagorean;
                            const runDiff = analytics.runDifferential;
                            const sos = analytics.strengthOfSchedule;
                            const playoff = analytics.playoffProbability;

                            return (
                              <tr key={team?.id || idx}>
                                <td className="stat-highlight">{idx + 1}</td>
                                <td className="team-name">{team?.name || 'Unknown'}</td>
                                <td>
                                  {analytics.record?.wins || 0}-{analytics.record?.losses || 0}
                                </td>
                                <td style={{ color: 'var(--blaze-copper)' }}>
                                  {pythag?.expectedWins?.toFixed(1) || 'N/A'}
                                </td>
                                <td>
                                  <span
                                    style={{
                                      color: pythag?.luckColor || '#94a3b8',
                                      fontWeight: '600',
                                      display: 'inline-flex',
                                      alignItems: 'center',
                                      gap: '4px',
                                    }}
                                    title={pythag?.interpretation || ''}
                                  >
                                    {pythag?.luckFactor !== undefined ? (
                                      <>
                                        {pythag.luckFactor > 0 ? '+' : ''}
                                        {pythag.luckFactor.toFixed(1)}
                                        {pythag.luckFactor > 1.5 && (
                                          <i className="fas fa-arrow-up" style={{ fontSize: '0.7rem' }}></i>
                                        )}
                                        {pythag.luckFactor < -1.5 && (
                                          <i className="fas fa-arrow-down" style={{ fontSize: '0.7rem' }}></i>
                                        )}
                                      </>
                                    ) : (
                                      'N/A'
                                    )}
                                  </span>
                                </td>
                                <td>
                                  <span style={{ color: runDiff?.color || '#94a3b8' }}>
                                    {runDiff?.perGameDifferential !== undefined ? (
                                      <>
                                        {runDiff.perGameDifferential > 0 ? '+' : ''}
                                        {runDiff.perGameDifferential.toFixed(2)}
                                      </>
                                    ) : (
                                      'N/A'
                                    )}
                                  </span>
                                </td>
                                <td title={sos?.interpretation || ''}>
                                  <span
                                    style={{
                                      color:
                                        sos?.sosRating > 52 ? '#10b981' : sos?.sosRating < 48 ? '#ef4444' : '#94a3b8',
                                    }}
                                  >
                                    {sos?.sosRating || 50}
                                  </span>
                                </td>
                                <td style={{ color: playoff?.playoffProbability > 50 ? '#10b981' : '#94a3b8' }}>
                                  {playoff?.playoffProbability ? `${playoff.playoffProbability.toFixed(1)}%` : '-'}
                                </td>
                              </tr>
                            );
                          })}
                        </tbody>
                      </table>
                    </div>
                    <div className="data-source">
                      <i className="fas fa-database"></i> Data Source: MLB Stats API + Blaze Intelligence Analytics ‚Ä¢
                      Last Updated: {new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' })} CDT ‚Ä¢
                      <span style={{ marginLeft: '10px' }}>
                        <i className="fas fa-book" style={{ marginRight: '5px' }}></i>
                        Methodology: Bill James (1980), Baseball Prospectus, FiveThirtyEight
                      </span>
                    </div>
                  </div>
                ))}
            </div>
          );
        };

        return (
          <div>
            <div className="tabs">
              <button
                className={`tab ${activeTab === 'standings' ? 'active' : ''}`}
                onClick={() => setActiveTab('standings')}
              >
                <i className="fas fa-list-ol"></i> Standings
              </button>
              <button
                className={`tab ${activeTab === 'advanced' ? 'active' : ''}`}
                onClick={() => setActiveTab('advanced')}
              >
                <i className="fas fa-chart-line"></i> Advanced Analytics
              </button>
              <button className={`tab ${activeTab === 'teams' ? 'active' : ''}`} onClick={() => setActiveTab('teams')}>
                <i className="fas fa-users"></i> Teams
              </button>
              <button
                className={`tab ${activeTab === 'players' ? 'active' : ''}`}
                onClick={() => setActiveTab('players')}
              >
                <i className="fas fa-user"></i> Players
              </button>
              <button
                className={`tab ${activeTab === 'schedule' ? 'active' : ''}`}
                onClick={() => setActiveTab('schedule')}
              >
                <i className="fas fa-calendar"></i> Schedule
              </button>
            </div>

            {activeTab === 'standings' && renderStandings()}
            {activeTab === 'advanced' && renderAdvancedAnalytics()}
            {activeTab === 'teams' && renderTeams()}
            {activeTab === 'players' && renderPlayers()}
            {activeTab === 'schedule' && renderSchedule()}
          </div>
        );
      }

      ReactDOM.render(<MLBDashboard />, document.getElementById('root'));
    </script>

    <!-- Blaze Advanced Graphics System V4 -->
    <script>
      // Global references for graphics engines
      let blazeParticles = null;
      let blazePostprocessing = null;

      async function initAdvancedGraphics() {
        const canvas = document.getElementById('particle-field');
        if (!canvas || typeof THREE === 'undefined') {
          console.warn('Three.js or canvas not available');
          return;
        }

        try {
          console.log('‚öæ Initializing MLB V4 Graphics System...');

          // Initialize Premium V4 Particle Engine with 120K particles (optimized for MLB page)
          blazeParticles = new BlazeParticleEngineV4('particle-field', {
            particleCount: 120000,
            particleSize: 2.5,
            dataNodeCount: 80,
            connectionCount: 150,
            enableMouseInteraction: true,
            enableParallax: true,
            enableFog: true,
            // MLB-specific: Baseball diamond green accent (#006341)
            accentColor: '#006341',
          });

          await blazeParticles.init();
          console.log(`‚úÖ MLB Particle Engine initialized with ${blazeParticles.useWebGPU ? 'WebGPU' : 'WebGL2'}`);

          // Initialize Postprocessing Effects
          if (typeof blazeParticles.renderer !== 'undefined') {
            try {
              blazePostprocessing = new BlazePostprocessing(
                blazeParticles.scene,
                blazeParticles.camera,
                blazeParticles.renderer
              );

              const postprocessingInitialized = await blazePostprocessing.init();
              if (postprocessingInitialized) {
                console.log('‚úÖ MLB Postprocessing pipeline initialized');

                // Replace render method to use postprocessing
                const originalRender = blazeParticles.render.bind(blazeParticles);
                blazeParticles.render = function (deltaTime) {
                  this.update(deltaTime);
                  if (blazePostprocessing && blazePostprocessing.initialized) {
                    blazePostprocessing.render(deltaTime);
                  } else {
                    originalRender(deltaTime);
                  }
                };
              }
            } catch (postError) {
              console.warn('Postprocessing initialization failed, using basic renderer:', postError);
            }
          }

          // Setup scroll-driven effects
          let lastScrollProgress = 0;
          window.addEventListener('scroll', () => {
            if (blazePostprocessing && blazePostprocessing.initialized) {
              const scrollProgress = Math.min(
                window.scrollY / (document.documentElement.scrollHeight - window.innerHeight),
                1
              );
              if (Math.abs(scrollProgress - lastScrollProgress) > 0.01) {
                blazePostprocessing.updateOnScroll(scrollProgress);
                lastScrollProgress = scrollProgress;
              }
            }
          });

          // Setup hover effects for cards
          document.querySelectorAll('.card, .tab, .standings-table tr').forEach((card) => {
            card.addEventListener('mouseenter', () => {
              if (blazePostprocessing && blazePostprocessing.initialized) {
                blazePostprocessing.onCardHover(true);
              }
            });
            card.addEventListener('mouseleave', () => {
              if (blazePostprocessing && blazePostprocessing.initialized) {
                blazePostprocessing.onCardHover(false);
              }
            });
          });

          console.log('üéâ MLB V4 Graphics System Ready!');
          console.log(`   ‚Ä¢ Particles: 120,000 (baseball diamond green accent)`);
          console.log(`   ‚Ä¢ Data Nodes: 80 (varied geometries with PBR)`);
          console.log(`   ‚Ä¢ Renderer: ${blazeParticles.useWebGPU ? 'WebGPU' : 'WebGL2'} with ACES tone mapping`);
        } catch (error) {
          console.error('‚ùå Error initializing MLB advanced graphics:', error);
        }
      }

      // Initialize on load
      window.addEventListener('load', initAdvancedGraphics);
    </script>

    <!-- Cookie Consent Banner -->
    <script src="/components/CookieConsent.js"></script>

    <!-- Universal Footer -->
    <div id="footer-container"></div>
    <script src="/lib/footer.js"></script>
  </body>
</html>

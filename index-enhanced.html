<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blaze Sports Intel - Enhanced Platform v2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            margin-bottom: 40px;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b00, #ffa500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 1.2em;
            color: #ffa500;
            margin-bottom: 20px;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            border-bottom-color: #ffa500;
            color: #ffa500;
        }

        .tab:hover {
            background: rgba(255,255,255,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .card {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .card h2 {
            margin-bottom: 20px;
            color: #ffa500;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(0,255,0,0.2);
            color: #00ff00;
        }

        .status.error {
            background: rgba(255,0,0,0.2);
            color: #ff0000;
        }

        .status.loading {
            background: rgba(255,255,0,0.2);
            color: #ffff00;
        }

        .status.stale {
            background: rgba(255,165,0,0.2);
            color: #ffa500;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .search-container {
            margin: 20px 0;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
        }

        .search-input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .autocomplete-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .autocomplete-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .autocomplete-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .filter-select option {
            background: #1e3c72;
            color: white;
        }

        .loading-spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid #ffa500;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .player-card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #ffa500;
        }

        .game-score {
            font-size: 24px;
            font-weight: bold;
            color: #ffa500;
            text-align: center;
            margin: 10px 0;
        }

        .team-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #ffa500;
        }

        .stat-label {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
        }

        .refresh-btn {
            background: linear-gradient(45deg, #ff6b00, #ffa500);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .refresh-btn:hover {
            transform: scale(1.05);
        }

        .last-updated {
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            text-align: right;
            margin-top: 10px;
        }

        .error-message {
            background: rgba(255,0,0,0.2);
            border: 1px solid #ff0000;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ”¥ Blaze Sports Intel</h1>
            <p class="subtitle">Enhanced Platform v2.0 - Real Data, Real Analytics</p>
            <div class="nav-tabs">
                <div class="tab active" onclick="showTab('overview')">Overview</div>
                <div class="tab" onclick="showTab('standings')">Standings</div>
                <div class="tab" onclick="showTab('players')">Players</div>
                <div class="tab" onclick="showTab('games')">Games</div>
                <div class="tab" onclick="showTab('analytics')">Analytics</div>
            </div>
        </header>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="dashboard">
                <div class="card">
                    <h2>System Status <span id="system-status" class="status loading">Loading...</span></h2>
                    <div id="system-info">
                        <div class="loading-spinner"></div>
                    </div>
                </div>

                <div class="card">
                    <h2>Live Scores <span id="scores-status" class="status loading">Loading...</span></h2>
                    <div id="live-scores">
                        <div class="loading-spinner"></div>
                    </div>
                </div>

                <div class="card">
                    <h2>Recent Updates</h2>
                    <div id="recent-updates">
                        <div class="data-row">
                            <span>Cardinals Analytics Updated</span>
                            <span>2 min ago</span>
                        </div>
                        <div class="data-row">
                            <span>Player Stats Synced</span>
                            <span>5 min ago</span>
                        </div>
                        <div class="data-row">
                            <span>Game Results Updated</span>
                            <span>12 min ago</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Standings Tab -->
        <div id="standings" class="tab-content">
            <div class="filter-controls">
                <select class="filter-select" id="standings-sport" onchange="loadStandings()">
                    <option value="MLB">MLB</option>
                    <option value="NFL">NFL</option>
                    <option value="NBA">NBA</option>
                    <option value="NCAA Football">NCAA Football</option>
                </select>
                <button class="refresh-btn" onclick="loadStandings()">Refresh</button>
            </div>
            <div class="dashboard">
                <div class="card" style="grid-column: 1/-1;">
                    <h2>League Standings <span id="standings-status" class="status loading">Loading...</span></h2>
                    <div id="standings-data">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Players Tab -->
        <div id="players" class="tab-content">
            <div class="search-container">
                <input type="text" class="search-input" id="player-search" 
                       placeholder="Search players by name, team, or position..." 
                       oninput="searchPlayers(this.value)">
                <div class="autocomplete-results" id="player-autocomplete"></div>
            </div>
            <div class="filter-controls">
                <select class="filter-select" id="players-sport" onchange="loadPlayers()">
                    <option value="">All Sports</option>
                    <option value="MLB">MLB</option>
                    <option value="NFL">NFL</option>
                    <option value="NBA">NBA</option>
                </select>
                <select class="filter-select" id="players-position" onchange="loadPlayers()">
                    <option value="">All Positions</option>
                    <option value="QB">QB</option>
                    <option value="RB">RB</option>
                    <option value="WR">WR</option>
                    <option value="P">Pitcher</option>
                    <option value="C">Catcher</option>
                    <option value="OF">Outfield</option>
                </select>
                <button class="refresh-btn" onclick="loadPlayers()">Refresh</button>
            </div>
            <div id="players-data">
                <div class="loading-spinner"></div>
            </div>
        </div>

        <!-- Games Tab -->
        <div id="games" class="tab-content">
            <div class="filter-controls">
                <select class="filter-select" id="games-sport" onchange="loadGames()">
                    <option value="">All Sports</option>
                    <option value="MLB">MLB</option>
                    <option value="NFL">NFL</option>
                    <option value="NBA">NBA</option>
                </select>
                <select class="filter-select" id="games-status" onchange="loadGames()">
                    <option value="">All Games</option>
                    <option value="completed">Completed</option>
                    <option value="scheduled">Scheduled</option>
                    <option value="in_progress">In Progress</option>
                </select>
                <button class="refresh-btn" onclick="loadGames()">Refresh</button>
            </div>
            <div id="games-data">
                <div class="loading-spinner"></div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="search-container">
                <input type="text" class="search-input" id="team-search" 
                       placeholder="Enter team name or ID for detailed analytics..." 
                       onkeypress="if(event.key==='Enter') loadTeamAnalytics(this.value)">
            </div>
            <div id="analytics-data">
                <div class="card">
                    <h2>Team Analytics</h2>
                    <p>Search for a team above to view detailed analytics including:</p>
                    <ul style="margin: 15px 0 0 20px; color: rgba(255,255,255,0.8);">
                        <li>Pythagorean Win Expectation</li>
                        <li>Elo Rating & Historical Changes</li>
                        <li>Strength of Schedule</li>
                        <li>Win Probability Trends</li>
                        <li>Performance vs Expectations</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Base URL
        const API_BASE = 'http://localhost:3000';
        let currentTab = 'overview';

        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            currentTab = tabName;

            // Load data for the tab if needed
            switch(tabName) {
                case 'overview':
                    loadOverview();
                    break;
                case 'standings':
                    loadStandings();
                    break;
                case 'players':
                    loadPlayers();
                    break;
                case 'games':
                    loadGames();
                    break;
                case 'analytics':
                    // Analytics loads on demand
                    break;
            }
        }

        // API Helper Functions
        async function apiCall(endpoint, showError = true) {
            try {
                setStatus(endpoint, 'loading');
                const response = await fetch(`${API_BASE}${endpoint}`);
                const data = await response.json();
                
                if (!data.success && data.success !== undefined) {
                    throw new Error(data.error || 'API call failed');
                }
                
                setStatus(endpoint, 'success');
                return data;
            } catch (error) {
                console.error(`API call failed for ${endpoint}:`, error);
                setStatus(endpoint, 'error');
                if (showError) {
                    showError(`Failed to load data: ${error.message}`);
                }
                return null;
            }
        }

        function setStatus(endpoint, status) {
            const statusMap = {
                '/health': 'system-status',
                '/api/games': 'scores-status',
                'standings': 'standings-status'
            };
            
            const elementId = statusMap[endpoint] || statusMap['standings'];
            const element = document.getElementById(elementId);
            
            if (element) {
                element.className = `status ${status}`;
                element.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            }
        }

        function showError(message) {
            // Show error in current active tab
            const activeTab = document.querySelector('.tab-content.active');
            if (activeTab) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.textContent = message;
                activeTab.insertBefore(errorDiv, activeTab.firstChild);
                
                // Remove error after 5 seconds
                setTimeout(() => errorDiv.remove(), 5000);
            }
        }

        // Load Overview Data
        async function loadOverview() {
            // Load system status
            const health = await apiCall('/health');
            if (health) {
                document.getElementById('system-info').innerHTML = `
                    <div class="data-row">
                        <span>Database</span>
                        <span>${health.database}</span>
                    </div>
                    <div class="data-row">
                        <span>API Server</span>
                        <span>Online</span>
                    </div>
                    <div class="data-row">
                        <span>Last Check</span>
                        <span>${new Date().toLocaleTimeString()}</span>
                    </div>
                `;
            }

            // Load recent games as "live scores"
            const games = await apiCall('/api/games?limit=5');
            if (games && games.games) {
                const scoresHtml = games.games.map(game => `
                    <div class="data-row">
                        <span>${game.away_team_abbr || 'Away'} @ ${game.home_team_abbr || 'Home'}</span>
                        <span class="game-score">${game.away_score || 0} - ${game.home_score || 0}</span>
                    </div>
                `).join('') || '<div class="data-row"><span>No recent games</span><span>-</span></div>';
                
                document.getElementById('live-scores').innerHTML = scoresHtml;
            }
        }

        // Load Standings
        async function loadStandings() {
            const sport = document.getElementById('standings-sport').value;
            const standings = await apiCall(`/api/standings/${sport}`);
            
            if (standings && standings.standings) {
                const standingsHtml = standings.standings.map((team, index) => `
                    <div class="data-row">
                        <span>${index + 1}. ${team.name}</span>
                        <span>${team.wins}-${team.losses} (${(parseFloat(team.wins) / (parseFloat(team.wins) + parseFloat(team.losses))).toFixed(3)})</span>
                    </div>
                `).join('');
                
                document.getElementById('standings-data').innerHTML = standingsHtml + 
                    `<div class="last-updated">Last updated: ${new Date().toLocaleString()}</div>`;
            }
        }

        // Load Players
        async function loadPlayers() {
            const sport = document.getElementById('players-sport').value;
            const position = document.getElementById('players-position').value;
            
            let query = '/api/players?limit=20';
            if (sport) query += `&sport=${sport}`;
            if (position) query += `&position=${position}`;
            
            const players = await apiCall(query);
            
            if (players && players.players) {
                const playersHtml = players.players.map(player => `
                    <div class="player-card">
                        <div class="data-row">
                            <span><strong>${player.first_name} ${player.last_name}</strong></span>
                            <span>#${player.jersey_number || 'N/A'}</span>
                        </div>
                        <div class="data-row">
                            <span>${player.position || 'Unknown'}</span>
                            <span>${player.team_name || 'Free Agent'}</span>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('players-data').innerHTML = playersHtml;
            }
        }

        // Load Games
        async function loadGames() {
            const sport = document.getElementById('games-sport').value;
            const status = document.getElementById('games-status').value;
            
            let query = '/api/games?limit=10';
            if (sport) query += `&sport=${sport}`;
            if (status) query += `&status=${status}`;
            
            const games = await apiCall(query);
            
            if (games && games.games) {
                const gamesHtml = games.games.map(game => `
                    <div class="card">
                        <div class="game-score">${game.away_team_name || 'Away'} @ ${game.home_team_name || 'Home'}</div>
                        <div class="game-score">${game.away_score || 0} - ${game.home_score || 0}</div>
                        <div class="data-row">
                            <span>Status</span>
                            <span>${game.status || 'Unknown'}</span>
                        </div>
                        <div class="data-row">
                            <span>Date</span>
                            <span>${new Date(game.game_date).toLocaleDateString()}</span>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('games-data').innerHTML = gamesHtml;
            }
        }

        // Load Team Analytics
        async function loadTeamAnalytics(teamQuery) {
            if (!teamQuery.trim()) return;
            
            const analytics = await apiCall(`/api/analytics/team/${encodeURIComponent(teamQuery)}`);
            
            if (analytics && analytics.team) {
                const team = analytics.team;
                const stats = analytics.game_statistics;
                const calc = analytics.calculated_metrics;
                
                const analyticsHtml = `
                    <div class="card">
                        <h2>${team.name} Analytics</h2>
                        <div class="team-stats">
                            <div class="stat-item">
                                <div class="stat-value">${stats?.total_games || 0}</div>
                                <div class="stat-label">Games</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${stats?.actual_wins || 0}</div>
                                <div class="stat-label">Wins</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${calc?.actual_win_percentage || '0.000'}</div>
                                <div class="stat-label">Win %</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${calc?.points_differential || '0.0'}</div>
                                <div class="stat-label">Point Diff</div>
                            </div>
                        </div>
                        <div class="last-updated">Data source: ${analytics.dataSource}</div>
                    </div>
                `;
                
                document.getElementById('analytics-data').innerHTML = analyticsHtml;
            }
        }

        // Search Players with Autocomplete
        let searchTimeout;
        async function searchPlayers(query) {
            clearTimeout(searchTimeout);
            
            if (query.length < 2) {
                document.getElementById('player-autocomplete').style.display = 'none';
                return;
            }
            
            searchTimeout = setTimeout(async () => {
                const players = await apiCall(`/api/players?limit=10`, false);
                
                if (players && players.players) {
                    const filtered = players.players.filter(player => 
                        `${player.first_name} ${player.last_name}`.toLowerCase().includes(query.toLowerCase()) ||
                        (player.team_name && player.team_name.toLowerCase().includes(query.toLowerCase())) ||
                        (player.position && player.position.toLowerCase().includes(query.toLowerCase()))
                    );
                    
                    const autocompleteHtml = filtered.map(player => `
                        <div class="autocomplete-item" onclick="selectPlayer('${player.first_name} ${player.last_name}')">
                            ${player.first_name} ${player.last_name} - ${player.position || 'Unknown'} - ${player.team_name || 'Free Agent'}
                        </div>
                    `).join('');
                    
                    const autocomplete = document.getElementById('player-autocomplete');
                    autocomplete.innerHTML = autocompleteHtml;
                    autocomplete.style.display = filtered.length > 0 ? 'block' : 'none';
                }
            }, 300);
        }

        function selectPlayer(playerName) {
            document.getElementById('player-search').value = playerName;
            document.getElementById('player-autocomplete').style.display = 'none';
            // Could load detailed player stats here
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadOverview();
            
            // Set up periodic refresh for overview
            setInterval(() => {
                if (currentTab === 'overview') {
                    loadOverview();
                }
            }, 30000); // Refresh every 30 seconds
        });

        // Hide autocomplete when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.search-container')) {
                document.getElementById('player-autocomplete').style.display = 'none';
            }
        });
    </script>
</body>
</html>
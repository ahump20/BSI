class BlazeGestureHandler{constructor(options={}){this.options={swipeThreshold: options.swipeThreshold||50,swipeVelocity: options.swipeVelocity||0.3,pinchThreshold: options.pinchThreshold||0.1,longPressDelay: options.longPressDelay||500,doubleTapDelay: options.doubleTapDelay||300,pullToRefreshThreshold: options.pullToRefreshThreshold||80,enableSwipe: options.enableSwipe!==false,enablePinch: options.enablePinch!==false,enablePullToRefresh: options.enablePullToRefresh!==false,enableLongPress: options.enableLongPress!==false,enableDoubleTap: options.enableDoubleTap!==false,debug: options.debug||false};this.touchStart={x: 0,y: 0,time: 0};this.touchEnd={x: 0,y: 0,time: 0};this.lastTap=0;this.longPressTimer=null;this.isPinching=false;this.initialPinchDistance=0;this.pullToRefreshActive=false;this.handlers={swipeLeft: [],swipeRight: [],swipeUp: [],swipeDown: [],pinchIn: [],pinchOut: [],longPress: [],doubleTap: [],pullToRefresh: []};this.init();}init(){document.addEventListener('touchstart',this.handleTouchStart.bind(this),{passive: false});document.addEventListener('touchmove',this.handleTouchMove.bind(this),{passive: false});document.addEventListener('touchend',this.handleTouchEnd.bind(this),{passive: false});document.addEventListener('touchcancel',this.handleTouchCancel.bind(this));if(this.options.debug){}}handleTouchStart(e){const touch=e.touches[0];this.touchStart.x=touch.clientX;this.touchStart.y=touch.clientY;this.touchStart.time=Date.now();if(this.options.enablePinch&&e.touches.length===2){this.isPinching=true;this.initialPinchDistance=this.getPinchDistance(e.touches);if(this.options.debug){}}if(this.options.enableLongPress&&e.touches.length===1){this.longPressTimer=setTimeout(()=>{this.trigger('longPress',{x: this.touchStart.x,y: this.touchStart.y,target: e.target});},this.options.longPressDelay);}if(this.options.enableDoubleTap&&e.touches.length===1){const now=Date.now();if(now-this.lastTap<this.options.doubleTapDelay){this.trigger('doubleTap',{x: this.touchStart.x,y: this.touchStart.y,target: e.target});this.lastTap=0;}else{this.lastTap=now;}}}handleTouchMove(e){if(this.longPressTimer){clearTimeout(this.longPressTimer);this.longPressTimer=null;}if(this.isPinching&&e.touches.length===2){const currentDistance=this.getPinchDistance(e.touches);const delta=currentDistance-this.initialPinchDistance;const scale=currentDistance/this.initialPinchDistance;if(Math.abs(scale-1)>this.options.pinchThreshold){if(scale>1){this.trigger('pinchOut',{scale,delta});}else{this.trigger('pinchIn',{scale,delta});}this.initialPinchDistance=currentDistance;}e.preventDefault();}if(this.options.enablePullToRefresh&&e.touches.length===1){const touch=e.touches[0];const deltaY=touch.clientY-this.touchStart.y;if(window.scrollY===0&&deltaY>0){if(deltaY>this.options.pullToRefreshThreshold&&!this.pullToRefreshActive){this.pullToRefreshActive=true;this.trigger('pullToRefresh',{distance: deltaY});}if(deltaY>20){e.preventDefault();}}}}handleTouchEnd(e){if(this.longPressTimer){clearTimeout(this.longPressTimer);this.longPressTimer=null;}if(this.isPinching){this.isPinching=false;return;}if(this.pullToRefreshActive){this.pullToRefreshActive=false;}if(this.options.enableSwipe&&e.changedTouches.length===1){const touch=e.changedTouches[0];this.touchEnd.x=touch.clientX;this.touchEnd.y=touch.clientY;this.touchEnd.time=Date.now();const deltaX=this.touchEnd.x-this.touchStart.x;const deltaY=this.touchEnd.y-this.touchStart.y;const deltaTime=this.touchEnd.time-this.touchStart.time;const velocity=Math.sqrt(deltaX*deltaX+deltaY*deltaY)/deltaTime;if(this.options.debug){}if(Math.abs(deltaX)>Math.abs(deltaY)){if(Math.abs(deltaX)>this.options.swipeThreshold&&velocity>this.options.swipeVelocity){if(deltaX>0){this.trigger('swipeRight',{distance: deltaX,velocity});}else{this.trigger('swipeLeft',{distance: Math.abs(deltaX),velocity});}}}else{if(Math.abs(deltaY)>this.options.swipeThreshold&&velocity>this.options.swipeVelocity){if(deltaY>0){this.trigger('swipeDown',{distance: deltaY,velocity});}else{this.trigger('swipeUp',{distance: Math.abs(deltaY),velocity});}}}}}handleTouchCancel(e){if(this.longPressTimer){clearTimeout(this.longPressTimer);this.longPressTimer=null;}this.isPinching=false;this.pullToRefreshActive=false;}getPinchDistance(touches){const dx=touches[0].clientX-touches[1].clientX;const dy=touches[0].clientY-touches[1].clientY;return Math.sqrt(dx*dx+dy*dy);}on(event,callback){if(this.handlers[event]){this.handlers[event].push(callback);}else{}return this;}off(event,callback){if(this.handlers[event]){const index=this.handlers[event].indexOf(callback);if(index>-1){this.handlers[event].splice(index,1);}}return this;}trigger(event,data={}){if(this.handlers[event]){if(this.options.debug){}this.handlers[event].forEach(callback=>callback(data));}}destroy(){document.removeEventListener('touchstart',this.handleTouchStart);document.removeEventListener('touchmove',this.handleTouchMove);document.removeEventListener('touchend',this.handleTouchEnd);document.removeEventListener('touchcancel',this.handleTouchCancel);this.handlers={};}}class SwipeNavigation{constructor(sections,options={}){this.sections=Array.isArray(sections)? sections : Array.from(document.querySelectorAll(sections));this.currentIndex=0;this.options={loop: options.loop!==false,animationDuration: options.animationDuration||300,onNavigate: options.onNavigate||(()=>{}),...options};this.gesture=new BlazeGestureHandler({enablePinch: false,enablePullToRefresh: false,enableLongPress: false,enableDoubleTap: false});this.init();}init(){this.gesture.on('swipeLeft',()=>this.next());this.gesture.on('swipeRight',()=>this.previous());this.showSection(this.currentIndex);}showSection(index){this.sections.forEach((section,i)=>{if(i===index){section.style.display='block';section.style.opacity='0';setTimeout(()=>{section.style.transition=`opacity ${this.options.animationDuration}ms ease-in-out`;section.style.opacity='1';},10);}else{section.style.opacity='0';setTimeout(()=>{section.style.display='none';},this.options.animationDuration);}});this.currentIndex=index;this.options.onNavigate(index,this.sections[index]);}next(){let nextIndex=this.currentIndex+1;if(nextIndex>=this.sections.length){if(this.options.loop){nextIndex=0;}else{return;}}this.showSection(nextIndex);}previous(){let prevIndex=this.currentIndex-1;if(prevIndex<0){if(this.options.loop){prevIndex=this.sections.length-1;}else{return;}}this.showSection(prevIndex);}destroy(){this.gesture.destroy();}}class PullToRefresh{constructor(container,refreshCallback,options={}){this.container=typeof container==='string' ? document.querySelector(container): container;this.refreshCallback=refreshCallback;this.options={threshold: options.threshold||80,refreshText: options.refreshText||'Pull to refresh',releaseText: options.releaseText||'Release to refresh',loadingText: options.loadingText||'Refreshing...',...options};this.isRefreshing=false;this.pullDistance=0;this.gesture=new BlazeGestureHandler({enableSwipe: false,enablePinch: false,enableLongPress: false,enableDoubleTap: false});this.init();}init(){this.indicator=document.createElement('div');this.indicator.className='pull-to-refresh-indicator';this.indicator.style.cssText=` position: absolute;top:-60px;left: 0;right: 0;height: 60px;display: flex;align-items: center;justify-content: center;color: #BF5700;font-weight: 600;transition: transform 0.3s ease;`;this.indicator.innerHTML=`<div class="pull-to-refresh-content"><i class="fas fa-arrow-down" style="margin-right: 8px;"></i><span>${this.options.refreshText}</span></div>`;if(this.container){this.container.style.position='relative';this.container.insertBefore(this.indicator,this.container.firstChild);}let startY=0;let canPull=false;document.addEventListener('touchstart',(e)=>{if(window.scrollY===0){startY=e.touches[0].clientY;canPull=true;}},{passive: true});document.addEventListener('touchmove',(e)=>{if(!canPull||this.isRefreshing)return;const currentY=e.touches[0].clientY;this.pullDistance=Math.max(0,currentY-startY);if(this.pullDistance>0){const translateY=Math.min(this.pullDistance,this.options.threshold+20);this.indicator.style.transform=`translateY(${translateY}px)`;const icon=this.indicator.querySelector('.fas');const text=this.indicator.querySelector('span');if(this.pullDistance>=this.options.threshold){icon.className='fas fa-arrow-up';text.textContent=this.options.releaseText;}else{icon.className='fas fa-arrow-down';text.textContent=this.options.refreshText;}}},{passive: true});document.addEventListener('touchend',async()=>{if(!canPull||this.isRefreshing)return;if(this.pullDistance>=this.options.threshold){this.isRefreshing=true;const icon=this.indicator.querySelector('.fas');const text=this.indicator.querySelector('span');icon.className='fas fa-spinner fa-spin';text.textContent=this.options.loadingText;try{await this.refreshCallback();}catch(error){console.error('[PullToRefresh] Error:',error);}finally{setTimeout(()=>{this.indicator.style.transform='translateY(0)';this.isRefreshing=false;this.pullDistance=0;canPull=false;setTimeout(()=>{icon.className='fas fa-arrow-down';text.textContent=this.options.refreshText;},300);},500);}}else{this.indicator.style.transform='translateY(0)';this.pullDistance=0;canPull=false;}},{passive: true});}destroy(){this.gesture.destroy();if(this.indicator&&this.indicator.parentNode){this.indicator.parentNode.removeChild(this.indicator);}}}class TouchOptimizedTable{constructor(table,options={}){this.table=typeof table==='string' ? document.querySelector(table): table;this.options={enableHorizontalScroll: options.enableHorizontalScroll!==false,highlightOnTouch: options.highlightOnTouch!==false,...options};this.init();}init(){if(!this.table)return;const wrapper=document.createElement('div');wrapper.className='touch-table-wrapper';wrapper.style.cssText=` overflow-x: auto;-webkit-overflow-scrolling: touch;position: relative;`;this.table.parentNode.insertBefore(wrapper,this.table);wrapper.appendChild(this.table);if(this.options.highlightOnTouch){const rows=this.table.querySelectorAll('tbody tr');rows.forEach(row=>{row.addEventListener('touchstart',()=>{row.style.backgroundColor='rgba(191,87,0,0.1)';},{passive: true});row.addEventListener('touchend',()=>{setTimeout(()=>{row.style.backgroundColor='';},150);},{passive: true});});}const cells=this.table.querySelectorAll('td,th');cells.forEach(cell=>{cell.style.minHeight='44px';cell.style.padding='12px';});}}if(typeof window!=='undefined'){window.BlazeGestureHandler=BlazeGestureHandler;window.SwipeNavigation=SwipeNavigation;window.PullToRefresh=PullToRefresh;window.TouchOptimizedTable=TouchOptimizedTable;}
{"version":3,"file":"index-CyDSLlA9.js","sources":["../../src/core/Field.ts","../../src/core/BallPhysics.ts","../../src/core/PlayerController.ts","../../src/core/SteeringAI.ts","../../src/core/AISystem.ts","../../src/core/ScoreSystem.ts","../../src/core/AudioManager.ts","../../src/core/DriveSystem.ts","../../src/core/PlaybookSystem.ts","../../src/data/teams.ts","../../src/data/plays.ts","../../src/dynamics/GhostRenderer3D.ts","../../src/dynamics/FootballAdapter.ts","../../src/dynamics/GenieSystem.ts","../../src/core/BlitzGameEngine.ts","../../src/core/InputSystem.ts","../../src/main.ts"],"sourcesContent":["/**\n * Blaze Blitz Football - Field Generation\n *\n * Creates the 100-yard football field with yard lines,\n * end zones, hash marks, and team branding\n */\n\nimport {\n  Scene,\n  MeshBuilder,\n  StandardMaterial,\n  PBRMaterial,\n  Color3,\n  Vector3,\n  Mesh,\n  DynamicTexture,\n  PointLight,\n} from '@babylonjs/core';\nimport type { BlitzTeam } from '@data/teams';\n\n/** Field dimensions in game units (1 unit = 1 yard) */\nexport const FIELD_CONFIG = {\n  length: 100,        // 100 yards\n  width: 53.33,       // 53 1/3 yards (160 feet)\n  endZoneDepth: 10,   // 10 yards each end zone\n  hashWidth: 18.5,    // Distance between hash marks\n  yardLineInterval: 5, // Yard lines every 5 yards\n  numberInterval: 10,  // Numbers every 10 yards\n} as const;\n\n/** Colors for field elements */\nconst FIELD_COLORS = {\n  grass: '#2E7D32',\n  grassDark: '#1B5E20',\n  yardLine: '#FFFFFF',\n  hashMark: '#FFFFFF',\n  endZoneText: '#FFFFFF',\n} as const;\n\n/** Field builder class */\nexport class FootballField {\n  private scene: Scene;\n  private homeTeam: BlitzTeam;\n  private awayTeam: BlitzTeam;\n  private fieldMeshes: Mesh[] = [];\n  private _jumbotronTexture: DynamicTexture | null = null;\n\n  constructor(scene: Scene, homeTeam: BlitzTeam, awayTeam: BlitzTeam) {\n    this.scene = scene;\n    this.homeTeam = homeTeam;\n    this.awayTeam = awayTeam;\n  }\n\n  /** Build the complete field */\n  public build(): void {\n    this.createGround();\n    this.createEndZones();\n    this.createYardLines();\n    this.createHashMarks();\n    this.createFieldNumbers();\n    this.createSidelines();\n    this.createStadiumShell();\n  }\n\n  /** Create the main grass surface */\n  private createGround(): void {\n    const totalLength = FIELD_CONFIG.length + FIELD_CONFIG.endZoneDepth * 2;\n\n    // Main playing surface\n    const ground = MeshBuilder.CreateGround(\n      'field',\n      {\n        width: FIELD_CONFIG.width,\n        height: totalLength,\n        subdivisions: 20,\n      },\n      this.scene\n    );\n\n    // Create striped grass texture pattern\n    const grassMat = new PBRMaterial('grassMat', this.scene);\n    grassMat.albedoColor = Color3.FromHexString(FIELD_COLORS.grass);\n    grassMat.roughness = 0.95;\n    grassMat.metallic = 0;\n\n    ground.material = grassMat;\n    ground.receiveShadows = true;\n    ground.position.z = FIELD_CONFIG.length / 2; // Center field at z=50\n\n    this.fieldMeshes.push(ground);\n\n    // Add alternating grass stripes for visual appeal\n    for (let i = 0; i < 20; i++) {\n      if (i % 2 === 0) continue; // Skip even stripes\n\n      const stripe = MeshBuilder.CreateGround(\n        `grassStripe_${i}`,\n        {\n          width: FIELD_CONFIG.width,\n          height: 5,\n        },\n        this.scene\n      );\n\n      const stripeMat = new PBRMaterial(`stripeMat_${i}`, this.scene);\n      stripeMat.albedoColor = Color3.FromHexString(FIELD_COLORS.grassDark);\n      stripeMat.roughness = 0.95;\n      stripeMat.metallic = 0;\n\n      stripe.material = stripeMat;\n      stripe.position.y = 0.001;\n      stripe.position.z = i * 5 + 2.5;\n      stripe.receiveShadows = true;\n\n      this.fieldMeshes.push(stripe);\n    }\n  }\n\n  /** Create the end zones with team colors */\n  private createEndZones(): void {\n    // Home end zone (z < 0)\n    const homeEndZone = MeshBuilder.CreateGround(\n      'homeEndZone',\n      {\n        width: FIELD_CONFIG.width,\n        height: FIELD_CONFIG.endZoneDepth,\n      },\n      this.scene\n    );\n\n    const homeMat = new PBRMaterial('homeEndZoneMat', this.scene);\n    homeMat.albedoColor = Color3.FromHexString(this.homeTeam.primaryColor);\n    homeMat.roughness = 0.9;\n    homeMat.metallic = 0;\n\n    homeEndZone.material = homeMat;\n    homeEndZone.position.y = 0.002;\n    homeEndZone.position.z = -FIELD_CONFIG.endZoneDepth / 2;\n    homeEndZone.receiveShadows = true;\n\n    this.fieldMeshes.push(homeEndZone);\n\n    // Away end zone (z > 100)\n    const awayEndZone = MeshBuilder.CreateGround(\n      'awayEndZone',\n      {\n        width: FIELD_CONFIG.width,\n        height: FIELD_CONFIG.endZoneDepth,\n      },\n      this.scene\n    );\n\n    const awayMat = new PBRMaterial('awayEndZoneMat', this.scene);\n    awayMat.albedoColor = Color3.FromHexString(this.awayTeam.primaryColor);\n    awayMat.roughness = 0.9;\n    awayMat.metallic = 0;\n\n    awayEndZone.material = awayMat;\n    awayEndZone.position.y = 0.002;\n    awayEndZone.position.z = FIELD_CONFIG.length + FIELD_CONFIG.endZoneDepth / 2;\n    awayEndZone.receiveShadows = true;\n\n    this.fieldMeshes.push(awayEndZone);\n\n    // Add team name text to end zones\n    this.createEndZoneText(this.homeTeam, -FIELD_CONFIG.endZoneDepth / 2, false);\n    this.createEndZoneText(this.awayTeam, FIELD_CONFIG.length + FIELD_CONFIG.endZoneDepth / 2, true);\n  }\n\n  /** Create end zone team text */\n  private createEndZoneText(team: BlitzTeam, zPos: number, flip: boolean): void {\n    const textPlane = MeshBuilder.CreatePlane(\n      `endZoneText_${team.id}`,\n      { width: 40, height: 8 },\n      this.scene\n    );\n\n    // Create dynamic texture for text\n    const textureResolution = 1024;\n    const texture = new DynamicTexture(\n      `endZoneTexture_${team.id}`,\n      { width: textureResolution, height: textureResolution / 5 },\n      this.scene,\n      true\n    );\n\n    const ctx = texture.getContext();\n    ctx.fillStyle = 'transparent';\n    ctx.clearRect(0, 0, textureResolution, textureResolution / 5);\n\n    ctx.font = 'bold 120px Arial';\n    ctx.fillStyle = team.secondaryColor;\n    (ctx as unknown as CanvasRenderingContext2D).textAlign = 'center';\n    (ctx as unknown as CanvasRenderingContext2D).textBaseline = 'middle';\n    ctx.fillText(team.shortName, textureResolution / 2, textureResolution / 10);\n\n    texture.update();\n\n    const textMat = new StandardMaterial(`endZoneTextMat_${team.id}`, this.scene);\n    textMat.diffuseTexture = texture;\n    textMat.diffuseTexture.hasAlpha = true;\n    textMat.useAlphaFromDiffuseTexture = true;\n    textMat.backFaceCulling = false;\n    textMat.emissiveColor = Color3.White();\n\n    textPlane.material = textMat;\n    textPlane.rotation.x = Math.PI / 2;\n    textPlane.position.y = 0.003;\n    textPlane.position.z = zPos;\n\n    if (flip) {\n      textPlane.rotation.y = Math.PI;\n    }\n\n    this.fieldMeshes.push(textPlane);\n  }\n\n  /** Create yard lines */\n  private createYardLines(): void {\n    const lineMat = new StandardMaterial('yardLineMat', this.scene);\n    lineMat.diffuseColor = Color3.White();\n    lineMat.emissiveColor = new Color3(0.2, 0.2, 0.2);\n\n    // Create yard lines every 5 yards\n    for (let yard = 0; yard <= FIELD_CONFIG.length; yard += FIELD_CONFIG.yardLineInterval) {\n      const lineWidth = yard % 10 === 0 ? 0.3 : 0.15; // Thicker lines every 10 yards\n\n      const line = MeshBuilder.CreateBox(\n        `yardLine_${yard}`,\n        {\n          width: FIELD_CONFIG.width,\n          height: 0.01,\n          depth: lineWidth,\n        },\n        this.scene\n      );\n\n      line.material = lineMat;\n      line.position.y = 0.005;\n      line.position.z = yard;\n\n      this.fieldMeshes.push(line);\n    }\n\n    // Goal lines (thicker)\n    const goalLineMat = new StandardMaterial('goalLineMat', this.scene);\n    goalLineMat.diffuseColor = Color3.White();\n    goalLineMat.emissiveColor = new Color3(0.5, 0.5, 0.5);\n\n    [0, FIELD_CONFIG.length].forEach((zPos, idx) => {\n      const goalLine = MeshBuilder.CreateBox(\n        `goalLine_${idx}`,\n        {\n          width: FIELD_CONFIG.width,\n          height: 0.01,\n          depth: 0.5,\n        },\n        this.scene\n      );\n\n      goalLine.material = goalLineMat;\n      goalLine.position.y = 0.006;\n      goalLine.position.z = zPos;\n\n      this.fieldMeshes.push(goalLine);\n    });\n  }\n\n  /** Create hash marks */\n  private createHashMarks(): void {\n    const hashMat = new StandardMaterial('hashMat', this.scene);\n    hashMat.diffuseColor = Color3.White();\n\n    const hashLength = 0.75;\n    const hashWidth = 0.1;\n\n    // Hash marks every yard\n    for (let yard = 1; yard < FIELD_CONFIG.length; yard++) {\n      // Skip where yard lines exist\n      if (yard % FIELD_CONFIG.yardLineInterval === 0) continue;\n\n      // Left hash marks\n      const leftHash = MeshBuilder.CreateBox(\n        `hashLeft_${yard}`,\n        {\n          width: hashLength,\n          height: 0.01,\n          depth: hashWidth,\n        },\n        this.scene\n      );\n\n      leftHash.material = hashMat;\n      leftHash.position.x = -FIELD_CONFIG.hashWidth / 2;\n      leftHash.position.y = 0.004;\n      leftHash.position.z = yard;\n\n      this.fieldMeshes.push(leftHash);\n\n      // Right hash marks\n      const rightHash = MeshBuilder.CreateBox(\n        `hashRight_${yard}`,\n        {\n          width: hashLength,\n          height: 0.01,\n          depth: hashWidth,\n        },\n        this.scene\n      );\n\n      rightHash.material = hashMat;\n      rightHash.position.x = FIELD_CONFIG.hashWidth / 2;\n      rightHash.position.y = 0.004;\n      rightHash.position.z = yard;\n\n      this.fieldMeshes.push(rightHash);\n    }\n  }\n\n  /** Create field numbers */\n  private createFieldNumbers(): void {\n    const numbers = [10, 20, 30, 40, 50, 40, 30, 20, 10];\n\n    numbers.forEach((num, idx) => {\n      const zPos = (idx + 1) * 10;\n\n      // Left side number\n      this.createFieldNumber(num, -FIELD_CONFIG.width / 2 + 6, zPos, false);\n\n      // Right side number\n      this.createFieldNumber(num, FIELD_CONFIG.width / 2 - 6, zPos, true);\n    });\n  }\n\n  /** Create a single field number */\n  private createFieldNumber(\n    num: number,\n    xPos: number,\n    zPos: number,\n    flip: boolean\n  ): void {\n    const numberPlane = MeshBuilder.CreatePlane(\n      `fieldNumber_${num}_${xPos > 0 ? 'R' : 'L'}_${zPos}`,\n      { width: 4, height: 6 },\n      this.scene\n    );\n\n    const texture = new DynamicTexture(\n      `numberTexture_${num}_${xPos}_${zPos}`,\n      { width: 256, height: 384 },\n      this.scene,\n      true\n    );\n\n    const ctx = texture.getContext();\n    ctx.clearRect(0, 0, 256, 384);\n\n    ctx.font = 'bold 280px Arial';\n    ctx.fillStyle = '#FFFFFF';\n    ctx.strokeStyle = '#000000';\n    ctx.lineWidth = 8;\n    (ctx as unknown as CanvasRenderingContext2D).textAlign = 'center';\n    (ctx as unknown as CanvasRenderingContext2D).textBaseline = 'middle';\n    ctx.strokeText(num.toString(), 128, 192);\n    ctx.fillText(num.toString(), 128, 192);\n\n    texture.update();\n\n    const numMat = new StandardMaterial(`numberMat_${num}_${xPos}_${zPos}`, this.scene);\n    numMat.diffuseTexture = texture;\n    numMat.diffuseTexture.hasAlpha = true;\n    numMat.useAlphaFromDiffuseTexture = true;\n    numMat.backFaceCulling = false;\n    numMat.emissiveColor = new Color3(0.3, 0.3, 0.3);\n\n    numberPlane.material = numMat;\n    numberPlane.rotation.x = Math.PI / 2;\n    numberPlane.position.x = xPos;\n    numberPlane.position.y = 0.007;\n    numberPlane.position.z = zPos;\n\n    if (flip) {\n      numberPlane.rotation.y = Math.PI;\n    }\n\n    this.fieldMeshes.push(numberPlane);\n  }\n\n  /** Create sidelines and out-of-bounds markers */\n  private createSidelines(): void {\n    const sidelineMat = new StandardMaterial('sidelineMat', this.scene);\n    sidelineMat.diffuseColor = Color3.White();\n    sidelineMat.emissiveColor = new Color3(0.3, 0.3, 0.3);\n\n    const totalLength = FIELD_CONFIG.length + FIELD_CONFIG.endZoneDepth * 2;\n\n    // Left sideline\n    const leftSideline = MeshBuilder.CreateBox(\n      'leftSideline',\n      {\n        width: 0.3,\n        height: 0.01,\n        depth: totalLength,\n      },\n      this.scene\n    );\n\n    leftSideline.material = sidelineMat;\n    leftSideline.position.x = -FIELD_CONFIG.width / 2;\n    leftSideline.position.y = 0.005;\n    leftSideline.position.z = FIELD_CONFIG.length / 2;\n\n    this.fieldMeshes.push(leftSideline);\n\n    // Right sideline\n    const rightSideline = MeshBuilder.CreateBox(\n      'rightSideline',\n      {\n        width: 0.3,\n        height: 0.01,\n        depth: totalLength,\n      },\n      this.scene\n    );\n\n    rightSideline.material = sidelineMat;\n    rightSideline.position.x = FIELD_CONFIG.width / 2;\n    rightSideline.position.y = 0.005;\n    rightSideline.position.z = FIELD_CONFIG.length / 2;\n\n    this.fieldMeshes.push(rightSideline);\n\n    // Out of bounds areas (darker)\n    const oobMat = new PBRMaterial('oobMat', this.scene);\n    oobMat.albedoColor = new Color3(0.15, 0.15, 0.15);\n    oobMat.roughness = 1;\n    oobMat.metallic = 0;\n\n    [-1, 1].forEach((side) => {\n      const oob = MeshBuilder.CreateGround(\n        `oob_${side > 0 ? 'right' : 'left'}`,\n        {\n          width: 10,\n          height: totalLength,\n        },\n        this.scene\n      );\n\n      oob.material = oobMat;\n      oob.position.x = side * (FIELD_CONFIG.width / 2 + 5);\n      oob.position.y = -0.01;\n      oob.position.z = FIELD_CONFIG.length / 2;\n\n      this.fieldMeshes.push(oob);\n    });\n  }\n\n  /** Get yard line position (0-100) from world Z coordinate */\n  public static worldZToYardLine(z: number): number {\n    return Math.max(0, Math.min(100, z));\n  }\n\n  /** Get world Z coordinate from yard line (0-100) */\n  public static yardLineToWorldZ(yardLine: number): number {\n    return yardLine;\n  }\n\n  /** Check if position is in bounds */\n  public static isInBounds(x: number, z: number): boolean {\n    const halfWidth = FIELD_CONFIG.width / 2;\n    return (\n      x >= -halfWidth &&\n      x <= halfWidth &&\n      z >= -FIELD_CONFIG.endZoneDepth &&\n      z <= FIELD_CONFIG.length + FIELD_CONFIG.endZoneDepth\n    );\n  }\n\n  /** Check if position is in end zone */\n  public static isInEndZone(z: number): 'home' | 'away' | null {\n    if (z <= 0) return 'home';\n    if (z >= FIELD_CONFIG.length) return 'away';\n    return null;\n  }\n\n  /** Create stadium grandstands, light towers, and jumbotron */\n  private createStadiumShell(): void {\n    const totalLength = FIELD_CONFIG.length + FIELD_CONFIG.endZoneDepth * 2;\n    const halfWidth = FIELD_CONFIG.width / 2;\n\n    // Grandstand material - dark concrete look\n    const standMat = new PBRMaterial('standMat', this.scene);\n    standMat.albedoColor = new Color3(0.3, 0.3, 0.32);\n    standMat.roughness = 0.85;\n    standMat.metallic = 0.1;\n\n    // 4 grandstands around field perimeter\n    const stands: Array<{ w: number; h: number; d: number; pos: [number, number, number] }> = [\n      { w: 200, h: 15, d: 8, pos: [-(halfWidth + 12), 7.5, FIELD_CONFIG.length / 2] }, // Left\n      { w: 200, h: 15, d: 8, pos: [halfWidth + 12, 7.5, FIELD_CONFIG.length / 2] },    // Right\n      { w: 8, h: 15, d: FIELD_CONFIG.width + 24, pos: [0, 7.5, -FIELD_CONFIG.endZoneDepth - 8] }, // Behind home\n      { w: 8, h: 15, d: FIELD_CONFIG.width + 24, pos: [0, 7.5, FIELD_CONFIG.length + FIELD_CONFIG.endZoneDepth + 8] }, // Behind away\n    ];\n\n    stands.forEach((s, i) => {\n      const stand = MeshBuilder.CreateBox(`grandstand_${i}`, { width: s.d, height: s.h, depth: s.w }, this.scene);\n      stand.material = standMat;\n      stand.position.set(s.pos[0], s.pos[1], s.pos[2]);\n      stand.receiveShadows = true;\n      this.fieldMeshes.push(stand);\n    });\n\n    // 4 corner light towers\n    const towerMat = new PBRMaterial('towerMat', this.scene);\n    towerMat.albedoColor = new Color3(0.4, 0.4, 0.4);\n    towerMat.roughness = 0.6;\n    towerMat.metallic = 0.5;\n\n    const corners: Array<[number, number]> = [\n      [-(halfWidth + 8), -FIELD_CONFIG.endZoneDepth],\n      [halfWidth + 8, -FIELD_CONFIG.endZoneDepth],\n      [-(halfWidth + 8), FIELD_CONFIG.length + FIELD_CONFIG.endZoneDepth],\n      [halfWidth + 8, FIELD_CONFIG.length + FIELD_CONFIG.endZoneDepth],\n    ];\n\n    corners.forEach(([x, z], i) => {\n      const tower = MeshBuilder.CreateCylinder(`lightTower_${i}`, { diameter: 2, height: 40 }, this.scene);\n      tower.material = towerMat;\n      tower.position.set(x, 20, z);\n      this.fieldMeshes.push(tower);\n\n      const light = new PointLight(`towerLight_${i}`, new Vector3(x, 40, z), this.scene);\n      light.intensity = 0.6;\n      light.range = 80;\n      light.diffuse = Color3.White();\n    });\n\n    // Jumbotron behind away end zone\n    const jumbotronPlane = MeshBuilder.CreatePlane(\n      'jumbotron',\n      { width: 20, height: 8 },\n      this.scene\n    );\n    jumbotronPlane.position.set(0, 18, FIELD_CONFIG.length + FIELD_CONFIG.endZoneDepth + 3);\n\n    const jumbotronTexture = new DynamicTexture('jumbotronTex', { width: 512, height: 256 }, this.scene, false);\n    const jumbotronMat = new StandardMaterial('jumbotronMat', this.scene);\n    jumbotronMat.diffuseTexture = jumbotronTexture;\n    jumbotronMat.emissiveColor = new Color3(0.8, 0.8, 0.8);\n    jumbotronMat.backFaceCulling = false;\n    jumbotronPlane.material = jumbotronMat;\n\n    // Initial text\n    this.updateJumbotron(jumbotronTexture, 0, 0);\n    this.fieldMeshes.push(jumbotronPlane);\n\n    // Store reference for updates\n    this._jumbotronTexture = jumbotronTexture;\n  }\n\n  /** Update jumbotron score display */\n  public updateJumbotron(texture: DynamicTexture | null = null, home: number = 0, away: number = 0): void {\n    const tex = texture || this._jumbotronTexture;\n    if (!tex) return;\n    const ctx = tex.getContext();\n    ctx.fillStyle = '#111111';\n    ctx.fillRect(0, 0, 512, 256);\n    ctx.font = 'bold 60px Arial';\n    ctx.fillStyle = '#FFFFFF';\n    (ctx as unknown as CanvasRenderingContext2D).textAlign = 'center';\n    (ctx as unknown as CanvasRenderingContext2D).textBaseline = 'middle';\n    ctx.fillText(`SCORE: ${home} - ${away}`, 256, 128);\n    tex.update();\n  }\n\n  /** Dispose all field meshes */\n  public dispose(): void {\n    this.fieldMeshes.forEach((mesh) => mesh.dispose());\n    this.fieldMeshes = [];\n  }\n}\n","/**\n * Blaze Blitz Football - Ball Physics\n *\n * Arcade-style football physics with:\n * - Bullet pass (flattened arc, high velocity)\n * - Lob pass (higher arc for deep throws)\n * - Magnetic catch radius\n * - Fumble mechanics\n */\n\nimport {\n  Scene,\n  MeshBuilder,\n  StandardMaterial,\n  Color3,\n  Vector3,\n  Mesh,\n  TrailMesh,\n  ParticleSystem,\n  Texture,\n  Color4,\n} from '@babylonjs/core';\n\n/** Ball state */\nexport type BallState =\n  | 'held'        // Ball is being held by a player\n  | 'thrown'      // Ball is in the air (pass)\n  | 'loose'       // Fumble - anyone can grab it\n  | 'dead';       // Play is over\n\n/** Pass type affects trajectory */\nexport type PassType =\n  | 'bullet'      // Flat, fast trajectory\n  | 'touch'       // Normal arc\n  | 'lob';        // High arc for deep throws\n\n/** Football physics configuration */\nexport interface BallConfig {\n  catchRadius: number;      // Magnetic catch radius (yards)\n  fumbleChance: number;     // Base fumble chance on big hits (0-1)\n  bulletVelocity: number;   // Bullet pass velocity (yards/sec)\n  touchVelocity: number;    // Touch pass velocity\n  lobVelocity: number;      // Lob pass velocity\n  gravity: number;          // Gravity strength\n}\n\nconst DEFAULT_CONFIG: BallConfig = {\n  catchRadius: 2.5,         // 2.5 yard catch radius\n  fumbleChance: 0.15,       // 15% base fumble on big hit\n  bulletVelocity: 45,       // Fast bullet pass\n  touchVelocity: 35,        // Normal pass\n  lobVelocity: 25,          // Slower lob\n  gravity: 15,              // Yards/sec^2\n};\n\n/** Football physics manager */\nexport class FootballPhysics {\n  private scene: Scene;\n  private config: BallConfig;\n\n  // Ball mesh and visual effects\n  private ball: Mesh | null = null;\n  private ballTrail: TrailMesh | null = null;\n  private catchParticles: ParticleSystem | null = null;\n\n  // Ball state\n  private state: BallState = 'dead';\n  private holder: string | null = null;  // Player ID holding the ball\n\n  // Trajectory tracking\n  private velocity: Vector3 = Vector3.Zero();\n  private targetPosition: Vector3 | null = null;\n  private passType: PassType = 'touch';\n  private flightTime: number = 0;\n  private maxFlightTime: number = 0;\n\n  constructor(scene: Scene, config: Partial<BallConfig> = {}) {\n    this.scene = scene;\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n\n  /** Initialize the football */\n  public initialize(): void {\n    this.createBall();\n    this.createVisualEffects();\n  }\n\n  /** Create the football mesh */\n  private createBall(): void {\n    // Create prolate spheroid (football shape)\n    this.ball = MeshBuilder.CreateSphere(\n      'football',\n      {\n        diameterX: 0.6,\n        diameterY: 0.35,\n        diameterZ: 0.35,\n        segments: 16,\n      },\n      this.scene\n    );\n\n    // Brown leather material\n    const ballMat = new StandardMaterial('footballMat', this.scene);\n    ballMat.diffuseColor = new Color3(0.55, 0.27, 0.07);\n    ballMat.specularColor = new Color3(0.3, 0.2, 0.1);\n\n    this.ball.material = ballMat;\n    this.ball.position.y = 1; // Start above ground\n    this.ball.rotation.x = Math.PI / 2; // Point forward\n\n    // Initially hidden until game starts\n    this.ball.isVisible = false;\n  }\n\n  /** Create visual effects */\n  private createVisualEffects(): void {\n    if (!this.ball) return;\n\n    // Ball trail when thrown\n    this.ballTrail = new TrailMesh(\n      'ballTrail',\n      this.ball,\n      this.scene,\n      0.15,\n      30,\n      true\n    );\n\n    const trailMat = new StandardMaterial('trailMat', this.scene);\n    trailMat.emissiveColor = new Color3(1, 1, 1);\n    trailMat.alpha = 0.3;\n    this.ballTrail.material = trailMat;\n    this.ballTrail.isVisible = false;\n\n    // Catch particles\n    this.catchParticles = new ParticleSystem('catchParticles', 50, this.scene);\n    this.catchParticles.particleTexture = new Texture(\n      'https://raw.githubusercontent.com/BabylonJS/Assets/master/textures/flare.png',\n      this.scene\n    );\n\n    this.catchParticles.emitter = Vector3.Zero();\n    this.catchParticles.minSize = 0.2;\n    this.catchParticles.maxSize = 0.5;\n    this.catchParticles.minLifeTime = 0.2;\n    this.catchParticles.maxLifeTime = 0.4;\n    this.catchParticles.emitRate = 100;\n    this.catchParticles.blendMode = ParticleSystem.BLENDMODE_ADD;\n    this.catchParticles.gravity = new Vector3(0, -5, 0);\n    this.catchParticles.direction1 = new Vector3(-1, 1, -1);\n    this.catchParticles.direction2 = new Vector3(1, 2, 1);\n    this.catchParticles.color1 = new Color4(1, 0.8, 0, 1);\n    this.catchParticles.color2 = new Color4(1, 0.5, 0, 1);\n    this.catchParticles.colorDead = new Color4(1, 0.3, 0, 0);\n  }\n\n  /** Give ball to a player */\n  public giveTo(playerId: string, position: Vector3): void {\n    this.state = 'held';\n    this.holder = playerId;\n    this.velocity = Vector3.Zero();\n    this.targetPosition = null;\n\n    if (this.ball) {\n      this.ball.isVisible = true;\n      this.ball.position = position.clone();\n      this.ball.position.y = 1.2; // Chest height\n    }\n\n    if (this.ballTrail) {\n      this.ballTrail.isVisible = false;\n    }\n  }\n\n  /** Throw the ball to a target position */\n  public throwTo(\n    targetPos: Vector3,\n    passType: PassType = 'touch',\n    holdTime: number = 0 // How long throw button was held\n  ): void {\n    if (!this.ball || this.state !== 'held') return;\n\n    this.state = 'thrown';\n    this.holder = null;\n    this.passType = passType;\n    this.targetPosition = targetPos.clone();\n    this.flightTime = 0;\n\n    // Determine velocity based on pass type and hold time\n    let baseVelocity: number;\n    let arcHeight: number;\n\n    switch (passType) {\n      case 'bullet':\n        baseVelocity = this.config.bulletVelocity * (1 + holdTime * 0.2);\n        arcHeight = 0.1; // Very flat\n        break;\n      case 'lob':\n        baseVelocity = this.config.lobVelocity;\n        arcHeight = 0.6; // High arc\n        break;\n      default:\n        baseVelocity = this.config.touchVelocity;\n        arcHeight = 0.3; // Normal arc\n    }\n\n    // Calculate trajectory\n    const startPos = this.ball.position.clone();\n    const distance = Vector3.Distance(startPos, targetPos);\n    this.maxFlightTime = distance / baseVelocity;\n\n    // Initial velocity vector\n    const direction = targetPos.subtract(startPos).normalize();\n    const horizontalVelocity = direction.scale(baseVelocity);\n\n    // Add vertical component for arc\n    const peakHeight = distance * arcHeight;\n    const verticalVelocity = (peakHeight + 0.5 * this.config.gravity * Math.pow(this.maxFlightTime / 2, 2)) / (this.maxFlightTime / 2);\n\n    this.velocity = new Vector3(\n      horizontalVelocity.x,\n      verticalVelocity,\n      horizontalVelocity.z\n    );\n\n    // Show trail\n    if (this.ballTrail) {\n      this.ballTrail.isVisible = true;\n    }\n\n    // Rotate ball to point in direction of throw\n    const angle = Math.atan2(direction.x, direction.z);\n    this.ball.rotation.y = angle;\n  }\n\n  /** Update ball physics (call every frame) */\n  public update(deltaTime: number): void {\n    if (!this.ball || this.state !== 'thrown') return;\n\n    this.flightTime += deltaTime;\n\n    // Apply gravity to vertical velocity\n    this.velocity.y -= this.config.gravity * deltaTime;\n\n    // Update position\n    this.ball.position.addInPlace(this.velocity.scale(deltaTime));\n\n    // Spin the ball\n    this.ball.rotation.x += deltaTime * 10;\n\n    // Check if ball hit the ground\n    if (this.ball.position.y <= 0.3) {\n      this.ball.position.y = 0.3;\n      this.state = 'loose'; // Incomplete pass or fumble\n      this.velocity = Vector3.Zero();\n\n      if (this.ballTrail) {\n        this.ballTrail.isVisible = false;\n      }\n    }\n  }\n\n  /** Check if a player is within catch radius */\n  public isInCatchRadius(playerPosition: Vector3): boolean {\n    if (!this.ball || this.state !== 'thrown') return false;\n\n    const distance = Vector3.Distance(this.ball.position, playerPosition);\n    return distance <= this.config.catchRadius;\n  }\n\n  /** Attempt to catch the ball */\n  public attemptCatch(\n    playerId: string,\n    playerPosition: Vector3,\n    catchSkill: number = 5 // 1-10 skill\n  ): boolean {\n    if (!this.ball || this.state !== 'thrown') return false;\n\n    const distance = Vector3.Distance(this.ball.position, playerPosition);\n\n    // Must be within catch radius\n    if (distance > this.config.catchRadius) return false;\n\n    // Catch success based on skill and distance\n    const baseSuccess = 0.7 + (catchSkill / 10) * 0.25;\n    const distancePenalty = (distance / this.config.catchRadius) * 0.2;\n    const successChance = baseSuccess - distancePenalty;\n\n    const caught = Math.random() < successChance;\n\n    if (caught) {\n      // Magnetic snap to player\n      this.giveTo(playerId, playerPosition);\n\n      // Catch particles effect\n      if (this.catchParticles) {\n        this.catchParticles.emitter = playerPosition.clone();\n        this.catchParticles.start();\n        setTimeout(() => this.catchParticles?.stop(), 200);\n      }\n\n      return true;\n    }\n\n    // Dropped - ball becomes loose\n    this.state = 'loose';\n    return false;\n  }\n\n  /** Force a fumble */\n  public fumble(tacklerPower: number = 5): boolean {\n    if (this.state !== 'held') return false;\n\n    const fumbleChance = this.config.fumbleChance * (tacklerPower / 5);\n    const fumbled = Math.random() < fumbleChance;\n\n    if (fumbled) {\n      this.state = 'loose';\n      this.holder = null;\n\n      if (this.ball) {\n        // Ball pops out in random direction\n        const randomAngle = Math.random() * Math.PI * 2;\n        this.velocity = new Vector3(\n          Math.cos(randomAngle) * 5,\n          3,\n          Math.sin(randomAngle) * 5\n        );\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  /** Pick up a loose ball */\n  public pickUp(playerId: string, playerPosition: Vector3): boolean {\n    if (!this.ball || this.state !== 'loose') return false;\n\n    const distance = Vector3.Distance(this.ball.position, playerPosition);\n\n    if (distance <= 1.5) { // Must be close to pick up\n      this.giveTo(playerId, playerPosition);\n      return true;\n    }\n\n    return false;\n  }\n\n  /** Update ball position when held by a player */\n  public updateHeldPosition(playerPosition: Vector3, facingAngle: number): void {\n    if (!this.ball || this.state !== 'held') return;\n\n    // Position ball at player's side\n    const offsetX = Math.sin(facingAngle) * 0.3;\n    const offsetZ = Math.cos(facingAngle) * 0.3;\n\n    this.ball.position.x = playerPosition.x + offsetX;\n    this.ball.position.y = playerPosition.y + 0.8;\n    this.ball.position.z = playerPosition.z + offsetZ;\n    this.ball.rotation.y = facingAngle;\n  }\n\n  /** Mark ball as dead (play over) */\n  public markDead(): void {\n    this.state = 'dead';\n    this.holder = null;\n    this.velocity = Vector3.Zero();\n\n    if (this.ballTrail) {\n      this.ballTrail.isVisible = false;\n    }\n  }\n\n  /** Get current ball state */\n  public getState(): BallState {\n    return this.state;\n  }\n\n  /** Get who is holding the ball */\n  public getHolder(): string | null {\n    return this.holder;\n  }\n\n  /** Get ball position */\n  public getPosition(): Vector3 | null {\n    return this.ball?.position.clone() || null;\n  }\n\n  /** Get ball mesh for collision detection */\n  public getMesh(): Mesh | null {\n    return this.ball;\n  }\n\n  /** Check if ball is catchable (in air) */\n  public isCatchable(): boolean {\n    return this.state === 'thrown';\n  }\n\n  /** Hide the ball */\n  public hide(): void {\n    if (this.ball) {\n      this.ball.isVisible = false;\n    }\n    if (this.ballTrail) {\n      this.ballTrail.isVisible = false;\n    }\n  }\n\n  /** Show the ball */\n  public show(): void {\n    if (this.ball) {\n      this.ball.isVisible = true;\n    }\n  }\n\n  /** Dispose resources */\n  public dispose(): void {\n    this.ball?.dispose();\n    this.ballTrail?.dispose();\n    this.catchParticles?.dispose();\n  }\n}\n","/**\n * Blaze Blitz Football - Player Controller\n *\n * Snappy, arcade-style controls:\n * - WASD movement with instant acceleration\n * - Turbo boost with stamina management\n * - Tackle mechanics with late-hit window\n * - Context-sensitive actions (snap, throw, tackle)\n */\n\nimport { Vector3 } from '@babylonjs/core';\n\n/** Input state */\nexport interface InputState {\n  moveX: number;       // -1 to 1 (A/D or left/right)\n  moveZ: number;       // -1 to 1 (W/S or up/down)\n  turbo: boolean;      // Shift held\n  action: boolean;     // Space pressed\n  actionHoldTime: number; // How long action button held\n  selectReceiver: number | null; // Which receiver to target (0-4)\n  mouseX: number;      // Mouse position for aiming\n  mouseZ: number;\n}\n\n/** Player movement configuration */\nexport interface PlayerControlConfig {\n  baseSpeed: number;         // Normal movement speed (yards/sec)\n  turboMultiplier: number;   // Speed boost when turbo active\n  accelerationTime: number;  // Time to reach max speed (seconds)\n  maxStamina: number;        // Total stamina pool\n  staminaDrainRate: number;  // Stamina drain per second when turbo\n  staminaRegenRate: number;  // Stamina regen per second when not turbo\n  fatigueSpeedFloor: number; // Min speed multiplier at zero stamina\n  cutbackPenalty: number;    // Speed loss on sharp cuts (0-1)\n  tackleRadius: number;      // How close to tackle\n  tackleImpulse: number;     // Knockback force on tackle\n  lateHitWindow: number;     // Seconds after whistle tackles still work\n}\n\nconst DEFAULT_CONFIG: PlayerControlConfig = {\n  baseSpeed: 15,            // 15 yards/sec (fast arcade feel)\n  turboMultiplier: 1.5,     // 50% speed boost\n  accelerationTime: 0.2,    // Nearly instant acceleration\n  maxStamina: 100,\n  staminaDrainRate: 25,     // 4 seconds of full turbo\n  staminaRegenRate: 15,     // Slower regen\n  fatigueSpeedFloor: 0.84,  // Fatigue slows top speed at low stamina\n  cutbackPenalty: 0.28,     // Momentum loss on sharp cuts\n  tackleRadius: 1.5,        // 1.5 yard tackle range\n  tackleImpulse: 8,         // Knockback force\n  lateHitWindow: 1.5,       // 1.5 seconds of late-hit drama\n};\n\n/** Player controller class */\nexport class PlayerController {\n  private config: PlayerControlConfig;\n  private inputState: InputState;\n\n  // Movement state\n  private velocity: Vector3 = Vector3.Zero();\n  private position: Vector3;\n  private rotation: number = 0; // Facing direction (radians)\n\n  // Stamina\n  private stamina: number;\n  private isTurboActive: boolean = false;\n\n  // Action state\n  private isActionPressed: boolean = false;\n  private actionPressTime: number = 0;\n  private canAct: boolean = true;\n\n  // Tackle state\n  private isTackling: boolean = false;\n  private tackleTimer: number = 0;\n  private whistleBlown: boolean = false;\n  private whistleTime: number = 0;\n\n  // Keyboard state tracking\n  private keysDown: Set<string> = new Set();\n\n  constructor(startPosition: Vector3, config: Partial<PlayerControlConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.position = startPosition.clone();\n    this.stamina = this.config.maxStamina;\n\n    this.inputState = {\n      moveX: 0,\n      moveZ: 0,\n      turbo: false,\n      action: false,\n      actionHoldTime: 0,\n      selectReceiver: null,\n      mouseX: 0,\n      mouseZ: 0,\n    };\n\n    this.setupInputHandlers();\n  }\n\n  /** Setup keyboard and mouse input handlers */\n  private setupInputHandlers(): void {\n    // Keyboard down\n    window.addEventListener('keydown', (e) => {\n      this.keysDown.add(e.code);\n\n      // Track action press time\n      if (e.code === 'Space' && !this.isActionPressed) {\n        this.isActionPressed = true;\n        this.actionPressTime = performance.now();\n      }\n\n      // Receiver selection (1-5 keys)\n      if (e.code >= 'Digit1' && e.code <= 'Digit5') {\n        this.inputState.selectReceiver = parseInt(e.code.slice(-1)) - 1;\n      }\n\n      this.updateInputState();\n    });\n\n    // Keyboard up\n    window.addEventListener('keyup', (e) => {\n      this.keysDown.delete(e.code);\n\n      if (e.code === 'Space') {\n        this.isActionPressed = false;\n        this.inputState.actionHoldTime = (performance.now() - this.actionPressTime) / 1000;\n      }\n\n      this.updateInputState();\n    });\n\n    // Mouse move for aiming\n    window.addEventListener('mousemove', (e) => {\n      // Convert screen coordinates to field coordinates\n      // This will need to be updated based on camera setup\n      this.inputState.mouseX = (e.clientX / window.innerWidth - 0.5) * 2;\n      this.inputState.mouseZ = (e.clientY / window.innerHeight - 0.5) * 2;\n    });\n\n    // Mouse click for receiver selection\n    window.addEventListener('click', (e) => {\n      // Will be used for clicking on receivers to select\n      this.inputState.action = true;\n    });\n  }\n\n  /** Update input state from keyboard state */\n  private updateInputState(): void {\n    // Movement (WASD)\n    this.inputState.moveX = 0;\n    this.inputState.moveZ = 0;\n\n    if (this.keysDown.has('KeyA') || this.keysDown.has('ArrowLeft')) {\n      this.inputState.moveX -= 1;\n    }\n    if (this.keysDown.has('KeyD') || this.keysDown.has('ArrowRight')) {\n      this.inputState.moveX += 1;\n    }\n    if (this.keysDown.has('KeyW') || this.keysDown.has('ArrowUp')) {\n      this.inputState.moveZ += 1; // Forward is positive Z\n    }\n    if (this.keysDown.has('KeyS') || this.keysDown.has('ArrowDown')) {\n      this.inputState.moveZ -= 1;\n    }\n\n    // Turbo (Shift)\n    this.inputState.turbo = this.keysDown.has('ShiftLeft') || this.keysDown.has('ShiftRight');\n\n    // Action (Space)\n    this.inputState.action = this.keysDown.has('Space');\n  }\n\n  /** Update player movement (call every frame) */\n  public update(deltaTime: number): void {\n    // Handle stamina\n    this.updateStamina(deltaTime);\n\n    // Calculate movement\n    this.updateMovement(deltaTime);\n\n    // Update tackle timer\n    if (this.isTackling) {\n      this.tackleTimer -= deltaTime;\n      if (this.tackleTimer <= 0) {\n        this.isTackling = false;\n      }\n    }\n\n    // Reset one-frame inputs\n    this.inputState.selectReceiver = null;\n  }\n\n  /** Update stamina based on turbo usage */\n  private updateStamina(deltaTime: number): void {\n    if (this.inputState.turbo && this.stamina > 0) {\n      // Drain stamina when using turbo\n      this.stamina -= this.config.staminaDrainRate * deltaTime;\n      this.stamina = Math.max(0, this.stamina);\n      this.isTurboActive = this.stamina > 0;\n    } else {\n      // Regenerate stamina when not using turbo\n      this.stamina += this.config.staminaRegenRate * deltaTime;\n      this.stamina = Math.min(this.config.maxStamina, this.stamina);\n      this.isTurboActive = false;\n    }\n  }\n\n  /** Update player movement based on input */\n  private updateMovement(deltaTime: number): void {\n    // Get movement input\n    const inputDir = new Vector3(\n      this.inputState.moveX,\n      0,\n      this.inputState.moveZ\n    );\n\n    // Normalize if moving diagonally\n    if (inputDir.length() > 0) {\n      inputDir.normalize();\n    }\n\n    // Calculate target speed\n    let targetSpeed = this.config.baseSpeed;\n    if (this.isTurboActive) {\n      targetSpeed *= this.config.turboMultiplier;\n    }\n\n    const staminaRatio = this.config.maxStamina > 0\n      ? Math.max(0, Math.min(1, this.stamina / this.config.maxStamina))\n      : 1;\n    const fatigueFactor = this.config.fatigueSpeedFloor\n      + (1 - this.config.fatigueSpeedFloor) * staminaRatio;\n    targetSpeed *= fatigueFactor;\n\n    if (inputDir.length() > 0 && this.velocity.length() > 0.5) {\n      const currentDir = this.velocity.clone().normalize();\n      const alignment = Math.max(-1, Math.min(1, Vector3.Dot(currentDir, inputDir)));\n      const turnIntensity = Math.min(1, (1 - alignment) / 2);\n      targetSpeed *= 1 - turnIntensity * this.config.cutbackPenalty;\n    }\n\n    // Target velocity\n    const targetVelocity = inputDir.scale(targetSpeed);\n\n    // Snappy acceleration (almost instant)\n    const lerpFactor = 1 - Math.pow(0.01, deltaTime / this.config.accelerationTime);\n    this.velocity = Vector3.Lerp(this.velocity, targetVelocity, lerpFactor);\n\n    // Update position\n    this.position.addInPlace(this.velocity.scale(deltaTime));\n\n    // Update rotation to face movement direction\n    if (this.velocity.length() > 0.5) {\n      this.rotation = Math.atan2(this.velocity.x, this.velocity.z);\n    }\n  }\n\n  /** Attempt a tackle */\n  public attemptTackle(): boolean {\n    if (this.isTackling) return false;\n\n    this.isTackling = true;\n    this.tackleTimer = 0.3; // Tackle animation duration\n\n    return true;\n  }\n\n  /** Check if we can tackle a target */\n  public canTackle(targetPosition: Vector3): boolean {\n    // Check late hit window\n    if (this.whistleBlown) {\n      const timeSinceWhistle = (performance.now() - this.whistleTime) / 1000;\n      if (timeSinceWhistle > this.config.lateHitWindow) {\n        return false;\n      }\n    }\n\n    const distance = Vector3.Distance(this.position, targetPosition);\n    return distance <= this.config.tackleRadius;\n  }\n\n  /** Calculate tackle impulse direction */\n  public getTackleImpulse(targetPosition: Vector3): Vector3 {\n    const direction = targetPosition.subtract(this.position).normalize();\n    return direction.scale(this.config.tackleImpulse);\n  }\n\n  /** Mark whistle blown (play is dead) */\n  public blowWhistle(): void {\n    this.whistleBlown = true;\n    this.whistleTime = performance.now();\n  }\n\n  /** Reset for new play */\n  public resetForNewPlay(): void {\n    this.velocity = Vector3.Zero();\n    this.isTackling = false;\n    this.tackleTimer = 0;\n    this.whistleBlown = false;\n    this.canAct = true;\n    this.isActionPressed = false;\n    this.inputState.actionHoldTime = 0;\n  }\n\n  /** Get current position */\n  public getPosition(): Vector3 {\n    return this.position.clone();\n  }\n\n  /** Set position (for teleporting/reset) */\n  public setPosition(pos: Vector3): void {\n    this.position = pos.clone();\n  }\n\n  /** Get current velocity */\n  public getVelocity(): Vector3 {\n    return this.velocity.clone();\n  }\n\n  /** Get facing rotation */\n  public getRotation(): number {\n    return this.rotation;\n  }\n\n  /** Get current stamina (0-100) */\n  public getStamina(): number {\n    return this.stamina;\n  }\n\n  /** Is turbo currently active */\n  public isTurboOn(): boolean {\n    return this.isTurboActive;\n  }\n\n  /** Get current input state */\n  public getInputState(): InputState {\n    return { ...this.inputState };\n  }\n\n  /** Is action button pressed */\n  public isActionDown(): boolean {\n    return this.inputState.action;\n  }\n\n  /** Get action hold time (for bullet pass) */\n  public getActionHoldTime(): number {\n    return this.inputState.actionHoldTime;\n  }\n\n  /** Get selected receiver index */\n  public getSelectedReceiver(): number | null {\n    return this.inputState.selectReceiver;\n  }\n\n  /** Is player currently tackling */\n  public isTacklingNow(): boolean {\n    return this.isTackling;\n  }\n\n  /** Update configuration */\n  public updateConfig(config: Partial<PlayerControlConfig>): void {\n    this.config = { ...this.config, ...config };\n  }\n\n  /** Dispose input handlers */\n  public dispose(): void {\n    // Remove event listeners if needed\n    // In a real implementation, we'd store references to remove them\n    this.keysDown.clear();\n  }\n}\n\n/**\n * Touch controls for mobile with visual feedback and haptics\n */\nexport class TouchController {\n  private canvas: HTMLCanvasElement;\n  private virtualJoystickCenter: { x: number; y: number } | null = null;\n  private virtualJoystickCurrent: { x: number; y: number } | null = null;\n  private virtualJoystickActive: boolean = false;\n  private touchStartTime: number = 0;\n  private actionTouchId: number | null = null;\n  private joystickTouchId: number | null = null;\n\n  // Visual elements\n  private joystickOuter: HTMLDivElement | null = null;\n  private joystickInner: HTMLDivElement | null = null;\n  private actionButton: HTMLDivElement | null = null;\n  private turboButton: HTMLDivElement | null = null;\n\n  // Output state\n  public moveX: number = 0;\n  public moveZ: number = 0;\n  public turbo: boolean = false;\n  public action: boolean = false;\n  public selectedReceiver: number | null = null;\n\n  // Configuration\n  private readonly JOYSTICK_SIZE = 120;\n  private readonly JOYSTICK_INNER_SIZE = 50;\n  private readonly BUTTON_SIZE = 80;\n  private readonly HAPTIC_TAP = [10];\n  private readonly HAPTIC_HEAVY = [30];\n  private readonly HAPTIC_DOUBLE = [10, 50, 10];\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this.createVisualControls();\n    this.setupTouchHandlers();\n  }\n\n  /** Create visual touch control overlays */\n  private createVisualControls(): void {\n    // Create container for touch controls\n    const container = document.createElement('div');\n    container.id = 'touchControls';\n    container.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n      z-index: 50;\n      display: none;\n    `;\n    document.body.appendChild(container);\n\n    // Virtual joystick outer ring\n    this.joystickOuter = document.createElement('div');\n    this.joystickOuter.style.cssText = `\n      position: absolute;\n      bottom: 100px;\n      left: 40px;\n      width: ${this.JOYSTICK_SIZE}px;\n      height: ${this.JOYSTICK_SIZE}px;\n      border-radius: 50%;\n      border: 3px solid rgba(57, 255, 20, 0.5);\n      background: rgba(0, 0, 0, 0.3);\n      pointer-events: auto;\n      touch-action: none;\n    `;\n    container.appendChild(this.joystickOuter);\n\n    // Virtual joystick inner knob\n    this.joystickInner = document.createElement('div');\n    this.joystickInner.style.cssText = `\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      width: ${this.JOYSTICK_INNER_SIZE}px;\n      height: ${this.JOYSTICK_INNER_SIZE}px;\n      border-radius: 50%;\n      background: radial-gradient(circle, rgba(57, 255, 20, 0.8) 0%, rgba(57, 255, 20, 0.4) 100%);\n      transform: translate(-50%, -50%);\n      box-shadow: 0 0 15px rgba(57, 255, 20, 0.6);\n      transition: transform 0.05s ease-out;\n    `;\n    this.joystickOuter.appendChild(this.joystickInner);\n\n    // Action button (throw/snap)\n    this.actionButton = document.createElement('div');\n    this.actionButton.style.cssText = `\n      position: absolute;\n      bottom: 100px;\n      right: 40px;\n      width: ${this.BUTTON_SIZE}px;\n      height: ${this.BUTTON_SIZE}px;\n      border-radius: 50%;\n      border: 3px solid rgba(255, 110, 199, 0.6);\n      background: rgba(255, 110, 199, 0.3);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: 'Russo One', sans-serif;\n      font-size: 12px;\n      color: white;\n      text-transform: uppercase;\n      pointer-events: auto;\n      touch-action: none;\n      user-select: none;\n    `;\n    this.actionButton.textContent = 'THROW';\n    container.appendChild(this.actionButton);\n\n    // Turbo button\n    this.turboButton = document.createElement('div');\n    this.turboButton.style.cssText = `\n      position: absolute;\n      bottom: 200px;\n      right: 40px;\n      width: ${this.BUTTON_SIZE * 0.8}px;\n      height: ${this.BUTTON_SIZE * 0.8}px;\n      border-radius: 50%;\n      border: 3px solid rgba(255, 215, 0, 0.6);\n      background: rgba(255, 215, 0, 0.2);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-family: 'Russo One', sans-serif;\n      font-size: 10px;\n      color: white;\n      text-transform: uppercase;\n      pointer-events: auto;\n      touch-action: none;\n      user-select: none;\n    `;\n    this.turboButton.textContent = 'TURBO';\n    container.appendChild(this.turboButton);\n\n    // Show controls on mobile\n    if ('ontouchstart' in window) {\n      container.style.display = 'block';\n    }\n  }\n\n  /** Trigger haptic feedback */\n  private haptic(pattern: number[]): void {\n    if ('vibrate' in navigator) {\n      navigator.vibrate(pattern);\n    }\n  }\n\n  private setupTouchHandlers(): void {\n    // Joystick touch handlers\n    this.joystickOuter?.addEventListener('touchstart', this.handleJoystickStart.bind(this), { passive: false });\n    this.joystickOuter?.addEventListener('touchmove', this.handleJoystickMove.bind(this), { passive: false });\n    this.joystickOuter?.addEventListener('touchend', this.handleJoystickEnd.bind(this), { passive: false });\n    this.joystickOuter?.addEventListener('touchcancel', this.handleJoystickEnd.bind(this), { passive: false });\n\n    // Action button handlers\n    this.actionButton?.addEventListener('touchstart', this.handleActionStart.bind(this), { passive: false });\n    this.actionButton?.addEventListener('touchend', this.handleActionEnd.bind(this), { passive: false });\n    this.actionButton?.addEventListener('touchcancel', this.handleActionEnd.bind(this), { passive: false });\n\n    // Turbo button handlers\n    this.turboButton?.addEventListener('touchstart', this.handleTurboStart.bind(this), { passive: false });\n    this.turboButton?.addEventListener('touchend', this.handleTurboEnd.bind(this), { passive: false });\n    this.turboButton?.addEventListener('touchcancel', this.handleTurboEnd.bind(this), { passive: false });\n\n    // Fallback: Canvas touch for areas without visual controls\n    this.canvas.addEventListener('touchstart', this.handleCanvasTouch.bind(this), { passive: false });\n  }\n\n  private handleJoystickStart(e: TouchEvent): void {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const touch = e.changedTouches[0];\n    this.joystickTouchId = touch.identifier;\n    this.virtualJoystickActive = true;\n\n    const rect = this.joystickOuter!.getBoundingClientRect();\n    this.virtualJoystickCenter = {\n      x: rect.left + rect.width / 2,\n      y: rect.top + rect.height / 2,\n    };\n    this.virtualJoystickCurrent = {\n      x: touch.clientX,\n      y: touch.clientY,\n    };\n\n    this.haptic(this.HAPTIC_TAP);\n    this.updateJoystickVisual();\n  }\n\n  private handleJoystickMove(e: TouchEvent): void {\n    e.preventDefault();\n\n    for (let i = 0; i < e.changedTouches.length; i++) {\n      const touch = e.changedTouches[i];\n      if (touch.identifier === this.joystickTouchId && this.virtualJoystickCenter) {\n        this.virtualJoystickCurrent = {\n          x: touch.clientX,\n          y: touch.clientY,\n        };\n\n        const dx = touch.clientX - this.virtualJoystickCenter.x;\n        const dy = touch.clientY - this.virtualJoystickCenter.y;\n\n        const maxRadius = this.JOYSTICK_SIZE / 2 - this.JOYSTICK_INNER_SIZE / 2;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n\n        if (distance > 8) { // Dead zone\n          const clampedDist = Math.min(distance, maxRadius);\n          this.moveX = (dx / maxRadius) * Math.min(1, clampedDist / maxRadius);\n          this.moveZ = (-dy / maxRadius) * Math.min(1, clampedDist / maxRadius); // Invert Y\n        } else {\n          this.moveX = 0;\n          this.moveZ = 0;\n        }\n\n        this.updateJoystickVisual();\n        break;\n      }\n    }\n  }\n\n  private handleJoystickEnd(e: TouchEvent): void {\n    e.preventDefault();\n\n    for (let i = 0; i < e.changedTouches.length; i++) {\n      if (e.changedTouches[i].identifier === this.joystickTouchId) {\n        this.joystickTouchId = null;\n        this.virtualJoystickActive = false;\n        this.moveX = 0;\n        this.moveZ = 0;\n        this.resetJoystickVisual();\n        break;\n      }\n    }\n  }\n\n  private handleActionStart(e: TouchEvent): void {\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.action = true;\n    this.touchStartTime = performance.now();\n    this.actionTouchId = e.changedTouches[0].identifier;\n\n    // Visual feedback\n    if (this.actionButton) {\n      this.actionButton.style.background = 'rgba(255, 110, 199, 0.7)';\n      this.actionButton.style.boxShadow = '0 0 30px rgba(255, 110, 199, 0.8)';\n      this.actionButton.style.transform = 'scale(0.95)';\n    }\n\n    this.haptic(this.HAPTIC_HEAVY);\n  }\n\n  private handleActionEnd(e: TouchEvent): void {\n    e.preventDefault();\n\n    for (let i = 0; i < e.changedTouches.length; i++) {\n      if (e.changedTouches[i].identifier === this.actionTouchId) {\n        this.action = false;\n        this.actionTouchId = null;\n\n        // Reset visual\n        if (this.actionButton) {\n          this.actionButton.style.background = 'rgba(255, 110, 199, 0.3)';\n          this.actionButton.style.boxShadow = 'none';\n          this.actionButton.style.transform = 'scale(1)';\n        }\n        break;\n      }\n    }\n  }\n\n  private handleTurboStart(e: TouchEvent): void {\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.turbo = true;\n\n    // Visual feedback\n    if (this.turboButton) {\n      this.turboButton.style.background = 'rgba(255, 215, 0, 0.6)';\n      this.turboButton.style.boxShadow = '0 0 30px rgba(255, 215, 0, 0.8)';\n      this.turboButton.style.transform = 'scale(0.95)';\n    }\n\n    this.haptic(this.HAPTIC_DOUBLE);\n  }\n\n  private handleTurboEnd(e: TouchEvent): void {\n    e.preventDefault();\n\n    this.turbo = false;\n\n    // Reset visual\n    if (this.turboButton) {\n      this.turboButton.style.background = 'rgba(255, 215, 0, 0.2)';\n      this.turboButton.style.boxShadow = 'none';\n      this.turboButton.style.transform = 'scale(1)';\n    }\n  }\n\n  private handleCanvasTouch(e: TouchEvent): void {\n    // Only handle touches that aren't on the visual controls\n    const touch = e.touches[0];\n    if (!touch) return;\n\n    const rect = this.canvas.getBoundingClientRect();\n    const x = touch.clientX - rect.left;\n\n    // If touch is in receiver selection area (top of screen), select receiver\n    if (touch.clientY < 150) {\n      const receiverIndex = Math.floor((x / rect.width) * 5);\n      this.selectedReceiver = Math.min(4, Math.max(0, receiverIndex));\n      this.haptic(this.HAPTIC_TAP);\n    }\n  }\n\n  private updateJoystickVisual(): void {\n    if (!this.joystickInner || !this.virtualJoystickCenter || !this.virtualJoystickCurrent) return;\n\n    const maxOffset = (this.JOYSTICK_SIZE - this.JOYSTICK_INNER_SIZE) / 2;\n    const dx = this.virtualJoystickCurrent.x - this.virtualJoystickCenter.x;\n    const dy = this.virtualJoystickCurrent.y - this.virtualJoystickCenter.y;\n\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    const clampedDist = Math.min(distance, maxOffset);\n    const angle = Math.atan2(dy, dx);\n\n    const offsetX = Math.cos(angle) * clampedDist;\n    const offsetY = Math.sin(angle) * clampedDist;\n\n    this.joystickInner.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;\n\n    // Glow intensity based on distance\n    const intensity = clampedDist / maxOffset;\n    this.joystickInner.style.boxShadow = `0 0 ${15 + intensity * 20}px rgba(57, 255, 20, ${0.6 + intensity * 0.4})`;\n  }\n\n  private resetJoystickVisual(): void {\n    if (this.joystickInner) {\n      this.joystickInner.style.transform = 'translate(-50%, -50%)';\n      this.joystickInner.style.boxShadow = '0 0 15px rgba(57, 255, 20, 0.6)';\n    }\n  }\n\n  /** Get action hold time */\n  public getActionHoldTime(): number {\n    if (!this.action) return 0;\n    return (performance.now() - this.touchStartTime) / 1000;\n  }\n\n  /** Get selected receiver and clear */\n  public getSelectedReceiver(): number | null {\n    const receiver = this.selectedReceiver;\n    this.selectedReceiver = null;\n    return receiver;\n  }\n\n  /** Show/hide touch controls */\n  public setVisible(visible: boolean): void {\n    const container = document.getElementById('touchControls');\n    if (container) {\n      container.style.display = visible ? 'block' : 'none';\n    }\n  }\n\n  /** Trigger haptic for game events */\n  public triggerHaptic(type: 'light' | 'heavy' | 'success' | 'error'): void {\n    switch (type) {\n      case 'light':\n        this.haptic([10]);\n        break;\n      case 'heavy':\n        this.haptic([50]);\n        break;\n      case 'success':\n        this.haptic([20, 50, 30, 50, 40]);\n        break;\n      case 'error':\n        this.haptic([100, 50, 100]);\n        break;\n    }\n  }\n\n  /** Cleanup */\n  public dispose(): void {\n    const container = document.getElementById('touchControls');\n    if (container) {\n      container.remove();\n    }\n  }\n}\n","/**\n * Blaze Blitz Football - Steering AI\n *\n * Yuka.js-inspired steering behaviors for defender AI:\n * - Pursuit: Chase ball carrier with prediction\n * - Interpose: Get between receiver and ball\n * - Seek: Move directly toward target\n * - Flee: Move away from threat\n */\n\nimport { Vector3 } from '@babylonjs/core';\n\n/** Agent state for AI calculations */\nexport interface SteeringAgent {\n  id: string;\n  position: Vector3;\n  velocity: Vector3;\n  maxSpeed: number;\n  maxForce: number;   // Max steering force\n  mass: number;\n  rotation: number;   // Facing angle (radians)\n}\n\n/** Target for steering behaviors */\nexport interface SteeringTarget {\n  position: Vector3;\n  velocity?: Vector3;\n}\n\n/** Steering behavior weights */\nexport interface SteeringWeights {\n  pursuit: number;\n  interpose: number;\n  seek: number;\n  flee: number;\n  separation: number;  // Avoid clustering with teammates\n  arrival: number;     // Slow down when approaching target\n}\n\nconst DEFAULT_WEIGHTS: SteeringWeights = {\n  pursuit: 1.0,\n  interpose: 0.8,\n  seek: 1.0,\n  flee: 1.0,\n  separation: 0.5,\n  arrival: 0.6,\n};\n\n/** Football-specific AI configuration */\nexport interface DefenderAIConfig {\n  pursuitLookAhead: number;     // How far ahead to predict (seconds)\n  interposeRatio: number;       // Position between ball and receiver (0-1)\n  separationRadius: number;     // Min distance from teammates\n  arrivalRadius: number;        // Start slowing when this close\n  reactionTime: number;         // Delay before reacting (seconds)\n  coverageAggressiveness: number; // How tight to cover (0-1)\n}\n\nconst DEFAULT_AI_CONFIG: DefenderAIConfig = {\n  pursuitLookAhead: 0.5,\n  interposeRatio: 0.6,\n  separationRadius: 3,\n  arrivalRadius: 5,\n  reactionTime: 0.15,\n  coverageAggressiveness: 0.7,\n};\n\n/** Steering behavior calculator */\nexport class SteeringBehaviors {\n  private config: DefenderAIConfig;\n  private weights: SteeringWeights;\n\n  constructor(\n    config: Partial<DefenderAIConfig> = {},\n    weights: Partial<SteeringWeights> = {}\n  ) {\n    this.config = { ...DEFAULT_AI_CONFIG, ...config };\n    this.weights = { ...DEFAULT_WEIGHTS, ...weights };\n  }\n\n  /**\n   * SEEK - Move directly toward a target position\n   * Basic steering: desired velocity - current velocity\n   */\n  public seek(agent: SteeringAgent, targetPos: Vector3): Vector3 {\n    const desired = targetPos.subtract(agent.position).normalize().scale(agent.maxSpeed);\n    const steering = desired.subtract(agent.velocity);\n    return this.truncate(steering, agent.maxForce);\n  }\n\n  /**\n   * FLEE - Move directly away from a position\n   */\n  public flee(agent: SteeringAgent, threatPos: Vector3): Vector3 {\n    const desired = agent.position.subtract(threatPos).normalize().scale(agent.maxSpeed);\n    const steering = desired.subtract(agent.velocity);\n    return this.truncate(steering, agent.maxForce);\n  }\n\n  /**\n   * PURSUIT - Chase a moving target with prediction\n   * Predicts where target will be and seeks that point\n   */\n  public pursuit(agent: SteeringAgent, target: SteeringTarget): Vector3 {\n    // Calculate distance to target\n    const toTarget = target.position.subtract(agent.position);\n    const distance = toTarget.length();\n\n    // Determine look-ahead time based on distance\n    const speed = agent.velocity.length();\n    const lookAhead = speed > 0\n      ? Math.min(distance / speed, this.config.pursuitLookAhead * 2)\n      : this.config.pursuitLookAhead;\n\n    // Predict future position\n    const futurePos = target.position.clone();\n    if (target.velocity) {\n      futurePos.addInPlace(target.velocity.scale(lookAhead));\n    }\n\n    // Seek the predicted position\n    return this.seek(agent, futurePos);\n  }\n\n  /**\n   * INTERPOSE - Position between two targets (e.g., ball and receiver)\n   * Used for coverage - get between QB and receiver\n   */\n  public interpose(\n    agent: SteeringAgent,\n    targetA: SteeringTarget, // Ball/QB\n    targetB: SteeringTarget  // Receiver\n  ): Vector3 {\n    // Calculate midpoint weighted by interpose ratio\n    const midpoint = targetA.position.scale(1 - this.config.interposeRatio)\n      .add(targetB.position.scale(this.config.interposeRatio));\n\n    // Seek the interpose point\n    return this.seek(agent, midpoint);\n  }\n\n  /**\n   * SEPARATION - Avoid clustering with teammates\n   * Keeps defenders spread out for better coverage\n   */\n  public separation(agent: SteeringAgent, neighbors: SteeringAgent[]): Vector3 {\n    const steering = Vector3.Zero();\n\n    for (const neighbor of neighbors) {\n      if (neighbor.id === agent.id) continue;\n\n      const toAgent = agent.position.subtract(neighbor.position);\n      const distance = toAgent.length();\n\n      if (distance > 0 && distance < this.config.separationRadius) {\n        // Weight by inverse distance (closer = stronger repulsion)\n        const force = toAgent.normalize().scale(this.config.separationRadius / distance);\n        steering.addInPlace(force);\n      }\n    }\n\n    if (steering.length() > 0) {\n      steering.normalize().scaleInPlace(agent.maxSpeed);\n      steering.subtractInPlace(agent.velocity);\n      return this.truncate(steering, agent.maxForce);\n    }\n\n    return Vector3.Zero();\n  }\n\n  /**\n   * ARRIVAL - Slow down when approaching target\n   * Prevents overshooting the target position\n   */\n  public arrival(agent: SteeringAgent, targetPos: Vector3): Vector3 {\n    const toTarget = targetPos.subtract(agent.position);\n    const distance = toTarget.length();\n\n    if (distance < 0.1) return Vector3.Zero();\n\n    // Calculate desired speed based on distance\n    let desiredSpeed: number;\n    if (distance <= this.config.arrivalRadius) {\n      // Slow down as we approach\n      desiredSpeed = agent.maxSpeed * (distance / this.config.arrivalRadius);\n    } else {\n      desiredSpeed = agent.maxSpeed;\n    }\n\n    const desired = toTarget.normalize().scale(desiredSpeed);\n    const steering = desired.subtract(agent.velocity);\n    return this.truncate(steering, agent.maxForce);\n  }\n\n  /**\n   * Calculate combined steering force for a defender\n   */\n  public calculateDefenderSteering(\n    agent: SteeringAgent,\n    ballCarrier: SteeringTarget | null,\n    assignment: SteeringTarget | null, // Man coverage assignment\n    teammates: SteeringAgent[],\n    ballPosition: Vector3 | null\n  ): Vector3 {\n    const steering = Vector3.Zero();\n\n    // If ball carrier exists, pursue them\n    if (ballCarrier) {\n      const pursuitForce = this.pursuit(agent, ballCarrier);\n      steering.addInPlace(pursuitForce.scale(this.weights.pursuit));\n    }\n    // If we have a coverage assignment (man or zone), cover them\n    else if (assignment && ballPosition) {\n      // Interpose between ball and receiver\n      const interposeForce = this.interpose(\n        agent,\n        { position: ballPosition },\n        assignment\n      );\n      steering.addInPlace(interposeForce.scale(this.weights.interpose));\n    }\n    // Default: return to zone position\n    else if (assignment) {\n      const seekForce = this.arrival(agent, assignment.position);\n      steering.addInPlace(seekForce.scale(this.weights.seek));\n    }\n\n    // Always add separation from teammates\n    const separationForce = this.separation(agent, teammates);\n    steering.addInPlace(separationForce.scale(this.weights.separation));\n\n    return this.truncate(steering, agent.maxForce);\n  }\n\n  /**\n   * Apply steering force to agent and update position\n   */\n  public applySteeringForce(\n    agent: SteeringAgent,\n    force: Vector3,\n    deltaTime: number\n  ): void {\n    // F = ma, so a = F/m\n    const acceleration = force.scale(1 / agent.mass);\n\n    // Update velocity\n    agent.velocity.addInPlace(acceleration.scale(deltaTime));\n\n    // Clamp to max speed\n    if (agent.velocity.length() > agent.maxSpeed) {\n      agent.velocity.normalize().scaleInPlace(agent.maxSpeed);\n    }\n\n    // Update position\n    agent.position.addInPlace(agent.velocity.scale(deltaTime));\n\n    // Update rotation to face movement direction\n    if (agent.velocity.length() > 0.1) {\n      agent.rotation = Math.atan2(agent.velocity.x, agent.velocity.z);\n    }\n  }\n\n  /** Truncate vector to max length */\n  private truncate(vector: Vector3, maxLength: number): Vector3 {\n    if (vector.length() > maxLength) {\n      return vector.normalize().scale(maxLength);\n    }\n    return vector;\n  }\n\n  /** Update configuration */\n  public updateConfig(config: Partial<DefenderAIConfig>): void {\n    this.config = { ...this.config, ...config };\n  }\n\n  /** Update weights */\n  public updateWeights(weights: Partial<SteeringWeights>): void {\n    this.weights = { ...this.weights, ...weights };\n  }\n}\n\n/**\n * Defender AI Controller\n * High-level AI that uses steering behaviors\n */\nexport class DefenderAI {\n  private steering: SteeringBehaviors;\n  private agent: SteeringAgent;\n  private reactionTimer: number = 0;\n  private coverageType: 'man' | 'zone' = 'zone';\n  private zonePosition: Vector3 | null = null;\n  private manAssignment: string | null = null;\n\n  constructor(agent: SteeringAgent, config?: Partial<DefenderAIConfig>) {\n    this.agent = agent;\n    this.steering = new SteeringBehaviors(config);\n  }\n\n  /** Set zone coverage position */\n  public setZoneCoverage(position: Vector3): void {\n    this.coverageType = 'zone';\n    this.zonePosition = position.clone();\n    this.manAssignment = null;\n  }\n\n  /** Set man coverage assignment */\n  public setManCoverage(receiverId: string): void {\n    this.coverageType = 'man';\n    this.manAssignment = receiverId;\n    this.zonePosition = null;\n  }\n\n  /** Update defender AI */\n  public update(\n    deltaTime: number,\n    ballCarrierPosition: Vector3 | null,\n    ballCarrierVelocity: Vector3 | null,\n    receiverPositions: Map<string, Vector3>,\n    ballPosition: Vector3 | null,\n    teammates: SteeringAgent[]\n  ): void {\n    // Add reaction delay\n    this.reactionTimer -= deltaTime;\n    if (this.reactionTimer > 0) return;\n\n    let assignment: SteeringTarget | null = null;\n\n    // Determine assignment target\n    if (this.coverageType === 'man' && this.manAssignment) {\n      const receiverPos = receiverPositions.get(this.manAssignment);\n      if (receiverPos) {\n        assignment = { position: receiverPos };\n      }\n    } else if (this.coverageType === 'zone' && this.zonePosition) {\n      assignment = { position: this.zonePosition };\n    }\n\n    // Create ball carrier target if exists\n    let ballCarrier: SteeringTarget | null = null;\n    if (ballCarrierPosition) {\n      ballCarrier = {\n        position: ballCarrierPosition,\n        velocity: ballCarrierVelocity || undefined,\n      };\n    }\n\n    // Calculate steering force\n    const steeringForce = this.steering.calculateDefenderSteering(\n      this.agent,\n      ballCarrier,\n      assignment,\n      teammates,\n      ballPosition\n    );\n\n    // Apply force to agent\n    this.steering.applySteeringForce(this.agent, steeringForce, deltaTime);\n  }\n\n  /** Trigger reaction delay (e.g., when ball is snapped) */\n  public triggerReaction(delay: number = 0.15): void {\n    this.reactionTimer = delay;\n  }\n\n  /** Get agent data */\n  public getAgent(): SteeringAgent {\n    return this.agent;\n  }\n\n  /** Update agent position (for syncing with game state) */\n  public setPosition(position: Vector3): void {\n    this.agent.position = position.clone();\n  }\n\n  /** Check if defender can make a tackle (within range) */\n  public canTackle(targetPosition: Vector3, tackleRadius: number = 1.5): boolean {\n    const distance = Vector3.Distance(this.agent.position, targetPosition);\n    return distance <= tackleRadius;\n  }\n}\n","/**\n * Blaze Blitz Football - Advanced AI System\n *\n * Layered defensive AI with zone/man coverage, blitz packages,\n * read-react logic, pursuit angles, and coverage probability.\n * Built on top of SteeringAI primitives.\n */\n\nimport { Vector3 } from '@babylonjs/core';\nimport { SteeringBehaviors, type SteeringAgent, type SteeringTarget } from './SteeringAI';\n\n// ---------------------------------------------------------------------------\n// Enums & Types\n// ---------------------------------------------------------------------------\n\n/** Coverage scheme the defense is running */\nexport enum CoverageScheme {\n  Cover0 = 'cover0', // Pure man, no deep safety\n  Cover1 = 'cover1', // Man + 1 deep safety\n  Cover2 = 'cover2', // 2 deep safeties, 5 underneath zones\n  Cover3 = 'cover3', // 3 deep thirds, 4 underneath\n  Cover4 = 'cover4', // Quarters\n  Cover6 = 'cover6', // Cover 2 on one side, Cover 4 on other\n  ManPress = 'man_press',\n  ManOff = 'man_off',\n}\n\n/** Role a defender fills within a play */\nexport type DefenderRole =\n  | 'deep_third_left'\n  | 'deep_third_mid'\n  | 'deep_third_right'\n  | 'deep_half_left'\n  | 'deep_half_right'\n  | 'flat_left'\n  | 'flat_right'\n  | 'hook_curl_left'\n  | 'hook_curl_right'\n  | 'seam_left'\n  | 'seam_right'\n  | 'man_coverage'\n  | 'spy'\n  | 'blitzer'\n  | 'contain_left'\n  | 'contain_right';\n\n/** Blitz package identifier */\nexport type BlitzPackage =\n  | 'none'\n  | 'a_gap_left'\n  | 'a_gap_right'\n  | 'b_gap_left'\n  | 'b_gap_right'\n  | 'edge_left'\n  | 'edge_right'\n  | 'delayed'\n  | 'zone_blitz'; // Lineman drops, DB blitzes\n\n/** A rectangular zone on the field defined by yard-line and lateral boundaries */\nexport interface ZoneDefinition {\n  /** Unique identifier for this zone */\n  name: string;\n  /** Minimum X (sideline-to-sideline, left edge) */\n  xMin: number;\n  /** Maximum X */\n  xMax: number;\n  /** Minimum Z (down-field, closer to own end zone) */\n  zMin: number;\n  /** Maximum Z (further toward opponent end zone) */\n  zMax: number;\n}\n\n/** Per-defender attributes that drive probability-based outcomes */\ninterface CoverageAttributes {\n  /** 0-1 rating. Higher = faster reaction, tighter coverage */\n  coverageRating: number;\n  /** Base reaction delay in seconds before defender reacts to a stimulus */\n  baseReactionTime: number;\n  /** Multiplier on max speed when closing on ball carrier or receiver */\n  closingSpeedMultiplier: number;\n  /** 0-1 probability of successfully contesting a catch at ideal range */\n  contestProbability: number;\n}\n\n/** Internal state for a single AI-controlled defender */\ninterface DefenderState {\n  agent: SteeringAgent;\n  role: DefenderRole;\n  attributes: CoverageAttributes;\n\n  // Assignment state\n  manAssignmentId: string | null;\n  zone: ZoneDefinition | null;\n\n  // Read-react timers\n  reactionTimer: number;\n  routeRecognitionTimer: number;\n  hasRecognizedRoute: boolean;\n\n  // Blitz state\n  blitzPackage: BlitzPackage;\n  blitzDelayTimer: number;\n  isBlitzing: boolean;\n\n  // Pursuit\n  pursuitAngle: Vector3 | null;\n  containSide: 'left' | 'right' | null;\n}\n\n// ---------------------------------------------------------------------------\n// Zone Templates (relative to line of scrimmage at z=0, offense going +Z)\n// Field width assumed -26.67 to 26.67 (53.33 yards = 160 feet)\n// ---------------------------------------------------------------------------\n\nconst HALF_WIDTH = 26.67;\nconst THIRD_WIDTH = HALF_WIDTH / 1.5; // ~17.78\n\nfunction buildZoneTemplates(los: number): Record<string, ZoneDefinition> {\n  return {\n    // Deep thirds (15+ yards from LOS)\n    deep_third_left: {\n      name: 'deep_third_left',\n      xMin: -HALF_WIDTH,\n      xMax: -THIRD_WIDTH / 2,\n      zMin: los + 15,\n      zMax: los + 40,\n    },\n    deep_third_mid: {\n      name: 'deep_third_mid',\n      xMin: -THIRD_WIDTH / 2,\n      xMax: THIRD_WIDTH / 2,\n      zMin: los + 15,\n      zMax: los + 40,\n    },\n    deep_third_right: {\n      name: 'deep_third_right',\n      xMin: THIRD_WIDTH / 2,\n      xMax: HALF_WIDTH,\n      zMin: los + 15,\n      zMax: los + 40,\n    },\n    // Deep halves\n    deep_half_left: {\n      name: 'deep_half_left',\n      xMin: -HALF_WIDTH,\n      xMax: 0,\n      zMin: los + 15,\n      zMax: los + 40,\n    },\n    deep_half_right: {\n      name: 'deep_half_right',\n      xMin: 0,\n      xMax: HALF_WIDTH,\n      zMin: los + 15,\n      zMax: los + 40,\n    },\n    // Flats (0-8 yards, outside)\n    flat_left: {\n      name: 'flat_left',\n      xMin: -HALF_WIDTH,\n      xMax: -10,\n      zMin: los,\n      zMax: los + 8,\n    },\n    flat_right: {\n      name: 'flat_right',\n      xMin: 10,\n      xMax: HALF_WIDTH,\n      zMin: los,\n      zMax: los + 8,\n    },\n    // Hook/curl (5-15 yards, inside-ish)\n    hook_curl_left: {\n      name: 'hook_curl_left',\n      xMin: -15,\n      xMax: -2,\n      zMin: los + 5,\n      zMax: los + 15,\n    },\n    hook_curl_right: {\n      name: 'hook_curl_right',\n      xMin: 2,\n      xMax: 15,\n      zMin: los + 5,\n      zMax: los + 15,\n    },\n    // Seams (10-20 yards, between hashes)\n    seam_left: {\n      name: 'seam_left',\n      xMin: -10,\n      xMax: -2,\n      zMin: los + 10,\n      zMax: los + 20,\n    },\n    seam_right: {\n      name: 'seam_right',\n      xMin: 2,\n      xMax: 10,\n      zMin: los + 10,\n      zMax: los + 20,\n    },\n  };\n}\n\nfunction zoneCenter(zone: ZoneDefinition): Vector3 {\n  return new Vector3(\n    (zone.xMin + zone.xMax) * 0.5,\n    0,\n    (zone.zMin + zone.zMax) * 0.5,\n  );\n}\n\nfunction isInsideZone(pos: Vector3, zone: ZoneDefinition): boolean {\n  return (\n    pos.x >= zone.xMin &&\n    pos.x <= zone.xMax &&\n    pos.z >= zone.zMin &&\n    pos.z <= zone.zMax\n  );\n}\n\n// ---------------------------------------------------------------------------\n// Default coverage attributes by archetype\n// ---------------------------------------------------------------------------\n\nfunction defaultAttributes(role: DefenderRole): CoverageAttributes {\n  switch (role) {\n    case 'deep_third_left':\n    case 'deep_third_mid':\n    case 'deep_third_right':\n    case 'deep_half_left':\n    case 'deep_half_right':\n      return { coverageRating: 0.8, baseReactionTime: 0.2, closingSpeedMultiplier: 1.1, contestProbability: 0.6 };\n    case 'man_coverage':\n      return { coverageRating: 0.75, baseReactionTime: 0.18, closingSpeedMultiplier: 1.05, contestProbability: 0.55 };\n    case 'flat_left':\n    case 'flat_right':\n    case 'hook_curl_left':\n    case 'hook_curl_right':\n      return { coverageRating: 0.65, baseReactionTime: 0.22, closingSpeedMultiplier: 1.0, contestProbability: 0.45 };\n    case 'seam_left':\n    case 'seam_right':\n      return { coverageRating: 0.7, baseReactionTime: 0.2, closingSpeedMultiplier: 1.0, contestProbability: 0.5 };\n    case 'blitzer':\n      return { coverageRating: 0.4, baseReactionTime: 0.12, closingSpeedMultiplier: 1.15, contestProbability: 0.25 };\n    case 'spy':\n      return { coverageRating: 0.6, baseReactionTime: 0.15, closingSpeedMultiplier: 1.1, contestProbability: 0.35 };\n    case 'contain_left':\n    case 'contain_right':\n      return { coverageRating: 0.5, baseReactionTime: 0.18, closingSpeedMultiplier: 1.05, contestProbability: 0.3 };\n    default:\n      return { coverageRating: 0.5, baseReactionTime: 0.2, closingSpeedMultiplier: 1.0, contestProbability: 0.4 };\n  }\n}\n\n// ---------------------------------------------------------------------------\n// Pursuit helpers\n// ---------------------------------------------------------------------------\n\n/** Calculate an intercept point using pursuit angle rather than direct chase */\nfunction computePursuitAngle(\n  defenderPos: Vector3,\n  targetPos: Vector3,\n  targetVel: Vector3,\n  defenderSpeed: number,\n): Vector3 {\n  const toTarget = targetPos.subtract(defenderPos);\n  const dist = toTarget.length();\n  if (dist < 0.5) return targetPos.clone();\n\n  const targetSpeed = targetVel.length();\n  if (targetSpeed < 0.1) return targetPos.clone();\n\n  // Time-to-intercept estimate\n  const closingSpeed = defenderSpeed + targetSpeed;\n  const t = dist / closingSpeed;\n\n  // Predict where the target will be\n  const intercept = targetPos.add(targetVel.scale(t));\n  return intercept;\n}\n\n/** Determine contain target: force runner toward sideline or funnel inside */\nfunction computeContainTarget(\n  defenderPos: Vector3,\n  runnerPos: Vector3,\n  side: 'left' | 'right',\n): Vector3 {\n  // Position outside the runner to force them toward the sideline\n  const offsetX = side === 'left' ? -4 : 4;\n  return new Vector3(\n    runnerPos.x + offsetX,\n    0,\n    runnerPos.z + 2, // Slightly ahead\n  );\n}\n\n// ---------------------------------------------------------------------------\n// Scheme Assignments\n// ---------------------------------------------------------------------------\n\ntype RoleAssignmentMap = DefenderRole[];\n\nfunction rolesForScheme(scheme: CoverageScheme, blitz: BlitzPackage): RoleAssignmentMap {\n  // Returns a list of 7 roles for a typical front-7 + 4 DBs = 11, but we\n  // only control defensive non-linemen in the arcade game. Assume 7 AI defenders.\n  switch (scheme) {\n    case CoverageScheme.Cover3:\n      return applyBlitz([\n        'deep_third_left', 'deep_third_mid', 'deep_third_right',\n        'flat_left', 'flat_right', 'hook_curl_left', 'hook_curl_right',\n      ], blitz);\n    case CoverageScheme.Cover2:\n      return applyBlitz([\n        'deep_half_left', 'deep_half_right',\n        'flat_left', 'flat_right', 'hook_curl_left', 'hook_curl_right', 'seam_left',\n      ], blitz);\n    case CoverageScheme.Cover4:\n      return applyBlitz([\n        'deep_third_left', 'deep_third_right', 'deep_half_left', 'deep_half_right',\n        'hook_curl_left', 'hook_curl_right', 'seam_right',\n      ], blitz);\n    case CoverageScheme.Cover1:\n      return applyBlitz([\n        'deep_third_mid', 'man_coverage', 'man_coverage',\n        'man_coverage', 'man_coverage', 'hook_curl_left', 'hook_curl_right',\n      ], blitz);\n    case CoverageScheme.Cover0:\n      return applyBlitz([\n        'man_coverage', 'man_coverage', 'man_coverage',\n        'man_coverage', 'man_coverage', 'blitzer', 'blitzer',\n      ], blitz);\n    case CoverageScheme.ManPress:\n      return applyBlitz([\n        'deep_third_mid', 'man_coverage', 'man_coverage',\n        'man_coverage', 'man_coverage', 'man_coverage', 'spy',\n      ], blitz);\n    case CoverageScheme.ManOff:\n      return applyBlitz([\n        'deep_third_mid', 'man_coverage', 'man_coverage',\n        'man_coverage', 'man_coverage', 'hook_curl_left', 'hook_curl_right',\n      ], blitz);\n    case CoverageScheme.Cover6:\n      return applyBlitz([\n        'deep_half_left', 'deep_third_right', 'deep_half_right',\n        'flat_left', 'flat_right', 'hook_curl_left', 'seam_right',\n      ], blitz);\n    default:\n      return rolesForScheme(CoverageScheme.Cover3, blitz);\n  }\n}\n\nfunction applyBlitz(roles: DefenderRole[], blitz: BlitzPackage): DefenderRole[] {\n  if (blitz === 'none') return roles;\n\n  const result = [...roles];\n\n  if (blitz === 'zone_blitz') {\n    // Swap: a zone defender becomes blitzer, last blitzer-capable slot drops into coverage\n    const zoneIdx = result.findIndex(r =>\n      r === 'hook_curl_left' || r === 'hook_curl_right' || r === 'flat_left' || r === 'flat_right',\n    );\n    if (zoneIdx !== -1) {\n      const originalRole = result[zoneIdx];\n      result[zoneIdx] = 'blitzer';\n      // Find a man or deep defender to replace the vacated zone\n      const deepIdx = result.findIndex(r => r === 'man_coverage' || r === 'spy');\n      if (deepIdx !== -1) result[deepIdx] = originalRole;\n    }\n    return result;\n  }\n\n  if (blitz === 'delayed') {\n    // Mark last non-blitzer as blitzer (will use delay timer)\n    for (let i = result.length - 1; i >= 0; i--) {\n      if (result[i] !== 'blitzer') {\n        result[i] = 'blitzer';\n        break;\n      }\n    }\n    return result;\n  }\n\n  // Standard blitz: convert one defender to blitzer\n  for (let i = result.length - 1; i >= 0; i--) {\n    if (result[i] !== 'blitzer' && result[i] !== 'deep_third_mid') {\n      result[i] = 'blitzer';\n      break;\n    }\n  }\n  return result;\n}\n\n// ---------------------------------------------------------------------------\n// Blitz gap targets (relative to LOS center)\n// ---------------------------------------------------------------------------\n\nfunction blitzTarget(pkg: BlitzPackage, los: number): Vector3 {\n  switch (pkg) {\n    case 'a_gap_left': return new Vector3(-1.5, 0, los - 2);\n    case 'a_gap_right': return new Vector3(1.5, 0, los - 2);\n    case 'b_gap_left': return new Vector3(-4, 0, los - 2);\n    case 'b_gap_right': return new Vector3(4, 0, los - 2);\n    case 'edge_left': return new Vector3(-8, 0, los - 1);\n    case 'edge_right': return new Vector3(8, 0, los - 1);\n    case 'delayed': return new Vector3(0, 0, los - 2);\n    case 'zone_blitz': return new Vector3(0, 0, los - 2);\n    default: return new Vector3(0, 0, los);\n  }\n}\n\n// ---------------------------------------------------------------------------\n// AISystem\n// ---------------------------------------------------------------------------\n\nexport class AISystem {\n  private steering: SteeringBehaviors;\n  private defenders: Map<string, DefenderState> = new Map();\n  private scheme: CoverageScheme = CoverageScheme.Cover3;\n  private blitzPackage: BlitzPackage = 'none';\n  private lineOfScrimmage: number = 0;\n  private zones: Record<string, ZoneDefinition> = {};\n\n  // Read-react state\n  private qbEyeDirection: Vector3 = Vector3.Forward();\n  private isPlayAction: boolean = false;\n  private playElapsed: number = 0;\n\n  /** Route recognition delay in seconds */\n  private static readonly ROUTE_BREAK_DELAY = 0.5;\n\n  constructor() {\n    this.steering = new SteeringBehaviors(\n      { pursuitLookAhead: 0.6, separationRadius: 2.5, arrivalRadius: 4, coverageAggressiveness: 0.8 },\n      { pursuit: 1.2, interpose: 0.9, seek: 1.0, separation: 0.4, arrival: 0.7, flee: 0.0 },\n    );\n  }\n\n  // -----------------------------------------------------------------------\n  // Setup\n  // -----------------------------------------------------------------------\n\n  /** Register a defender agent with the system */\n  public addDefender(\n    agent: SteeringAgent,\n    role: DefenderRole = 'hook_curl_left',\n    attributes?: Partial<CoverageAttributes>,\n  ): void {\n    const baseAttrs = defaultAttributes(role);\n    const state: DefenderState = {\n      agent,\n      role,\n      attributes: { ...baseAttrs, ...attributes },\n      manAssignmentId: null,\n      zone: null,\n      reactionTimer: 0,\n      routeRecognitionTimer: 0,\n      hasRecognizedRoute: false,\n      blitzPackage: 'none',\n      blitzDelayTimer: 0,\n      isBlitzing: false,\n      pursuitAngle: null,\n      containSide: null,\n    };\n    this.defenders.set(agent.id, state);\n  }\n\n  /** Remove a defender */\n  public removeDefender(id: string): void {\n    this.defenders.delete(id);\n  }\n\n  /** Set line of scrimmage and rebuild zones */\n  public setLineOfScrimmage(los: number): void {\n    this.lineOfScrimmage = los;\n    this.zones = buildZoneTemplates(los);\n  }\n\n  /** Apply a coverage scheme. Distributes roles across registered defenders. */\n  public setScheme(scheme: CoverageScheme, blitz: BlitzPackage = 'none'): void {\n    this.scheme = scheme;\n    this.blitzPackage = blitz;\n\n    const roles = rolesForScheme(scheme, blitz);\n    const defenderIds = Array.from(this.defenders.keys());\n\n    for (let i = 0; i < defenderIds.length; i++) {\n      const state = this.defenders.get(defenderIds[i])!;\n      const role = roles[i % roles.length];\n      state.role = role;\n      state.attributes = { ...defaultAttributes(role), ...state.attributes };\n      state.isBlitzing = role === 'blitzer';\n      state.blitzPackage = role === 'blitzer' ? blitz : 'none';\n      state.blitzDelayTimer = blitz === 'delayed' && role === 'blitzer' ? 0.8 + Math.random() * 0.4 : 0;\n\n      // Assign zone\n      if (this.zones[role]) {\n        state.zone = this.zones[role];\n      } else {\n        state.zone = null;\n      }\n\n      // Contain assignments for edge rushers\n      if (role === 'contain_left') state.containSide = 'left';\n      else if (role === 'contain_right') state.containSide = 'right';\n      else state.containSide = null;\n    }\n  }\n\n  /** Assign a specific defender to man-cover a receiver */\n  public assignManCoverage(defenderId: string, receiverId: string): void {\n    const state = this.defenders.get(defenderId);\n    if (!state) return;\n    state.role = 'man_coverage';\n    state.manAssignmentId = receiverId;\n    state.zone = null;\n  }\n\n  // -----------------------------------------------------------------------\n  // Read-React Inputs\n  // -----------------------------------------------------------------------\n\n  /** Feed QB eye direction so defenders can read it */\n  public setQBEyeDirection(dir: Vector3): void {\n    this.qbEyeDirection = dir.normalize();\n  }\n\n  /** Flag play-action so defenders can recognize it */\n  public setPlayAction(active: boolean): void {\n    this.isPlayAction = active;\n  }\n\n  // -----------------------------------------------------------------------\n  // Main Update\n  // -----------------------------------------------------------------------\n\n  /**\n   * Tick every frame.\n   *\n   * @param dt - Delta time in seconds\n   * @param ballCarrierPos - Position of the ball carrier (null pre-throw)\n   * @param ballCarrierVel - Velocity of the ball carrier\n   * @param ballPos - Current ball position\n   * @param receiverPositions - Map of receiver ID -> position\n   * @param receiverVelocities - Map of receiver ID -> velocity\n   */\n  public update(\n    dt: number,\n    ballCarrierPos: Vector3 | null,\n    ballCarrierVel: Vector3 | null,\n    ballPos: Vector3 | null,\n    receiverPositions: Map<string, Vector3>,\n    receiverVelocities: Map<string, Vector3>,\n  ): void {\n    this.playElapsed += dt;\n    const allAgents = this.getAllAgents();\n\n    for (const [, state] of this.defenders) {\n      // Tick timers\n      state.reactionTimer = Math.max(0, state.reactionTimer - dt);\n      if (state.reactionTimer > 0) continue; // Still reacting\n\n      // Route recognition timer\n      if (!state.hasRecognizedRoute) {\n        state.routeRecognitionTimer += dt;\n        if (state.routeRecognitionTimer >= AISystem.ROUTE_BREAK_DELAY) {\n          state.hasRecognizedRoute = true;\n        }\n      }\n\n      // Delayed blitz timer\n      if (state.blitzDelayTimer > 0) {\n        state.blitzDelayTimer -= dt;\n        // While waiting, play zone\n        this.updateZoneCoverage(state, dt, receiverPositions, ballPos, allAgents);\n        continue;\n      }\n\n      // Determine behavior\n      if (state.isBlitzing) {\n        this.updateBlitzer(state, dt, ballCarrierPos, ballCarrierVel, allAgents);\n      } else if (ballCarrierPos) {\n        this.updatePursuit(state, dt, ballCarrierPos, ballCarrierVel, allAgents);\n      } else if (state.role === 'man_coverage') {\n        this.updateManCoverage(state, dt, receiverPositions, receiverVelocities, ballPos, allAgents);\n      } else if (state.role === 'spy') {\n        this.updateSpy(state, dt, ballCarrierPos, ballCarrierVel, ballPos, allAgents);\n      } else if (state.containSide) {\n        this.updateContain(state, dt, ballCarrierPos, ballPos, allAgents);\n      } else {\n        this.updateZoneCoverage(state, dt, receiverPositions, ballPos, allAgents);\n      }\n    }\n  }\n\n  // -----------------------------------------------------------------------\n  // Behavior Implementations\n  // -----------------------------------------------------------------------\n\n  private updateZoneCoverage(\n    state: DefenderState,\n    dt: number,\n    receiverPositions: Map<string, Vector3>,\n    ballPos: Vector3 | null,\n    allAgents: SteeringAgent[],\n  ): void {\n    if (!state.zone) {\n      // No zone assigned, hold position\n      this.steering.applySteeringForce(state.agent, Vector3.Zero(), dt);\n      return;\n    }\n\n    // Check if any receiver is in this zone\n    let closestInZone: { id: string; pos: Vector3; dist: number } | null = null;\n    for (const [id, pos] of receiverPositions) {\n      if (isInsideZone(pos, state.zone)) {\n        const dist = Vector3.Distance(state.agent.position, pos);\n        if (!closestInZone || dist < closestInZone.dist) {\n          closestInZone = { id, pos, dist };\n        }\n      }\n    }\n\n    let force: Vector3;\n    if (closestInZone && state.hasRecognizedRoute) {\n      // React to receiver in zone: interpose between ball and receiver\n      if (ballPos) {\n        force = this.steering.interpose(\n          state.agent,\n          { position: ballPos },\n          { position: closestInZone.pos },\n        );\n      } else {\n        force = this.steering.seek(state.agent, closestInZone.pos);\n      }\n\n      // Read QB eyes: if QB is looking this direction, close faster\n      const toReceiver = closestInZone.pos.subtract(state.agent.position).normalize();\n      const eyeAlignment = Vector3.Dot(this.qbEyeDirection, toReceiver);\n      if (eyeAlignment > 0.6) {\n        force.scaleInPlace(1.0 + state.attributes.coverageRating * 0.3);\n      }\n    } else {\n      // No receiver in zone, settle at zone center\n      const center = zoneCenter(state.zone);\n      force = this.steering.arrival(state.agent, center);\n    }\n\n    // Separation\n    const sep = this.steering.separation(state.agent, allAgents);\n    force.addInPlace(sep.scale(0.4));\n\n    this.applyWithRating(state, force, dt);\n  }\n\n  private updateManCoverage(\n    state: DefenderState,\n    dt: number,\n    receiverPositions: Map<string, Vector3>,\n    receiverVelocities: Map<string, Vector3>,\n    ballPos: Vector3 | null,\n    allAgents: SteeringAgent[],\n  ): void {\n    if (!state.manAssignmentId) {\n      // No assignment, fall back to zone center\n      this.steering.applySteeringForce(state.agent, Vector3.Zero(), dt);\n      return;\n    }\n\n    const recPos = receiverPositions.get(state.manAssignmentId);\n    if (!recPos) return;\n\n    const recVel = receiverVelocities.get(state.manAssignmentId) || Vector3.Zero();\n\n    // Press vs off coverage: press stays tight, off maintains cushion\n    const isPress = this.scheme === CoverageScheme.ManPress || this.scheme === CoverageScheme.Cover0;\n    const cushion = isPress ? 1.0 : 5.0;\n\n    const toReceiver = recPos.subtract(state.agent.position);\n    const dist = toReceiver.length();\n\n    let force: Vector3;\n\n    if (dist > cushion && !state.hasRecognizedRoute) {\n      // Maintain cushion: arrival to a point between defender and receiver\n      const cushionPoint = recPos.subtract(toReceiver.normalize().scale(cushion));\n      force = this.steering.arrival(state.agent, cushionPoint);\n    } else {\n      // Shadow the receiver\n      const target: SteeringTarget = { position: recPos, velocity: recVel };\n\n      if (ballPos && state.hasRecognizedRoute) {\n        // Route recognized, jump the route: interpose between ball and receiver\n        force = this.steering.interpose(state.agent, { position: ballPos }, target);\n        force.scaleInPlace(1.0 + state.attributes.coverageRating * 0.2);\n      } else {\n        // Mirror: pursuit on the receiver\n        force = this.steering.pursuit(state.agent, target);\n      }\n    }\n\n    // Separation\n    const sep = this.steering.separation(state.agent, allAgents);\n    force.addInPlace(sep.scale(0.3));\n\n    this.applyWithRating(state, force, dt);\n  }\n\n  private updateBlitzer(\n    state: DefenderState,\n    dt: number,\n    ballCarrierPos: Vector3 | null,\n    ballCarrierVel: Vector3 | null,\n    allAgents: SteeringAgent[],\n  ): void {\n    const target = ballCarrierPos\n      ? ballCarrierPos\n      : blitzTarget(state.blitzPackage, this.lineOfScrimmage);\n\n    const vel = ballCarrierVel || Vector3.Zero();\n    const blitzTarget_: SteeringTarget = { position: target, velocity: vel };\n\n    let force = this.steering.pursuit(state.agent, blitzTarget_);\n    // Blitzers get a speed boost\n    force.scaleInPlace(1.15);\n\n    const sep = this.steering.separation(state.agent, allAgents);\n    force.addInPlace(sep.scale(0.2));\n\n    this.steering.applySteeringForce(state.agent, force, dt);\n  }\n\n  private updatePursuit(\n    state: DefenderState,\n    dt: number,\n    ballCarrierPos: Vector3,\n    ballCarrierVel: Vector3 | null,\n    allAgents: SteeringAgent[],\n  ): void {\n    const vel = ballCarrierVel || Vector3.Zero();\n\n    // Contain assignment: force sideline\n    if (state.containSide) {\n      const containTarget = computeContainTarget(state.agent.position, ballCarrierPos, state.containSide);\n      const force = this.steering.seek(state.agent, containTarget);\n      const sep = this.steering.separation(state.agent, allAgents);\n      force.addInPlace(sep.scale(0.3));\n      this.applyWithRating(state, force, dt);\n      return;\n    }\n\n    // Angle-based pursuit\n    const interceptPoint = computePursuitAngle(\n      state.agent.position,\n      ballCarrierPos,\n      vel,\n      state.agent.maxSpeed * state.attributes.closingSpeedMultiplier,\n    );\n\n    state.pursuitAngle = interceptPoint.clone();\n    const force = this.steering.seek(state.agent, interceptPoint);\n\n    // Play-action recognition: if play-action is detected, defenders hesitate\n    if (this.isPlayAction && this.playElapsed < 1.0) {\n      force.scaleInPlace(0.5); // Half-speed commitment during play-action read\n    }\n\n    const sep = this.steering.separation(state.agent, allAgents);\n    force.addInPlace(sep.scale(0.3));\n\n    this.applyWithRating(state, force, dt);\n  }\n\n  private updateSpy(\n    state: DefenderState,\n    dt: number,\n    ballCarrierPos: Vector3 | null,\n    ballCarrierVel: Vector3 | null,\n    ballPos: Vector3 | null,\n    allAgents: SteeringAgent[],\n  ): void {\n    // Spy mirrors QB laterally, stays at LOS depth\n    const targetX = ballPos ? ballPos.x : 0;\n    const spyPos = new Vector3(targetX, 0, this.lineOfScrimmage + 3);\n\n    let force: Vector3;\n    if (ballCarrierPos) {\n      // QB scramble detected: pursue\n      const target: SteeringTarget = {\n        position: ballCarrierPos,\n        velocity: ballCarrierVel || undefined,\n      };\n      force = this.steering.pursuit(state.agent, target);\n    } else {\n      force = this.steering.arrival(state.agent, spyPos);\n    }\n\n    const sep = this.steering.separation(state.agent, allAgents);\n    force.addInPlace(sep.scale(0.3));\n    this.applyWithRating(state, force, dt);\n  }\n\n  private updateContain(\n    state: DefenderState,\n    dt: number,\n    ballCarrierPos: Vector3 | null,\n    ballPos: Vector3 | null,\n    allAgents: SteeringAgent[],\n  ): void {\n    const referencePos = ballCarrierPos || ballPos || new Vector3(0, 0, this.lineOfScrimmage);\n    const containTarget = computeContainTarget(\n      state.agent.position,\n      referencePos,\n      state.containSide!,\n    );\n\n    const force = this.steering.seek(state.agent, containTarget);\n    const sep = this.steering.separation(state.agent, allAgents);\n    force.addInPlace(sep.scale(0.3));\n    this.applyWithRating(state, force, dt);\n  }\n\n  // -----------------------------------------------------------------------\n  // Coverage Probability\n  // -----------------------------------------------------------------------\n\n  /** Apply steering force modulated by coverage rating (closing speed) */\n  private applyWithRating(state: DefenderState, force: Vector3, dt: number): void {\n    // Coverage rating affects effective closing speed\n    const speedMod = 0.85 + state.attributes.coverageRating * 0.3; // 0.85-1.15 range\n    const modulated = force.scale(speedMod);\n    this.steering.applySteeringForce(state.agent, modulated, dt);\n  }\n\n  // -----------------------------------------------------------------------\n  // Public Queries\n  // -----------------------------------------------------------------------\n\n  /** Trigger reaction delay on all defenders (snap, pass thrown, etc.) */\n  public triggerReaction(overrideDelay?: number): void {\n    for (const [, state] of this.defenders) {\n      const delay = overrideDelay ?? state.attributes.baseReactionTime;\n      // Modulate by coverage rating: better players react faster\n      state.reactionTimer = delay * (1.3 - state.attributes.coverageRating * 0.5);\n    }\n    this.playElapsed = 0;\n    // Reset route recognition\n    for (const [, state] of this.defenders) {\n      state.routeRecognitionTimer = 0;\n      state.hasRecognizedRoute = false;\n    }\n  }\n\n  /** Check if a specific defender can tackle the ball carrier */\n  public canTackle(defenderId: string, targetPos: Vector3, tackleRadius: number = 1.5): boolean {\n    const state = this.defenders.get(defenderId);\n    if (!state) return false;\n    const dist = Vector3.Distance(state.agent.position, targetPos);\n    return dist <= tackleRadius;\n  }\n\n  /** Get the SteeringAgent for a defender */\n  public getAgent(defenderId: string): SteeringAgent | null {\n    return this.defenders.get(defenderId)?.agent ?? null;\n  }\n\n  /** Get all registered agents */\n  public getAllAgents(): SteeringAgent[] {\n    const agents: SteeringAgent[] = [];\n    for (const [, state] of this.defenders) {\n      agents.push(state.agent);\n    }\n    return agents;\n  }\n\n  /** Get defender count */\n  public get defenderCount(): number {\n    return this.defenders.size;\n  }\n\n  /** Get the current scheme */\n  public get currentScheme(): CoverageScheme {\n    return this.scheme;\n  }\n\n  /** Evaluate catch contest probability for a defender near a receiver */\n  public contestCatchProbability(defenderId: string, receiverPos: Vector3): number {\n    const state = this.defenders.get(defenderId);\n    if (!state) return 0;\n\n    const dist = Vector3.Distance(state.agent.position, receiverPos);\n    if (dist > 3) return 0; // Too far to contest\n\n    // Base probability scaled by distance (closer = better contest)\n    const distanceFactor = 1 - dist / 3;\n    return state.attributes.contestProbability * distanceFactor * state.attributes.coverageRating;\n  }\n\n  /** Reset the system between plays */\n  public reset(): void {\n    this.playElapsed = 0;\n    this.isPlayAction = false;\n    this.qbEyeDirection = Vector3.Forward();\n    for (const [, state] of this.defenders) {\n      state.reactionTimer = 0;\n      state.routeRecognitionTimer = 0;\n      state.hasRecognizedRoute = false;\n      state.pursuitAngle = null;\n      state.blitzDelayTimer = 0;\n    }\n  }\n}\n","/**\n * Blaze Blitz Football - Score System\n *\n * Tracks game clock, scoring, per-game/per-drive statistics,\n * and unlockable achievements across a full game session.\n */\n\nimport type { DriveResult } from './DriveSystem';\n\n// ============================================================================\n// Config\n// ============================================================================\n\nexport interface ScoreConfig {\n  quarterLengthSec: number;\n  playClockSec: number;\n  overtimeSuddenDeath: boolean;\n  twoMinuteWarningEnabled: boolean;\n}\n\nconst DEFAULT_CONFIG: ScoreConfig = {\n  quarterLengthSec: 120,\n  playClockSec: 25,\n  overtimeSuddenDeath: true,\n  twoMinuteWarningEnabled: true,\n};\n\n// ============================================================================\n// Clock\n// ============================================================================\n\nexport interface GameClock {\n  quarter: number;             // 1-4, 5+ for overtime\n  timeRemainingSec: number;    // Seconds left in current quarter\n  playClockSec: number;        // Seconds left on play clock\n  isRunning: boolean;\n  isHalftime: boolean;\n  isTwoMinuteWarning: boolean;\n  isOvertime: boolean;\n  isGameOver: boolean;\n}\n\n// ============================================================================\n// Scoring\n// ============================================================================\n\ntype Team = 'home' | 'away';\n\nexport interface TeamScore {\n  team: Team;\n  total: number;\n  touchdowns: number;\n  extraPoints: number;\n  twoPointConversions: number;\n  fieldGoals: number;\n  safeties: number;\n  quarterScores: number[];     // Index 0 = Q1, etc.\n}\n\n// ============================================================================\n// Statistics\n// ============================================================================\n\nexport interface PassingStats {\n  attempts: number;\n  completions: number;\n  yards: number;\n  touchdowns: number;\n  interceptions: number;\n  passerRating: number;\n}\n\nexport interface RushingStats {\n  attempts: number;\n  yards: number;\n  touchdowns: number;\n  longestRun: number;\n}\n\nexport interface ReceivingStats {\n  receptions: number;\n  yards: number;\n  touchdowns: number;\n  byReceiver: Map<string, { receptions: number; yards: number; touchdowns: number }>;\n}\n\nexport interface DefenseStats {\n  sacks: number;\n  interceptions: number;\n  fumbleRecoveries: number;\n}\n\nexport interface GameStats {\n  passing: PassingStats;\n  rushing: RushingStats;\n  receiving: ReceivingStats;\n  defense: DefenseStats;\n  bigPlays: number;            // 20+ yards\n  explosivePlays: number;      // 40+ yards\n  timeOfPossessionSec: number;\n  thirdDownAttempts: number;\n  thirdDownConversions: number;\n  fourthDownAttempts: number;\n  fourthDownConversions: number;\n}\n\n// ============================================================================\n// Drive Summary\n// ============================================================================\n\nexport interface DriveSummary {\n  driveIndex: number;\n  team: Team;\n  plays: number;\n  yards: number;\n  result: DriveResult;\n  elapsedSec: number;\n  startQuarter: number;\n  startTimeRemaining: number;\n}\n\n// ============================================================================\n// Achievements\n// ============================================================================\n\nexport interface Achievement {\n  id: string;\n  name: string;\n  description: string;\n  unlockedAt: number | null;   // Game time (total elapsed seconds) when unlocked, null if locked\n}\n\nconst ACHIEVEMENT_DEFS: Omit<Achievement, 'unlockedAt'>[] = [\n  { id: 'first_td', name: 'First Blood', description: 'Score your first touchdown' },\n  { id: '100yd_passer', name: 'Arm Cannon', description: 'Pass for 100+ yards in a game' },\n  { id: 'pick_six', name: 'Pick Six', description: 'Return an interception for a touchdown' },\n  { id: 'shutout', name: 'Lockdown', description: 'Win without allowing a score' },\n  { id: 'comeback', name: 'Never Say Die', description: 'Win after trailing by 14+' },\n  { id: 'perfect_drive', name: 'Surgeon', description: 'Complete a drive with a perfect passer rating' },\n  { id: 'hat_trick', name: 'Hat Trick', description: 'Score 3 touchdowns' },\n];\n\n// ============================================================================\n// Score System\n// ============================================================================\n\nexport class ScoreSystem {\n  private config: ScoreConfig;\n  private clock: GameClock;\n  private scores: Record<Team, TeamScore>;\n  private stats: Record<Team, GameStats>;\n  private drives: DriveSummary[];\n  private achievements: Map<string, Achievement>;\n  private maxTrailingDeficit: number;\n\n  // Tracking for current drive passer rating\n  private currentDrivePassing: PassingStats | null;\n\n  constructor(config: Partial<ScoreConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.clock = this.createClock();\n    this.scores = { home: this.createTeamScore('home'), away: this.createTeamScore('away') };\n    this.stats = { home: this.createGameStats(), away: this.createGameStats() };\n    this.drives = [];\n    this.achievements = new Map();\n    this.maxTrailingDeficit = 0;\n    this.currentDrivePassing = null;\n\n    for (const def of ACHIEVEMENT_DEFS) {\n      this.achievements.set(def.id, { ...def, unlockedAt: null });\n    }\n  }\n\n  // --------------------------------------------------------------------------\n  // Factory helpers\n  // --------------------------------------------------------------------------\n\n  private createClock(): GameClock {\n    return {\n      quarter: 1,\n      timeRemainingSec: this.config.quarterLengthSec,\n      playClockSec: this.config.playClockSec,\n      isRunning: false,\n      isHalftime: false,\n      isTwoMinuteWarning: false,\n      isOvertime: false,\n      isGameOver: false,\n    };\n  }\n\n  private createTeamScore(team: Team): TeamScore {\n    return {\n      team,\n      total: 0,\n      touchdowns: 0,\n      extraPoints: 0,\n      twoPointConversions: 0,\n      fieldGoals: 0,\n      safeties: 0,\n      quarterScores: [0, 0, 0, 0],\n    };\n  }\n\n  private createGameStats(): GameStats {\n    return {\n      passing: { attempts: 0, completions: 0, yards: 0, touchdowns: 0, interceptions: 0, passerRating: 0 },\n      rushing: { attempts: 0, yards: 0, touchdowns: 0, longestRun: 0 },\n      receiving: { receptions: 0, yards: 0, touchdowns: 0, byReceiver: new Map() },\n      defense: { sacks: 0, interceptions: 0, fumbleRecoveries: 0 },\n      bigPlays: 0,\n      explosivePlays: 0,\n      timeOfPossessionSec: 0,\n      thirdDownAttempts: 0,\n      thirdDownConversions: 0,\n      fourthDownAttempts: 0,\n      fourthDownConversions: 0,\n    };\n  }\n\n  // --------------------------------------------------------------------------\n  // Clock\n  // --------------------------------------------------------------------------\n\n  getClock(): Readonly<GameClock> {\n    return this.clock;\n  }\n\n  startClock(): void {\n    if (!this.clock.isGameOver && !this.clock.isHalftime) {\n      this.clock.isRunning = true;\n    }\n  }\n\n  stopClock(): void {\n    this.clock.isRunning = false;\n  }\n\n  resetPlayClock(): void {\n    this.clock.playClockSec = this.config.playClockSec;\n  }\n\n  /** Advance the game clock by `dt` seconds. Returns true if the quarter ended. */\n  tick(dt: number): boolean {\n    if (!this.clock.isRunning || this.clock.isGameOver) return false;\n\n    // Play clock\n    this.clock.playClockSec = Math.max(0, this.clock.playClockSec - dt);\n\n    // Game clock\n    const prev = this.clock.timeRemainingSec;\n    this.clock.timeRemainingSec = Math.max(0, this.clock.timeRemainingSec - dt);\n\n    // Two-minute warning check\n    if (\n      this.config.twoMinuteWarningEnabled &&\n      !this.clock.isTwoMinuteWarning &&\n      (this.clock.quarter === 2 || this.clock.quarter === 4) &&\n      prev > 120 &&\n      this.clock.timeRemainingSec <= 120\n    ) {\n      this.clock.isTwoMinuteWarning = true;\n      this.clock.isRunning = false;\n      return false;\n    }\n\n    if (this.clock.timeRemainingSec <= 0) {\n      return this.endQuarter();\n    }\n\n    return false;\n  }\n\n  clearTwoMinuteWarning(): void {\n    this.clock.isTwoMinuteWarning = false;\n  }\n\n  private endQuarter(): boolean {\n    this.clock.isRunning = false;\n\n    if (this.clock.quarter === 2) {\n      this.clock.isHalftime = true;\n      return true;\n    }\n\n    if (this.clock.quarter === 4) {\n      if (this.scores.home.total === this.scores.away.total && this.config.overtimeSuddenDeath) {\n        this.clock.quarter = 5;\n        this.clock.isOvertime = true;\n        this.clock.timeRemainingSec = this.config.quarterLengthSec;\n        return true;\n      }\n      this.clock.isGameOver = true;\n      this.evaluateEndGameAchievements();\n      return true;\n    }\n\n    // Overtime quarter ended  if still tied, add another OT quarter\n    if (this.clock.isOvertime) {\n      if (this.scores.home.total === this.scores.away.total) {\n        this.clock.quarter += 1;\n        this.clock.timeRemainingSec = this.config.quarterLengthSec;\n        return true;\n      }\n      this.clock.isGameOver = true;\n      this.evaluateEndGameAchievements();\n      return true;\n    }\n\n    // Q1 or Q3  advance normally\n    this.clock.quarter += 1;\n    this.clock.timeRemainingSec = this.config.quarterLengthSec;\n    this.clock.isTwoMinuteWarning = false;\n    return true;\n  }\n\n  endHalftime(): void {\n    if (!this.clock.isHalftime) return;\n    this.clock.isHalftime = false;\n    this.clock.quarter = 3;\n    this.clock.timeRemainingSec = this.config.quarterLengthSec;\n    this.clock.isTwoMinuteWarning = false;\n  }\n\n  /** Total elapsed game seconds. */\n  getElapsedSec(): number {\n    const completedQuarters = this.clock.quarter - 1;\n    const elapsed = completedQuarters * this.config.quarterLengthSec;\n    return elapsed + (this.config.quarterLengthSec - this.clock.timeRemainingSec);\n  }\n\n  // --------------------------------------------------------------------------\n  // Scoring\n  // --------------------------------------------------------------------------\n\n  getScore(team: Team): Readonly<TeamScore> {\n    return this.scores[team];\n  }\n\n  scoreTouchdown(team: Team): void {\n    this.addPoints(team, 6);\n    this.scores[team].touchdowns += 1;\n    this.checkScoringAchievements(team);\n  }\n\n  scoreExtraPoint(team: Team): void {\n    this.addPoints(team, 1);\n    this.scores[team].extraPoints += 1;\n  }\n\n  scoreTwoPointConversion(team: Team): void {\n    this.addPoints(team, 2);\n    this.scores[team].twoPointConversions += 1;\n  }\n\n  scoreFieldGoal(team: Team): void {\n    this.addPoints(team, 3);\n    this.scores[team].fieldGoals += 1;\n    this.checkOvertimeEnd();\n  }\n\n  scoreSafety(team: Team): void {\n    this.addPoints(team, 2);\n    this.scores[team].safeties += 1;\n    this.checkOvertimeEnd();\n  }\n\n  private addPoints(team: Team, pts: number): void {\n    this.scores[team].total += pts;\n    const qi = Math.min(this.clock.quarter - 1, this.scores[team].quarterScores.length - 1);\n    if (qi >= 0) {\n      // Extend array for overtime quarters\n      while (this.scores[team].quarterScores.length <= qi) {\n        this.scores[team].quarterScores.push(0);\n      }\n      this.scores[team].quarterScores[qi] += pts;\n    }\n\n    this.trackDeficit();\n  }\n\n  private checkOvertimeEnd(): void {\n    if (this.clock.isOvertime && this.scores.home.total !== this.scores.away.total) {\n      this.clock.isGameOver = true;\n      this.evaluateEndGameAchievements();\n    }\n  }\n\n  private trackDeficit(): void {\n    const deficit = this.scores.away.total - this.scores.home.total;\n    // Track max deficit the home team faced (positive means home was trailing)\n    if (deficit > this.maxTrailingDeficit) {\n      this.maxTrailingDeficit = deficit;\n    }\n  }\n\n  // --------------------------------------------------------------------------\n  // Statistics\n  // --------------------------------------------------------------------------\n\n  getStats(team: Team): Readonly<GameStats> {\n    return this.stats[team];\n  }\n\n  recordPassAttempt(team: Team, completed: boolean, yards: number, isTd: boolean, isInt: boolean): void {\n    const p = this.stats[team].passing;\n    p.attempts += 1;\n    if (completed) {\n      p.completions += 1;\n      p.yards += yards;\n      if (isTd) p.touchdowns += 1;\n    }\n    if (isInt) p.interceptions += 1;\n    p.passerRating = ScoreSystem.computePasserRating(p);\n\n    if (completed) {\n      if (yards >= 40) this.stats[team].explosivePlays += 1;\n      else if (yards >= 20) this.stats[team].bigPlays += 1;\n    }\n\n    // Current drive passer tracking\n    if (this.currentDrivePassing) {\n      this.currentDrivePassing.attempts += 1;\n      if (completed) {\n        this.currentDrivePassing.completions += 1;\n        this.currentDrivePassing.yards += yards;\n        if (isTd) this.currentDrivePassing.touchdowns += 1;\n      }\n      if (isInt) this.currentDrivePassing.interceptions += 1;\n      this.currentDrivePassing.passerRating = ScoreSystem.computePasserRating(this.currentDrivePassing);\n    }\n\n    this.checkStatAchievements(team);\n  }\n\n  recordReception(team: Team, receiverId: string, yards: number, isTd: boolean): void {\n    const r = this.stats[team].receiving;\n    r.receptions += 1;\n    r.yards += yards;\n    if (isTd) r.touchdowns += 1;\n\n    const existing = r.byReceiver.get(receiverId);\n    if (existing) {\n      existing.receptions += 1;\n      existing.yards += yards;\n      if (isTd) existing.touchdowns += 1;\n    } else {\n      r.byReceiver.set(receiverId, { receptions: 1, yards, touchdowns: isTd ? 1 : 0 });\n    }\n  }\n\n  recordRush(team: Team, yards: number, isTd: boolean): void {\n    const r = this.stats[team].rushing;\n    r.attempts += 1;\n    r.yards += yards;\n    if (isTd) r.touchdowns += 1;\n    if (yards > r.longestRun) r.longestRun = yards;\n\n    if (yards >= 40) this.stats[team].explosivePlays += 1;\n    else if (yards >= 20) this.stats[team].bigPlays += 1;\n  }\n\n  recordSack(defensiveTeam: Team): void {\n    this.stats[defensiveTeam].defense.sacks += 1;\n  }\n\n  recordInterception(defensiveTeam: Team): void {\n    this.stats[defensiveTeam].defense.interceptions += 1;\n  }\n\n  recordFumbleRecovery(defensiveTeam: Team): void {\n    this.stats[defensiveTeam].defense.fumbleRecoveries += 1;\n  }\n\n  recordPickSix(defensiveTeam: Team): void {\n    this.recordInterception(defensiveTeam);\n    this.unlock('pick_six');\n  }\n\n  recordThirdDown(team: Team, converted: boolean): void {\n    this.stats[team].thirdDownAttempts += 1;\n    if (converted) this.stats[team].thirdDownConversions += 1;\n  }\n\n  recordFourthDown(team: Team, converted: boolean): void {\n    this.stats[team].fourthDownAttempts += 1;\n    if (converted) this.stats[team].fourthDownConversions += 1;\n  }\n\n  addTimeOfPossession(team: Team, seconds: number): void {\n    this.stats[team].timeOfPossessionSec += seconds;\n  }\n\n  // --------------------------------------------------------------------------\n  // Passer Rating (NFL formula, clamped 0-158.3)\n  // --------------------------------------------------------------------------\n\n  static computePasserRating(p: PassingStats): number {\n    if (p.attempts === 0) return 0;\n\n    const a = Math.min(Math.max(((p.completions / p.attempts) - 0.3) * 5, 0), 2.375);\n    const b = Math.min(Math.max(((p.yards / p.attempts) - 3) * 0.25, 0), 2.375);\n    const c = Math.min(Math.max((p.touchdowns / p.attempts) * 20, 0), 2.375);\n    const d = Math.min(Math.max(2.375 - ((p.interceptions / p.attempts) * 25), 0), 2.375);\n\n    return Math.round(((a + b + c + d) / 6) * 100 * 10) / 10;\n  }\n\n  // --------------------------------------------------------------------------\n  // Drives\n  // --------------------------------------------------------------------------\n\n  getDrives(): readonly DriveSummary[] {\n    return this.drives;\n  }\n\n  startDrive(team: Team): void {\n    this.currentDrivePassing = {\n      attempts: 0,\n      completions: 0,\n      yards: 0,\n      touchdowns: 0,\n      interceptions: 0,\n      passerRating: 0,\n    };\n  }\n\n  endDrive(team: Team, plays: number, yards: number, result: DriveResult, elapsedSec: number): void {\n    const summary: DriveSummary = {\n      driveIndex: this.drives.length,\n      team,\n      plays,\n      yards,\n      result,\n      elapsedSec,\n      startQuarter: this.clock.quarter,\n      startTimeRemaining: this.clock.timeRemainingSec + elapsedSec,\n    };\n    this.drives.push(summary);\n\n    // Check perfect drive\n    if (\n      this.currentDrivePassing &&\n      this.currentDrivePassing.attempts > 0 &&\n      result === 'touchdown' &&\n      this.currentDrivePassing.passerRating >= 158.3\n    ) {\n      this.unlock('perfect_drive');\n    }\n\n    this.currentDrivePassing = null;\n  }\n\n  // --------------------------------------------------------------------------\n  // Achievements\n  // --------------------------------------------------------------------------\n\n  getAchievements(): Achievement[] {\n    return Array.from(this.achievements.values());\n  }\n\n  getUnlockedAchievements(): Achievement[] {\n    return this.getAchievements().filter((a) => a.unlockedAt !== null);\n  }\n\n  isUnlocked(id: string): boolean {\n    return (this.achievements.get(id)?.unlockedAt ?? null) !== null;\n  }\n\n  private unlock(id: string): void {\n    const a = this.achievements.get(id);\n    if (a && a.unlockedAt === null) {\n      a.unlockedAt = this.getElapsedSec();\n    }\n  }\n\n  private checkScoringAchievements(team: Team): void {\n    const s = this.scores[team];\n\n    if (s.touchdowns >= 1) this.unlock('first_td');\n    if (s.touchdowns >= 3) this.unlock('hat_trick');\n\n    // Overtime sudden-death TD ends the game\n    if (this.clock.isOvertime && this.scores.home.total !== this.scores.away.total) {\n      this.clock.isGameOver = true;\n      this.evaluateEndGameAchievements();\n    }\n  }\n\n  private checkStatAchievements(team: Team): void {\n    if (this.stats[team].passing.yards >= 100) this.unlock('100yd_passer');\n  }\n\n  private evaluateEndGameAchievements(): void {\n    // Shutout: winner allowed 0 points\n    const winner: Team = this.scores.home.total > this.scores.away.total ? 'home' : 'away';\n    const loser: Team = winner === 'home' ? 'away' : 'home';\n    if (this.scores[loser].total === 0) this.unlock('shutout');\n\n    // Comeback: home team won after trailing by 14+\n    if (winner === 'home' && this.maxTrailingDeficit >= 14) {\n      this.unlock('comeback');\n    }\n  }\n\n  // --------------------------------------------------------------------------\n  // Reset\n  // --------------------------------------------------------------------------\n\n  reset(config?: Partial<ScoreConfig>): void {\n    if (config) this.config = { ...DEFAULT_CONFIG, ...config };\n    this.clock = this.createClock();\n    this.scores = { home: this.createTeamScore('home'), away: this.createTeamScore('away') };\n    this.stats = { home: this.createGameStats(), away: this.createGameStats() };\n    this.drives = [];\n    this.maxTrailingDeficit = 0;\n    this.currentDrivePassing = null;\n    for (const [id, a] of this.achievements) {\n      a.unlockedAt = null;\n    }\n  }\n}\n","/**\n * Blaze Blitz Football - Audio Manager\n * Handles all game audio: music, SFX, crowd ambience\n * Mobile-friendly with user interaction requirement\n */\n\nimport { Scene } from '@babylonjs/core';\n\n/** Audio configuration */\ninterface AudioConfig {\n  masterVolume: number;\n  musicVolume: number;\n  sfxVolume: number;\n  ambientVolume: number;\n}\n\n/** SFX types available for football */\ntype SFXType =\n  | 'snap'\n  | 'tackle'\n  | 'tackle_big'\n  | 'catch'\n  | 'incomplete'\n  | 'whistle'\n  | 'crowd_cheer'\n  | 'crowd_gasp'\n  | 'crowd_ambient'\n  | 'touchdown'\n  | 'first_down'\n  | 'turbo_boost'\n  | 'game_start'\n  | 'game_over'\n  | 'pass_throw'\n  | 'hit_impact'\n  | 'fumble'\n  | 'stiff_arm'\n  | 'juke';\n\n/** Default audio config */\nconst DEFAULT_CONFIG: AudioConfig = {\n  masterVolume: 0.7,\n  musicVolume: 0.4,\n  sfxVolume: 0.8,\n  ambientVolume: 0.3,\n};\n\n/**\n * AudioManager - Handles all game audio for Blitz Football\n * Uses Web Audio API for procedurally generated sounds\n */\nexport class AudioManager {\n  private scene: Scene;\n  private config: AudioConfig;\n  private isUnlocked: boolean = false;\n\n  // Synthesized audio (no external files needed)\n  private audioContext: AudioContext | null = null;\n\n  // Ambient sound references\n  private _ambientNoise: AudioBufferSourceNode | null = null;\n  private _ambientLfo: OscillatorNode | null = null;\n  private _crowdSources: Array<{ noise: AudioBufferSourceNode; lfo: OscillatorNode; panner: PannerNode }> | null = null;\n  private _crowdGain: GainNode | null = null;\n  private _convolver: ConvolverNode | null = null;\n\n  constructor(scene: Scene, config: Partial<AudioConfig> = {}) {\n    this.scene = scene;\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.initAudioContext();\n  }\n\n  /** Initialize Web Audio context */\n  private initAudioContext(): void {\n    try {\n      this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n    } catch (e) {\n      console.warn('Web Audio API not supported');\n    }\n\n    // Create synthetic reverb impulse response\n    if (this.audioContext) {\n      this.createReverbConvolver();\n    }\n  }\n\n  /** Unlock audio (required for mobile) - call on first user interaction */\n  public async unlock(): Promise<void> {\n    if (this.isUnlocked) return;\n\n    if (this.audioContext?.state === 'suspended') {\n      await this.audioContext.resume();\n    }\n\n    // Play silent buffer to unlock\n    if (this.audioContext) {\n      const buffer = this.audioContext.createBuffer(1, 1, 22050);\n      const source = this.audioContext.createBufferSource();\n      source.buffer = buffer;\n      source.connect(this.audioContext.destination);\n      source.start(0);\n    }\n\n    this.isUnlocked = true;\n  }\n\n  /** Check if audio is unlocked */\n  public get unlocked(): boolean {\n    return this.isUnlocked;\n  }\n\n  /**\n   * Play a synthesized sound effect\n   * Uses Web Audio API to generate sounds procedurally\n   */\n  public playSFX(type: SFXType): void {\n    if (!this.audioContext || !this.isUnlocked) return;\n\n    const volume = this.config.masterVolume * this.config.sfxVolume;\n\n    switch (type) {\n      case 'snap':\n        this.playSnap(volume);\n        break;\n      case 'tackle':\n        this.playTackle(volume);\n        break;\n      case 'tackle_big':\n        this.playBigTackle(volume);\n        break;\n      case 'catch':\n        this.playCatch(volume);\n        break;\n      case 'incomplete':\n        this.playIncomplete(volume);\n        break;\n      case 'whistle':\n        this.playWhistle(volume);\n        break;\n      case 'crowd_cheer':\n        this.playCrowdCheer(volume);\n        break;\n      case 'crowd_gasp':\n        this.playCrowdGasp(volume);\n        break;\n      case 'touchdown':\n        this.playTouchdown(volume);\n        break;\n      case 'first_down':\n        this.playFirstDown(volume);\n        break;\n      case 'turbo_boost':\n        this.playTurboBoost(volume);\n        break;\n      case 'game_start':\n        this.playGameStart(volume);\n        break;\n      case 'game_over':\n        this.playGameOver(volume);\n        break;\n      case 'pass_throw':\n        this.playPassThrow(volume);\n        break;\n      case 'hit_impact':\n        this.playHitImpact(volume);\n        break;\n      case 'fumble':\n        this.playFumble(volume);\n        break;\n      case 'stiff_arm':\n        this.playStiffArm(volume);\n        break;\n      case 'juke':\n        this.playJuke(volume);\n        break;\n      default:\n        break;\n    }\n  }\n\n  /** Ball snap - quick leather pop */\n  private playSnap(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // Quick burst\n    const noiseBuffer = this.createNoiseBuffer(0.05);\n    const noise = ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'bandpass';\n    filter.frequency.value = 1500;\n    filter.Q.value = 2;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(volume * 0.5, now);\n    gain.gain.exponentialDecayTo(0.001, now + 0.05);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    noise.start(now);\n  }\n\n  /** Standard tackle impact */\n  private playTackle(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // Impact noise\n    const noiseBuffer = this.createNoiseBuffer(0.12);\n    const noise = ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'lowpass';\n    filter.frequency.value = 800;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(volume * 0.7, now);\n    gain.gain.exponentialDecayTo(0.001, now + 0.12);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    noise.start(now);\n\n    // Low thud\n    const osc = ctx.createOscillator();\n    osc.type = 'sine';\n    osc.frequency.setValueAtTime(100, now);\n    osc.frequency.exponentialRampToValueAtTime(40, now + 0.08);\n\n    const oscGain = ctx.createGain();\n    oscGain.gain.setValueAtTime(volume * 0.5, now);\n    oscGain.gain.exponentialDecayTo(0.001, now + 0.08);\n\n    osc.connect(oscGain);\n    oscGain.connect(ctx.destination);\n    osc.detune.value = Math.random() * 400 - 200;\n    osc.start(now);\n    osc.stop(now + 0.1);\n  }\n\n  /** Big hit tackle - more impactful */\n  private playBigTackle(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // Heavy impact\n    const noiseBuffer = this.createNoiseBuffer(0.2);\n    const noise = ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'lowpass';\n    filter.frequency.value = 600;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(volume * 0.9, now);\n    gain.gain.exponentialDecayTo(0.001, now + 0.2);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    noise.start(now);\n\n    // Deep bass thud\n    const osc = ctx.createOscillator();\n    osc.type = 'sine';\n    osc.frequency.setValueAtTime(80, now);\n    osc.frequency.exponentialRampToValueAtTime(30, now + 0.15);\n\n    const oscGain = ctx.createGain();\n    oscGain.gain.setValueAtTime(volume * 0.7, now);\n    oscGain.gain.exponentialDecayTo(0.001, now + 0.15);\n\n    osc.connect(oscGain);\n    oscGain.connect(ctx.destination);\n    osc.detune.value = Math.random() * 400 - 200;\n    osc.start(now);\n    osc.stop(now + 0.2);\n\n    // Add crowd gasp\n    setTimeout(() => this.playCrowdGasp(volume * 0.5), 100);\n  }\n\n  /** Ball catch - leather thud */\n  private playCatch(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    const noiseBuffer = this.createNoiseBuffer(0.06);\n    const noise = ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'bandpass';\n    filter.frequency.value = 1200;\n    filter.Q.value = 1;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(volume * 0.4, now);\n    gain.gain.exponentialDecayTo(0.001, now + 0.06);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    noise.start(now);\n  }\n\n  /** Incomplete pass */\n  private playIncomplete(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // Soft thud as ball hits ground\n    const noiseBuffer = this.createNoiseBuffer(0.08);\n    const noise = ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'lowpass';\n    filter.frequency.value = 500;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(volume * 0.3, now);\n    gain.gain.exponentialDecayTo(0.001, now + 0.08);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    noise.start(now);\n\n    // Crowd disappointment\n    setTimeout(() => this.playCrowdGasp(volume * 0.3), 50);\n  }\n\n  /** Referee whistle */\n  private playWhistle(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // High pitched whistle\n    const osc = ctx.createOscillator();\n    osc.type = 'sine';\n    osc.frequency.setValueAtTime(3000, now);\n    osc.frequency.setValueAtTime(2800, now + 0.1);\n    osc.frequency.setValueAtTime(3000, now + 0.2);\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(0, now);\n    gain.gain.linearRampToValueAtTime(volume * 0.3, now + 0.02);\n    gain.gain.setValueAtTime(volume * 0.3, now + 0.25);\n    gain.gain.linearRampToValueAtTime(0, now + 0.3);\n\n    osc.connect(gain);\n    gain.connect(ctx.destination);\n    if (this._convolver) {\n      const wetGain = ctx.createGain();\n      wetGain.gain.value = 0.3;\n      gain.connect(this._convolver);\n      this._convolver.connect(wetGain);\n      wetGain.connect(ctx.destination);\n    }\n    osc.detune.value = Math.random() * 400 - 200;\n    osc.start(now);\n    osc.stop(now + 0.35);\n  }\n\n  /** Crowd cheer - layered noise with modulation */\n  private playCrowdCheer(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n    const duration = 1.5;\n\n    const noiseBuffer = this.createNoiseBuffer(duration);\n    const noise = ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'bandpass';\n    filter.frequency.value = 1200;\n    filter.Q.value = 0.5;\n\n    // Modulation for \"crowd wave\" effect\n    const lfo = ctx.createOscillator();\n    lfo.frequency.value = 3;\n    const lfoGain = ctx.createGain();\n    lfoGain.gain.value = 200;\n    lfo.connect(lfoGain);\n    lfoGain.connect(filter.frequency);\n    lfo.detune.value = Math.random() * 400 - 200;\n    lfo.start(now);\n    lfo.stop(now + duration);\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(0, now);\n    gain.gain.linearRampToValueAtTime(volume * 0.5, now + 0.2);\n    gain.gain.setValueAtTime(volume * 0.5, now + 0.8);\n    gain.gain.linearRampToValueAtTime(0, now + duration);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    noise.start(now);\n  }\n\n  /** Crowd gasp - quick intake */\n  private playCrowdGasp(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    const noiseBuffer = this.createNoiseBuffer(0.4);\n    const noise = ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'bandpass';\n    filter.frequency.setValueAtTime(2000, now);\n    filter.frequency.linearRampToValueAtTime(800, now + 0.4);\n    filter.Q.value = 1;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(volume * 0.4, now);\n    gain.gain.linearRampToValueAtTime(0, now + 0.4);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    noise.start(now);\n  }\n\n  /** Touchdown fanfare */\n  private playTouchdown(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // Triumphant chord\n    const notes = [261.63, 329.63, 392.0, 523.25, 659.26];\n    const delays = [0, 0.05, 0.1, 0.15, 0.2];\n\n    notes.forEach((freq, i) => {\n      const osc = ctx.createOscillator();\n      osc.type = 'triangle';\n      osc.frequency.value = freq;\n\n      const gain = ctx.createGain();\n      gain.gain.setValueAtTime(0, now + delays[i]);\n      gain.gain.linearRampToValueAtTime(volume * 0.4, now + delays[i] + 0.05);\n      gain.gain.exponentialDecayTo(0.001, now + delays[i] + 1);\n\n      osc.connect(gain);\n      gain.connect(ctx.destination);\n      osc.detune.value = Math.random() * 400 - 200;\n      osc.start(now + delays[i]);\n      osc.stop(now + delays[i] + 1.2);\n    });\n\n    // Big crowd cheer\n    setTimeout(() => this.playCrowdCheer(volume * 1.5), 150);\n  }\n\n  /** First down sound */\n  private playFirstDown(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // Quick ascending arpeggio\n    const notes = [392.0, 493.88, 587.33];\n    notes.forEach((freq, i) => {\n      const osc = ctx.createOscillator();\n      osc.type = 'square';\n      osc.frequency.value = freq;\n\n      const gain = ctx.createGain();\n      const startTime = now + i * 0.08;\n      gain.gain.setValueAtTime(volume * 0.2, startTime);\n      gain.gain.exponentialDecayTo(0.001, startTime + 0.2);\n\n      osc.connect(gain);\n      gain.connect(ctx.destination);\n      osc.detune.value = Math.random() * 400 - 200;\n      osc.start(startTime);\n      osc.stop(startTime + 0.25);\n    });\n  }\n\n  /** Turbo boost activation */\n  private playTurboBoost(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // Whoosh sound\n    const noiseBuffer = this.createNoiseBuffer(0.15);\n    const noise = ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'bandpass';\n    filter.frequency.setValueAtTime(500, now);\n    filter.frequency.linearRampToValueAtTime(2000, now + 0.15);\n    filter.Q.value = 1;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(volume * 0.3, now);\n    gain.gain.linearRampToValueAtTime(0, now + 0.15);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    noise.start(now);\n  }\n\n  /** Game start sound */\n  private playGameStart(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // Horn-like sound\n    const osc = ctx.createOscillator();\n    osc.type = 'sawtooth';\n    osc.frequency.value = 220;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'lowpass';\n    filter.frequency.value = 800;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(0, now);\n    gain.gain.linearRampToValueAtTime(volume * 0.4, now + 0.1);\n    gain.gain.setValueAtTime(volume * 0.4, now + 0.4);\n    gain.gain.linearRampToValueAtTime(0, now + 0.6);\n\n    osc.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    osc.detune.value = Math.random() * 400 - 200;\n    osc.start(now);\n    osc.stop(now + 0.7);\n\n    // Quick crowd roar\n    setTimeout(() => this.playCrowdCheer(volume * 0.5), 200);\n  }\n\n  /** Game over sound */\n  private playGameOver(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // Final horn\n    const osc = ctx.createOscillator();\n    osc.type = 'sawtooth';\n    osc.frequency.setValueAtTime(220, now);\n    osc.frequency.linearRampToValueAtTime(110, now + 1);\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'lowpass';\n    filter.frequency.value = 600;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(volume * 0.4, now);\n    gain.gain.linearRampToValueAtTime(0, now + 1);\n\n    osc.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    osc.detune.value = Math.random() * 400 - 200;\n    osc.start(now);\n    osc.stop(now + 1.1);\n  }\n\n  /** Pass throw whoosh */\n  private playPassThrow(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    const noiseBuffer = this.createNoiseBuffer(0.2);\n    const noise = ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'bandpass';\n    filter.frequency.setValueAtTime(600, now);\n    filter.frequency.linearRampToValueAtTime(1500, now + 0.2);\n    filter.Q.value = 2;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(0, now);\n    gain.gain.linearRampToValueAtTime(volume * 0.2, now + 0.05);\n    gain.gain.linearRampToValueAtTime(0, now + 0.2);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    noise.start(now);\n  }\n\n  /** Hit impact - for collisions */\n  private playHitImpact(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    const noiseBuffer = this.createNoiseBuffer(0.08);\n    const noise = ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'lowpass';\n    filter.frequency.value = 1000;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(volume * 0.5, now);\n    gain.gain.exponentialDecayTo(0.001, now + 0.08);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    noise.start(now);\n  }\n\n  /** Fumble sound */\n  private playFumble(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // Descending tone\n    const osc = ctx.createOscillator();\n    osc.type = 'sawtooth';\n    osc.frequency.setValueAtTime(500, now);\n    osc.frequency.exponentialRampToValueAtTime(150, now + 0.3);\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'lowpass';\n    filter.frequency.value = 1000;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(volume * 0.25, now);\n    gain.gain.linearRampToValueAtTime(0, now + 0.3);\n\n    osc.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    osc.detune.value = Math.random() * 400 - 200;\n    osc.start(now);\n    osc.stop(now + 0.35);\n\n    // Crowd gasp\n    this.playCrowdGasp(volume * 0.6);\n  }\n\n  /** Stiff arm success */\n  private playStiffArm(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // Quick impact\n    const noiseBuffer = this.createNoiseBuffer(0.06);\n    const noise = ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'bandpass';\n    filter.frequency.value = 1000;\n    filter.Q.value = 1;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(volume * 0.4, now);\n    gain.gain.exponentialDecayTo(0.001, now + 0.06);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    noise.start(now);\n  }\n\n  /** Juke move success */\n  private playJuke(volume: number): void {\n    const ctx = this.audioContext!;\n    const now = ctx.currentTime;\n\n    // Quick swoosh\n    const noiseBuffer = this.createNoiseBuffer(0.1);\n    const noise = ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n\n    const filter = ctx.createBiquadFilter();\n    filter.type = 'bandpass';\n    filter.frequency.setValueAtTime(800, now);\n    filter.frequency.linearRampToValueAtTime(1500, now + 0.1);\n    filter.Q.value = 2;\n\n    const gain = ctx.createGain();\n    gain.gain.setValueAtTime(volume * 0.25, now);\n    gain.gain.linearRampToValueAtTime(0, now + 0.1);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(ctx.destination);\n    noise.start(now);\n  }\n\n  private createReverbConvolver(): void {\n    const ctx = this.audioContext!;\n    const sampleRate = ctx.sampleRate;\n    const length = sampleRate * 1.5; // 1.5s reverb\n    const impulse = ctx.createBuffer(2, length, sampleRate);\n\n    for (let channel = 0; channel < 2; channel++) {\n      const data = impulse.getChannelData(channel);\n      for (let i = 0; i < length; i++) {\n        data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (sampleRate * 0.4));\n      }\n    }\n\n    this._convolver = ctx.createConvolver();\n    this._convolver.buffer = impulse;\n  }\n\n  /** Create white noise buffer */\n  private createNoiseBuffer(duration: number): AudioBuffer {\n    const ctx = this.audioContext!;\n    const sampleRate = ctx.sampleRate;\n    const bufferSize = sampleRate * duration;\n    const buffer = ctx.createBuffer(1, bufferSize, sampleRate);\n    const data = buffer.getChannelData(0);\n\n    for (let i = 0; i < bufferSize; i++) {\n      data[i] = Math.random() * 2 - 1;\n    }\n\n    return buffer;\n  }\n\n  /** Start ambient crowd noise loop with spatial 4-corner sources */\n  public startAmbientCrowd(): void {\n    if (!this.audioContext || !this.isUnlocked) return;\n    this.stopAmbientCrowd();\n\n    const ctx = this.audioContext;\n    const volume = this.config.masterVolume * this.config.ambientVolume;\n\n    // Create master gain for crowd\n    this._crowdGain = ctx.createGain();\n    this._crowdGain.gain.value = volume * 0.25;\n    this._crowdGain.connect(ctx.destination);\n\n    // 4 spatial sources at stadium corners\n    const positions: Array<[number, number, number]> = [\n      [-1, 0, -1], [1, 0, -1], [-1, 0, 1], [1, 0, 1],\n    ];\n\n    this._crowdSources = positions.map((pos, i) => {\n      const bufferSize = ctx.sampleRate * 2;\n      const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      for (let j = 0; j < bufferSize; j++) {\n        data[j] = (Math.random() * 2 - 1) * 0.5;\n      }\n\n      const noise = ctx.createBufferSource();\n      noise.buffer = buffer;\n      noise.loop = true;\n\n      const filter = ctx.createBiquadFilter();\n      filter.type = 'bandpass';\n      filter.frequency.value = 600 + i * 150;\n      filter.Q.value = 0.4;\n\n      const panner = ctx.createPanner();\n      panner.positionX.value = pos[0];\n      panner.positionY.value = pos[1];\n      panner.positionZ.value = pos[2];\n      panner.panningModel = 'HRTF';\n      panner.distanceModel = 'inverse';\n      panner.refDistance = 1;\n      panner.maxDistance = 10;\n\n      // Individual LFO for organic feel\n      const lfo = ctx.createOscillator();\n      lfo.frequency.value = 0.15 + Math.random() * 0.2;\n      const lfoGain = ctx.createGain();\n      lfoGain.gain.value = 80;\n      lfo.connect(lfoGain);\n      lfoGain.connect(filter.frequency);\n      lfo.start();\n\n      noise.connect(filter);\n      filter.connect(panner);\n      panner.connect(this._crowdGain!);\n      noise.start();\n\n      return { noise, lfo, panner };\n    });\n  }\n\n  /** Stop ambient crowd */\n  public stopAmbientCrowd(): void {\n    if (this._crowdSources) {\n      this._crowdSources.forEach(s => {\n        s.noise.stop();\n        s.lfo.stop();\n      });\n      this._crowdSources = null;\n    }\n    if (this._crowdGain) {\n      this._crowdGain.disconnect();\n      this._crowdGain = null;\n    }\n    // Legacy cleanup\n    if (this._ambientNoise) {\n      this._ambientNoise.stop();\n      this._ambientNoise = null;\n    }\n    if (this._ambientLfo) {\n      this._ambientLfo.stop();\n      this._ambientLfo = null;\n    }\n  }\n\n  /** Set crowd intensity level (1.0 = normal, >1 = louder) */\n  public setCrowdIntensity(level: number): void {\n    if (!this._crowdGain || !this.audioContext) return;\n    const ctx = this.audioContext;\n    const baseVolume = this.config.masterVolume * this.config.ambientVolume * 0.25;\n    this._crowdGain.gain.cancelScheduledValues(ctx.currentTime);\n    this._crowdGain.gain.setValueAtTime(this._crowdGain.gain.value, ctx.currentTime);\n    this._crowdGain.gain.linearRampToValueAtTime(baseVolume * level, ctx.currentTime + 0.5);\n  }\n\n  /** Set master volume */\n  public setMasterVolume(volume: number): void {\n    this.config.masterVolume = Math.max(0, Math.min(1, volume));\n  }\n\n  /** Set SFX volume */\n  public setSFXVolume(volume: number): void {\n    this.config.sfxVolume = Math.max(0, Math.min(1, volume));\n  }\n\n  /** Cleanup */\n  public dispose(): void {\n    this.stopAmbientCrowd();\n    if (this.audioContext?.state !== 'closed') {\n      this.audioContext?.close();\n    }\n  }\n}\n\n// Add exponentialDecayTo helper to GainNode\ndeclare global {\n  interface AudioParam {\n    exponentialDecayTo(value: number, endTime: number): void;\n  }\n}\n\nif (!AudioParam.prototype.exponentialDecayTo) {\n  AudioParam.prototype.exponentialDecayTo = function (value: number, endTime: number): void {\n    this.exponentialRampToValueAtTime(Math.max(value, 0.0001), endTime);\n  };\n}\n","/**\n * Blaze Blitz Football - Drive System\n *\n * Manages the multi-down drive: field position, first-down chains,\n * penalties, turnovers on downs, and scoring drives.\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type DriveResult =\n  | 'touchdown'\n  | 'field_goal'\n  | 'turnover_on_downs'\n  | 'interception'\n  | 'fumble_lost'\n  | 'safety'\n  | 'timeout'\n  | 'in_progress';\n\nexport interface PlayResult {\n  yardsGained: number;\n  isComplete: boolean;       // Pass completed\n  isTouchdown: boolean;\n  isTurnover: boolean;\n  isFirstDown: boolean;\n  isSack: boolean;\n  isFumble: boolean;\n  isInterception: boolean;\n  isPenalty: boolean;\n  penaltyYards: number;\n  bigPlay: boolean;          // 20+ yards\n  explosivePlay: boolean;    // 40+ yards\n}\n\nexport interface DriveState {\n  down: number;              // 1-4\n  yardsToGo: number;\n  lineOfScrimmage: number;   // 0-100 (own 0 to opponent's 0)\n  firstDownMarker: number;   // Yard line of first-down marker\n  playCount: number;\n  driveYards: number;\n  driveResult: DriveResult;\n  isRedZone: boolean;        // Inside opponent 20\n  fieldPosition: 'own' | 'midfield' | 'opponent';\n  lastPlayResult: PlayResult | null;\n}\n\nexport interface DriveConfig {\n  startingYardLine: number;\n  enableTurnovers: boolean;\n  maxDowns: number;          // Usually 4\n  firstDownDistance: number;  // Usually 10\n  fieldLength: number;       // 100 yards\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst DEFAULT_DRIVE_CONFIG: DriveConfig = {\n  startingYardLine: 25,\n  enableTurnovers: true,\n  maxDowns: 4,\n  firstDownDistance: 10,\n  fieldLength: 100,\n};\n\n// ============================================================================\n// Drive System\n// ============================================================================\n\nexport class DriveSystem {\n  private config: DriveConfig;\n  private state: DriveState;\n  private playHistory: PlayResult[] = [];\n\n  constructor(config: Partial<DriveConfig> = {}) {\n    this.config = { ...DEFAULT_DRIVE_CONFIG, ...config };\n    this.state = this.createInitialState();\n  }\n\n  private createInitialState(): DriveState {\n    const los = this.config.startingYardLine;\n    return {\n      down: 1,\n      yardsToGo: this.config.firstDownDistance,\n      lineOfScrimmage: los,\n      firstDownMarker: Math.min(los + this.config.firstDownDistance, this.config.fieldLength),\n      playCount: 0,\n      driveYards: 0,\n      driveResult: 'in_progress',\n      isRedZone: los >= 80,\n      fieldPosition: los < 40 ? 'own' : los < 60 ? 'midfield' : 'opponent',\n      lastPlayResult: null,\n    };\n  }\n\n  /** Reset for new drive */\n  public reset(startYardLine?: number): void {\n    if (startYardLine !== undefined) {\n      this.config.startingYardLine = startYardLine;\n    }\n    this.state = this.createInitialState();\n    this.playHistory = [];\n  }\n\n  /** Process the result of a play */\n  public processPlay(yards: number, opts: {\n    isComplete?: boolean;\n    isSack?: boolean;\n    isFumble?: boolean;\n    isInterception?: boolean;\n    isPenalty?: boolean;\n    penaltyYards?: number;\n  } = {}): PlayResult {\n    const actualYards = opts.isPenalty ? (opts.penaltyYards ?? 0) : yards;\n\n    const result: PlayResult = {\n      yardsGained: actualYards,\n      isComplete: opts.isComplete ?? (actualYards > 0),\n      isTouchdown: false,\n      isTurnover: false,\n      isFirstDown: false,\n      isSack: opts.isSack ?? false,\n      isFumble: opts.isFumble ?? false,\n      isInterception: opts.isInterception ?? false,\n      isPenalty: opts.isPenalty ?? false,\n      penaltyYards: opts.penaltyYards ?? 0,\n      bigPlay: actualYards >= 20,\n      explosivePlay: actualYards >= 40,\n    };\n\n    // Update line of scrimmage\n    const newLos = this.state.lineOfScrimmage + actualYards;\n\n    // Check touchdown\n    if (newLos >= this.config.fieldLength) {\n      result.isTouchdown = true;\n      this.state.driveResult = 'touchdown';\n      this.state.lineOfScrimmage = this.config.fieldLength;\n      this.finalizPlay(result);\n      return result;\n    }\n\n    // Check safety (sacked behind own goal)\n    if (newLos <= 0) {\n      result.isTurnover = true;\n      this.state.driveResult = 'safety';\n      this.state.lineOfScrimmage = 0;\n      this.finalizPlay(result);\n      return result;\n    }\n\n    // Check turnovers\n    if (this.config.enableTurnovers) {\n      if (result.isInterception) {\n        result.isTurnover = true;\n        this.state.driveResult = 'interception';\n        this.finalizPlay(result);\n        return result;\n      }\n      if (result.isFumble) {\n        result.isTurnover = true;\n        this.state.driveResult = 'fumble_lost';\n        this.finalizPlay(result);\n        return result;\n      }\n    }\n\n    // Apply yards\n    this.state.lineOfScrimmage = newLos;\n    this.state.driveYards += Math.max(0, actualYards);\n\n    // Check first down\n    if (newLos >= this.state.firstDownMarker) {\n      result.isFirstDown = true;\n      this.state.down = 1;\n      this.state.yardsToGo = this.config.firstDownDistance;\n      this.state.firstDownMarker = Math.min(\n        newLos + this.config.firstDownDistance,\n        this.config.fieldLength,\n      );\n    } else {\n      // Advance down\n      this.state.down++;\n      this.state.yardsToGo = Math.max(1, this.state.firstDownMarker - newLos);\n\n      // Turnover on downs\n      if (this.state.down > this.config.maxDowns) {\n        result.isTurnover = true;\n        this.state.driveResult = 'turnover_on_downs';\n      }\n    }\n\n    this.finalizPlay(result);\n    return result;\n  }\n\n  private finalizPlay(result: PlayResult): void {\n    this.state.playCount++;\n    this.state.lastPlayResult = result;\n    this.state.isRedZone = this.state.lineOfScrimmage >= 80;\n    this.state.fieldPosition =\n      this.state.lineOfScrimmage < 40 ? 'own' :\n      this.state.lineOfScrimmage < 60 ? 'midfield' : 'opponent';\n    this.playHistory.push(result);\n  }\n\n  //  Accessors \n\n  public getState(): DriveState {\n    return { ...this.state };\n  }\n\n  public isOver(): boolean {\n    return this.state.driveResult !== 'in_progress';\n  }\n\n  public getDown(): number {\n    return this.state.down;\n  }\n\n  public getYardsToGo(): number {\n    return this.state.yardsToGo;\n  }\n\n  public getLineOfScrimmage(): number {\n    return this.state.lineOfScrimmage;\n  }\n\n  public getFirstDownMarker(): number {\n    return this.state.firstDownMarker;\n  }\n\n  public isRedZone(): boolean {\n    return this.state.isRedZone;\n  }\n\n  public getPlayHistory(): PlayResult[] {\n    return [...this.playHistory];\n  }\n\n  /** Get short description: \"1st & 10 at OWN 25\" */\n  public getDownAndDistance(): string {\n    const ordinal = ['1st', '2nd', '3rd', '4th'][this.state.down - 1] ?? `${this.state.down}th`;\n    const los = this.state.lineOfScrimmage;\n    const side = los <= 50 ? `OWN ${los}` : `OPP ${100 - los}`;\n    if (this.state.yardsToGo >= this.config.fieldLength - los) {\n      return `${ordinal} & Goal at ${side}`;\n    }\n    return `${ordinal} & ${this.state.yardsToGo} at ${side}`;\n  }\n\n  /** Average yards per play this drive */\n  public getAvgYardsPerPlay(): number {\n    if (this.state.playCount === 0) return 0;\n    return this.state.driveYards / this.state.playCount;\n  }\n}\n","/**\n * Blaze Blitz Football - Playbook System\n *\n * Formations, expanded route tree, offensive/defensive plays,\n * smart play-calling AI, and visual formation picker data.\n *\n * 7-on-7 arcade football. Coordinates use X = depth (negative = behind LOS),\n * Z = lateral (positive = right). Babylon.js Vector3(x, 0, z) for flat field.\n */\n\nimport { Vector3 } from '@babylonjs/core';\nimport type {\n  RouteType,\n  PlayerRoute,\n  OffensivePlay,\n  DefensivePlay,\n} from '../data/plays';\n\n// ---------------------------------------------------------------------------\n// Route Tree\n// ---------------------------------------------------------------------------\n\n/** Extended route types beyond the base set */\nexport type ExtendedRouteType = RouteType | 'screen' | 'seam' | 'comeback' | 'dig';\n\n// ---------------------------------------------------------------------------\n// Formations\n// ---------------------------------------------------------------------------\n\nexport type FormationType =\n  | 'shotgun'\n  | 'iform'\n  | 'trips'\n  | 'spread'\n  | 'singleback';\n\n/** Per-position offset from the default position for a given formation */\nexport interface FormationOffset {\n  positionId: string;\n  offsetX: number;\n  offsetZ: number;\n}\n\nexport interface Formation {\n  id: FormationType;\n  name: string;\n  description: string;\n  offsets: FormationOffset[];\n  /** Flat Vector3 array for the formation picker preview (x,0,z per player) */\n  preview: Vector3[];\n}\n\n// Offset helpers  only positions that move relative to the base OFFENSIVE_POSITIONS.\n// Positions not listed keep their defaults.\n\nconst SHOTGUN_OFFSETS: FormationOffset[] = [\n  { positionId: 'qb', offsetX: -2, offsetZ: 0 },\n  { positionId: 'rb', offsetX: 0, offsetZ: -3 },\n];\n\nconst IFORM_OFFSETS: FormationOffset[] = [\n  { positionId: 'qb', offsetX: 1, offsetZ: 0 },\n  { positionId: 'rb', offsetX: -4, offsetZ: 0 },\n  { positionId: 'te', offsetX: 0, offsetZ: -4 },\n];\n\nconst TRIPS_OFFSETS: FormationOffset[] = [\n  { positionId: 'qb', offsetX: -2, offsetZ: 0 },\n  { positionId: 'wr1', offsetX: 0, offsetZ: 18 },\n  { positionId: 'wr2', offsetX: -1, offsetZ: 12 },\n  { positionId: 'wr3', offsetX: 0, offsetZ: 15 },\n  { positionId: 'te', offsetX: 0, offsetZ: -6 },\n];\n\nconst SPREAD_OFFSETS: FormationOffset[] = [\n  { positionId: 'qb', offsetX: -3, offsetZ: 0 },\n  { positionId: 'wr1', offsetX: 0, offsetZ: 25 },\n  { positionId: 'wr2', offsetX: 0, offsetZ: -25 },\n  { positionId: 'wr3', offsetX: -1, offsetZ: 12 },\n  { positionId: 'te', offsetX: -1, offsetZ: -12 },\n  { positionId: 'rb', offsetX: -1, offsetZ: -4 },\n];\n\nconst SINGLEBACK_OFFSETS: FormationOffset[] = [\n  { positionId: 'qb', offsetX: 0, offsetZ: 0 },\n  { positionId: 'rb', offsetX: -4, offsetZ: 0 },\n  { positionId: 'te', offsetX: 0, offsetZ: -6 },\n];\n\nfunction buildPreview(offsets: FormationOffset[]): Vector3[] {\n  // Base positions for the 7 offensive players (from teams.ts defaults)\n  const base: Record<string, { x: number; z: number }> = {\n    qb: { x: -5, z: 0 },\n    rb: { x: -7, z: 0 },\n    wr1: { x: 0, z: 20 },\n    wr2: { x: 0, z: -20 },\n    wr3: { x: -1, z: 8 },\n    te: { x: -1, z: -8 },\n    c: { x: 0, z: 0 },\n  };\n\n  const applied = { ...base };\n  for (const o of offsets) {\n    if (applied[o.positionId]) {\n      applied[o.positionId] = {\n        x: base[o.positionId].x + o.offsetX,\n        z: base[o.positionId].z + o.offsetZ,\n      };\n    }\n  }\n\n  return Object.values(applied).map((p) => new Vector3(p.x, 0, p.z));\n}\n\nexport const FORMATIONS: Record<FormationType, Formation> = {\n  shotgun: {\n    id: 'shotgun',\n    name: 'Shotgun',\n    description: 'QB lined up 7 yards back, RB beside him',\n    offsets: SHOTGUN_OFFSETS,\n    preview: buildPreview(SHOTGUN_OFFSETS),\n  },\n  iform: {\n    id: 'iform',\n    name: 'I-Formation',\n    description: 'QB under center, RB directly behind',\n    offsets: IFORM_OFFSETS,\n    preview: buildPreview(IFORM_OFFSETS),\n  },\n  trips: {\n    id: 'trips',\n    name: 'Trips',\n    description: 'Three receivers stacked to one side',\n    offsets: TRIPS_OFFSETS,\n    preview: buildPreview(TRIPS_OFFSETS),\n  },\n  spread: {\n    id: 'spread',\n    name: 'Spread',\n    description: 'Receivers split wide, 5-wide look',\n    offsets: SPREAD_OFFSETS,\n    preview: buildPreview(SPREAD_OFFSETS),\n  },\n  singleback: {\n    id: 'singleback',\n    name: 'Singleback',\n    description: 'Balanced with one back behind QB',\n    offsets: SINGLEBACK_OFFSETS,\n    preview: buildPreview(SINGLEBACK_OFFSETS),\n  },\n};\n\n// ---------------------------------------------------------------------------\n// Enhanced Play Types\n// ---------------------------------------------------------------------------\n\nexport interface EnhancedOffensivePlay extends OffensivePlay {\n  formation: FormationType;\n  tempo: 'hurry' | 'normal' | 'slow';\n  /** Tags for the AI play recommender */\n  tags: string[];\n}\n\nexport interface EnhancedDefensivePlay extends DefensivePlay {\n  /** Which offensive categories this scheme is strong against */\n  strongAgainst: Array<OffensivePlay['category']>;\n  /** Which categories it's weak against */\n  weakAgainst: Array<OffensivePlay['category']>;\n  riskLevel: 1 | 2 | 3;\n}\n\n// ---------------------------------------------------------------------------\n// Offensive Plays (12+)\n// ---------------------------------------------------------------------------\n\nexport const PLAYBOOK_OFFENSE: EnhancedOffensivePlay[] = [\n  // --- SHORT ---\n  {\n    id: 'pb_quick_slants',\n    name: 'Quick Slants',\n    category: 'short',\n    formation: 'spread',\n    tempo: 'hurry',\n    description: 'Two slants off the snap for a fast 5-8 yard gain',\n    difficulty: 1,\n    tags: ['quick', 'safe', 'short_yardage'],\n    routes: [\n      { positionId: 'wr1', routeType: 'slant', routeDepth: 7, routeWidth: -5, breakDelay: 0.15, isPrimary: true },\n      { positionId: 'wr2', routeType: 'slant', routeDepth: 7, routeWidth: 5, breakDelay: 0.2, isPrimary: false },\n      { positionId: 'wr3', routeType: 'flat', routeDepth: 2, routeWidth: 10, breakDelay: 0.1, isPrimary: false },\n      { positionId: 'te', routeType: 'drag', routeDepth: 5, routeWidth: 12, breakDelay: 0.25, isPrimary: false },\n      { positionId: 'rb', routeType: 'checkdown', routeDepth: 3, routeWidth: -5, breakDelay: 0, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n  {\n    id: 'pb_rb_screen',\n    name: 'RB Screen',\n    category: 'short',\n    formation: 'shotgun',\n    tempo: 'normal',\n    description: 'Dump to the back and let blockers lead',\n    difficulty: 2,\n    tags: ['screen', 'run_after_catch', 'blitz_beater'],\n    routes: [\n      { positionId: 'rb', routeType: 'flat', routeDepth: -1, routeWidth: 14, breakDelay: 0.4, isPrimary: true },\n      { positionId: 'wr1', routeType: 'streak', routeDepth: 20, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'wr2', routeType: 'streak', routeDepth: 20, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'wr3', routeType: 'block', routeDepth: 4, routeWidth: 10, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'te', routeType: 'block', routeDepth: 4, routeWidth: 6, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 3, routeWidth: 12, breakDelay: 0.3, isPrimary: false },\n    ],\n  },\n  {\n    id: 'pb_flat_out',\n    name: 'Flat & Out',\n    category: 'short',\n    formation: 'singleback',\n    tempo: 'hurry',\n    description: 'Quick flat to the TE with a WR out route underneath',\n    difficulty: 1,\n    tags: ['quick', 'safe', 'sideline'],\n    routes: [\n      { positionId: 'te', routeType: 'flat', routeDepth: 3, routeWidth: -10, breakDelay: 0.15, isPrimary: true },\n      { positionId: 'wr1', routeType: 'out', routeDepth: 6, routeWidth: 8, breakDelay: 0.4, isPrimary: false },\n      { positionId: 'wr2', routeType: 'slant', routeDepth: 8, routeWidth: 5, breakDelay: 0.2, isPrimary: false },\n      { positionId: 'wr3', routeType: 'drag', routeDepth: 5, routeWidth: 15, breakDelay: 0.3, isPrimary: false },\n      { positionId: 'rb', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n\n  // --- MEDIUM ---\n  {\n    id: 'pb_curl_flat',\n    name: 'Curl-Flat Combo',\n    category: 'medium',\n    formation: 'singleback',\n    tempo: 'normal',\n    description: 'High-low read: curl at 12 yards with a flat underneath',\n    difficulty: 1,\n    tags: ['read', 'safe', 'zone_beater'],\n    routes: [\n      { positionId: 'wr1', routeType: 'curl', routeDepth: 12, routeWidth: 0, breakDelay: 0.7, isPrimary: true },\n      { positionId: 'wr3', routeType: 'flat', routeDepth: 3, routeWidth: 10, breakDelay: 0.15, isPrimary: false },\n      { positionId: 'wr2', routeType: 'curl', routeDepth: 12, routeWidth: 0, breakDelay: 0.7, isPrimary: false },\n      { positionId: 'te', routeType: 'in', routeDepth: 10, routeWidth: -10, breakDelay: 0.55, isPrimary: false },\n      { positionId: 'rb', routeType: 'checkdown', routeDepth: 4, routeWidth: 5, breakDelay: 0, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n  {\n    id: 'pb_mesh_cross',\n    name: 'Mesh Crossers',\n    category: 'medium',\n    formation: 'spread',\n    tempo: 'normal',\n    description: 'Crossing routes that create pick-style traffic',\n    difficulty: 2,\n    tags: ['crossing', 'man_beater', 'rac'],\n    routes: [\n      { positionId: 'wr1', routeType: 'drag', routeDepth: 6, routeWidth: -25, breakDelay: 0.25, isPrimary: true },\n      { positionId: 'wr2', routeType: 'drag', routeDepth: 5, routeWidth: 25, breakDelay: 0.2, isPrimary: false },\n      { positionId: 'wr3', routeType: 'in', routeDepth: 14, routeWidth: -12, breakDelay: 0.55, isPrimary: false },\n      { positionId: 'te', routeType: 'out', routeDepth: 10, routeWidth: -10, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'rb', routeType: 'wheel', routeDepth: 12, routeWidth: 14, breakDelay: 0.4, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n  {\n    id: 'pb_smash',\n    name: 'Smash Concept',\n    category: 'medium',\n    formation: 'trips',\n    tempo: 'normal',\n    description: 'Corner-hitch combo to beat Cover 2',\n    difficulty: 2,\n    tags: ['cover2_beater', 'read', 'sideline'],\n    routes: [\n      { positionId: 'wr1', routeType: 'corner', routeDepth: 14, routeWidth: 10, breakDelay: 0.55, isPrimary: true },\n      { positionId: 'wr3', routeType: 'curl', routeDepth: 6, routeWidth: 0, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'wr2', routeType: 'post', routeDepth: 16, routeWidth: -8, breakDelay: 0.55, isPrimary: false },\n      { positionId: 'te', routeType: 'drag', routeDepth: 5, routeWidth: -15, breakDelay: 0.3, isPrimary: false },\n      { positionId: 'rb', routeType: 'checkdown', routeDepth: 3, routeWidth: -5, breakDelay: 0, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n\n  // --- DEEP ---\n  {\n    id: 'pb_four_verts',\n    name: 'Four Verticals',\n    category: 'deep',\n    formation: 'spread',\n    tempo: 'normal',\n    description: 'Four receivers streak deep to stress the safeties',\n    difficulty: 3,\n    tags: ['vertical', 'aggressive', 'cover3_beater'],\n    routes: [\n      { positionId: 'wr1', routeType: 'streak', routeDepth: 30, routeWidth: 0, breakDelay: 0, isPrimary: true },\n      { positionId: 'wr2', routeType: 'streak', routeDepth: 30, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'wr3', routeType: 'streak', routeDepth: 25, routeWidth: 3, breakDelay: 0, isPrimary: false },\n      { positionId: 'te', routeType: 'streak', routeDepth: 22, routeWidth: -3, breakDelay: 0, isPrimary: false },\n      { positionId: 'rb', routeType: 'checkdown', routeDepth: 5, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n  {\n    id: 'pb_post_wheel',\n    name: 'Post-Wheel',\n    category: 'deep',\n    formation: 'shotgun',\n    tempo: 'normal',\n    description: 'Deep post with a wheel route to hold the safety',\n    difficulty: 2,\n    tags: ['deep', 'cover1_beater', 'big_play'],\n    routes: [\n      { positionId: 'wr1', routeType: 'post', routeDepth: 22, routeWidth: -10, breakDelay: 0.55, isPrimary: true },\n      { positionId: 'rb', routeType: 'wheel', routeDepth: 18, routeWidth: 16, breakDelay: 0.35, isPrimary: false },\n      { positionId: 'wr2', routeType: 'curl', routeDepth: 12, routeWidth: 0, breakDelay: 0.65, isPrimary: false },\n      { positionId: 'wr3', routeType: 'slant', routeDepth: 8, routeWidth: -5, breakDelay: 0.2, isPrimary: false },\n      { positionId: 'te', routeType: 'drag', routeDepth: 6, routeWidth: 15, breakDelay: 0.3, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n  {\n    id: 'pb_corner_post',\n    name: 'Corner-Post',\n    category: 'deep',\n    formation: 'trips',\n    tempo: 'slow',\n    description: 'Corner route with a deep post to split the coverage',\n    difficulty: 3,\n    tags: ['deep', 'cover2_beater', 'aggressive'],\n    routes: [\n      { positionId: 'wr1', routeType: 'corner', routeDepth: 25, routeWidth: 15, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'wr2', routeType: 'post', routeDepth: 28, routeWidth: -10, breakDelay: 0.55, isPrimary: true },\n      { positionId: 'wr3', routeType: 'in', routeDepth: 12, routeWidth: -8, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'te', routeType: 'flat', routeDepth: 3, routeWidth: -10, breakDelay: 0.15, isPrimary: false },\n      { positionId: 'rb', routeType: 'checkdown', routeDepth: 4, routeWidth: 4, breakDelay: 0, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n\n  // --- RUN ---\n  {\n    id: 'pb_hb_dive',\n    name: 'HB Dive',\n    category: 'run',\n    formation: 'iform',\n    tempo: 'hurry',\n    description: 'Quick handoff up the middle',\n    difficulty: 1,\n    tags: ['run', 'short_yardage', 'safe'],\n    routes: [\n      { positionId: 'rb', routeType: 'streak', routeDepth: 5, routeWidth: 0, breakDelay: 0, isPrimary: true },\n      { positionId: 'wr1', routeType: 'block', routeDepth: 5, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'wr2', routeType: 'block', routeDepth: 5, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'wr3', routeType: 'block', routeDepth: 3, routeWidth: 5, breakDelay: 0, isPrimary: false },\n      { positionId: 'te', routeType: 'block', routeDepth: 3, routeWidth: -5, breakDelay: 0, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 2, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n  {\n    id: 'pb_stretch',\n    name: 'Outside Stretch',\n    category: 'run',\n    formation: 'singleback',\n    tempo: 'normal',\n    description: 'RB bounces it to the outside',\n    difficulty: 2,\n    tags: ['run', 'outside', 'rac'],\n    routes: [\n      { positionId: 'rb', routeType: 'flat', routeDepth: 2, routeWidth: 18, breakDelay: 0.1, isPrimary: true },\n      { positionId: 'wr1', routeType: 'block', routeDepth: 5, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'wr2', routeType: 'block', routeDepth: 5, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'wr3', routeType: 'block', routeDepth: 3, routeWidth: 10, breakDelay: 0, isPrimary: false },\n      { positionId: 'te', routeType: 'block', routeDepth: 3, routeWidth: 12, breakDelay: 0, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 2, routeWidth: 5, breakDelay: 0, isPrimary: false },\n    ],\n  },\n  {\n    id: 'pb_pa_deep',\n    name: 'Play Action Deep',\n    category: 'deep',\n    formation: 'iform',\n    tempo: 'slow',\n    description: 'Fake the run, hit the post',\n    difficulty: 3,\n    tags: ['play_action', 'deep', 'big_play'],\n    unlockRequirement: { type: 'touchdowns', value: 3 },\n    routes: [\n      { positionId: 'wr1', routeType: 'post', routeDepth: 30, routeWidth: -10, breakDelay: 0.6, isPrimary: true },\n      { positionId: 'wr2', routeType: 'corner', routeDepth: 25, routeWidth: 14, breakDelay: 0.55, isPrimary: false },\n      { positionId: 'wr3', routeType: 'drag', routeDepth: 8, routeWidth: -20, breakDelay: 0.3, isPrimary: false },\n      { positionId: 'te', routeType: 'streak', routeDepth: 18, routeWidth: -4, breakDelay: 0.1, isPrimary: false },\n      { positionId: 'rb', routeType: 'block', routeDepth: 1, routeWidth: 0, breakDelay: 0.8, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n];\n\n// ---------------------------------------------------------------------------\n// Defensive Schemes (10)\n// ---------------------------------------------------------------------------\n\nexport const PLAYBOOK_DEFENSE: EnhancedDefensivePlay[] = [\n  {\n    id: 'def_cover0',\n    name: 'Cover 0',\n    type: 'man',\n    description: 'Pure man, no deep safety. All-in.',\n    blitzers: ['dl1', 'dl2'],\n    coverageDepths: { dl1: 0, dl2: 0, lb: 0, cb1: 0, cb2: 0, ss: 0, fs: 0 },\n    strongAgainst: ['run', 'short'],\n    weakAgainst: ['deep'],\n    riskLevel: 3,\n  },\n  {\n    id: 'def_cover1',\n    name: 'Cover 1',\n    type: 'man',\n    description: 'Man coverage with a single high safety',\n    blitzers: ['dl1', 'dl2'],\n    coverageDepths: { dl1: 0, dl2: 0, lb: 5, cb1: 0, cb2: 0, ss: 0, fs: 25 },\n    strongAgainst: ['short', 'run'],\n    weakAgainst: ['deep'],\n    riskLevel: 2,\n  },\n  {\n    id: 'def_cover2',\n    name: 'Cover 2',\n    type: 'zone',\n    description: 'Two deep safeties, corners in flats',\n    blitzers: [],\n    coverageDepths: { dl1: 2, dl2: 2, lb: 8, cb1: 5, cb2: 5, ss: 20, fs: 20 },\n    strongAgainst: ['short', 'medium'],\n    weakAgainst: ['deep', 'run'],\n    riskLevel: 1,\n  },\n  {\n    id: 'def_cover3',\n    name: 'Cover 3',\n    type: 'zone',\n    description: 'Three deep zones, four underneath',\n    blitzers: [],\n    coverageDepths: { dl1: 2, dl2: 2, lb: 10, cb1: 20, cb2: 20, ss: 8, fs: 25 },\n    strongAgainst: ['deep', 'medium'],\n    weakAgainst: ['short', 'run'],\n    riskLevel: 1,\n  },\n  {\n    id: 'def_cover4',\n    name: 'Cover 4',\n    type: 'zone',\n    description: 'Four deep zones, prevent the big play',\n    blitzers: [],\n    coverageDepths: { dl1: 2, dl2: 2, lb: 12, cb1: 22, cb2: 22, ss: 22, fs: 28 },\n    strongAgainst: ['deep'],\n    weakAgainst: ['short', 'run'],\n    riskLevel: 1,\n  },\n  {\n    id: 'def_tampa2',\n    name: 'Tampa 2',\n    type: 'zone',\n    description: 'Cover 2 shell with the LB dropping deep middle',\n    blitzers: [],\n    coverageDepths: { dl1: 2, dl2: 2, lb: 18, cb1: 5, cb2: 5, ss: 20, fs: 20 },\n    strongAgainst: ['medium', 'deep'],\n    weakAgainst: ['run', 'short'],\n    riskLevel: 1,\n  },\n  {\n    id: 'def_zone_blitz',\n    name: 'Zone Blitz',\n    type: 'blitz',\n    description: 'Blitz from unexpected spots, drop a lineman into coverage',\n    blitzers: ['dl1', 'lb', 'ss'],\n    coverageDepths: { dl1: 0, dl2: 8, lb: 0, cb1: 12, cb2: 12, ss: 0, fs: 22 },\n    strongAgainst: ['medium', 'short'],\n    weakAgainst: ['deep'],\n    riskLevel: 2,\n  },\n  {\n    id: 'def_man_blitz',\n    name: 'Man Blitz',\n    type: 'blitz',\n    description: 'Man coverage with an extra rusher',\n    blitzers: ['dl1', 'dl2', 'lb', 'ss'],\n    coverageDepths: { dl1: 0, dl2: 0, lb: 0, cb1: 0, cb2: 0, ss: 0, fs: 18 },\n    strongAgainst: ['short', 'run'],\n    weakAgainst: ['deep'],\n    riskLevel: 3,\n  },\n  {\n    id: 'def_nickel',\n    name: 'Nickel',\n    type: 'zone',\n    description: 'Extra DB for passing downs, balanced coverage',\n    blitzers: [],\n    coverageDepths: { dl1: 2, dl2: 2, lb: 7, cb1: 10, cb2: 10, ss: 15, fs: 22 },\n    strongAgainst: ['medium', 'short'],\n    weakAgainst: ['run'],\n    riskLevel: 1,\n  },\n  {\n    id: 'def_dime',\n    name: 'Dime',\n    type: 'zone',\n    description: 'Maximum pass coverage for obvious passing downs',\n    blitzers: [],\n    coverageDepths: { dl1: 2, dl2: 2, lb: 12, cb1: 14, cb2: 14, ss: 18, fs: 25 },\n    strongAgainst: ['deep', 'medium'],\n    weakAgainst: ['run', 'short'],\n    riskLevel: 1,\n  },\n];\n\n// ---------------------------------------------------------------------------\n// Visual Formation Picker Data\n// ---------------------------------------------------------------------------\n\nexport interface FormationPickerEntry {\n  formation: FormationType;\n  label: string;\n  playCount: number;\n  categories: Array<OffensivePlay['category']>;\n  avgDifficulty: number;\n  preview: Vector3[];\n}\n\nfunction buildPickerEntries(): FormationPickerEntry[] {\n  const types: FormationType[] = ['shotgun', 'iform', 'trips', 'spread', 'singleback'];\n  return types.map((ft) => {\n    const plays = PLAYBOOK_OFFENSE.filter((p) => p.formation === ft);\n    const cats = [...new Set(plays.map((p) => p.category))];\n    const avg = plays.length > 0\n      ? plays.reduce((s, p) => s + p.difficulty, 0) / plays.length\n      : 0;\n    return {\n      formation: ft,\n      label: FORMATIONS[ft].name,\n      playCount: plays.length,\n      categories: cats,\n      avgDifficulty: Math.round(avg * 10) / 10,\n      preview: FORMATIONS[ft].preview,\n    };\n  });\n}\n\nexport const FORMATION_PICKER: FormationPickerEntry[] = buildPickerEntries();\n\n// ---------------------------------------------------------------------------\n// Game Situation (input to AI)\n// ---------------------------------------------------------------------------\n\nexport interface GameSituation {\n  down: number;           // 1-4\n  yardsToGo: number;\n  yardLine: number;       // 0-100, distance to opponent end zone\n  scoreDiff: number;      // positive = winning\n  timeRemaining: number;  // seconds\n  quarter: number;        // 1-4\n}\n\n// ---------------------------------------------------------------------------\n// PlaybookSystem Class\n// ---------------------------------------------------------------------------\n\nexport class PlaybookSystem {\n  private offensivePlays: EnhancedOffensivePlay[];\n  private defensivePlays: EnhancedDefensivePlay[];\n\n  constructor(\n    offensivePlays: EnhancedOffensivePlay[] = PLAYBOOK_OFFENSE,\n    defensivePlays: EnhancedDefensivePlay[] = PLAYBOOK_DEFENSE,\n  ) {\n    this.offensivePlays = offensivePlays;\n    this.defensivePlays = defensivePlays;\n  }\n\n  /** Get a formation definition by type */\n  getFormation(type: FormationType): Formation {\n    return FORMATIONS[type];\n  }\n\n  /** Get all offensive plays that use a given formation */\n  getPlaysForFormation(type: FormationType): EnhancedOffensivePlay[] {\n    return this.offensivePlays.filter((p) => p.formation === type);\n  }\n\n  /**\n   * AI defensive play selection based on game situation.\n   * Considers down, distance, field position, score differential, and time.\n   */\n  selectDefensivePlay(situation: GameSituation): EnhancedDefensivePlay {\n    const scores = this.defensivePlays.map((play) => ({\n      play,\n      score: this.scoreDefensivePlay(play, situation),\n    }));\n\n    scores.sort((a, b) => b.score - a.score);\n\n    // Top-2 weighted random to avoid being perfectly predictable\n    const top = scores.slice(0, 2);\n    const totalWeight = top.reduce((s, t) => s + t.score, 0);\n    if (totalWeight <= 0) return scores[0].play;\n\n    const roll = Math.random() * totalWeight;\n    let acc = 0;\n    for (const entry of top) {\n      acc += entry.score;\n      if (roll <= acc) return entry.play;\n    }\n    return scores[0].play;\n  }\n\n  /**\n   * Recommend offensive plays for the current situation.\n   * Returns up to `limit` plays sorted by relevance score descending.\n   */\n  getPlayRecommendations(situation: GameSituation, limit = 4): EnhancedOffensivePlay[] {\n    const scored = this.offensivePlays.map((play) => ({\n      play,\n      score: this.scoreOffensivePlay(play, situation),\n    }));\n    scored.sort((a, b) => b.score - a.score);\n    return scored.slice(0, limit).map((s) => s.play);\n  }\n\n  // --- Private scoring helpers ---\n\n  private scoreDefensivePlay(play: EnhancedDefensivePlay, sit: GameSituation): number {\n    let score = 10;\n\n    // Predict likely offensive category from situation\n    const likelyCategory = this.predictOffensiveCategory(sit);\n\n    if (play.strongAgainst.includes(likelyCategory)) score += 8;\n    if (play.weakAgainst.includes(likelyCategory)) score -= 6;\n\n    // Short yardage: favor blitzes and man\n    if (sit.yardsToGo <= 3) {\n      if (play.type === 'blitz') score += 5;\n      if (play.type === 'man') score += 3;\n    }\n\n    // Long yardage: favor deep zones\n    if (sit.yardsToGo >= 15) {\n      if (play.id === 'def_cover4' || play.id === 'def_cover3') score += 5;\n      if (play.type === 'blitz') score -= 3;\n    }\n\n    // 4th down: aggressive\n    if (sit.down === 4) {\n      if (play.type === 'blitz') score += 4;\n    }\n\n    // Losing late: take risks\n    if (sit.scoreDiff < 0 && sit.timeRemaining < 120) {\n      score += play.riskLevel * 2;\n    }\n\n    // Winning late: play safe prevent\n    if (sit.scoreDiff > 0 && sit.timeRemaining < 120) {\n      if (play.id === 'def_cover4') score += 6;\n      if (play.type === 'blitz') score -= 4;\n    }\n\n    // Red zone offense (opponent close to scoring): tighten coverage\n    if (sit.yardLine <= 20) {\n      if (play.type === 'zone') score += 2;\n    }\n\n    return Math.max(score, 0);\n  }\n\n  private scoreOffensivePlay(play: EnhancedOffensivePlay, sit: GameSituation): number {\n    let score = 10;\n\n    // Category fit for situation\n    const needed = this.predictOffensiveCategory(sit);\n    if (play.category === needed) score += 10;\n\n    // Short yardage: prefer safe/short/run\n    if (sit.yardsToGo <= 3) {\n      if (play.category === 'short' || play.category === 'run') score += 5;\n      if (play.tags.includes('safe')) score += 3;\n    }\n\n    // Long yardage: deep or medium\n    if (sit.yardsToGo >= 15) {\n      if (play.category === 'deep') score += 6;\n      if (play.category === 'medium') score += 3;\n      if (play.category === 'run') score -= 4;\n    }\n\n    // 4th down short: safe plays\n    if (sit.down === 4 && sit.yardsToGo <= 3) {\n      if (play.tags.includes('safe')) score += 5;\n      if (play.difficulty === 1) score += 3;\n    }\n\n    // Losing late: aggressive\n    if (sit.scoreDiff < -7 && sit.timeRemaining < 180) {\n      if (play.category === 'deep') score += 6;\n      if (play.tempo === 'hurry') score += 3;\n    }\n\n    // Winning late: run clock\n    if (sit.scoreDiff > 7 && sit.timeRemaining < 180) {\n      if (play.category === 'run') score += 8;\n      if (play.tempo === 'slow') score += 3;\n    }\n\n    // Red zone: short passes and runs\n    if (sit.yardLine <= 10) {\n      if (play.category === 'short' || play.category === 'run') score += 4;\n      if (play.category === 'deep') score -= 4;\n    }\n\n    // Penalize high difficulty on early downs\n    if (sit.down <= 2 && play.difficulty === 3) score -= 2;\n\n    return Math.max(score, 0);\n  }\n\n  private predictOffensiveCategory(sit: GameSituation): OffensivePlay['category'] {\n    // Short yardage situations\n    if (sit.yardsToGo <= 3) return 'run';\n\n    // Long yardage\n    if (sit.yardsToGo >= 15) return 'deep';\n\n    // Medium yardage\n    if (sit.yardsToGo >= 7) return 'medium';\n\n    // Default to short for manageable distances\n    return 'short';\n  }\n}\n","/**\n * Blaze Blitz Football - Original Team Definitions\n *\n * 100% Original IP - No NFL content\n * Generic team names without city affiliations\n */\n\n/** Team interface */\nexport interface BlitzTeam {\n  id: string;\n  name: string;\n  shortName: string;\n  mascot: string;\n  description: string;\n\n  // Visual properties\n  primaryColor: string;\n  secondaryColor: string;\n  accentColor: string;\n  helmetColor: string;\n\n  // Team stats (affect AI behavior when playing against)\n  offense: number;  // 1-10: Affects QB accuracy, WR speed\n  defense: number;  // 1-10: Affects DB coverage, pass rush\n  speed: number;    // 1-10: Overall team speed\n  power: number;    // 1-10: Tackle strength, blocking\n\n  // Special ability\n  specialAbility: {\n    name: string;\n    description: string;\n    effect: string;\n  };\n}\n\n/** Home team - Blaze Firebirds (player's team) */\nexport const FIREBIRDS: BlitzTeam = {\n  id: 'team_firebirds',\n  name: 'Blaze Firebirds',\n  shortName: 'FIRE',\n  mascot: 'Phoenix',\n  description: 'Rising from the flames with explosive offense and fiery determination.',\n\n  primaryColor: '#BF5700',    // Burnt orange\n  secondaryColor: '#FF6B35',  // Ember\n  accentColor: '#C9A227',     // Gold\n  helmetColor: '#BF5700',\n\n  offense: 8,\n  defense: 6,\n  speed: 8,\n  power: 7,\n\n  specialAbility: {\n    name: 'Phoenix Rising',\n    description: 'Turbo regenerates 50% faster when behind',\n    effect: 'turbo_regen',\n  },\n};\n\n/** Away team - Shadow Wolves (AI opponent) */\nexport const SHADOW_WOLVES: BlitzTeam = {\n  id: 'team_wolves',\n  name: 'Shadow Wolves',\n  shortName: 'WOLF',\n  mascot: 'Wolf',\n  description: 'A relentless pack that hunts quarterbacks and terrorizes offenses.',\n\n  primaryColor: '#1A1A1A',    // Midnight\n  secondaryColor: '#4169E1',  // Royal blue\n  accentColor: '#C0C0C0',     // Silver\n  helmetColor: '#1A1A1A',\n\n  offense: 6,\n  defense: 9,\n  speed: 7,\n  power: 8,\n\n  specialAbility: {\n    name: 'Pack Hunter',\n    description: 'Defenders converge 25% faster on ball carrier',\n    effect: 'pack_hunt',\n  },\n};\n\n/** Additional unlockable teams */\nexport const UNLOCKABLE_TEAMS: BlitzTeam[] = [\n  {\n    id: 'team_thunder',\n    name: 'Storm Thunder',\n    shortName: 'THDR',\n    mascot: 'Lightning Bolt',\n    description: 'Electrifying speed that strikes before you can react.',\n\n    primaryColor: '#FFD700',    // Gold/Yellow\n    secondaryColor: '#000080',  // Navy\n    accentColor: '#FFFFFF',     // White\n    helmetColor: '#FFD700',\n\n    offense: 9,\n    defense: 5,\n    speed: 10,\n    power: 5,\n\n    specialAbility: {\n      name: 'Lightning Strike',\n      description: 'Big plays (20+ yards) give 2x bonus points',\n      effect: 'big_play_bonus',\n    },\n  },\n  {\n    id: 'team_ironclad',\n    name: 'Iron Titans',\n    shortName: 'IRON',\n    mascot: 'Titan',\n    description: 'An unstoppable ground game built on raw power.',\n\n    primaryColor: '#4A4A4A',    // Iron gray\n    secondaryColor: '#8B0000',  // Dark red\n    accentColor: '#C0C0C0',     // Silver\n    helmetColor: '#4A4A4A',\n\n    offense: 7,\n    defense: 7,\n    speed: 5,\n    power: 10,\n\n    specialAbility: {\n      name: 'Iron Will',\n      description: 'Cannot be tackled for loss on first contact',\n      effect: 'no_tfl',\n    },\n  },\n  {\n    id: 'team_vipers',\n    name: 'Venom Vipers',\n    shortName: 'VIPE',\n    mascot: 'Viper',\n    description: 'Quick-strike offense that leaves opponents paralyzed.',\n\n    primaryColor: '#228B22',    // Forest green\n    secondaryColor: '#000000',  // Black\n    accentColor: '#FFD700',     // Gold fangs\n    helmetColor: '#228B22',\n\n    offense: 8,\n    defense: 8,\n    speed: 9,\n    power: 6,\n\n    specialAbility: {\n      name: 'Venom Strike',\n      description: 'Stiff-arms have 100% success rate',\n      effect: 'super_stiff_arm',\n    },\n  },\n];\n\n/** Get all teams */\nexport function getAllTeams(): BlitzTeam[] {\n  return [FIREBIRDS, SHADOW_WOLVES, ...UNLOCKABLE_TEAMS];\n}\n\n/** Get team by ID */\nexport function getTeamById(id: string): BlitzTeam | undefined {\n  return getAllTeams().find((team) => team.id === id);\n}\n\n/** Get player selectable teams (home teams) */\nexport function getPlayableTeams(): BlitzTeam[] {\n  return [FIREBIRDS, ...UNLOCKABLE_TEAMS];\n}\n\n/** Get AI opponent teams */\nexport function getOpponentTeams(): BlitzTeam[] {\n  return [SHADOW_WOLVES, ...UNLOCKABLE_TEAMS];\n}\n\n/** Player position definitions for 7-on-7 */\nexport interface PlayerPosition {\n  id: string;\n  name: string;\n  shortName: string;\n  role: 'offense' | 'defense';\n  defaultX: number;  // Relative to ball/line of scrimmage\n  defaultZ: number;  // Relative to center of field\n}\n\n/** Offensive positions (7 players) */\nexport const OFFENSIVE_POSITIONS: PlayerPosition[] = [\n  { id: 'qb', name: 'Quarterback', shortName: 'QB', role: 'offense', defaultX: -5, defaultZ: 0 },\n  { id: 'rb', name: 'Running Back', shortName: 'RB', role: 'offense', defaultX: -7, defaultZ: 0 },\n  { id: 'wr1', name: 'Wide Receiver 1', shortName: 'WR', role: 'offense', defaultX: 0, defaultZ: 20 },\n  { id: 'wr2', name: 'Wide Receiver 2', shortName: 'WR', role: 'offense', defaultX: 0, defaultZ: -20 },\n  { id: 'wr3', name: 'Slot Receiver', shortName: 'SL', role: 'offense', defaultX: -1, defaultZ: 8 },\n  { id: 'te', name: 'Tight End', shortName: 'TE', role: 'offense', defaultX: -1, defaultZ: -8 },\n  { id: 'c', name: 'Center', shortName: 'C', role: 'offense', defaultX: 0, defaultZ: 0 },\n];\n\n/** Defensive positions (7 players) */\nexport const DEFENSIVE_POSITIONS: PlayerPosition[] = [\n  { id: 'dl1', name: 'Defensive Line 1', shortName: 'DL', role: 'defense', defaultX: 1, defaultZ: -3 },\n  { id: 'dl2', name: 'Defensive Line 2', shortName: 'DL', role: 'defense', defaultX: 1, defaultZ: 3 },\n  { id: 'lb', name: 'Linebacker', shortName: 'LB', role: 'defense', defaultX: 4, defaultZ: 0 },\n  { id: 'cb1', name: 'Cornerback 1', shortName: 'CB', role: 'defense', defaultX: 2, defaultZ: 18 },\n  { id: 'cb2', name: 'Cornerback 2', shortName: 'CB', role: 'defense', defaultX: 2, defaultZ: -18 },\n  { id: 'ss', name: 'Strong Safety', shortName: 'SS', role: 'defense', defaultX: 8, defaultZ: 6 },\n  { id: 'fs', name: 'Free Safety', shortName: 'FS', role: 'defense', defaultX: 12, defaultZ: 0 },\n];\n","/**\n * Blaze Blitz Football - Play Definitions\n *\n * Offensive and defensive formations/routes for 7-on-7\n * Simplified for arcade gameplay\n */\n\nimport type { PlayerPosition } from './teams';\n\n/** Route type for receivers */\nexport type RouteType =\n  | 'streak'      // Straight deep\n  | 'slant'       // Quick diagonal inside\n  | 'out'         // Run then cut outside\n  | 'in'          // Run then cut inside (dig)\n  | 'corner'      // Run deep then cut to corner\n  | 'post'        // Run deep then cut to middle\n  | 'curl'        // Run then turn back toward QB\n  | 'flat'        // Quick out to flat\n  | 'drag'        // Shallow cross\n  | 'wheel'       // RB/TE out then up\n  | 'block'       // Stay and block\n  | 'checkdown';  // Short safety valve\n\n/** Individual player route in a play */\nexport interface PlayerRoute {\n  positionId: string;\n  routeType: RouteType;\n  routeDepth: number;     // How far downfield (yards)\n  routeWidth: number;     // How far to side (yards, positive = right)\n  breakDelay: number;     // Time before route break (0-1, percentage of route)\n  isPrimary: boolean;     // Is this the main target\n}\n\n/** Offensive play definition */\nexport interface OffensivePlay {\n  id: string;\n  name: string;\n  category: 'short' | 'medium' | 'deep' | 'run';\n  description: string;\n  routes: PlayerRoute[];\n  difficulty: 1 | 2 | 3;  // 1 = easy, 3 = hard to execute\n  unlockRequirement?: {\n    type: 'games' | 'touchdowns' | 'yards' | 'score';\n    value: number;\n  };\n}\n\n/** Defensive play/coverage */\nexport interface DefensivePlay {\n  id: string;\n  name: string;\n  type: 'man' | 'zone' | 'blitz';\n  description: string;\n  blitzers: string[];           // Position IDs that will rush\n  coverageDepths: Record<string, number>; // Position ID to coverage depth\n}\n\n/** Default offensive plays */\nexport const OFFENSIVE_PLAYS: OffensivePlay[] = [\n  // SHORT PASSES (Quick game)\n  {\n    id: 'play_slants',\n    name: 'Quick Slants',\n    category: 'short',\n    description: 'Fast-breaking slant routes for quick gains',\n    difficulty: 1,\n    routes: [\n      { positionId: 'wr1', routeType: 'slant', routeDepth: 8, routeWidth: -5, breakDelay: 0.2, isPrimary: true },\n      { positionId: 'wr2', routeType: 'slant', routeDepth: 8, routeWidth: 5, breakDelay: 0.2, isPrimary: false },\n      { positionId: 'wr3', routeType: 'flat', routeDepth: 2, routeWidth: 10, breakDelay: 0.1, isPrimary: false },\n      { positionId: 'te', routeType: 'drag', routeDepth: 5, routeWidth: 12, breakDelay: 0.3, isPrimary: false },\n      { positionId: 'rb', routeType: 'checkdown', routeDepth: 3, routeWidth: -5, breakDelay: 0, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n  {\n    id: 'play_screen',\n    name: 'Screen Pass',\n    category: 'short',\n    description: 'Dump it to the RB and let blockers lead the way',\n    difficulty: 2,\n    routes: [\n      { positionId: 'rb', routeType: 'flat', routeDepth: -2, routeWidth: 12, breakDelay: 0.4, isPrimary: true },\n      { positionId: 'wr1', routeType: 'streak', routeDepth: 20, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'wr2', routeType: 'streak', routeDepth: 20, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'wr3', routeType: 'block', routeDepth: 5, routeWidth: 8, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'te', routeType: 'block', routeDepth: 5, routeWidth: 5, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 3, routeWidth: 10, breakDelay: 0.3, isPrimary: false },\n    ],\n  },\n\n  // MEDIUM PASSES (Timing routes)\n  {\n    id: 'play_curls',\n    name: 'Curl Routes',\n    category: 'medium',\n    description: 'Receivers run and turn back for the ball',\n    difficulty: 1,\n    routes: [\n      { positionId: 'wr1', routeType: 'curl', routeDepth: 12, routeWidth: 0, breakDelay: 0.7, isPrimary: true },\n      { positionId: 'wr2', routeType: 'curl', routeDepth: 12, routeWidth: 0, breakDelay: 0.7, isPrimary: false },\n      { positionId: 'wr3', routeType: 'out', routeDepth: 8, routeWidth: 8, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'te', routeType: 'in', routeDepth: 10, routeWidth: -10, breakDelay: 0.6, isPrimary: false },\n      { positionId: 'rb', routeType: 'checkdown', routeDepth: 5, routeWidth: 5, breakDelay: 0, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n  {\n    id: 'play_cross',\n    name: 'Crossers',\n    category: 'medium',\n    description: 'Crossing routes to create traffic for defenders',\n    difficulty: 2,\n    routes: [\n      { positionId: 'wr1', routeType: 'drag', routeDepth: 8, routeWidth: -25, breakDelay: 0.3, isPrimary: true },\n      { positionId: 'wr2', routeType: 'drag', routeDepth: 6, routeWidth: 25, breakDelay: 0.2, isPrimary: false },\n      { positionId: 'wr3', routeType: 'post', routeDepth: 15, routeWidth: -8, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'te', routeType: 'corner', routeDepth: 12, routeWidth: 12, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'rb', routeType: 'wheel', routeDepth: 10, routeWidth: 15, breakDelay: 0.4, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n\n  // DEEP PASSES (Big play potential)\n  {\n    id: 'play_four_verts',\n    name: 'Four Verticals',\n    category: 'deep',\n    description: 'Stretch the defense deep with four go routes',\n    difficulty: 3,\n    routes: [\n      { positionId: 'wr1', routeType: 'streak', routeDepth: 30, routeWidth: 0, breakDelay: 0, isPrimary: true },\n      { positionId: 'wr2', routeType: 'streak', routeDepth: 30, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'wr3', routeType: 'streak', routeDepth: 25, routeWidth: 5, breakDelay: 0, isPrimary: false },\n      { positionId: 'te', routeType: 'streak', routeDepth: 20, routeWidth: -5, breakDelay: 0, isPrimary: false },\n      { positionId: 'rb', routeType: 'checkdown', routeDepth: 5, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n  },\n  {\n    id: 'play_bomb',\n    name: 'Hail Mary',\n    category: 'deep',\n    description: 'All receivers go deep - throw it up and pray',\n    difficulty: 3,\n    routes: [\n      { positionId: 'wr1', routeType: 'post', routeDepth: 35, routeWidth: -10, breakDelay: 0.6, isPrimary: true },\n      { positionId: 'wr2', routeType: 'corner', routeDepth: 30, routeWidth: 15, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'wr3', routeType: 'streak', routeDepth: 35, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'te', routeType: 'post', routeDepth: 25, routeWidth: -5, breakDelay: 0.4, isPrimary: false },\n      { positionId: 'rb', routeType: 'streak', routeDepth: 20, routeWidth: 8, breakDelay: 0.3, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n    unlockRequirement: { type: 'touchdowns', value: 5 },\n  },\n\n  // SPECIAL PLAYS (Unlockable)\n  {\n    id: 'play_trick',\n    name: 'Flea Flicker',\n    category: 'deep',\n    description: 'Hand off then get the ball back - big play potential',\n    difficulty: 3,\n    routes: [\n      { positionId: 'wr1', routeType: 'streak', routeDepth: 35, routeWidth: 0, breakDelay: 0, isPrimary: true },\n      { positionId: 'wr2', routeType: 'post', routeDepth: 30, routeWidth: -12, breakDelay: 0.6, isPrimary: false },\n      { positionId: 'wr3', routeType: 'corner', routeDepth: 25, routeWidth: 15, breakDelay: 0.5, isPrimary: false },\n      { positionId: 'te', routeType: 'streak', routeDepth: 20, routeWidth: 0, breakDelay: 0, isPrimary: false },\n      { positionId: 'rb', routeType: 'block', routeDepth: 2, routeWidth: 0, breakDelay: 0.8, isPrimary: false },\n      { positionId: 'c', routeType: 'block', routeDepth: 0, routeWidth: 0, breakDelay: 0, isPrimary: false },\n    ],\n    unlockRequirement: { type: 'score', value: 2000 },\n  },\n];\n\n/** Default defensive plays */\nexport const DEFENSIVE_PLAYS: DefensivePlay[] = [\n  {\n    id: 'def_cover2',\n    name: 'Cover 2',\n    type: 'zone',\n    description: 'Two deep safeties, corners in flats',\n    blitzers: [],\n    coverageDepths: {\n      dl1: 2,\n      dl2: 2,\n      lb: 8,\n      cb1: 5,\n      cb2: 5,\n      ss: 20,\n      fs: 20,\n    },\n  },\n  {\n    id: 'def_cover3',\n    name: 'Cover 3',\n    type: 'zone',\n    description: 'Three deep, four underneath',\n    blitzers: [],\n    coverageDepths: {\n      dl1: 2,\n      dl2: 2,\n      lb: 10,\n      cb1: 20,\n      cb2: 20,\n      ss: 8,\n      fs: 25,\n    },\n  },\n  {\n    id: 'def_man',\n    name: 'Man Coverage',\n    type: 'man',\n    description: 'Each defender covers a receiver',\n    blitzers: [],\n    coverageDepths: {\n      dl1: 2,\n      dl2: 2,\n      lb: 5,\n      cb1: 0,  // Man coverage - follows WR\n      cb2: 0,\n      ss: 0,\n      fs: 15,\n    },\n  },\n  {\n    id: 'def_blitz',\n    name: 'All-Out Blitz',\n    type: 'blitz',\n    description: 'Bring the heat - 5 rushers',\n    blitzers: ['dl1', 'dl2', 'lb', 'ss', 'cb2'],\n    coverageDepths: {\n      dl1: 0,  // Rush\n      dl2: 0,\n      lb: 0,\n      cb1: 0,  // Man\n      cb2: 0,\n      ss: 0,\n      fs: 20,\n    },\n  },\n];\n\n/** Get all offensive plays */\nexport function getAllOffensivePlays(): OffensivePlay[] {\n  return OFFENSIVE_PLAYS;\n}\n\n/** Get plays by category */\nexport function getPlaysByCategory(category: OffensivePlay['category']): OffensivePlay[] {\n  return OFFENSIVE_PLAYS.filter((play) => play.category === category);\n}\n\n/** Get unlocked plays based on player stats */\nexport function getUnlockedPlays(playerStats: {\n  gamesPlayed: number;\n  totalTouchdowns: number;\n  totalYards: number;\n  highScore: number;\n}): OffensivePlay[] {\n  return OFFENSIVE_PLAYS.filter((play) => {\n    if (!play.unlockRequirement) return true;\n\n    const { type, value } = play.unlockRequirement;\n    switch (type) {\n      case 'games':\n        return playerStats.gamesPlayed >= value;\n      case 'touchdowns':\n        return playerStats.totalTouchdowns >= value;\n      case 'yards':\n        return playerStats.totalYards >= value;\n      case 'score':\n        return playerStats.highScore >= value;\n      default:\n        return true;\n    }\n  });\n}\n\n/** Get a random defensive play (for AI) */\nexport function getRandomDefensivePlay(): DefensivePlay {\n  const index = Math.floor(Math.random() * DEFENSIVE_PLAYS.length);\n  return DEFENSIVE_PLAYS[index];\n}\n\n/** Get defensive play based on down and distance (smarter AI) */\nexport function getSmartDefensivePlay(down: number, yardsToGo: number): DefensivePlay {\n  // Short yardage - expect run or short pass\n  if (yardsToGo <= 3) {\n    return DEFENSIVE_PLAYS.find((p) => p.id === 'def_blitz') || DEFENSIVE_PLAYS[0];\n  }\n\n  // Long yardage - expect deep pass\n  if (yardsToGo >= 15) {\n    return DEFENSIVE_PLAYS.find((p) => p.id === 'def_cover3') || DEFENSIVE_PLAYS[0];\n  }\n\n  // 4th down - blitz\n  if (down === 4) {\n    return DEFENSIVE_PLAYS.find((p) => p.id === 'def_blitz') || DEFENSIVE_PLAYS[0];\n  }\n\n  // Default - mix it up\n  return getRandomDefensivePlay();\n}\n","/**\n * GhostRenderer3D  Babylon.js ghost mesh rendering for Blaze Blitz.\n *\n * Renders predicted receiver positions as transparent capsules\n * and predicted routes as dashed trajectory lines.\n */\n\nimport {\n  Scene,\n  Vector3,\n  MeshBuilder,\n  StandardMaterial,\n  Color3,\n  Color4,\n  Mesh,\n  GlowLayer,\n  LinesBuilder,\n} from '@babylonjs/core';\n\nconst MAX_GHOST_MESHES = 16;\nconst MAX_TRAIL_LINES = 8;\n\nconst GHOST_COLORS: Record<number, string> = {\n  1: '#39FF14', // WR1 - neon green\n  2: '#FF6EC7', // WR2 - hot pink\n  3: '#00BFFF', // WR3 - deep sky blue\n  4: '#FFD700', // TE - gold\n  5: '#FF6B35', // RB - ember\n};\n\nexport class GhostRenderer3D {\n  private scene: Scene;\n  private glowLayer: GlowLayer | null;\n  private ghostPool: Mesh[] = [];\n  private trailPool: Mesh[] = [];\n  private activeGhosts: number = 0;\n  private activeTrails: number = 0;\n\n  constructor(scene: Scene, glowLayer: GlowLayer | null = null) {\n    this.scene = scene;\n    this.glowLayer = glowLayer;\n    this._initPool();\n  }\n\n  private _initPool(): void {\n    for (let i = 0; i < MAX_GHOST_MESHES; i++) {\n      const mesh = MeshBuilder.CreateCapsule(\n        `ghost_receiver_${i}`,\n        { radius: 0.4, height: 1.8 },\n        this.scene\n      );\n      mesh.isVisible = false;\n\n      const mat = new StandardMaterial(`ghostMat_${i}`, this.scene);\n      mat.alpha = 0;\n      mat.disableLighting = true;\n      mesh.material = mat;\n\n      if (this.glowLayer) {\n        this.glowLayer.addIncludedOnlyMesh(mesh);\n      }\n\n      this.ghostPool.push(mesh);\n    }\n  }\n\n  /**\n   * Place a ghost receiver at a predicted position.\n   */\n  placeGhost(\n    position: Vector3,\n    probability: number,\n    playerType: number = 1\n  ): void {\n    if (this.activeGhosts >= MAX_GHOST_MESHES) return;\n\n    const mesh = this.ghostPool[this.activeGhosts];\n    mesh.position = position.clone();\n    mesh.position.y = 1;\n    mesh.isVisible = true;\n\n    const mat = mesh.material as StandardMaterial;\n    const colorHex = GHOST_COLORS[playerType] ?? '#39FF14';\n    mat.diffuseColor = Color3.FromHexString(colorHex);\n    mat.emissiveColor = Color3.FromHexString(colorHex).scale(0.4);\n    mat.alpha = Math.min(0.5, probability * 0.6);\n\n    this.activeGhosts++;\n  }\n\n  /**\n   * Render a predicted route as a dashed line from current to predicted position.\n   */\n  renderRoutePrediction(\n    fromPos: Vector3,\n    toPos: Vector3,\n    probability: number,\n    playerType: number = 1\n  ): void {\n    if (this.activeTrails >= MAX_TRAIL_LINES) return;\n\n    // Build dashed-line points\n    const steps = 12;\n    const points: Vector3[] = [];\n    for (let i = 0; i <= steps; i++) {\n      const t = i / steps;\n      // Slight arc upward\n      const arcHeight = Math.sin(t * Math.PI) * 1.5;\n      const pos = Vector3.Lerp(fromPos, toPos, t);\n      pos.y = 1 + arcHeight;\n      // Only add every other segment for dash effect\n      if (i % 2 === 0 || i === steps) {\n        points.push(pos);\n      }\n    }\n\n    if (points.length < 2) return;\n\n    const colorHex = GHOST_COLORS[playerType] ?? '#39FF14';\n    const color = Color3.FromHexString(colorHex);\n    const alpha = Math.min(0.6, probability * 0.7);\n\n    const colors = points.map(() => new Color4(color.r, color.g, color.b, alpha));\n\n    const line = MeshBuilder.CreateLines(\n      `ghostRoute_${this.activeTrails}`,\n      { points, colors, updatable: false },\n      this.scene\n    );\n\n    this.trailPool.push(line);\n    this.activeTrails++;\n  }\n\n  /**\n   * Clear all ghost meshes and trails. Call at start of each frame.\n   */\n  clear(): void {\n    for (let i = 0; i < this.activeGhosts; i++) {\n      this.ghostPool[i].isVisible = false;\n    }\n    this.activeGhosts = 0;\n\n    for (const trail of this.trailPool) {\n      trail.dispose();\n    }\n    this.trailPool = [];\n    this.activeTrails = 0;\n  }\n\n  dispose(): void {\n    this.clear();\n    for (const mesh of this.ghostPool) {\n      mesh.dispose();\n    }\n    this.ghostPool = [];\n  }\n}\n","/**\n * Football Adapter  maps Blaze Blitz entities to 12-bit tokens.\n *\n * Token layout (12 bits):\n *   bits 0-2: PlayerType (QB/WR1/WR2/WR3/TE/RB/DEFENDER/BALL)\n *   bits 3-5: PlayAction (huddle/set/snap/throw/run-route/catch/tackle/score)\n *   bits 6-7: Stamina (0-3, bucketed from 0-100%)\n *   bits 8-11: FieldRegion (16 zones: 8 yard segments x 2 lateral halves)\n */\n\nimport { Vector3 } from '@babylonjs/core';\n\n//  Enums \n\nexport enum PlayerType {\n  QB = 0,\n  WR1 = 1,\n  WR2 = 2,\n  WR3 = 3,\n  TE = 4,\n  RB = 5,\n  DEFENDER = 6,\n  BALL = 7,\n}\n\nexport enum PlayAction {\n  HUDDLE = 0,\n  SET = 1,\n  SNAP = 2,\n  THROW = 3,\n  RUN_ROUTE = 4,\n  CATCH = 5,\n  TACKLE = 6,\n  SCORE = 7,\n}\n\nexport enum Stamina {\n  FRESH = 3,\n  GOOD = 2,\n  TIRED = 1,\n  GASSED = 0,\n}\n\n//  Token encode/decode \n\nexport function encode(\n  type: PlayerType,\n  action: PlayAction,\n  stamina: number,\n  region: number\n): number {\n  return (type & 0x7) | ((action & 0x7) << 3) | ((stamina & 0x3) << 6) | ((region & 0xF) << 8);\n}\n\nexport function decode(token: number): {\n  type: PlayerType;\n  action: PlayAction;\n  stamina: number;\n  region: number;\n} {\n  return {\n    type: token & 0x7,\n    action: (token >> 3) & 0x7,\n    stamina: (token >> 6) & 0x3,\n    region: (token >> 8) & 0xF,\n  };\n}\n\n//  Field zone mapping \n// 100-yard field split into 8 yard-line segments (12.5 yards each),\n// each split laterally into left/right = 16 zones total.\n\nconst FIELD_LENGTH = 100; // yards\nconst FIELD_WIDTH = 53.3; // yards (standard)\n\nexport function positionToFieldZone(pos: Vector3, fieldLength: number = FIELD_LENGTH): number {\n  // Z axis = downfield (0 = own endzone, fieldLength = opponent endzone)\n  // X axis = lateral (-half width to +half width)\n  const yardLine = Math.max(0, Math.min(fieldLength, pos.z));\n  const segment = Math.min(7, Math.floor((yardLine / fieldLength) * 8));\n  const lateral = pos.x >= 0 ? 1 : 0; // 0 = left, 1 = right\n  return segment * 2 + lateral;\n}\n\nexport function regionToFieldPosition(\n  region: number,\n  fieldLength: number = FIELD_LENGTH\n): Vector3 {\n  const segment = Math.floor(region / 2);\n  const lateral = region % 2;\n  const z = ((segment + 0.5) / 8) * fieldLength;\n  const x = lateral === 1 ? 8 : -8;\n  return new Vector3(x, 1, z);\n}\n\n//  Entity-to-token helpers \n\nexport interface FootballEntity {\n  id: string;\n  type: PlayerType;\n  position: Vector3;\n  action: PlayAction;\n  stamina?: number; // 0-100\n}\n\nfunction bucketStamina(raw: number): number {\n  if (raw >= 75) return Stamina.FRESH;\n  if (raw >= 50) return Stamina.GOOD;\n  if (raw >= 25) return Stamina.TIRED;\n  return Stamina.GASSED;\n}\n\nexport function entityToToken(entity: FootballEntity, fieldLength?: number): number {\n  const region = positionToFieldZone(entity.position, fieldLength);\n  const stamina = bucketStamina(entity.stamina ?? 100);\n  return encode(entity.type, entity.action, stamina, region);\n}\n\n// Map Blitz position IDs to PlayerType\nconst POSITION_MAP: Record<string, PlayerType> = {\n  qb: PlayerType.QB,\n  wr1: PlayerType.WR1,\n  wr2: PlayerType.WR2,\n  wr3: PlayerType.WR3,\n  te: PlayerType.TE,\n  rb: PlayerType.RB,\n};\n\nexport function blitzIdToPlayerType(id: string): PlayerType {\n  return POSITION_MAP[id] ?? PlayerType.DEFENDER;\n}\n","/**\n * GenieSystem  Genie dynamics orchestrator for Blaze Blitz.\n *\n * Tracks QB, receivers, and defenders. After enough observations,\n * renders ghost receivers at predicted positions showing where\n * routes will go before/during the play.\n *\n * Killer feature: Route Prediction Ghosts  ghost receivers at\n * predicted positions 1-2 seconds ahead. Anomaly indicators flash\n * when a receiver breaks from predicted route (open receiver detection).\n */\n\nimport { Scene, Vector3, GlowLayer } from '@babylonjs/core';\nimport { GhostRenderer3D } from './GhostRenderer3D';\nimport {\n  entityToToken,\n  decode,\n  regionToFieldPosition,\n  FootballEntity,\n  PlayerType,\n  PlayAction,\n  blitzIdToPlayerType,\n} from './FootballAdapter';\n\n//  Inline DynamicsPredictor (TypeScript-native) \n\ninterface Prediction {\n  token: number;\n  probability: number;\n  observations: number;\n}\n\nclass DynamicsPredictor {\n  private transitions: Map<number, Map<number, Map<number, number>>> = new Map();\n  public totalObservations: number = 0;\n\n  observe(prevToken: number | null, nextToken: number | null): void {\n    if (prevToken === null || nextToken === null) {\n      this.totalObservations++;\n      return;\n    }\n    const actionKey = this._inferAction(prevToken, nextToken);\n    if (!this.transitions.has(prevToken)) this.transitions.set(prevToken, new Map());\n    const stateMap = this.transitions.get(prevToken)!;\n    if (!stateMap.has(actionKey)) stateMap.set(actionKey, new Map());\n    const actionMap = stateMap.get(actionKey)!;\n    actionMap.set(nextToken, (actionMap.get(nextToken) ?? 0) + 1);\n    this.totalObservations++;\n  }\n\n  predict(currentToken: number): Prediction[] {\n    const stateMap = this.transitions.get(currentToken);\n    if (!stateMap) return [{ token: currentToken, probability: 0.6, observations: 0 }];\n\n    const counts = new Map<number, number>();\n    let total = 0;\n    for (const actionMap of stateMap.values()) {\n      for (const [nextToken, count] of actionMap) {\n        counts.set(nextToken, (counts.get(nextToken) ?? 0) + count);\n        total += count;\n      }\n    }\n    if (total === 0) return [{ token: currentToken, probability: 0.6, observations: 0 }];\n\n    const predictions: Prediction[] = [];\n    for (const [token, count] of counts) {\n      predictions.push({ token, probability: count / total, observations: count });\n    }\n    predictions.sort((a, b) => b.probability - a.probability);\n    return predictions.slice(0, 5);\n  }\n\n  anomalyScore(prevToken: number, nextToken: number): number {\n    const predictions = this.predict(prevToken);\n    const match = predictions.find(p => p.token === nextToken);\n    if (!match) return 1.0;\n    return 1 - match.probability;\n  }\n\n  serialize(): string {\n    const data: Record<string, Record<string, Record<string, number>>> = {};\n    for (const [state, actionMap] of this.transitions) {\n      data[state] = {};\n      for (const [action, nextMap] of actionMap) {\n        data[state][action] = Object.fromEntries(nextMap);\n      }\n    }\n    return JSON.stringify({ version: 1, totalObservations: this.totalObservations, transitions: data });\n  }\n\n  static deserialize(json: string): DynamicsPredictor {\n    const raw = JSON.parse(json);\n    const p = new DynamicsPredictor();\n    p.totalObservations = raw.totalObservations ?? 0;\n    for (const [stateStr, actionObj] of Object.entries(raw.transitions ?? {})) {\n      const state = parseInt(stateStr, 10);\n      const stateMap = new Map<number, Map<number, number>>();\n      for (const [actionStr, nextObj] of Object.entries(actionObj as Record<string, Record<string, number>>)) {\n        const action = parseInt(actionStr, 10);\n        const nextMap = new Map<number, number>(\n          Object.entries(nextObj).map(([k, v]) => [parseInt(k, 10), v])\n        );\n        stateMap.set(action, nextMap);\n      }\n      p.transitions.set(state, stateMap);\n    }\n    return p;\n  }\n\n  private _inferAction(prevToken: number, nextToken: number): number {\n    if (prevToken === nextToken) return 0;\n    const prevRegion = (prevToken >> 8) & 0xF;\n    const nextRegion = (nextToken >> 8) & 0xF;\n    if (prevRegion !== nextRegion) return 1;\n    const prevStamina = (prevToken >> 6) & 0x3;\n    const nextStamina = (nextToken >> 6) & 0x3;\n    if (nextStamina < prevStamina) return 3;\n    if (nextStamina > prevStamina) return 4;\n    return 2;\n  }\n}\n\n//  GenieSystem \n\nconst MIN_PLAYS_FOR_GHOSTS = 3;\nconst ANOMALY_THRESHOLD = 0.65;\n\nexport class GenieSystem {\n  private scene: Scene;\n  private ghostRenderer: GhostRenderer3D;\n  private predictor: DynamicsPredictor;\n\n  private playCount: number = 0;\n  private prevTokens: Map<string, number> = new Map();\n\n  /** Anomaly callbacks for UI integration */\n  public onAnomaly: ((entityId: string, score: number) => void) | null = null;\n\n  constructor(scene: Scene, glowLayer: GlowLayer | null = null) {\n    this.scene = scene;\n    this.ghostRenderer = new GhostRenderer3D(scene, glowLayer);\n    this.predictor = new DynamicsPredictor();\n  }\n\n  /**\n   * Observe entity state change (call after each position/action update).\n   */\n  observeEntity(entity: FootballEntity): void {\n    const token = entityToToken(entity);\n    const prevToken = this.prevTokens.get(entity.id) ?? null;\n\n    if (prevToken !== null) {\n      this.predictor.observe(prevToken, token);\n\n      // Anomaly detection\n      const score = this.predictor.anomalyScore(prevToken, token);\n      if (score > ANOMALY_THRESHOLD && this.playCount >= MIN_PLAYS_FOR_GHOSTS) {\n        this.onAnomaly?.(entity.id, score);\n      }\n    } else {\n      this.predictor.observe(null, token);\n    }\n\n    this.prevTokens.set(entity.id, token);\n  }\n\n  /**\n   * Call when a new play starts.\n   */\n  onPlayStart(): void {\n    this.playCount++;\n  }\n\n  /**\n   * Call when a play ends. Clears per-play entity tokens.\n   */\n  onPlayEnd(): void {\n    // Observe \"despawn\" for all tracked entities\n    for (const [id, token] of this.prevTokens) {\n      this.predictor.observe(token, null);\n    }\n    this.prevTokens.clear();\n  }\n\n  /**\n   * Render ghost predictions. Call each frame during play_active.\n   */\n  renderGhosts(\n    currentEntities: Map<string, { position: Vector3; type: PlayerType }>\n  ): void {\n    this.ghostRenderer.clear();\n\n    if (this.playCount < MIN_PLAYS_FOR_GHOSTS) return;\n\n    for (const [entityId, currentToken] of this.prevTokens) {\n      const entityInfo = currentEntities.get(entityId);\n      if (!entityInfo) continue;\n\n      // Only predict for receivers (not QB, not defenders)\n      const pType = entityInfo.type;\n      if (\n        pType === PlayerType.QB ||\n        pType === PlayerType.DEFENDER ||\n        pType === PlayerType.BALL\n      ) {\n        continue;\n      }\n\n      const predictions = this.predictor.predict(currentToken);\n\n      let rendered = 0;\n      for (const pred of predictions) {\n        if (pred.probability < 0.1 || rendered >= 2) break;\n        if (pred.observations === 0) continue;\n\n        const decoded = decode(pred.token);\n        const predictedPos = regionToFieldPosition(decoded.region);\n\n        // Place ghost at predicted position\n        this.ghostRenderer.placeGhost(predictedPos, pred.probability, pType);\n\n        // Draw route line from current to predicted\n        this.ghostRenderer.renderRoutePrediction(\n          entityInfo.position,\n          predictedPos,\n          pred.probability,\n          pType\n        );\n\n        rendered++;\n      }\n    }\n  }\n\n  serialize(): string {\n    return this.predictor.serialize();\n  }\n\n  restore(json: string): void {\n    this.predictor = DynamicsPredictor.deserialize(json);\n    this.playCount = Math.floor(this.predictor.totalObservations / 10);\n  }\n\n  getStats(): { playCount: number; totalObservations: number } {\n    return {\n      playCount: this.playCount,\n      totalObservations: this.predictor.totalObservations,\n    };\n  }\n\n  dispose(): void {\n    this.ghostRenderer.dispose();\n  }\n}\n","/**\n * Blaze Blitz Football - Core Game Engine\n * A 60-90 second arcade football microgame for BlazeSportsIntel.com\n *\n * 100% Original IP - No NFL content\n * Built with Babylon.js 7.x + Havok Physics\n */\n\nimport {\n  Engine,\n  Scene,\n  ArcRotateCamera,\n  FollowCamera,\n  HemisphericLight,\n  DirectionalLight,\n  Vector3,\n  MeshBuilder,\n  StandardMaterial,\n  PBRMaterial,\n  Color3,\n  Color4,\n  Mesh,\n  ParticleSystem,\n  Texture,\n  ShadowGenerator,\n  DefaultRenderingPipeline,\n  GlowLayer,\n  SceneLoader,\n  DynamicTexture,\n} from '@babylonjs/core';\n\nimport { FootballField, FIELD_CONFIG } from './Field';\nimport { FootballPhysics, PassType } from './BallPhysics';\nimport { PlayerController, TouchController } from './PlayerController';\nimport { SteeringBehaviors, DefenderAI, SteeringAgent } from './SteeringAI';\nimport { AISystem, CoverageScheme, type DefenderRole } from './AISystem';\nimport { ScoreSystem } from './ScoreSystem';\nimport { AudioManager } from './AudioManager';\nimport { DriveSystem } from './DriveSystem';\nimport { PlaybookSystem, type EnhancedOffensivePlay, type GameSituation } from './PlaybookSystem';\nimport type { BlitzTeam, PlayerPosition } from '@data/teams';\nimport { FIREBIRDS, SHADOW_WOLVES, OFFENSIVE_POSITIONS, DEFENSIVE_POSITIONS } from '@data/teams';\nimport type { OffensivePlay, DefensivePlay, RouteType } from '@data/plays';\nimport { getAllOffensivePlays, getSmartDefensivePlay } from '@data/plays';\nimport { GenieSystem } from '../dynamics/GenieSystem';\nimport { PlayerType, PlayAction, FootballEntity, blitzIdToPlayerType } from '../dynamics/FootballAdapter';\n\n/** Game phase */\nexport type GamePhase =\n  | 'pre_snap'      // Selecting play, setting up\n  | 'play_active'   // Ball is live\n  | 'post_play'     // After whistle, before next play\n  | 'game_over';    // Drive finished\n\n/** Game state */\nexport interface BlitzGameState {\n  score: number;\n  yardsGained: number;\n  touchdowns: number;\n  firstDowns: number;\n  bigPlays: number;       // 20+ yard plays\n  turnovers: number;\n  turboYards: number;     // Yards gained while using turbo\n  stiffArms: number;\n  jukes: number;\n  tacklesMade: number;\n\n  // Current drive info\n  down: number;           // 1-4\n  yardsToGo: number;\n  lineOfScrimmage: number; // Yard line (0-100)\n  timeRemaining: number;  // Milliseconds\n\n  // Current play\n  phase: GamePhase;\n  currentPlay: OffensivePlay | null;\n  longestPlay: number;\n}\n\n/** Final game result */\nexport interface BlitzGameResult {\n  finalScore: number;\n  yardsGained: number;\n  touchdowns: number;\n  firstDowns: number;\n  bigPlays: number;\n  turnovers: number;\n  tacklesMade: number;\n  stiffArms: number;\n  jukes: number;\n  turboYards: number;\n  longestPlay: number;\n  result: 'touchdown' | 'turnover' | 'timeout' | 'incomplete';\n  durationSeconds: number;\n  teamId: string;\n}\n\n/** Scoring configuration */\nconst SCORING = {\n  yardsGained: 10,        // Per yard\n  turboYards: 15,         // Per yard while turbo\n  firstDown: 100,         // Bonus per first down\n  bigPlay: 200,           // 20+ yard plays\n  touchdown: 700,         // Touchdown bonus\n  stiffArm: 50,           // Per successful stiff-arm\n  juke: 75,               // Per successful juke\n} as const;\n\n/** Game configuration */\nexport interface BlitzGameConfig {\n  canvas: HTMLCanvasElement;\n  homeTeam: BlitzTeam;\n  awayTeam: BlitzTeam;\n  onGameStateChange: (state: BlitzGameState) => void;\n  onGameOver: (result: BlitzGameResult) => void;\n  onPlayFeedback?: (text: string, style: string) => void;\n}\n\n/** Brand colors */\nconst COLORS = {\n  blaze: {\n    burntOrange: '#BF5700',\n    ember: '#FF6B35',\n    gold: '#C9A227',\n    charcoal: '#1A1A1A',\n    midnight: '#0D0D0D',\n  },\n  arcade: {\n    neonGreen: '#39FF14',\n    hotPink: '#FF6EC7',\n    constructionYellow: '#FFD700',\n  },\n} as const;\n\nexport class BlitzGameEngine {\n  private engine: Engine;\n  private scene: Scene;\n  private camera!: FollowCamera;\n  private shadowGenerator: ShadowGenerator | null = null;\n  private glowLayer: GlowLayer | null = null;\n\n  // Game components\n  private field: FootballField | null = null;\n  private ball: FootballPhysics | null = null;\n  private playerController: PlayerController | null = null;\n  private touchController: TouchController | null = null;\n  private defenderAIs: DefenderAI[] = []; // legacy, kept for mesh sync\n  private aiSystem: AISystem;\n  private scoreSystem: ScoreSystem;\n\n  // Player meshes\n  private offensivePlayers: Map<string, Mesh> = new Map();\n  private defensivePlayers: Map<string, Mesh> = new Map();\n  private qbMesh: Mesh | null = null;\n\n  // Visual effects\n  private tackleParticles: ParticleSystem | null = null;\n  private touchdownParticles: ParticleSystem | null = null;\n  private turfSpray: ParticleSystem | null = null;\n  private speedLines: ParticleSystem | null = null;\n  private pipeline: DefaultRenderingPipeline | null = null;\n  private skyDome: Mesh | null = null;\n\n  // Camera effects\n  private cameraShakeDuration = 0;\n  private cameraShakeTimeRemaining = 0;\n  private cameraShakeIntensity = 0;\n  private cameraBaseRotationOffset = 180;\n\n  // Cleanup tracking\n  private resizeHandler: (() => void) | null = null;\n  private pendingTimeouts: Set<ReturnType<typeof setTimeout>> = new Set();\n  private pendingIntervals: Set<ReturnType<typeof setInterval>> = new Set();\n\n  // Audio\n  private audioManager: AudioManager | null = null;\n\n  // Genie Dynamics\n  private genieSystem: GenieSystem | null = null;\n\n  // New systems\n  private driveSystem: DriveSystem;\n  private playbookSystem: PlaybookSystem;\n\n  // Game state\n  private gameState: BlitzGameState;\n  private config: BlitzGameConfig;\n  private gameStartTime: number = 0;\n  private isGameOver: boolean = false;\n  private readonly GAME_DURATION_MS = 90000; // 90 seconds\n\n  // Play state\n  private selectedPlay: OffensivePlay | null = null;\n  private defensivePlay: DefensivePlay | null = null;\n  private ballCarrierId: string | null = null;\n  private playStartYardLine: number = 0;\n\n  /** Factory method */\n  public static async create(config: BlitzGameConfig): Promise<BlitzGameEngine> {\n    const engine = new BlitzGameEngine(config);\n    await engine.initialize();\n    return engine;\n  }\n\n  private constructor(config: BlitzGameConfig) {\n    this.config = config;\n\n    // Initialize Babylon engine\n    this.engine = new Engine(config.canvas, true, {\n      adaptToDeviceRatio: true,\n      powerPreference: 'high-performance',\n      antialias: true,\n      stencil: true,\n    });\n\n    this.scene = new Scene(this.engine);\n\n    // Initialize new systems\n    this.driveSystem = new DriveSystem({ startingYardLine: 20 });\n    this.playbookSystem = new PlaybookSystem();\n    this.aiSystem = new AISystem();\n    this.scoreSystem = new ScoreSystem({ quarterLengthSec: 90 });\n\n    // Initialize game state\n    this.gameState = {\n      score: 0,\n      yardsGained: 0,\n      touchdowns: 0,\n      firstDowns: 0,\n      bigPlays: 0,\n      turnovers: 0,\n      turboYards: 0,\n      stiffArms: 0,\n      jukes: 0,\n      tacklesMade: 0,\n      down: 1,\n      yardsToGo: 10,\n      lineOfScrimmage: 20, // Start at own 20\n      timeRemaining: this.GAME_DURATION_MS,\n      phase: 'pre_snap',\n      currentPlay: null,\n      longestPlay: 0,\n    };\n  }\n\n  private async initialize(): Promise<void> {\n    this.setupCamera();\n    this.setupLighting();\n    this.createSkyDome();\n    this.setupPostProcessing();\n    this.createField();\n    this.createPlayers();\n    this.setupBall();\n    this.setupControls();\n    this.createVisualEffects();\n    this.setupAudio();\n    this.genieSystem = new GenieSystem(this.scene, this.glowLayer);\n\n    // Start render loop\n    this.engine.runRenderLoop(() => {\n      this.update();\n      this.scene.render();\n    });\n\n    // Handle resize\n    this.resizeHandler = () => this.engine.resize();\n    window.addEventListener('resize', this.resizeHandler);\n  }\n\n  /** Setup procedural audio */\n  private setupAudio(): void {\n    this.audioManager = new AudioManager(this.scene, {\n      masterVolume: 0.7,\n      musicVolume: 0.4,\n      sfxVolume: 0.8,\n      ambientVolume: 0.3,\n    });\n  }\n\n  /** Unlock audio - call on first user interaction */\n  public async unlockAudio(): Promise<void> {\n    await this.audioManager?.unlock();\n    this.audioManager?.startAmbientCrowd();\n  }\n\n  private setupCamera(): void {\n    // Follow camera that tracks the ball carrier\n    this.camera = new FollowCamera(\n      'camera',\n      new Vector3(0, 20, -15),\n      this.scene\n    );\n\n    this.camera.heightOffset = 25;\n    this.camera.radius = 35;\n    this.camera.rotationOffset = 180;\n    this.camera.cameraAcceleration = 0.1;\n    this.camera.maxCameraSpeed = 20;\n    this.cameraBaseRotationOffset = this.camera.rotationOffset;\n\n    // Initial target (will be updated)\n    const targetMesh = MeshBuilder.CreateBox('cameraTarget', { size: 0.1 }, this.scene);\n    targetMesh.isVisible = false;\n    targetMesh.position = new Vector3(0, 0, 20);\n    this.camera.lockedTarget = targetMesh;\n  }\n\n  private setupLighting(): void {\n    // Stadium lights (bright)\n    const mainLight = new DirectionalLight(\n      'mainLight',\n      new Vector3(-0.5, -1, 0.5),\n      this.scene\n    );\n    mainLight.intensity = 1.2;\n    mainLight.diffuse = Color3.White();\n    mainLight.position = new Vector3(50, 80, -50);\n\n    // Shadows\n    this.shadowGenerator = new ShadowGenerator(2048, mainLight);\n    this.shadowGenerator.useBlurExponentialShadowMap = true;\n    this.shadowGenerator.blurScale = 2;\n\n    // Ambient fill\n    const ambientLight = new HemisphericLight(\n      'ambient',\n      new Vector3(0, 1, 0),\n      this.scene\n    );\n    ambientLight.intensity = 0.5;\n    ambientLight.diffuse = new Color3(0.9, 0.9, 1.0);\n    ambientLight.groundColor = new Color3(0.2, 0.4, 0.2);\n\n    // Night sky\n    this.scene.clearColor = new Color4(0.05, 0.05, 0.1, 1.0);\n\n    // Rim/back light for depth\n    const rimLight = new DirectionalLight('rimLight', new Vector3(-30, 40, 60).normalize(), this.scene);\n    rimLight.intensity = 0.4;\n    rimLight.diffuse = Color3.FromHexString('#FFF5E0');\n\n    const fieldGlow = new HemisphericLight('fieldGlow', new Vector3(0, 1, 1), this.scene);\n    fieldGlow.intensity = 0.2;\n    fieldGlow.diffuse = Color3.FromHexString('#FFB870');\n    fieldGlow.groundColor = new Color3(0.1, 0.1, 0.12);\n\n    // Exponential fog\n    this.scene.fogMode = Scene.FOGMODE_EXP2;\n    this.scene.fogDensity = 0.0008;\n    this.scene.fogColor = new Color3(0.05, 0.05, 0.1);\n  }\n\n  private createSkyDome(): void {\n    const dome = MeshBuilder.CreateSphere(\n      'skyDome',\n      { diameter: 500, segments: 32 },\n      this.scene\n    );\n    const skyMat = new StandardMaterial('skyMat', this.scene);\n    skyMat.backFaceCulling = false;\n    skyMat.disableLighting = true;\n\n    const texture = new DynamicTexture(\n      'skyTexture',\n      { width: 512, height: 512 },\n      this.scene,\n      true\n    );\n    const ctx = texture.getContext() as CanvasRenderingContext2D;\n    const gradient = ctx.createLinearGradient(0, 0, 0, 512);\n    gradient.addColorStop(0, '#0B1020');\n    gradient.addColorStop(0.5, '#141B2D');\n    gradient.addColorStop(1, '#1B2235');\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, 512, 512);\n\n    for (let i = 0; i < 120; i++) {\n      const x = Math.random() * 512;\n      const y = Math.random() * 256;\n      const radius = Math.random() * 1.5 + 0.5;\n      ctx.fillStyle = `rgba(255, 255, 255, ${Math.random() * 0.8})`;\n      ctx.beginPath();\n      ctx.arc(x, y, radius, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    texture.update();\n    skyMat.diffuseTexture = texture;\n    skyMat.emissiveColor = new Color3(0.4, 0.45, 0.6);\n    dome.material = skyMat;\n    dome.isPickable = false;\n    this.skyDome = dome;\n  }\n\n  private setupPostProcessing(): void {\n    const pipeline = new DefaultRenderingPipeline(\n      'pipeline',\n      true,\n      this.scene,\n      [this.camera]\n    );\n\n    // Bloom  toned down so player colors stay visible\n    pipeline.bloomEnabled = true;\n    pipeline.bloomThreshold = 0.8;\n    pipeline.bloomWeight = 0.3;\n    pipeline.bloomKernel = 64;\n\n    // Glow layer for ball carrier highlight only\n    this.glowLayer = new GlowLayer('glow', this.scene);\n    this.glowLayer.intensity = 0.6;\n\n    // Anti-aliasing\n    pipeline.fxaaEnabled = true;\n    pipeline.samples = 4;\n\n    pipeline.chromaticAberrationEnabled = true;\n    pipeline.chromaticAberration.aberrationAmount = 0.15;\n\n    pipeline.grainEnabled = true;\n    pipeline.grain.intensity = 3;\n    pipeline.grain.animated = true;\n\n    this.pipeline = pipeline;\n  }\n\n  private createField(): void {\n    this.field = new FootballField(\n      this.scene,\n      this.config.homeTeam,\n      this.config.awayTeam\n    );\n    this.field.build();\n  }\n\n  private createPlayers(): void {\n    const homeTeam = this.config.homeTeam;\n    const awayTeam = this.config.awayTeam;\n\n    // Create offensive players (home team)\n    OFFENSIVE_POSITIONS.forEach((pos) => {\n      const player = this.createPlayerMesh(pos.id, homeTeam, true);\n      this.offensivePlayers.set(pos.id, player);\n\n      if (pos.id === 'qb') {\n        this.qbMesh = player;\n      }\n    });\n\n    // Create defensive players (away team) with AI\n    DEFENSIVE_POSITIONS.forEach((pos) => {\n      const player = this.createPlayerMesh(pos.id, awayTeam, false);\n      this.defensivePlayers.set(pos.id, player);\n\n      // Create AI for this defender\n      const agent: SteeringAgent = {\n        id: pos.id,\n        position: player.position.clone(),\n        velocity: Vector3.Zero(),\n        maxSpeed: 12 + (awayTeam.speed / 10) * 5,\n        maxForce: 20,\n        mass: 1,\n        rotation: 0,\n      };\n\n      const ai = new DefenderAI(agent, {\n        pursuitLookAhead: 0.4,\n        coverageAggressiveness: awayTeam.defense / 10,\n      });\n\n      this.defenderAIs.push(ai);\n\n      // Register with AISystem v2\n      this.aiSystem.addDefender(agent);\n    });\n  }\n\n  private createPlayerMesh(\n    id: string,\n    team: BlitzTeam,\n    isOffense: boolean\n  ): Mesh {\n    // Capsule body (blocky/low-poly style)\n    const body = MeshBuilder.CreateCapsule(\n      `player_${id}`,\n      { radius: 0.5, height: 2 },\n      this.scene\n    );\n\n    // Team color material  emissive ensures visibility under stadium lights\n    const mat = new StandardMaterial(`playerMat_${id}`, this.scene);\n    mat.diffuseColor = Color3.FromHexString(team.primaryColor);\n    mat.specularColor = Color3.FromHexString(team.secondaryColor);\n    mat.emissiveColor = Color3.FromHexString(team.primaryColor).scale(0.3);\n    body.material = mat;\n\n    // Helmet (sphere on top)\n    const helmet = MeshBuilder.CreateSphere(\n      `helmet_${id}`,\n      { diameter: 0.6 },\n      this.scene\n    );\n    helmet.position.y = 1.1;\n    helmet.parent = body;\n\n    const helmetMat = new PBRMaterial(`helmetMat_${id}`, this.scene);\n    helmetMat.albedoColor = Color3.FromHexString(team.helmetColor);\n    helmetMat.metallic = 0.7;\n    helmetMat.roughness = 0.25;\n    helmet.material = helmetMat;\n\n    // Add to shadow caster\n    if (this.shadowGenerator) {\n      this.shadowGenerator.addShadowCaster(body);\n    }\n\n    // Exclude players from global glow  only ball carrier gets glow dynamically\n    if (this.glowLayer) {\n      this.glowLayer.addExcludedMesh(body);\n      this.glowLayer.addExcludedMesh(helmet);\n    }\n\n    // Initial position off-field\n    body.position.y = 1;\n    body.position.x = isOffense ? -30 : 30;\n\n    return body;\n  }\n\n  private setupBall(): void {\n    this.ball = new FootballPhysics(this.scene, {\n      catchRadius: 2.5,\n      bulletVelocity: 50,\n      touchVelocity: 38,\n    });\n    this.ball.initialize();\n  }\n\n  private setupControls(): void {\n    // Keyboard/mouse controls\n    this.playerController = new PlayerController(\n      new Vector3(0, 0, this.gameState.lineOfScrimmage - 5),\n      {\n        baseSpeed: 15,\n        turboMultiplier: 1.5,\n        accelerationTime: 0.2,\n      }\n    );\n\n    // Touch controls for mobile\n    if ('ontouchstart' in window) {\n      this.touchController = new TouchController(this.config.canvas);\n    }\n  }\n\n  private createVisualEffects(): void {\n    // Tackle impact particles\n    this.tackleParticles = new ParticleSystem('tackleParticles', 100, this.scene);\n    this.tackleParticles.particleTexture = new Texture(\n      'https://raw.githubusercontent.com/BabylonJS/Assets/master/textures/flare.png',\n      this.scene\n    );\n    this.tackleParticles.emitter = Vector3.Zero();\n    this.tackleParticles.minSize = 0.3;\n    this.tackleParticles.maxSize = 0.8;\n    this.tackleParticles.minLifeTime = 0.2;\n    this.tackleParticles.maxLifeTime = 0.5;\n    this.tackleParticles.emitRate = 150;\n    this.tackleParticles.blendMode = ParticleSystem.BLENDMODE_ADD;\n    this.tackleParticles.gravity = new Vector3(0, -10, 0);\n    this.tackleParticles.direction1 = new Vector3(-3, 2, -3);\n    this.tackleParticles.direction2 = new Vector3(3, 5, 3);\n    this.tackleParticles.color1 = Color3.FromHexString(COLORS.arcade.neonGreen).toColor4(1);\n    this.tackleParticles.color2 = Color3.FromHexString(COLORS.arcade.constructionYellow).toColor4(1);\n    this.tackleParticles.colorDead = new Color4(0, 1, 0, 0);\n\n    // Touchdown celebration particles\n    this.touchdownParticles = new ParticleSystem('tdParticles', 500, this.scene);\n    this.touchdownParticles.particleTexture = new Texture(\n      'https://raw.githubusercontent.com/BabylonJS/Assets/master/textures/flare.png',\n      this.scene\n    );\n    this.touchdownParticles.emitter = Vector3.Zero();\n    this.touchdownParticles.minSize = 0.5;\n    this.touchdownParticles.maxSize = 1.5;\n    this.touchdownParticles.minLifeTime = 1;\n    this.touchdownParticles.maxLifeTime = 2;\n    this.touchdownParticles.emitRate = 200;\n    this.touchdownParticles.blendMode = ParticleSystem.BLENDMODE_ADD;\n    this.touchdownParticles.gravity = new Vector3(0, -5, 0);\n    this.touchdownParticles.direction1 = new Vector3(-5, 10, -5);\n    this.touchdownParticles.direction2 = new Vector3(5, 20, 5);\n    this.touchdownParticles.color1 = Color3.FromHexString(COLORS.blaze.burntOrange).toColor4(1);\n    this.touchdownParticles.color2 = Color3.FromHexString(COLORS.blaze.gold).toColor4(1);\n    this.touchdownParticles.colorDead = new Color4(1, 0.5, 0, 0);\n\n    // Turf spray - emitted on juke/spin moves\n    this.turfSpray = new ParticleSystem('turfSpray', 30, this.scene);\n    this.turfSpray.particleTexture = new Texture(\n      'https://raw.githubusercontent.com/BabylonJS/Assets/master/textures/flare.png',\n      this.scene\n    );\n    this.turfSpray.emitter = Vector3.Zero();\n    this.turfSpray.minSize = 0.03;\n    this.turfSpray.maxSize = 0.07;\n    this.turfSpray.minLifeTime = 0.1;\n    this.turfSpray.maxLifeTime = 0.3;\n    this.turfSpray.emitRate = 80;\n    this.turfSpray.blendMode = ParticleSystem.BLENDMODE_STANDARD;\n    this.turfSpray.gravity = new Vector3(0, -5, 0);\n    this.turfSpray.direction1 = new Vector3(-1, 1, -1);\n    this.turfSpray.direction2 = new Vector3(1, 2, 1);\n    this.turfSpray.color1 = new Color4(0.4, 0.25, 0.1, 0.8);\n    this.turfSpray.color2 = new Color4(0.3, 0.2, 0.08, 0.6);\n    this.turfSpray.colorDead = new Color4(0.2, 0.15, 0.05, 0);\n\n    // Speed lines - emitted during turbo\n    this.speedLines = new ParticleSystem('speedLines', 20, this.scene);\n    this.speedLines.particleTexture = new Texture(\n      'https://raw.githubusercontent.com/BabylonJS/Assets/master/textures/flare.png',\n      this.scene\n    );\n    this.speedLines.emitter = Vector3.Zero();\n    this.speedLines.minSize = 0.05;\n    this.speedLines.maxSize = 0.15;\n    this.speedLines.minLifeTime = 0.05;\n    this.speedLines.maxLifeTime = 0.15;\n    this.speedLines.emitRate = 60;\n    this.speedLines.blendMode = ParticleSystem.BLENDMODE_ADD;\n    this.speedLines.gravity = Vector3.Zero();\n    this.speedLines.color1 = new Color4(1, 1, 1, 0.6);\n    this.speedLines.color2 = new Color4(0.9, 0.9, 1, 0.4);\n    this.speedLines.colorDead = new Color4(1, 1, 1, 0);\n  }\n\n  /** Start the game */\n  public startGame(): void {\n    this.gameStartTime = performance.now();\n    this.isGameOver = false;\n    this.resetGameState();\n    this.setupNewPlay();\n    this.config.onGameStateChange(this.gameState);\n\n    // Play game start sound\n    this.audioManager?.playSFX('game_start');\n  }\n\n  private resetGameState(): void {\n    this.driveSystem.reset(20);\n    this.aiSystem.reset();\n    this.gameState = {\n      score: 0,\n      yardsGained: 0,\n      touchdowns: 0,\n      firstDowns: 0,\n      bigPlays: 0,\n      turnovers: 0,\n      turboYards: 0,\n      stiffArms: 0,\n      jukes: 0,\n      tacklesMade: 0,\n      down: 1,\n      yardsToGo: 10,\n      lineOfScrimmage: 20,\n      timeRemaining: this.GAME_DURATION_MS,\n      phase: 'pre_snap',\n      currentPlay: null,\n      longestPlay: 0,\n    };\n  }\n\n  /** Setup for a new play */\n  private setupNewPlay(): void {\n    this.gameState.phase = 'pre_snap';\n\n    // Sync drive state into game state\n    const driveState = this.driveSystem.getState();\n    this.gameState.down = driveState.down;\n    this.gameState.yardsToGo = driveState.yardsToGo;\n    this.gameState.lineOfScrimmage = driveState.lineOfScrimmage;\n    this.playStartYardLine = driveState.lineOfScrimmage;\n\n    // Build game situation for smart play selection\n    const situation: GameSituation = {\n      down: driveState.down,\n      yardsToGo: driveState.yardsToGo,\n      yardLine: driveState.lineOfScrimmage,\n      scoreDiff: 0,\n      timeRemaining: this.gameState.timeRemaining / 1000,\n      quarter: 1,\n    };\n\n    // Recommend a play (engine auto-selects first recommendation for arcade pace)\n    const recommendations = this.playbookSystem.getPlayRecommendations(situation, 1);\n    this.selectedPlay = recommendations[0] ?? getAllOffensivePlays()[0];\n    this.gameState.currentPlay = this.selectedPlay;\n\n    // AI selects defensive play using PlaybookSystem\n    this.defensivePlay = this.playbookSystem.selectDefensivePlay(situation);\n\n    // Configure AISystem v2 for this play\n    this.aiSystem.setLineOfScrimmage(driveState.lineOfScrimmage);\n    this.aiSystem.setScheme(CoverageScheme.Cover3);\n\n    // Position players\n    this.positionPlayersForPlay();\n\n    // Give ball to QB\n    const qbPos = this.qbMesh?.position || new Vector3(0, 0, this.gameState.lineOfScrimmage - 5);\n    this.ball?.giveTo('qb', qbPos);\n    this.ballCarrierId = 'qb';\n\n    // Update camera target\n    if (this.camera.lockedTarget && this.qbMesh) {\n      (this.camera.lockedTarget as Mesh).position = this.qbMesh.position.clone();\n    }\n\n    // Auto-snap after short delay (arcade style - no huddle)\n    const snapTimer = setTimeout(() => {\n      this.pendingTimeouts.delete(snapTimer);\n      if (this.gameState.phase === 'pre_snap' && !this.isGameOver) {\n        this.snapBall();\n      }\n    }, 1500);\n    this.pendingTimeouts.add(snapTimer);\n  }\n\n  private positionPlayersForPlay(): void {\n    const los = this.gameState.lineOfScrimmage;\n\n    // Position offensive players\n    OFFENSIVE_POSITIONS.forEach((pos) => {\n      const mesh = this.offensivePlayers.get(pos.id);\n      if (mesh) {\n        mesh.position.x = pos.defaultZ; // Z in formation = X on field\n        mesh.position.z = los + pos.defaultX;\n        mesh.position.y = 1;\n      }\n    });\n\n    // Position defensive players\n    DEFENSIVE_POSITIONS.forEach((pos, idx) => {\n      const mesh = this.defensivePlayers.get(pos.id);\n      if (mesh) {\n        mesh.position.x = pos.defaultZ;\n        mesh.position.z = los + pos.defaultX;\n        mesh.position.y = 1;\n\n        // Update AI position\n        if (this.defenderAIs[idx]) {\n          this.defenderAIs[idx].setPosition(mesh.position);\n        }\n      }\n    });\n\n    // Set player controller position (QB)\n    this.playerController?.setPosition(new Vector3(0, 0, los - 5));\n  }\n\n  private snapBall(): void {\n    this.gameState.phase = 'play_active';\n\n    // Notify Genie of play start\n    this.genieSystem?.onPlayStart();\n\n    // Play snap sound\n    this.audioManager?.playSFX('snap');\n\n    // Start ScoreSystem game clock\n    this.scoreSystem.startClock();\n\n    // Trigger AI reaction delay (v2)\n    this.aiSystem.triggerReaction(0.2);\n\n    // Start route running (simplified - receivers move to targets)\n    if (this.selectedPlay) {\n      this.runRoutes();\n    }\n\n    this.config.onGameStateChange(this.gameState);\n  }\n\n  private runRoutes(): void {\n    if (!this.selectedPlay) return;\n\n    // Animate receivers running routes\n    this.selectedPlay.routes.forEach((route) => {\n      const mesh = this.offensivePlayers.get(route.positionId);\n      if (!mesh || route.routeType === 'block' || route.positionId === 'qb') return;\n\n      // Calculate route target position\n      const startPos = mesh.position.clone();\n      const targetPos = new Vector3(\n        startPos.x + route.routeWidth,\n        1,\n        startPos.z + route.routeDepth\n      );\n\n      // Simple linear route animation (could be enhanced with bezier curves)\n      this.animatePlayerToPosition(mesh, targetPos, 2000);\n    });\n  }\n\n  private animatePlayerToPosition(mesh: Mesh, target: Vector3, duration: number): void {\n    const startPos = mesh.position.clone();\n    const startTime = performance.now();\n\n    const animate = () => {\n      if (this.gameState.phase !== 'play_active') return;\n\n      const elapsed = performance.now() - startTime;\n      const t = Math.min(1, elapsed / duration);\n\n      mesh.position = Vector3.Lerp(startPos, target, t);\n\n      // Face movement direction\n      const dir = target.subtract(startPos);\n      mesh.rotation.y = Math.atan2(dir.x, dir.z);\n\n      if (t < 1) {\n        requestAnimationFrame(animate);\n      }\n    };\n\n    animate();\n  }\n\n  /** Main game loop update */\n  private update(): void {\n    if (this.isGameOver) return;\n\n    // Clamp deltaTime to prevent huge jumps (e.g. tab throttling, canvas hiddenvisible)\n    const rawDelta = this.engine.getDeltaTime() / 1000;\n    const deltaTime = Math.min(rawDelta, 0.1);\n\n    // Tick ScoreSystem clock  arcade mode: game ends when Q1 expires\n    if (this.gameState.phase === 'play_active') {\n      this.scoreSystem.tick(deltaTime);\n      if (this.scoreSystem.getClock().timeRemainingSec <= 0) {\n        this.endGame('timeout');\n        return;\n      }\n    }\n    // Sync time remaining from ScoreSystem\n    this.gameState.timeRemaining = this.scoreSystem.getClock().timeRemainingSec * 1000;\n\n    // Update based on game phase\n    if (this.gameState.phase === 'play_active') {\n      this.updatePlayActive(deltaTime);\n    }\n\n    // Update UI\n    this.config.onGameStateChange(this.gameState);\n  }\n\n  private updatePlayActive(deltaTime: number): void {\n    // Update player controller\n    this.playerController?.update(deltaTime);\n\n    // Update ball physics\n    this.ball?.update(deltaTime);\n\n    // Update QB mesh to follow controller\n    if (this.ballCarrierId === 'qb' && this.qbMesh && this.playerController) {\n      const pos = this.playerController.getPosition();\n      this.qbMesh.position = pos;\n      this.qbMesh.rotation.y = this.playerController.getRotation();\n\n      // Update ball position\n      this.ball?.updateHeldPosition(pos, this.playerController.getRotation());\n\n      // Update camera target\n      if (this.camera.lockedTarget) {\n        (this.camera.lockedTarget as Mesh).position = pos;\n      }\n\n      const speed = this.playerController.getVelocity().length();\n      const targetRadius = 34 + Math.min(10, speed * 0.6);\n      const targetHeight = 24 + Math.min(8, speed * 0.4);\n      let radius = targetRadius;\n      let height = targetHeight;\n\n      if (this.cameraShakeTimeRemaining > 0) {\n        this.cameraShakeTimeRemaining = Math.max(0, this.cameraShakeTimeRemaining - deltaTime);\n        const intensityScale = this.cameraShakeDuration > 0\n          ? this.cameraShakeTimeRemaining / this.cameraShakeDuration\n          : 0;\n        const jitter = (Math.random() * 2 - 1) * this.cameraShakeIntensity * intensityScale;\n        radius += jitter * 0.6;\n        height += jitter * 0.4;\n        this.camera.rotationOffset = this.cameraBaseRotationOffset + jitter;\n      } else {\n        this.camera.rotationOffset = this.cameraBaseRotationOffset;\n      }\n\n      this.camera.radius = radius;\n      this.camera.heightOffset = height;\n\n      // Turbo tracking\n      if (this.playerController.isTurboOn()) {\n        const velocity = this.playerController.getVelocity();\n        const yardsThisFrame = velocity.length() * deltaTime;\n        if (velocity.z > 0) { // Moving forward\n          this.gameState.turboYards += yardsThisFrame;\n        }\n\n        // Speed lines during turbo\n        if (this.speedLines && this.playerController) {\n          const vel = this.playerController.getVelocity();\n          this.speedLines.emitter = this.playerController.getPosition().clone();\n          this.speedLines.direction1 = vel.normalize().scale(-2);\n          this.speedLines.direction2 = vel.normalize().scale(-3);\n          if (!this.speedLines.isStarted) this.speedLines.start();\n        }\n      } else {\n        this.speedLines?.stop();\n      }\n    }\n\n    // Update defender AI (v2  AISystem with zone/man coverage)\n    const ballCarrierPos = this.ballCarrierId ? this.getBallCarrierPosition() : null;\n    const ballCarrierVel = this.playerController?.getVelocity() || null;\n    const ballPos = this.ball?.getPosition() || null;\n\n    // Build receiver positions + velocities maps\n    const receiverPositions = new Map<string, Vector3>();\n    const receiverVelocities = new Map<string, Vector3>();\n    this.offensivePlayers.forEach((mesh, id) => {\n      if (id !== 'qb' && id !== 'c') {\n        receiverPositions.set(id, mesh.position.clone());\n        // Approximate velocity from mesh movement (receivers are AI-driven)\n        receiverVelocities.set(id, Vector3.Zero());\n      }\n    });\n\n    // Feed QB look direction to AI for read-react\n    if (this.playerController) {\n      const rot = this.playerController.getRotation();\n      this.aiSystem.setQBEyeDirection(new Vector3(Math.sin(rot), 0, Math.cos(rot)));\n    }\n\n    // AISystem v2 single-call update\n    this.aiSystem.update(deltaTime, ballCarrierPos, ballCarrierVel, ballPos, receiverPositions, receiverVelocities);\n\n    // Sync AI agent positions back to meshes + check tackles\n    DEFENSIVE_POSITIONS.forEach((defPos) => {\n      const mesh = this.defensivePlayers.get(defPos.id);\n      const agent = this.aiSystem.getAgent(defPos.id);\n      if (mesh && agent) {\n        mesh.position.x = agent.position.x;\n        mesh.position.z = agent.position.z;\n        mesh.rotation.y = agent.rotation;\n\n        // Tackle check\n        if (ballCarrierPos && Vector3.Distance(agent.position, ballCarrierPos) < 1.5) {\n          this.handleTackle(agent.position);\n        }\n      }\n    });\n\n    // Manage ball carrier glow\n    if (this.glowLayer && this.ballCarrierId) {\n      const carrierMesh = this.ballCarrierId === 'qb' ? this.qbMesh : this.offensivePlayers.get(this.ballCarrierId);\n      if (carrierMesh) {\n        this.glowLayer.addIncludedOnlyMesh(carrierMesh as Mesh);\n      }\n    }\n\n    // Observe entities for Genie dynamics\n    if (this.genieSystem) {\n      this.offensivePlayers.forEach((mesh, id) => {\n        if (id === 'c') return;\n        const pType = blitzIdToPlayerType(id);\n        const action = id === this.ballCarrierId ? PlayAction.CATCH\n          : id === 'qb' ? PlayAction.SNAP : PlayAction.RUN_ROUTE;\n        this.genieSystem!.observeEntity({\n          id, type: pType, position: mesh.position.clone(),\n          action, stamina: 100,\n        });\n      });\n\n      const currentEntities = new Map<string, { position: Vector3; type: PlayerType }>();\n      this.offensivePlayers.forEach((mesh, id) => {\n        currentEntities.set(id, { position: mesh.position.clone(), type: blitzIdToPlayerType(id) });\n      });\n      this.genieSystem.renderGhosts(currentEntities);\n    }\n\n    // Check for throw (space bar)\n    if (this.ballCarrierId === 'qb' && this.playerController?.isActionDown()) {\n      const selectedIdx = this.playerController.getSelectedReceiver();\n      if (selectedIdx !== null) {\n        this.attemptThrow(selectedIdx);\n      }\n    }\n\n    // Check for touchdown\n    const carrierZ = ballCarrierPos?.z || 0;\n    if (carrierZ >= FIELD_CONFIG.length) {\n      this.scoreTouchdown();\n    }\n\n    // Check for out of bounds\n    if (ballCarrierPos && !FootballField.isInBounds(ballCarrierPos.x, ballCarrierPos.z)) {\n      this.endPlay(false);\n    }\n  }\n\n  private getBallCarrierPosition(): Vector3 | null {\n    if (!this.ballCarrierId) return null;\n\n    if (this.ballCarrierId === 'qb') {\n      return this.playerController?.getPosition() || null;\n    }\n\n    const mesh = this.offensivePlayers.get(this.ballCarrierId);\n    return mesh?.position.clone() || null;\n  }\n\n  private attemptThrow(receiverIndex: number): void {\n    // Map index to receiver position ID\n    const receiverIds = ['wr1', 'wr2', 'wr3', 'te', 'rb'];\n    const targetId = receiverIds[receiverIndex];\n    if (!targetId) return;\n\n    const targetMesh = this.offensivePlayers.get(targetId);\n    if (!targetMesh) return;\n\n    // Determine pass type based on hold time\n    const holdTime = this.playerController?.getActionHoldTime() || 0;\n    let passType: PassType = 'touch';\n    if (holdTime > 0.3) {\n      passType = 'bullet';\n    } else if (holdTime < 0.1) {\n      passType = 'lob';\n    }\n\n    // Lead the receiver\n    const leadDistance = 5;\n    const targetPos = targetMesh.position.clone();\n    targetPos.z += leadDistance;\n\n    // Throw the ball\n    this.ball?.throwTo(targetPos, passType, holdTime);\n    this.ballCarrierId = null;\n\n    // Play pass throw sound\n    this.audioManager?.playSFX('pass_throw');\n\n    // Check for catch after flight time\n    const catchTimer = setTimeout(() => {\n      this.pendingTimeouts.delete(catchTimer);\n      if (this.isGameOver || !this.ball) return;\n      if (this.ball.isCatchable()) {\n        const caught = this.ball.attemptCatch(\n          targetId,\n          targetMesh.position,\n          7 // Catch skill\n        );\n\n        if (caught) {\n          this.ballCarrierId = targetId;\n          // Play catch sound\n          this.audioManager?.playSFX('catch');\n          // Switch camera to follow receiver\n          if (this.camera.lockedTarget) {\n            (this.camera.lockedTarget as Mesh).position = targetMesh.position;\n          }\n        } else {\n          // Incomplete pass\n          this.audioManager?.playSFX('incomplete');\n          this.endPlay(true);\n        }\n      }\n    }, 800);\n    this.pendingTimeouts.add(catchTimer);\n  }\n\n  private handleTackle(tacklerPosition: Vector3): void {\n    if (this.gameState.phase !== 'play_active') return;\n\n    // Play tackle sound (big tackle if high velocity collision)\n    const carrierVelocity = this.playerController?.getVelocity()?.length() || 0;\n    if (carrierVelocity > 10) {\n      this.audioManager?.playSFX('tackle_big');\n    } else {\n      this.audioManager?.playSFX('tackle');\n    }\n\n    // Tackle particles\n    if (this.tackleParticles && this.ballCarrierId) {\n      const carrierPos = this.getBallCarrierPosition();\n      if (carrierPos) {\n        this.tackleParticles.emitter = carrierPos;\n        this.tackleParticles.start();\n        setTimeout(() => this.tackleParticles?.stop(), 300);\n      }\n    }\n\n    this.gameState.tacklesMade++;\n    this.triggerCameraShake(1.2, 350);\n    this.endPlay(false);\n  }\n\n  private scoreTouchdown(): void {\n    this.gameState.touchdowns++;\n    this.gameState.score += SCORING.touchdown;\n    this.scoreSystem.scoreTouchdown('home');\n    this.field?.updateJumbotron(null, this.gameState.score, 0);\n\n    // Play touchdown fanfare\n    this.audioManager?.playSFX('touchdown');\n    this.audioManager?.setCrowdIntensity(3);\n    this.triggerCameraShake(1.6, 600);\n\n    // Touchdown particles\n    const tdPos = this.getBallCarrierPosition() || new Vector3(0, 0, 100);\n    if (this.touchdownParticles) {\n      this.touchdownParticles.emitter = tdPos;\n      this.touchdownParticles.start();\n      const tdStopTimer = setTimeout(() => { this.pendingTimeouts.delete(tdStopTimer); this.touchdownParticles?.stop(); }, 2000);\n      this.pendingTimeouts.add(tdStopTimer);\n    }\n\n    // Mascot Easter egg  appears after 3+ touchdowns\n    if (this.gameState.touchdowns >= 3) {\n      this.spawnMascot();\n    }\n\n    // TD light flicker  animate lights with sine wave over 2s\n    const lights = this.scene.lights;\n    const originalIntensities = lights.map(l => l.intensity);\n    let flickerStart = performance.now();\n    const flickerInterval = setInterval(() => {\n      const elapsed = (performance.now() - flickerStart) / 1000;\n      if (elapsed > 2) {\n        lights.forEach((l, i) => l.intensity = originalIntensities[i]);\n        clearInterval(flickerInterval);\n        this.pendingIntervals.delete(flickerInterval);\n        return;\n      }\n      const flicker = 1 + 0.3 * Math.sin(elapsed * Math.PI * 6);\n      lights.forEach((l, i) => l.intensity = originalIntensities[i] * flicker);\n    }, 33);\n    this.pendingIntervals.add(flickerInterval);\n\n    this.endGame('touchdown');\n  }\n\n  private triggerCameraShake(intensity: number, durationMs: number): void {\n    this.cameraShakeIntensity = intensity;\n    this.cameraShakeDuration = durationMs / 1000;\n    this.cameraShakeTimeRemaining = this.cameraShakeDuration;\n  }\n\n  private endPlay(isIncomplete: boolean): void {\n    this.gameState.phase = 'post_play';\n    this.scoreSystem.stopClock();\n    this.genieSystem?.onPlayEnd();\n    this.playerController?.blowWhistle();\n    this.ball?.markDead();\n\n    // Play whistle sound\n    this.audioManager?.playSFX('whistle');\n    this.audioManager?.setCrowdIntensity(0.3);\n\n    // Calculate yards gained\n    const endYardLine = this.getBallCarrierPosition()?.z || this.gameState.lineOfScrimmage;\n    const yardsThisPlay = isIncomplete ? 0 : Math.max(0, endYardLine - this.playStartYardLine);\n\n    // Record pass attempt in ScoreSystem\n    this.scoreSystem.recordPassAttempt('home', !isIncomplete, yardsThisPlay, false, false);\n\n    // Process play through DriveSystem\n    const playResult = this.driveSystem.processPlay(yardsThisPlay, {\n      isComplete: !isIncomplete,\n    });\n\n    // Update game state from drive\n    if (yardsThisPlay > 0 && !isIncomplete) {\n      this.gameState.yardsGained += yardsThisPlay;\n      this.gameState.score += Math.floor(yardsThisPlay * SCORING.yardsGained);\n\n      if (playResult.bigPlay) {\n        this.gameState.bigPlays++;\n        this.gameState.score += SCORING.bigPlay;\n      }\n      if (yardsThisPlay > this.gameState.longestPlay) {\n        this.gameState.longestPlay = yardsThisPlay;\n      }\n    }\n\n    // Sync drive state back\n    const driveState = this.driveSystem.getState();\n    this.gameState.lineOfScrimmage = driveState.lineOfScrimmage;\n    this.gameState.down = driveState.down;\n    this.gameState.yardsToGo = driveState.yardsToGo;\n\n    if (playResult.isFirstDown) {\n      this.gameState.firstDowns++;\n      this.gameState.score += SCORING.firstDown;\n      this.audioManager?.playSFX('first_down');\n    }\n\n    // Check for turnover on downs\n    if (playResult.isTurnover || this.driveSystem.isOver()) {\n      this.endGame('turnover');\n      return;\n    }\n\n    this.config.onGameStateChange(this.gameState);\n\n    // Setup next play after delay\n    setTimeout(() => {\n      if (!this.isGameOver) {\n        this.setupNewPlay();\n      }\n    }, 1500);\n  }\n\n  private endGame(result: 'touchdown' | 'turnover' | 'timeout' | 'incomplete'): void {\n    if (this.isGameOver) return;\n\n    this.isGameOver = true;\n    this.gameState.phase = 'game_over';\n\n    // Stop ambient crowd and play game over sound\n    this.audioManager?.stopAmbientCrowd();\n    if (result !== 'touchdown') {\n      // Don't play game_over if touchdown (that already played its fanfare)\n      this.audioManager?.playSFX('game_over');\n    }\n\n    const gameResult: BlitzGameResult = {\n      finalScore: this.gameState.score,\n      yardsGained: this.gameState.yardsGained,\n      touchdowns: this.gameState.touchdowns,\n      firstDowns: this.gameState.firstDowns,\n      bigPlays: this.gameState.bigPlays,\n      turnovers: this.gameState.turnovers,\n      tacklesMade: this.gameState.tacklesMade,\n      stiffArms: this.gameState.stiffArms,\n      jukes: this.gameState.jukes,\n      turboYards: Math.floor(this.gameState.turboYards),\n      longestPlay: this.gameState.longestPlay,\n      result,\n      durationSeconds: Math.floor((performance.now() - this.gameStartTime) / 1000),\n      teamId: this.config.homeTeam.id,\n    };\n\n    this.config.onGameOver(gameResult);\n\n    // Submit to arcade leaderboard\n    this.submitToLeaderboard(gameResult);\n  }\n\n  /** Submit final score to leaderboard */\n  private async submitToLeaderboard(result: BlitzGameResult): Promise<void> {\n    try {\n      const playerName = this.config.homeTeam?.name || 'Anonymous';\n      const res = await fetch('/api/mini-games/leaderboard/submit', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          gameId: 'blitz',\n          playerName,\n          score: result.finalScore,\n          metadata: {\n            touchdowns: result.touchdowns,\n            yardsGained: result.yardsGained,\n            result: result.result,\n          },\n        }),\n      });\n      if (!res.ok) console.warn('[Blitz] Leaderboard submit failed:', res.status);\n    } catch {\n      // Leaderboard is non-critical  fail silently\n    }\n  }\n\n  /** Select a play by ID (legacy) */\n  public selectPlay(playId: string): void {\n    const plays = getAllOffensivePlays();\n    const play = plays.find((p) => p.id === playId);\n    if (play) {\n      this.selectedPlay = play;\n      this.gameState.currentPlay = play;\n    }\n  }\n\n  /** Set play directly from PlaybookSystem selection */\n  public setSelectedPlay(play: OffensivePlay): void {\n    this.selectedPlay = play;\n    this.gameState.currentPlay = play;\n  }\n\n  /** Trigger snap from external UI */\n  public triggerSnap(): void {\n    if (this.gameState.phase === 'pre_snap' && !this.isGameOver) {\n      this.snapBall();\n    }\n  }\n\n  /** Get current game state */\n  public getGameState(): BlitzGameState {\n    return { ...this.gameState };\n  }\n\n  /** Expose ScoreSystem for external UI reads */\n  public getScoreSystem(): ScoreSystem {\n    return this.scoreSystem;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Special Moves (called from InputSystem events)\n  // ---------------------------------------------------------------------------\n\n  /** Juke: lateral burst in the given direction. Awards points on success. */\n  public performJuke(direction: Vector3): void {\n    if (this.gameState.phase !== 'play_active' || !this.ballCarrierId) return;\n    if (!this.playerController) return;\n\n    // Apply lateral velocity burst\n    const jukeStrength = 8;\n    const pos = this.playerController.getPosition();\n    const lateralOffset = direction.normalize().scale(jukeStrength * 0.15);\n    this.playerController.setPosition(pos.add(lateralOffset));\n\n    this.gameState.jukes++;\n    this.gameState.score += SCORING.juke;\n    this.audioManager?.playSFX('juke');\n\n    if (this.turfSpray) {\n      this.turfSpray.emitter = this.playerController!.getPosition().clone();\n      this.turfSpray.start();\n      setTimeout(() => this.turfSpray?.stop(), 200);\n    }\n  }\n\n  /** Spin move: brief rotation + speed burst. */\n  public performSpin(): void {\n    if (this.gameState.phase !== 'play_active' || !this.ballCarrierId) return;\n    if (!this.playerController) return;\n\n    // Briefly boost forward speed\n    const pos = this.playerController.getPosition();\n    const rot = this.playerController.getRotation();\n    const forward = new Vector3(Math.sin(rot), 0, Math.cos(rot));\n    this.playerController.setPosition(pos.add(forward.scale(1.5)));\n\n    this.gameState.score += SCORING.juke; // reuse juke scoring for now\n    this.audioManager?.playSFX('juke');\n\n    if (this.turfSpray) {\n      this.turfSpray.emitter = this.playerController!.getPosition().clone();\n      this.turfSpray.start();\n      setTimeout(() => this.turfSpray?.stop(), 200);\n    }\n  }\n\n  /** Truck stick: power through a tackle attempt. */\n  public performTruck(): void {\n    if (this.gameState.phase !== 'play_active' || !this.ballCarrierId) return;\n    if (!this.playerController) return;\n\n    this.gameState.stiffArms++;\n    this.gameState.score += SCORING.stiffArm;\n    this.audioManager?.playSFX('stiff_arm');\n  }\n\n  /** Dive forward: lunge for extra yardage, ends the play. */\n  public performDive(direction: Vector3): void {\n    if (this.gameState.phase !== 'play_active' || !this.ballCarrierId) return;\n    if (!this.playerController) return;\n\n    const pos = this.playerController.getPosition();\n    const diveVector = direction.length() > 0 ? direction.normalize() : new Vector3(0, 0, 1);\n    this.playerController.setPosition(pos.add(diveVector.scale(3)));\n\n    // Dive ends the play\n    this.endPlay(false);\n  }\n\n  /** Call an audible  pick a new recommended play pre-snap */\n  public callAudible(): void {\n    if (this.gameState.phase !== 'pre_snap') return;\n    const driveState = this.driveSystem.getState();\n    const situation: GameSituation = {\n      down: driveState.down,\n      yardsToGo: driveState.yardsToGo,\n      yardLine: driveState.lineOfScrimmage,\n      scoreDiff: 0,\n      timeRemaining: this.gameState.timeRemaining / 1000,\n      quarter: 1,\n    };\n    const recs = this.playbookSystem.getPlayRecommendations(situation, 4);\n    // Pick a different play than current if possible\n    const alt = recs.find((p) => p.name !== this.selectedPlay?.name) ?? recs[0];\n    if (alt) {\n      this.setSelectedPlay(alt);\n      this.config.onPlayFeedback?.('AUDIBLE!', 'firstdown');\n    }\n  }\n\n  /** Change a receiver's route pre-snap (hot route) */\n  public setHotRoute(receiverIndex: number, routeType: RouteType): void {\n    if (this.gameState.phase !== 'pre_snap' || !this.selectedPlay) return;\n    const receiverIds = ['wr1', 'wr2', 'wr3', 'te', 'rb'];\n    const targetId = receiverIds[receiverIndex];\n    if (!targetId) return;\n\n    const route = this.selectedPlay.routes.find((r) => r.positionId === targetId);\n    if (route) {\n      (route as { routeType: RouteType }).routeType = routeType;\n    }\n  }\n\n  /** Pump fake  freezes defenders briefly */\n  public pumpFake(): void {\n    if (this.gameState.phase !== 'play_active' || this.ballCarrierId !== 'qb') return;\n    this.aiSystem.triggerReaction(0.4); // Defenders hesitate\n    this.config.onPlayFeedback?.('PUMP FAKE', 'firstdown');\n  }\n\n  /** Throw the ball away  intentional incompletion to avoid sack */\n  public throwAway(): void {\n    if (this.gameState.phase !== 'play_active' || this.ballCarrierId !== 'qb') return;\n    const qbPos = this.playerController?.getPosition();\n    if (qbPos && this.ball) {\n      // Throw to sideline\n      const sidelineTarget = new Vector3(\n        qbPos.x > 0 ? FIELD_CONFIG.width / 2 + 5 : -(FIELD_CONFIG.width / 2 + 5),\n        5,\n        qbPos.z + 10,\n      );\n      this.ball.throwTo(sidelineTarget, 'bullet', 0);\n    }\n    this.ballCarrierId = null;\n    this.scoreSystem.stopClock();\n    this.scoreSystem.recordPassAttempt('home', false, 0, false, false);\n    setTimeout(() => this.endPlay(true), 600);\n  }\n\n  private spawnMascot(): void {\n    SceneLoader.ImportMeshAsync('', '/assets/', 'blaze_mascot.glb', this.scene).then((result) => {\n      const mascotRoot = result.meshes[0];\n      mascotRoot.scaling = new Vector3(2, 2, 2);\n\n      // Position at end zone center\n      const startZ = (FIELD_CONFIG.length + FIELD_CONFIG.endZoneDepth * 2) / 2 + 5;\n      mascotRoot.position = new Vector3(0, 0, startZ);\n\n      // Animate running across end zone over 3 seconds\n      const startX = -15;\n      const endX = 15;\n      mascotRoot.position.x = startX;\n      const runStart = performance.now();\n      const runDuration = 3000;\n\n      const runInterval = setInterval(() => {\n        const elapsed = performance.now() - runStart;\n        const t = Math.min(elapsed / runDuration, 1);\n        mascotRoot.position.x = startX + (endX - startX) * t;\n\n        // Bobbing animation\n        mascotRoot.position.y = Math.abs(Math.sin(t * Math.PI * 6)) * 1.5;\n\n        if (t >= 1) {\n          clearInterval(runInterval);\n          this.pendingIntervals.delete(runInterval);\n\n          // Firework particle burst\n          const fireworks = new ParticleSystem('mascotFireworks', 500, this.scene);\n          fireworks.emitter = mascotRoot.position.clone();\n          fireworks.minSize = 0.1;\n          fireworks.maxSize = 0.4;\n          fireworks.minLifeTime = 0.5;\n          fireworks.maxLifeTime = 2.0;\n          fireworks.emitRate = 500;\n          fireworks.blendMode = ParticleSystem.BLENDMODE_ADD;\n          fireworks.direction1 = new Vector3(-5, 8, -5);\n          fireworks.direction2 = new Vector3(5, 15, 5);\n          fireworks.gravity = new Vector3(0, -9.8, 0);\n          fireworks.color1 = new Color4(1.0, 0.5, 0.0, 1.0); // Orange\n          fireworks.color2 = new Color4(1.0, 0.84, 0.0, 1.0); // Gold\n          fireworks.colorDead = new Color4(1.0, 0.2, 0.0, 0.0);\n          fireworks.createPointEmitter(new Vector3(-1, 0, -1), new Vector3(1, 1, 1));\n          fireworks.targetStopDuration = 2;\n          fireworks.disposeOnStop = true;\n          fireworks.start();\n\n          // Dispose mascot after fireworks\n          const mascotTimer = setTimeout(() => { this.pendingTimeouts.delete(mascotTimer); mascotRoot.dispose(); }, 2500);\n          this.pendingTimeouts.add(mascotTimer);\n        }\n      }, 16);\n      this.pendingIntervals.add(runInterval);\n    }).catch((err) => {\n      console.warn('Failed to load mascot:', err);\n    });\n  }\n\n  /** Dispose resources */\n  public dispose(): void {\n    this.isGameOver = true;\n\n    // Clear all tracked timers\n    for (const t of this.pendingTimeouts) clearTimeout(t);\n    this.pendingTimeouts.clear();\n    for (const i of this.pendingIntervals) clearInterval(i);\n    this.pendingIntervals.clear();\n\n    // Remove resize listener\n    if (this.resizeHandler) {\n      window.removeEventListener('resize', this.resizeHandler);\n      this.resizeHandler = null;\n    }\n\n    // Dispose camera target mesh\n    if (this.camera?.lockedTarget) {\n      (this.camera.lockedTarget as Mesh).dispose();\n    }\n\n    this.genieSystem?.dispose();\n    this.audioManager?.dispose();\n    this.field?.dispose();\n    this.ball?.dispose();\n    this.playerController?.dispose();\n    this.tackleParticles?.dispose();\n    this.touchdownParticles?.dispose();\n    this.turfSpray?.dispose();\n    this.speedLines?.dispose();\n    this.scene.dispose();\n    this.engine.dispose();\n  }\n}\n","/**\n * Blaze Blitz Football - Enhanced Input System\n *\n * State-machine-driven input handling for all play phases:\n * pre-snap audibles/hot routes, pocket passing, scramble, ball carrier moves.\n * Typed event emitter, configurable bindings, touch gesture support,\n * cooldown management on special moves.\n */\n\nimport { Vector3 } from '@babylonjs/core/Maths/math.vector';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** Current phase of play  determines which inputs are active. */\nexport type InputPhase = 'pre_snap' | 'pocket' | 'scramble' | 'ball_carrier';\n\n/** Every discrete action the input layer can emit. */\nexport type InputAction =\n  // Pre-snap\n  | 'select_receiver'\n  | 'hot_route_out'\n  | 'hot_route_in'\n  | 'hot_route_streak'\n  | 'hot_route_curl'\n  | 'audible'\n  // Post-snap QB\n  | 'throw'\n  | 'pump_fake'\n  | 'throw_away'\n  | 'move'\n  // Ball carrier\n  | 'juke'\n  | 'spin'\n  | 'truck'\n  | 'dive';\n\n/** Payload emitted with every input event. */\nexport interface InputEvent {\n  action: InputAction;\n  phase: InputPhase;\n  /** Movement direction (normalized) when relevant, otherwise zero. */\n  direction: Vector3;\n  /** 1-4 receiver index for select_receiver, undefined otherwise. */\n  receiverIndex?: number;\n  /** Timestamp (performance.now) of the event. */\n  timestamp: number;\n}\n\n/** Per-action key binding. Values are `KeyboardEvent.code` strings. */\nexport interface KeyBindings {\n  moveUp: string;\n  moveDown: string;\n  moveLeft: string;\n  moveRight: string;\n  selectReceiver1: string;\n  selectReceiver2: string;\n  selectReceiver3: string;\n  selectReceiver4: string;\n  audible: string;\n  pumpFake: string;\n  throwAway: string;\n  juke: string;\n  spin: string;\n  truck: string;\n  dive: string;\n}\n\n/** Cooldown durations (seconds) for special moves. */\nexport interface CooldownConfig {\n  juke: number;\n  spin: number;\n  truck: number;\n}\n\n/** Full InputSystem configuration. */\nexport interface InputConfig {\n  bindings: KeyBindings;\n  cooldowns: CooldownConfig;\n  /** Minimum swipe distance in px to register a touch gesture. */\n  swipeThreshold: number;\n  /** Enable touch/gesture controls. */\n  touchEnabled: boolean;\n}\n\n// ---------------------------------------------------------------------------\n// Defaults\n// ---------------------------------------------------------------------------\n\nconst DEFAULT_BINDINGS: KeyBindings = {\n  moveUp: 'KeyW',\n  moveDown: 'KeyS',\n  moveLeft: 'KeyA',\n  moveRight: 'KeyD',\n  selectReceiver1: 'Digit1',\n  selectReceiver2: 'Digit2',\n  selectReceiver3: 'Digit3',\n  selectReceiver4: 'Digit4',\n  audible: 'KeyA',\n  pumpFake: 'KeyR',\n  throwAway: 'Space',\n  juke: 'KeyJ',\n  spin: 'KeyK',\n  truck: 'KeyL',\n  dive: 'Space',\n};\n\nconst DEFAULT_COOLDOWNS: CooldownConfig = {\n  juke: 0.8,\n  spin: 1.2,\n  truck: 1.5,\n};\n\nconst DEFAULT_CONFIG: InputConfig = {\n  bindings: DEFAULT_BINDINGS,\n  cooldowns: DEFAULT_COOLDOWNS,\n  swipeThreshold: 40,\n  touchEnabled: true,\n};\n\n// ---------------------------------------------------------------------------\n// Typed event emitter\n// ---------------------------------------------------------------------------\n\ntype Listener = (event: InputEvent) => void;\n\n/** Map of action -> array of listeners for typed dispatch. */\ntype ListenerMap = { [A in InputAction]?: Listener[] };\n\n// ---------------------------------------------------------------------------\n// InputSystem\n// ---------------------------------------------------------------------------\n\nexport class InputSystem {\n  private phase: InputPhase = 'pre_snap';\n  private config: InputConfig;\n\n  // Key tracking\n  private keysDown = new Set<string>();\n\n  // Cooldown trackers (seconds remaining)\n  private cooldowns: Record<'juke' | 'spin' | 'truck', number> = {\n    juke: 0,\n    spin: 0,\n    truck: 0,\n  };\n\n  // Movement vector rebuilt each frame from held keys\n  private moveDirection = Vector3.Zero();\n\n  // Event listeners\n  private listeners: ListenerMap = {};\n  private globalListeners: Listener[] = [];\n\n  // Touch state\n  private touchStartX = 0;\n  private touchStartY = 0;\n  private touchStartTime = 0;\n\n  // Bound handler refs for cleanup\n  private handleKeyDown: (e: KeyboardEvent) => void;\n  private handleKeyUp: (e: KeyboardEvent) => void;\n  private handlePointerDown: (e: PointerEvent) => void;\n  private handlePointerUp: (e: PointerEvent) => void;\n  private handleContextMenu: (e: Event) => void;\n\n  constructor(\n    private canvas: HTMLCanvasElement,\n    config?: Partial<InputConfig>,\n  ) {\n    this.config = {\n      ...DEFAULT_CONFIG,\n      ...config,\n      bindings: { ...DEFAULT_BINDINGS, ...config?.bindings },\n      cooldowns: { ...DEFAULT_COOLDOWNS, ...config?.cooldowns },\n    };\n\n    this.handleKeyDown = this.onKeyDown.bind(this);\n    this.handleKeyUp = this.onKeyUp.bind(this);\n    this.handlePointerDown = this.onPointerDown.bind(this);\n    this.handlePointerUp = this.onPointerUp.bind(this);\n    this.handleContextMenu = (e: Event) => e.preventDefault();\n\n    this.attach();\n  }\n\n  // -----------------------------------------------------------------------\n  // Public API\n  // -----------------------------------------------------------------------\n\n  /** Transition to a new input phase. Clears held keys to avoid stale state. */\n  setPhase(phase: InputPhase): void {\n    this.phase = phase;\n    this.keysDown.clear();\n    this.moveDirection.setAll(0);\n  }\n\n  getPhase(): InputPhase {\n    return this.phase;\n  }\n\n  /** Subscribe to a specific action. Returns an unsubscribe function. */\n  on(action: InputAction, listener: Listener): () => void {\n    const list = this.listeners[action] ?? (this.listeners[action] = []);\n    list.push(listener);\n    return () => {\n      const idx = list.indexOf(listener);\n      if (idx !== -1) list.splice(idx, 1);\n    };\n  }\n\n  /** Subscribe to all actions. Returns an unsubscribe function. */\n  onAny(listener: Listener): () => void {\n    this.globalListeners.push(listener);\n    return () => {\n      const idx = this.globalListeners.indexOf(listener);\n      if (idx !== -1) this.globalListeners.splice(idx, 1);\n    };\n  }\n\n  /** Call once per frame with delta time (seconds). Ticks cooldowns & emits move. */\n  update(dt: number): void {\n    // Tick cooldowns\n    for (const key of ['juke', 'spin', 'truck'] as const) {\n      if (this.cooldowns[key] > 0) {\n        this.cooldowns[key] = Math.max(0, this.cooldowns[key] - dt);\n      }\n    }\n\n    // Rebuild move direction from held keys\n    this.rebuildMoveDirection();\n\n    // Emit continuous move event when direction is non-zero\n    if (this.moveDirection.lengthSquared() > 0.001) {\n      if (this.phase !== 'pre_snap') {\n        this.emit('move', this.moveDirection.clone());\n      }\n    }\n  }\n\n  /** Current normalized movement direction (read-only copy). */\n  getMoveDirection(): Vector3 {\n    return this.moveDirection.clone();\n  }\n\n  /** Whether a special-move cooldown is still active. */\n  isOnCooldown(move: 'juke' | 'spin' | 'truck'): boolean {\n    return this.cooldowns[move] > 0;\n  }\n\n  /** Remaining cooldown in seconds. */\n  getCooldown(move: 'juke' | 'spin' | 'truck'): number {\n    return this.cooldowns[move];\n  }\n\n  /** Hot-swap key bindings at runtime. */\n  setBindings(bindings: Partial<KeyBindings>): void {\n    Object.assign(this.config.bindings, bindings);\n  }\n\n  /** Detach all DOM listeners. Call on teardown. */\n  dispose(): void {\n    this.detach();\n    this.listeners = {};\n    this.globalListeners = [];\n  }\n\n  // -----------------------------------------------------------------------\n  // DOM attachment\n  // -----------------------------------------------------------------------\n\n  private attach(): void {\n    window.addEventListener('keydown', this.handleKeyDown);\n    window.addEventListener('keyup', this.handleKeyUp);\n    this.canvas.addEventListener('pointerdown', this.handlePointerDown);\n    this.canvas.addEventListener('pointerup', this.handlePointerUp);\n    this.canvas.addEventListener('contextmenu', this.handleContextMenu);\n  }\n\n  private detach(): void {\n    window.removeEventListener('keydown', this.handleKeyDown);\n    window.removeEventListener('keyup', this.handleKeyUp);\n    this.canvas.removeEventListener('pointerdown', this.handlePointerDown);\n    this.canvas.removeEventListener('pointerup', this.handlePointerUp);\n    this.canvas.removeEventListener('contextmenu', this.handleContextMenu);\n  }\n\n  // -----------------------------------------------------------------------\n  // Keyboard handling\n  // -----------------------------------------------------------------------\n\n  private onKeyDown(e: KeyboardEvent): void {\n    if (e.repeat) return;\n    this.keysDown.add(e.code);\n\n    const b = this.config.bindings;\n\n    switch (this.phase) {\n      case 'pre_snap':\n        this.handlePreSnapKey(e.code, b);\n        break;\n      case 'pocket':\n        this.handlePocketKey(e.code, b);\n        break;\n      case 'scramble':\n        this.handleScrambleKey(e.code, b);\n        break;\n      case 'ball_carrier':\n        this.handleBallCarrierKey(e.code, b);\n        break;\n    }\n  }\n\n  private onKeyUp(e: KeyboardEvent): void {\n    this.keysDown.delete(e.code);\n  }\n\n  // -- Pre-snap --------------------------------------------------------\n\n  private handlePreSnapKey(code: string, b: KeyBindings): void {\n    if (code === b.selectReceiver1) return this.emit('select_receiver', Vector3.Zero(), 1);\n    if (code === b.selectReceiver2) return this.emit('select_receiver', Vector3.Zero(), 2);\n    if (code === b.selectReceiver3) return this.emit('select_receiver', Vector3.Zero(), 3);\n    if (code === b.selectReceiver4) return this.emit('select_receiver', Vector3.Zero(), 4);\n\n    // Hot route directions (arrow keys always active for hot routes pre-snap)\n    if (code === 'ArrowLeft')  return this.emit('hot_route_out', Vector3.Left());\n    if (code === 'ArrowRight') return this.emit('hot_route_in', Vector3.Right());\n    if (code === 'ArrowUp')    return this.emit('hot_route_streak', Vector3.Forward());\n    if (code === 'ArrowDown')  return this.emit('hot_route_curl', Vector3.Backward());\n\n    // WASD hot routes (only when not colliding with audible  'A' dual-mapped)\n    if (code === b.moveLeft && code === b.audible) {\n      // 'A' key: audible takes priority pre-snap\n      return this.emit('audible', Vector3.Zero());\n    }\n    if (code === b.audible) return this.emit('audible', Vector3.Zero());\n\n    // WASD as hot route fallback (if keys differ from audible)\n    if (code === b.moveLeft)  return this.emit('hot_route_out', Vector3.Left());\n    if (code === b.moveRight) return this.emit('hot_route_in', Vector3.Right());\n    if (code === b.moveUp)    return this.emit('hot_route_streak', Vector3.Forward());\n    if (code === b.moveDown)  return this.emit('hot_route_curl', Vector3.Backward());\n  }\n\n  // -- Pocket ----------------------------------------------------------\n\n  private handlePocketKey(code: string, b: KeyBindings): void {\n    if (code === b.pumpFake) return this.emit('pump_fake', Vector3.Zero());\n    if (code === b.throwAway) return this.emit('throw_away', Vector3.Zero());\n\n    // Receiver selection also valid in pocket\n    if (code === b.selectReceiver1) return this.emit('select_receiver', Vector3.Zero(), 1);\n    if (code === b.selectReceiver2) return this.emit('select_receiver', Vector3.Zero(), 2);\n    if (code === b.selectReceiver3) return this.emit('select_receiver', Vector3.Zero(), 3);\n    if (code === b.selectReceiver4) return this.emit('select_receiver', Vector3.Zero(), 4);\n    // Movement keys handled in update() via rebuildMoveDirection\n  }\n\n  // -- Scramble --------------------------------------------------------\n\n  private handleScrambleKey(code: string, b: KeyBindings): void {\n    // Still allow throws while scrambling\n    if (code === b.pumpFake) return this.emit('pump_fake', Vector3.Zero());\n    if (code === b.throwAway) return this.emit('throw_away', Vector3.Zero());\n    if (code === b.selectReceiver1) return this.emit('select_receiver', Vector3.Zero(), 1);\n    if (code === b.selectReceiver2) return this.emit('select_receiver', Vector3.Zero(), 2);\n    if (code === b.selectReceiver3) return this.emit('select_receiver', Vector3.Zero(), 3);\n    if (code === b.selectReceiver4) return this.emit('select_receiver', Vector3.Zero(), 4);\n  }\n\n  // -- Ball carrier ----------------------------------------------------\n\n  private handleBallCarrierKey(code: string, b: KeyBindings): void {\n    if (code === b.juke) return this.trySpecialMove('juke');\n    if (code === b.spin || code === 'ShiftLeft' || code === 'ShiftRight') {\n      return this.trySpecialMove('spin');\n    }\n    if (code === b.truck || code === 'ControlLeft' || code === 'ControlRight') {\n      return this.trySpecialMove('truck');\n    }\n    if (code === b.dive) return this.emit('dive', this.moveDirection.clone());\n  }\n\n  // -----------------------------------------------------------------------\n  // Pointer / touch handling\n  // -----------------------------------------------------------------------\n\n  private onPointerDown(e: PointerEvent): void {\n    this.touchStartX = e.clientX;\n    this.touchStartY = e.clientY;\n    this.touchStartTime = performance.now();\n\n    // Right-click = pump fake in passing phases\n    if (e.button === 2) {\n      if (this.phase === 'pocket' || this.phase === 'scramble') {\n        this.emit('pump_fake', Vector3.Zero());\n      }\n      return;\n    }\n\n    // Left-click in ball_carrier = juke\n    if (e.button === 0 && this.phase === 'ball_carrier') {\n      this.trySpecialMove('juke');\n    }\n  }\n\n  private onPointerUp(e: PointerEvent): void {\n    if (e.button !== 0) return;\n\n    const dx = e.clientX - this.touchStartX;\n    const dy = e.clientY - this.touchStartY;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n    const elapsed = performance.now() - this.touchStartTime;\n\n    // Swipe detection (touch gesture)\n    if (this.config.touchEnabled && dist > this.config.swipeThreshold) {\n      this.handleSwipe(dx, dy);\n      return;\n    }\n\n    // Tap = throw in passing phases\n    if (elapsed < 300 && dist < 10) {\n      if (this.phase === 'pocket' || this.phase === 'scramble') {\n        this.emit('throw', Vector3.Zero());\n      }\n    }\n  }\n\n  private handleSwipe(dx: number, dy: number): void {\n    const absDx = Math.abs(dx);\n    const absDy = Math.abs(dy);\n\n    // Determine primary direction\n    let direction: Vector3;\n    if (absDx > absDy) {\n      direction = dx > 0 ? Vector3.Right() : Vector3.Left();\n    } else {\n      direction = dy > 0 ? Vector3.Backward() : Vector3.Forward();\n    }\n\n    switch (this.phase) {\n      case 'pre_snap':\n        // Swipe = hot route in swipe direction\n        if (absDx > absDy) {\n          this.emit(dx > 0 ? 'hot_route_in' : 'hot_route_out', direction);\n        } else {\n          this.emit(dy < 0 ? 'hot_route_streak' : 'hot_route_curl', direction);\n        }\n        break;\n      case 'ball_carrier':\n        // Swipe = directional juke\n        this.trySpecialMove('juke', direction);\n        break;\n      default:\n        break;\n    }\n  }\n\n  // -----------------------------------------------------------------------\n  // Movement\n  // -----------------------------------------------------------------------\n\n  private rebuildMoveDirection(): void {\n    const b = this.config.bindings;\n    let x = 0;\n    let z = 0;\n\n    if (this.keysDown.has(b.moveLeft) || this.keysDown.has('ArrowLeft'))  x -= 1;\n    if (this.keysDown.has(b.moveRight) || this.keysDown.has('ArrowRight')) x += 1;\n    if (this.keysDown.has(b.moveUp) || this.keysDown.has('ArrowUp'))      z += 1;\n    if (this.keysDown.has(b.moveDown) || this.keysDown.has('ArrowDown'))   z -= 1;\n\n    this.moveDirection.set(x, 0, z);\n    if (this.moveDirection.lengthSquared() > 1) {\n      this.moveDirection.normalize();\n    }\n  }\n\n  // -----------------------------------------------------------------------\n  // Special moves with cooldown\n  // -----------------------------------------------------------------------\n\n  private trySpecialMove(\n    move: 'juke' | 'spin' | 'truck',\n    direction?: Vector3,\n  ): void {\n    if (this.cooldowns[move] > 0) return;\n\n    this.cooldowns[move] = this.config.cooldowns[move];\n    const dir = direction ?? this.moveDirection.clone();\n    this.emit(move, dir);\n  }\n\n  // -----------------------------------------------------------------------\n  // Event dispatch\n  // -----------------------------------------------------------------------\n\n  private emit(\n    action: InputAction,\n    direction: Vector3,\n    receiverIndex?: number,\n  ): void {\n    const event: InputEvent = {\n      action,\n      phase: this.phase,\n      direction,\n      receiverIndex,\n      timestamp: performance.now(),\n    };\n\n    const actionListeners = this.listeners[action];\n    if (actionListeners) {\n      for (let i = 0; i < actionListeners.length; i++) {\n        actionListeners[i](event);\n      }\n    }\n    for (let i = 0; i < this.globalListeners.length; i++) {\n      this.globalListeners[i](event);\n    }\n  }\n}\n","/**\n * Blaze Blitz - Main Entry Point\n *\n * Initializes the game and handles UI interactions\n */\n\nimport { BlitzGameEngine, BlitzGameState, BlitzGameResult } from '@core/BlitzGameEngine';\nimport { FIREBIRDS, SHADOW_WOLVES, getPlayableTeams, BlitzTeam } from '@data/teams';\nimport { PlaybookSystem, type FormationType, type EnhancedOffensivePlay, type GameSituation } from '@core/PlaybookSystem';\nimport { DriveSystem } from '@core/DriveSystem';\nimport { InputSystem } from '@core/InputSystem';\nimport { ScoreSystem } from '@core/ScoreSystem';\n\n/** Player ID management */\nfunction getPlayerId(): string {\n  let playerId = localStorage.getItem('blitz_player_id');\n  if (!playerId) {\n    playerId = `player_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n    localStorage.setItem('blitz_player_id', playerId);\n  }\n  return playerId;\n}\n\n/** Get stored high score */\nfunction getHighScore(): number {\n  return parseInt(localStorage.getItem('blitz_high_score') || '0', 10);\n}\n\n/** Save high score */\nfunction saveHighScore(score: number): void {\n  const current = getHighScore();\n  if (score > current) {\n    localStorage.setItem('blitz_high_score', score.toString());\n  }\n}\n\n/** Get stored player name */\nfunction getPlayerName(): string {\n  return localStorage.getItem('blitz_player_name') || '';\n}\n\n/** Save player name */\nfunction savePlayerName(name: string): void {\n  localStorage.setItem('blitz_player_name', name);\n}\n\n/** Store the last game result for sharing */\nlet lastGameResult: BlitzGameResult | null = null;\n\n/** UI Elements */\nconst elements = {\n  loadingScreen: document.getElementById('loadingScreen')!,\n  menuScreen: document.getElementById('menuScreen')!,\n  renderCanvas: document.getElementById('renderCanvas') as HTMLCanvasElement,\n  gameUI: document.getElementById('gameUI')!,\n  driveInfo: document.getElementById('driveInfo')!,\n  staminaBar: document.getElementById('staminaBar')!,\n  gameOverScreen: document.getElementById('gameOverScreen')!,\n\n  // Menu\n  highScore: document.getElementById('highScore')!,\n  teamSelect: document.getElementById('teamSelect')!,\n  playButton: document.getElementById('playButton')!,\n\n  // Game UI\n  score: document.getElementById('score')!,\n  timer: document.getElementById('timer')!,\n  down: document.getElementById('down')!,\n  yards: document.getElementById('yards')!,\n  driveText: document.getElementById('driveText')!,\n  staminaFill: document.getElementById('staminaFill')!,\n\n  // Feedback\n  playFeedback: document.getElementById('playFeedback')!,\n\n  // Game Over\n  gameOverResult: document.getElementById('gameOverResult')!,\n  finalScore: document.getElementById('finalScore')!,\n  gameStats: document.getElementById('gameStats')!,\n  leaderboard: document.getElementById('leaderboard')!,\n  playAgainButton: document.getElementById('playAgainButton')!,\n  menuButton: document.getElementById('menuButton')!,\n\n  // Name and Share\n  playerNameInput: document.getElementById('playerNameInput') as HTMLInputElement,\n  saveNameBtn: document.getElementById('saveNameBtn')!,\n  shareXBtn: document.getElementById('shareXBtn') as HTMLAnchorElement,\n  copyLinkBtn: document.getElementById('copyLinkBtn')!,\n\n  // New HUD elements\n  playClock: document.getElementById('playClock')!,\n  playClockText: document.getElementById('playClockText')!,\n  scoreTicker: document.getElementById('scoreTicker')!,\n  homeTeamName: document.getElementById('homeTeamName')!,\n  homeTeamScore: document.getElementById('homeTeamScore')!,\n  awayTeamScore: document.getElementById('awayTeamScore')!,\n  awayTeamName: document.getElementById('awayTeamName')!,\n  quarterDisplay: document.getElementById('quarterDisplay')!,\n  playCallOverlay: document.getElementById('playCallOverlay')!,\n  formationPicker: document.getElementById('formationPicker')!,\n  playPicker: document.getElementById('playPicker')!,\n  moveIndicators: document.getElementById('moveIndicators')!,\n  jukeReady: document.getElementById('jukeReady')!,\n  spinReady: document.getElementById('spinReady')!,\n  truckReady: document.getElementById('truckReady')!,\n};\n\n/** Game state */\nlet gameEngine: BlitzGameEngine | null = null;\nlet selectedTeam: BlitzTeam = FIREBIRDS;\nlet lastFeedback: string = '';\nlet feedbackTimeout: number | null = null;\nconst playbook = new PlaybookSystem();\nlet inputSystem: InputSystem | null = null;\nlet scoreSystem: ScoreSystem | null = null;\nlet cooldownRaf: number | null = null;\nlet selectedFormation: FormationType = 'shotgun';\nlet playClockInterval: number | null = null;\nlet playClockSeconds = 25;\n\n//  Play Call UI \n\nfunction renderFormationPicker(): void {\n  const container = elements.formationPicker;\n  while (container.firstChild) container.removeChild(container.firstChild);\n\n  const formations: Array<{ id: FormationType; label: string }> = [\n    { id: 'shotgun', label: 'Shotgun' },\n    { id: 'iform', label: 'I-Form' },\n    { id: 'trips', label: 'Trips' },\n    { id: 'spread', label: 'Spread' },\n    { id: 'singleback', label: 'Singleback' },\n  ];\n\n  for (const f of formations) {\n    const btn = document.createElement('button');\n    btn.textContent = f.label;\n    btn.style.cssText = `font-family:'Russo One',sans-serif;font-size:0.75rem;padding:0.375rem 0.75rem;border:2px solid ${f.id === selectedFormation ? 'var(--arcade-neon-green)' : 'rgba(255,255,255,0.2)'};background:${f.id === selectedFormation ? 'rgba(57,255,20,0.15)' : 'rgba(255,255,255,0.05)'};color:${f.id === selectedFormation ? 'var(--arcade-neon-green)' : 'rgba(255,255,255,0.6)'};cursor:pointer;text-transform:uppercase;letter-spacing:0.05em;transition:all 0.15s;`;\n    btn.addEventListener('click', () => {\n      selectedFormation = f.id;\n      renderFormationPicker();\n      renderPlayPicker();\n    });\n    container.appendChild(btn);\n  }\n}\n\nfunction renderPlayPicker(): void {\n  const container = elements.playPicker;\n  while (container.firstChild) container.removeChild(container.firstChild);\n\n  const plays = playbook.getPlaysForFormation(selectedFormation);\n\n  for (const play of plays) {\n    const card = document.createElement('button');\n    card.style.cssText = `display:flex;flex-direction:column;align-items:center;padding:0.5rem 0.75rem;border:2px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);cursor:pointer;transition:all 0.15s;min-width:90px;`;\n    const name = document.createElement('span');\n    name.textContent = play.name;\n    name.style.cssText = `font-family:'Russo One',sans-serif;font-size:0.6875rem;color:var(--arcade-yellow);text-transform:uppercase;`;\n    const desc = document.createElement('span');\n    desc.textContent = play.description ?? '';\n    desc.style.cssText = `font-size:0.5rem;color:rgba(255,255,255,0.35);margin-top:2px;`;\n    card.appendChild(name);\n    card.appendChild(desc);\n\n    card.addEventListener('mouseenter', () => {\n      card.style.borderColor = 'var(--arcade-yellow)';\n      card.style.background = 'rgba(255,215,0,0.1)';\n    });\n    card.addEventListener('mouseleave', () => {\n      card.style.borderColor = 'rgba(255,255,255,0.15)';\n      card.style.background = 'rgba(255,255,255,0.05)';\n    });\n    card.addEventListener('click', () => {\n      selectPlay(play);\n    });\n\n    container.appendChild(card);\n  }\n}\n\nfunction selectPlay(play: EnhancedOffensivePlay): void {\n  elements.playCallOverlay.style.display = 'none';\n  if (gameEngine) {\n    gameEngine.setSelectedPlay(play);\n    gameEngine.triggerSnap();\n  }\n  stopPlayClock();\n}\n\nfunction showPlayCallUI(): void {\n  renderFormationPicker();\n  renderPlayPicker();\n  elements.playCallOverlay.style.display = 'flex';\n  resetPlayClock();\n}\n\nfunction hidePlayCallUI(): void {\n  elements.playCallOverlay.style.display = 'none';\n  stopPlayClock();\n}\n\nfunction resetPlayClock(): void {\n  playClockSeconds = 25;\n  elements.playClockText.textContent = '25';\n  elements.playClock.style.display = 'block';\n  stopPlayClock();\n  playClockInterval = window.setInterval(() => {\n    playClockSeconds--;\n    elements.playClockText.textContent = String(playClockSeconds);\n    if (playClockSeconds <= 5) {\n      elements.playClockText.style.color = 'var(--arcade-hot-pink)';\n    }\n    if (playClockSeconds <= 0) {\n      stopPlayClock();\n      // Auto-select recommended play\n      const situation: GameSituation = { down: 1, yardsToGo: 10, yardLine: 75, scoreDiff: 0, timeRemaining: 120, quarter: 1 };\n      const recs = playbook.getPlayRecommendations(situation, 1);\n      if (recs.length > 0) selectPlay(recs[0]);\n    }\n  }, 1000);\n}\n\nfunction startPlayClock(): void {\n  // Clock already running from showPlayCallUI\n}\n\nfunction stopPlayClock(): void {\n  if (playClockInterval !== null) {\n    clearInterval(playClockInterval);\n    playClockInterval = null;\n  }\n  elements.playClockText.style.color = 'var(--arcade-yellow)';\n}\n\n/** Initialize the application */\nasync function init(): Promise<void> {\n  // Show high score\n  elements.highScore.textContent = getHighScore().toLocaleString();\n\n  // Populate team selection\n  populateTeamSelect();\n\n  // Setup event listeners\n  setupEventListeners();\n\n  // Hide loading, show menu\n  elements.loadingScreen.style.display = 'none';\n  elements.menuScreen.style.display = 'flex';\n\n  // Add \"Back to Arcade\" link\n  const arcadeLink = document.createElement('a');\n  arcadeLink.href = '/mini-games';\n  arcadeLink.textContent = '\\u2190 Back to Arcade';\n  arcadeLink.style.cssText = 'position:fixed;top:8px;left:12px;color:#888;font-size:12px;text-decoration:none;z-index:9999;font-family:sans-serif;';\n  arcadeLink.addEventListener('mouseenter', () => { arcadeLink.style.color = '#bf5700'; });\n  arcadeLink.addEventListener('mouseleave', () => { arcadeLink.style.color = '#888'; });\n  document.body.appendChild(arcadeLink);\n}\n\n/** Populate team selection grid */\nfunction populateTeamSelect(): void {\n  const teams = getPlayableTeams();\n\n  teams.forEach((team, index) => {\n    const card = document.createElement('div');\n    card.className = 'team-card' + (index === 0 ? ' selected' : '');\n    card.dataset.teamId = team.id;\n\n    card.innerHTML = `\n      <div class=\"team-logo\" style=\"background-color: ${team.primaryColor}; box-shadow: 0 0 15px ${team.primaryColor};\">\n        ${team.shortName.charAt(0)}\n      </div>\n      <div class=\"team-name\" style=\"color: ${team.primaryColor};\">${team.name}</div>\n      <div class=\"team-stats\">\n        <span>OFF ${team.offense}</span>\n        <span>DEF ${team.defense}</span>\n        <span>SPD ${team.speed}</span>\n      </div>\n    `;\n\n    card.addEventListener('click', () => {\n      // Deselect all\n      document.querySelectorAll('.team-card').forEach((c) => c.classList.remove('selected'));\n      // Select this one\n      card.classList.add('selected');\n      selectedTeam = team;\n    });\n\n    elements.teamSelect.appendChild(card);\n  });\n}\n\n/** Setup event listeners */\nfunction setupEventListeners(): void {\n  // Play button\n  elements.playButton.addEventListener('click', startGame);\n\n  // Play again button\n  elements.playAgainButton.addEventListener('click', startGame);\n\n  // Menu button\n  elements.menuButton.addEventListener('click', showMenu);\n\n  // Save name button\n  elements.saveNameBtn.addEventListener('click', handleSaveName);\n\n  // Copy link button\n  elements.copyLinkBtn.addEventListener('click', handleCopyLink);\n\n  // Pre-fill name input if saved\n  const savedName = getPlayerName();\n  if (savedName) {\n    elements.playerNameInput.value = savedName;\n  }\n}\n\n/** Handle saving player name */\nasync function handleSaveName(): Promise<void> {\n  const name = elements.playerNameInput.value.trim();\n  if (!name) return;\n\n  // Save locally\n  savePlayerName(name);\n\n  // Update on server\n  try {\n    elements.saveNameBtn.textContent = 'Saving...';\n    elements.saveNameBtn.setAttribute('disabled', 'true');\n\n    await fetch('/api/blitz/submit-score', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        playerId: getPlayerId(),\n        playerName: name,\n        score: lastGameResult?.finalScore || 0,\n        teamId: lastGameResult?.teamId || selectedTeam.id,\n        stats: {\n          yardsGained: lastGameResult?.yardsGained || 0,\n          touchdowns: lastGameResult?.touchdowns || 0,\n          firstDowns: lastGameResult?.firstDowns || 0,\n          bigPlays: lastGameResult?.bigPlays || 0,\n          turnovers: lastGameResult?.turnovers || 0,\n          tacklesMade: lastGameResult?.tacklesMade || 0,\n          stiffArms: lastGameResult?.stiffArms || 0,\n          jukes: lastGameResult?.jukes || 0,\n          turboYards: lastGameResult?.turboYards || 0,\n          longestPlay: lastGameResult?.longestPlay || 0,\n          durationSeconds: lastGameResult?.durationSeconds || 0,\n          result: lastGameResult?.result || 'incomplete',\n        },\n      }),\n    });\n\n    elements.saveNameBtn.textContent = 'Saved!';\n\n    // Refresh leaderboard to show updated name\n    const response = await fetch('/api/blitz/leaderboard?limit=5');\n    if (response.ok) {\n      const data = (await response.json()) as { success: boolean; entries?: Array<{ rank: number; playerName: string; score: number }> };\n\n      if (data.success && data.entries) {\n        const container = elements.leaderboard;\n        container.textContent = '';\n\n        const title = document.createElement('div');\n        title.className = 'leaderboard-title';\n        title.textContent = 'Top Scores';\n        container.appendChild(title);\n\n        for (const entry of data.entries) {\n          const row = document.createElement('div');\n          row.className = 'leaderboard-entry';\n          const rank = document.createElement('span');\n          rank.className = 'rank';\n          rank.textContent = `#${entry.rank}`;\n          const player = document.createElement('span');\n          player.className = 'player';\n          player.textContent = entry.playerName || 'Anonymous';\n          const score = document.createElement('span');\n          score.className = 'lb-score';\n          score.textContent = entry.score.toLocaleString();\n          row.appendChild(rank);\n          row.appendChild(player);\n          row.appendChild(score);\n          container.appendChild(row);\n        }\n      }\n    }\n  } catch (error) {\n    console.error('Failed to save name:', error);\n    elements.saveNameBtn.textContent = 'Error';\n  } finally {\n    setTimeout(() => {\n      elements.saveNameBtn.textContent = 'Save Name';\n      elements.saveNameBtn.removeAttribute('disabled');\n    }, 2000);\n  }\n}\n\n/** Handle copying share link */\nfunction handleCopyLink(): void {\n  const score = lastGameResult?.finalScore || 0;\n  const shareUrl = `https://blaze-blitz-football.pages.dev?ref=share&score=${score}`;\n\n  navigator.clipboard.writeText(shareUrl).then(() => {\n    elements.copyLinkBtn.classList.add('copied');\n    elements.copyLinkBtn.innerHTML = '<span></span> Copied!';\n\n    setTimeout(() => {\n      elements.copyLinkBtn.classList.remove('copied');\n      elements.copyLinkBtn.innerHTML = '<span></span> Copy Link';\n    }, 2000);\n  }).catch(() => {\n    // Fallback for older browsers\n    const textArea = document.createElement('textarea');\n    textArea.value = shareUrl;\n    document.body.appendChild(textArea);\n    textArea.select();\n    document.execCommand('copy');\n    document.body.removeChild(textArea);\n\n    elements.copyLinkBtn.classList.add('copied');\n    elements.copyLinkBtn.innerHTML = '<span></span> Copied!';\n\n    setTimeout(() => {\n      elements.copyLinkBtn.classList.remove('copied');\n      elements.copyLinkBtn.innerHTML = '<span></span> Copy Link';\n    }, 2000);\n  });\n}\n\n/** Start the game */\nasync function startGame(): Promise<void> {\n  // Hide menus\n  elements.menuScreen.style.display = 'none';\n  elements.gameOverScreen.style.display = 'none';\n\n  // Show game elements\n  elements.renderCanvas.style.display = 'block';\n  elements.gameUI.style.display = 'flex';\n  elements.driveInfo.style.display = 'block';\n  elements.staminaBar.style.display = 'block';\n  elements.scoreTicker.style.display = 'block';\n  elements.moveIndicators.style.display = 'flex';\n\n  // Set team names in score ticker\n  elements.homeTeamName.textContent = selectedTeam.shortName;\n  elements.awayTeamName.textContent = 'WOLVES';\n  elements.homeTeamScore.textContent = '0';\n  elements.awayTeamScore.textContent = '0';\n  elements.quarterDisplay.textContent = 'Q1';\n\n  // Dispose existing systems\n  if (inputSystem) { inputSystem.dispose(); inputSystem = null; }\n  if (cooldownRaf !== null) { cancelAnimationFrame(cooldownRaf); cooldownRaf = null; }\n  scoreSystem = new ScoreSystem({ quarterLengthSec: 90, playClockSec: 25 });\n\n  // Dispose existing engine if any\n  if (gameEngine) {\n    gameEngine.dispose();\n  }\n\n  // Create new game engine\n  gameEngine = await BlitzGameEngine.create({\n    canvas: elements.renderCanvas,\n    homeTeam: selectedTeam,\n    awayTeam: SHADOW_WOLVES,\n    onGameStateChange: handleGameStateChange,\n    onGameOver: handleGameOver,\n    onPlayFeedback: (text, style) => showFeedback(text, `feedback-${style}`),\n  });\n\n  // Unlock audio (requires user interaction - we have it from button click)\n  await gameEngine.unlockAudio();\n\n  // Start the game\n  gameEngine.startGame();\n\n  // Create InputSystem after engine so canvas is sized\n  inputSystem = new InputSystem(elements.renderCanvas);\n  inputSystem.setPhase('pre_snap');\n\n  // Wire InputSystem events  engine\n  // throw/select_receiver still handled by engine's own polling in updatePlayActive.\n  // Special moves use new public methods on the engine.\n  inputSystem.on('juke', (e) => gameEngine?.performJuke(e.direction));\n  inputSystem.on('spin', () => gameEngine?.performSpin());\n  inputSystem.on('truck', () => gameEngine?.performTruck());\n  inputSystem.on('dive', (e) => gameEngine?.performDive(e.direction));\n  inputSystem.on('audible', () => gameEngine?.callAudible());\n  inputSystem.on('pump_fake', () => gameEngine?.pumpFake());\n  inputSystem.on('throw_away', () => gameEngine?.throwAway());\n  inputSystem.on('hot_route_out', (e) => gameEngine?.setHotRoute(e.receiverIndex ?? 0, 'out'));\n  inputSystem.on('hot_route_in', (e) => gameEngine?.setHotRoute(e.receiverIndex ?? 0, 'in'));\n  inputSystem.on('hot_route_streak', (e) => gameEngine?.setHotRoute(e.receiverIndex ?? 0, 'streak'));\n  inputSystem.on('hot_route_curl', (e) => gameEngine?.setHotRoute(e.receiverIndex ?? 0, 'curl'));\n\n  // Cooldown indicator loop\n  let lastTime = performance.now();\n  const updateCooldowns = () => {\n    const now = performance.now();\n    const dt = (now - lastTime) / 1000;\n    lastTime = now;\n\n    if (inputSystem) {\n      inputSystem.update(dt);\n\n      // Update cooldown indicators\n      elements.jukeReady.style.opacity = inputSystem.isOnCooldown('juke') ? '0.3' : '1';\n      elements.spinReady.style.opacity = inputSystem.isOnCooldown('spin') ? '0.3' : '1';\n      elements.truckReady.style.opacity = inputSystem.isOnCooldown('truck') ? '0.3' : '1';\n    }\n\n    cooldownRaf = requestAnimationFrame(updateCooldowns);\n  };\n  cooldownRaf = requestAnimationFrame(updateCooldowns);\n}\n\n/** Handle game state changes */\nfunction handleGameStateChange(state: BlitzGameState): void {\n  // Update score\n  elements.score.textContent = state.score.toLocaleString();\n\n  // Update timer\n  const seconds = Math.ceil(state.timeRemaining / 1000);\n  elements.timer.textContent = seconds.toString();\n  elements.timer.classList.toggle('timer-warning', seconds <= 10);\n\n  // Update down\n  const downText = ['1st', '2nd', '3rd', '4th'][state.down - 1] || '4th';\n  elements.down.textContent = downText;\n\n  // Update yards\n  elements.yards.textContent = state.yardsGained.toString();\n\n  // Update drive info\n  const yardLine = state.lineOfScrimmage;\n  const sideText = yardLine <= 50 ? 'OWN' : 'OPP';\n  const displayYardLine = yardLine <= 50 ? yardLine : 100 - yardLine;\n  elements.driveText.textContent = `${downText} & ${state.yardsToGo} at ${sideText} ${displayYardLine}`;\n\n  // Update score ticker\n  elements.homeTeamScore.textContent = state.score.toString();\n\n  // Update quarter from ScoreSystem if available\n  if (scoreSystem) {\n    const clock = scoreSystem.getClock();\n    elements.quarterDisplay.textContent = clock.isOvertime ? 'OT' : `Q${clock.quarter}`;\n  }\n\n  // Sync input phase with game phase\n  if (inputSystem) {\n    if (state.phase === 'pre_snap') inputSystem.setPhase('pre_snap');\n    else if (state.phase === 'play_active') inputSystem.setPhase('pocket');\n    // ball_carrier phase set by engine when catch happens\n  }\n\n  // Show/hide play call overlay based on phase\n  if (state.phase === 'pre_snap') {\n    showPlayCallUI();\n  } else {\n    hidePlayCallUI();\n  }\n\n  // Move indicators - show during play_active when ball carrier\n  if (state.phase === 'play_active') {\n    elements.moveIndicators.style.display = 'flex';\n  } else {\n    elements.moveIndicators.style.display = 'none';\n  }\n\n  // Show feedback for events\n  if (state.touchdowns > 0 && lastFeedback !== 'touchdown') {\n    showFeedback('TOUCHDOWN!', 'feedback-touchdown');\n    lastFeedback = 'touchdown';\n  } else if (state.firstDowns > 0 && state.down === 1 && lastFeedback !== 'firstdown') {\n    showFeedback('FIRST DOWN!', 'feedback-firstdown');\n    lastFeedback = 'firstdown';\n  } else if (state.bigPlays > 0 && lastFeedback !== 'bigplay') {\n    showFeedback('BIG PLAY!', 'feedback-bigplay');\n    lastFeedback = 'bigplay';\n  }\n}\n\n/** Show feedback text */\nfunction showFeedback(text: string, className: string): void {\n  if (feedbackTimeout) {\n    clearTimeout(feedbackTimeout);\n  }\n\n  elements.playFeedback.textContent = text;\n  elements.playFeedback.className = `show ${className}`;\n\n  feedbackTimeout = window.setTimeout(() => {\n    elements.playFeedback.classList.remove('show');\n  }, 1500);\n}\n\n/** Handle game over */\nasync function handleGameOver(result: BlitzGameResult): Promise<void> {\n  // Store result for sharing\n  lastGameResult = result;\n\n  // Hide game elements\n  elements.gameUI.style.display = 'none';\n  elements.driveInfo.style.display = 'none';\n  elements.staminaBar.style.display = 'none';\n  elements.renderCanvas.style.display = 'none';\n  elements.scoreTicker.style.display = 'none';\n  elements.playClock.style.display = 'none';\n  elements.moveIndicators.style.display = 'none';\n  hidePlayCallUI();\n\n  // Tear down input loop\n  if (inputSystem) { inputSystem.dispose(); inputSystem = null; }\n  if (cooldownRaf !== null) { cancelAnimationFrame(cooldownRaf); cooldownRaf = null; }\n\n  // Update high score\n  saveHighScore(result.finalScore);\n  elements.highScore.textContent = getHighScore().toLocaleString();\n\n  // Show result\n  const resultText = {\n    touchdown: 'TOUCHDOWN!',\n    turnover: 'TURNOVER ON DOWNS',\n    timeout: 'TIME EXPIRED',\n    incomplete: 'DRIVE ENDED',\n  }[result.result];\n\n  elements.gameOverResult.textContent = resultText;\n  elements.finalScore.textContent = result.finalScore.toLocaleString();\n\n  // Populate stats  enhanced with ScoreSystem data when available\n  const ss = gameEngine?.getScoreSystem();\n  const homeStats = ss?.getStats('home');\n  const passerRating = homeStats?.passing.passerRating ?? 0;\n  const compPct = homeStats && homeStats.passing.attempts > 0\n    ? Math.round((homeStats.passing.completions / homeStats.passing.attempts) * 100)\n    : 0;\n\n  // Build stat rows using safe DOM construction\n  const statsContainer = elements.gameStats;\n  statsContainer.textContent = '';\n  const statRows: [string, string][] = [\n    ['Total Yards', String(result.yardsGained)],\n    ['Touchdowns', String(result.touchdowns)],\n    ['First Downs', String(result.firstDowns)],\n    ['Completion %', `${compPct}%`],\n    ['Passer Rating', passerRating.toFixed(1)],\n    ['Big Plays (20+ yds)', String(result.bigPlays)],\n    ['Longest Play', `${result.longestPlay} yds`],\n    ['Turbo Yards', String(result.turboYards)],\n    ['Duration', `${result.durationSeconds}s`],\n  ];\n  for (const [label, value] of statRows) {\n    const row = document.createElement('div');\n    row.className = 'stat-row';\n    const labelEl = document.createElement('span');\n    labelEl.className = 'label';\n    labelEl.textContent = label;\n    const valueEl = document.createElement('span');\n    valueEl.className = 'value';\n    valueEl.textContent = value;\n    row.appendChild(labelEl);\n    row.appendChild(valueEl);\n    statsContainer.appendChild(row);\n  }\n\n  // Set up X/Twitter share link\n  const shareText = `Just scored ${result.finalScore.toLocaleString()} points in Blaze Blitz!  ${result.touchdowns} TDs, ${result.yardsGained} yards. Can you beat my score?`;\n  const shareUrl = 'https://blazesportsintel.com/games/blitz/';\n  elements.shareXBtn.href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`;\n\n  // Pre-fill name input if saved\n  const savedName = getPlayerName();\n  if (savedName) {\n    elements.playerNameInput.value = savedName;\n  }\n\n  // Show game over screen IMMEDIATELY  before any async network calls\n  elements.gameOverScreen.style.display = 'flex';\n\n  // Reset feedback tracking\n  lastFeedback = '';\n\n  // Fire-and-forget: submit score and fetch leaderboard (non-blocking)\n  submitScoreAndLeaderboard(result).catch(() => {});\n}\n\n/** Submit score and fetch leaderboard  fire-and-forget, never blocks game-over UI */\nasync function submitScoreAndLeaderboard(result: BlitzGameResult): Promise<void> {\n  // Submit score\n  try {\n    const response = await fetch('/api/blitz/submit-score', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        playerId: getPlayerId(),\n        score: result.finalScore,\n        teamId: result.teamId,\n        stats: {\n          yardsGained: result.yardsGained,\n          touchdowns: result.touchdowns,\n          firstDowns: result.firstDowns,\n          bigPlays: result.bigPlays,\n          turnovers: result.turnovers,\n          tacklesMade: result.tacklesMade,\n          stiffArms: result.stiffArms,\n          jukes: result.jukes,\n          turboYards: result.turboYards,\n          longestPlay: result.longestPlay,\n          durationSeconds: result.durationSeconds,\n          result: result.result,\n        },\n      }),\n    });\n\n    if (response.ok) {\n      const data = (await response.json()) as { success: boolean; data?: { isHighScore?: boolean } };\n      if (data.success && data.data?.isHighScore) {\n        elements.gameOverResult.textContent += ' NEW HIGH SCORE!';\n      }\n    }\n  } catch {\n    // Leaderboard not available\n  }\n\n  // Fetch leaderboard (safe DOM construction)\n  try {\n    const response = await fetch('/api/blitz/leaderboard?limit=5');\n    if (!response.ok) return;\n    const data = (await response.json()) as { success: boolean; entries?: Array<{ rank: number; playerName: string; score: number }> };\n\n    if (data.success && data.entries) {\n      const container = elements.leaderboard;\n      container.textContent = '';\n\n      const title = document.createElement('div');\n      title.className = 'leaderboard-title';\n      title.textContent = 'Top Scores';\n      container.appendChild(title);\n\n      for (const entry of data.entries) {\n        const row = document.createElement('div');\n        row.className = 'leaderboard-entry';\n\n        const rank = document.createElement('span');\n        rank.className = 'rank';\n        rank.textContent = `#${entry.rank}`;\n\n        const player = document.createElement('span');\n        player.className = 'player';\n        player.textContent = entry.playerName || 'Anonymous';\n\n        const score = document.createElement('span');\n        score.className = 'lb-score';\n        score.textContent = entry.score.toLocaleString();\n\n        row.appendChild(rank);\n        row.appendChild(player);\n        row.appendChild(score);\n        container.appendChild(row);\n      }\n    }\n  } catch {\n    // Leaderboard not available\n  }\n}\n\n/** Show main menu */\nfunction showMenu(): void {\n  // Dispose game engine\n  if (gameEngine) {\n    gameEngine.dispose();\n    gameEngine = null;\n  }\n\n  // Hide game over\n  elements.gameOverScreen.style.display = 'none';\n\n  // Show menu\n  elements.menuScreen.style.display = 'flex';\n}\n\n// Start the app\ninit().catch(console.error);\n"],"names":["FIELD_CONFIG","FIELD_COLORS","FootballField","scene","homeTeam","awayTeam","__publicField","totalLength","ground","MeshBuilder","grassMat","PBRMaterial","Color3","i","stripe","stripeMat","homeEndZone","homeMat","awayEndZone","awayMat","team","zPos","flip","textPlane","textureResolution","texture","DynamicTexture","ctx","textMat","StandardMaterial","lineMat","yard","lineWidth","line","goalLineMat","idx","goalLine","hashMat","hashLength","hashWidth","leftHash","rightHash","num","xPos","numberPlane","numMat","sidelineMat","leftSideline","rightSideline","oobMat","side","oob","z","yardLine","x","halfWidth","standMat","s","stand","towerMat","tower","light","PointLight","Vector3","jumbotronPlane","jumbotronTexture","jumbotronMat","home","away","tex","mesh","DEFAULT_CONFIG","FootballPhysics","config","ballMat","TrailMesh","trailMat","ParticleSystem","Texture","Color4","playerId","position","targetPos","passType","holdTime","baseVelocity","arcHeight","startPos","distance","direction","horizontalVelocity","verticalVelocity","angle","deltaTime","playerPosition","catchSkill","baseSuccess","distancePenalty","successChance","tacklerPower","fumbleChance","randomAngle","facingAngle","offsetX","offsetZ","PlayerController","startPosition","inputDir","targetSpeed","staminaRatio","fatigueFactor","currentDir","alignment","turnIntensity","targetVelocity","lerpFactor","targetPosition","pos","TouchController","canvas","container","pattern","touch","rect","dx","dy","maxRadius","clampedDist","receiverIndex","maxOffset","offsetY","intensity","receiver","visible","type","DEFAULT_WEIGHTS","DEFAULT_AI_CONFIG","SteeringBehaviors","weights","agent","steering","threatPos","target","speed","lookAhead","futurePos","targetA","targetB","midpoint","neighbors","neighbor","toAgent","force","toTarget","desiredSpeed","ballCarrier","assignment","teammates","ballPosition","pursuitForce","interposeForce","seekForce","separationForce","acceleration","vector","maxLength","DefenderAI","receiverId","ballCarrierPosition","ballCarrierVelocity","receiverPositions","receiverPos","steeringForce","delay","tackleRadius","CoverageScheme","HALF_WIDTH","THIRD_WIDTH","buildZoneTemplates","los","zoneCenter","zone","isInsideZone","defaultAttributes","role","computePursuitAngle","defenderPos","targetVel","defenderSpeed","dist","closingSpeed","t","computeContainTarget","runnerPos","rolesForScheme","scheme","blitz","applyBlitz","roles","result","zoneIdx","r","originalRole","deepIdx","blitzTarget","pkg","_AISystem","attributes","baseAttrs","state","id","defenderIds","defenderId","dir","active","dt","ballCarrierPos","ballCarrierVel","ballPos","receiverVelocities","allAgents","closestInZone","toReceiver","center","sep","recPos","recVel","cushion","cushionPoint","vel","blitzTarget_","containTarget","interceptPoint","targetX","spyPos","referencePos","speedMod","modulated","overrideDelay","agents","distanceFactor","AISystem","ACHIEVEMENT_DEFS","ScoreSystem","def","prev","pts","qi","deficit","completed","yards","isTd","isInt","p","existing","defensiveTeam","converted","seconds","a","b","c","d","plays","elapsedSec","summary","winner","loser","AudioManager","buffer","source","volume","now","noiseBuffer","noise","filter","gain","osc","oscGain","wetGain","duration","lfo","lfoGain","notes","delays","freq","startTime","sampleRate","length","impulse","channel","data","bufferSize","positions","j","panner","level","baseVolume","value","endTime","DEFAULT_DRIVE_CONFIG","DriveSystem","startYardLine","opts","actualYards","newLos","ordinal","SHOTGUN_OFFSETS","IFORM_OFFSETS","TRIPS_OFFSETS","SPREAD_OFFSETS","SINGLEBACK_OFFSETS","buildPreview","offsets","base","applied","o","FORMATIONS","PLAYBOOK_OFFENSE","PLAYBOOK_DEFENSE","buildPickerEntries","ft","cats","avg","PlaybookSystem","offensivePlays","defensivePlays","situation","scores","play","top","totalWeight","roll","acc","entry","limit","scored","sit","score","likelyCategory","needed","FIREBIRDS","SHADOW_WOLVES","UNLOCKABLE_TEAMS","getPlayableTeams","OFFENSIVE_POSITIONS","DEFENSIVE_POSITIONS","OFFENSIVE_PLAYS","getAllOffensivePlays","MAX_GHOST_MESHES","MAX_TRAIL_LINES","GHOST_COLORS","GhostRenderer3D","glowLayer","mat","probability","playerType","colorHex","fromPos","toPos","steps","points","color","alpha","colors","trail","PlayerType","PlayAction","encode","action","stamina","region","decode","token","FIELD_LENGTH","positionToFieldZone","fieldLength","segment","lateral","regionToFieldPosition","bucketStamina","raw","entityToToken","entity","POSITION_MAP","blitzIdToPlayerType","DynamicsPredictor","prevToken","nextToken","actionKey","stateMap","actionMap","currentToken","counts","total","count","predictions","match","nextMap","json","stateStr","actionObj","actionStr","nextObj","k","v","prevRegion","nextRegion","prevStamina","nextStamina","MIN_PLAYS_FOR_GHOSTS","ANOMALY_THRESHOLD","GenieSystem","currentEntities","entityId","entityInfo","pType","rendered","pred","decoded","predictedPos","SCORING","COLORS","BlitzGameEngine","Engine","Scene","engine","FollowCamera","targetMesh","mainLight","DirectionalLight","ShadowGenerator","ambientLight","HemisphericLight","rimLight","fieldGlow","dome","skyMat","gradient","y","radius","pipeline","DefaultRenderingPipeline","GlowLayer","player","ai","isOffense","body","helmet","helmetMat","driveState","recommendations","qbPos","snapTimer","route","animate","elapsed","rawDelta","targetRadius","targetHeight","height","intensityScale","jitter","velocity","yardsThisFrame","rot","defPos","carrierMesh","selectedIdx","targetId","leadDistance","catchTimer","tacklerPosition","carrierPos","tdPos","tdStopTimer","lights","originalIntensities","l","flickerStart","flickerInterval","flicker","durationMs","isIncomplete","endYardLine","yardsThisPlay","playResult","gameResult","playerName","res","playId","jukeStrength","lateralOffset","forward","diveVector","recs","alt","routeType","sidelineTarget","SceneLoader","mascotRoot","startZ","startX","endX","runStart","runDuration","runInterval","fireworks","mascotTimer","err","DEFAULT_BINDINGS","DEFAULT_COOLDOWNS","InputSystem","e","phase","listener","list","key","move","bindings","code","absDx","absDy","event","actionListeners","getPlayerId","getHighScore","saveHighScore","current","getPlayerName","savePlayerName","name","lastGameResult","elements","gameEngine","selectedTeam","lastFeedback","feedbackTimeout","playbook","inputSystem","scoreSystem","cooldownRaf","selectedFormation","playClockInterval","playClockSeconds","renderFormationPicker","formations","f","btn","renderPlayPicker","card","desc","selectPlay","stopPlayClock","showPlayCallUI","resetPlayClock","hidePlayCallUI","init","populateTeamSelect","setupEventListeners","arcadeLink","index","startGame","showMenu","handleSaveName","handleCopyLink","savedName","response","title","row","rank","error","shareUrl","textArea","handleGameStateChange","handleGameOver","text","style","showFeedback","lastTime","updateCooldowns","downText","sideText","displayYardLine","clock","className","resultText","homeStats","passerRating","compPct","statsContainer","statRows","label","labelEl","valueEl","shareText","submitScoreAndLeaderboard"],"mappings":"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"}
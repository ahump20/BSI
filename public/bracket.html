<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Tournament Bracket | Blaze Sports Intel</title>
    <meta name="description" content="Interactive 3D tournament bracket visualization for CWS, CFP, and conference championships.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
      <link rel="stylesheet" href="/css/bsi-tokens.css">
  <style>
        :root {
            --burnt-orange: #BF5700;
            --texas-soil: #8B4513;
            --ember: #FF6B35;
            --charcoal: #1A1A1A;
            --midnight: #0D0D0D;
            --cream: #FAF8F5;
            --gold: #C9A227;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'IBM Plex Sans', sans-serif;
            background: var(--midnight);
            color: var(--cream);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--charcoal) 0%, var(--midnight) 100%);
            border-bottom: 1px solid rgba(191, 87, 0, 0.3);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--burnt-orange);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
        }

        .nav-links a {
            color: var(--cream);
            text-decoration: none;
            font-size: 0.9rem;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .nav-links a:hover { opacity: 1; color: var(--ember); }

        .main-content {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 60px);
        }

        .controls {
            background: var(--charcoal);
            padding: 1rem 2rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-group label {
            font-size: 0.85rem;
            color: rgba(250, 248, 245, 0.7);
        }

        select, button {
            background: var(--midnight);
            border: 1px solid rgba(191, 87, 0, 0.3);
            color: var(--cream);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s;
        }

        select:hover, button:hover {
            border-color: var(--burnt-orange);
        }

        button.primary {
            background: var(--burnt-orange);
            border-color: var(--burnt-orange);
        }

        button.primary:hover {
            background: var(--ember);
        }

        .canvas-container {
            flex: 1;
            position: relative;
        }

        #bracketCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .team-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(191, 87, 0, 0.5);
            border-radius: 8px;
            padding: 1rem;
            min-width: 250px;
            display: none;
        }

        .team-info.visible { display: block; }

        .team-info h3 {
            color: var(--burnt-orange);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .team-info p {
            font-size: 0.9rem;
            color: rgba(250, 248, 245, 0.8);
            margin: 0.25rem 0;
        }

        .team-info .seed {
            display: inline-block;
            background: var(--gold);
            color: var(--midnight);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8rem;
            margin-right: 0.5rem;
        }

        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1rem;
            font-size: 0.85rem;
        }

        .legend h4 {
            margin-bottom: 0.5rem;
            color: var(--burnt-orange);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.3rem 0;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .instructions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(26, 26, 26, 0.8);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 0.8rem;
            color: rgba(250, 248, 245, 0.6);
        }

        .data-stamp {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 0.75rem;
            color: rgba(250, 248, 245, 0.5);
        }

        @media (max-width: 768px) {
            .header { padding: 0.75rem 1rem; }
            .controls { padding: 0.75rem 1rem; flex-direction: column; align-items: stretch; }
            .legend, .instructions { display: none; }
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="/" class="logo">Blaze Sports Intel</a>
        <nav class="nav-links">
            <a href="/">Home</a>
            <a href="/trivia">Trivia</a>
            <a href="/predictions">Predictions</a>
            <a href="/ask">Ask AI</a>
        </nav>
    </header>

    <main class="main-content">
        <div class="controls">
            <div class="control-group">
                <label for="tournamentSelect">Tournament:</label>
                <select id="tournamentSelect">
                    <option value="cws">College World Series 2024</option>
                    <option value="cfp">College Football Playoff 2024</option>
                    <option value="sec">SEC Tournament 2024</option>
                    <option value="big12">Big 12 Tournament 2024</option>
                </select>
            </div>
            <div class="control-group">
                <label for="viewSelect">View:</label>
                <select id="viewSelect">
                    <option value="3d">3D Bracket</option>
                    <option value="top">Top Down</option>
                    <option value="side">Side View</option>
                </select>
            </div>
            <button class="primary" id="resetCamera">Reset View</button>
            <button id="toggleAnimation">Pause Animation</button>
        </div>

        <div class="canvas-container">
            <canvas id="bracketCanvas"></canvas>

            <div class="data-stamp" id="dataStamp"></div>

            <div class="legend">
                <h4>Round Colors</h4>
                <div class="legend-item">
                    <div class="legend-color" style="background: #BF5700;"></div>
                    <span>Championship</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #C9A227;"></div>
                    <span>Semifinals</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4A90A4;"></div>
                    <span>Quarterfinals</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #6B7280;"></div>
                    <span>First Round</span>
                </div>
            </div>

            <div class="team-info" id="teamInfo">
                <h3 id="teamName">Team Name</h3>
                <p><span class="seed" id="teamSeed">#1</span> <span id="teamConference">Conference</span></p>
                <p id="teamRecord">Record: 0-0</p>
                <p id="teamStatus">Status: Active</p>
            </div>

            <div class="instructions">
                Click &amp; drag to rotate | Scroll to zoom | Click team for details
            </div>
        </div>
    </main>

    <script>
        // Tournament data
        const tournaments = {
            cws: {
                name: "College World Series 2024",
                teams: [
                    { name: "Texas A&M", seed: 3, conference: "SEC", record: "53-15", status: "Champion", eliminated: false },
                    { name: "Tennessee", seed: 1, conference: "SEC", record: "60-13", status: "Runner-up", eliminated: true },
                    { name: "Florida", seed: 2, conference: "SEC", record: "54-15", status: "Eliminated", eliminated: true },
                    { name: "Kentucky", seed: 2, conference: "SEC", record: "45-18", status: "Eliminated", eliminated: true },
                    { name: "NC State", seed: 10, conference: "ACC", record: "38-22", status: "Eliminated", eliminated: true },
                    { name: "Virginia", seed: 12, conference: "ACC", record: "46-17", status: "Eliminated", eliminated: true },
                    { name: "Florida State", seed: 8, conference: "ACC", record: "47-16", status: "Eliminated", eliminated: true },
                    { name: "North Carolina", seed: 4, conference: "ACC", record: "47-15", status: "Eliminated", eliminated: true }
                ],
                rounds: ["First Round", "Semifinals", "Championship"]
            },
            cfp: {
                name: "College Football Playoff 2024",
                teams: [
                    { name: "Michigan", seed: 1, conference: "Big Ten", record: "15-0", status: "Champion", eliminated: false },
                    { name: "Washington", seed: 2, conference: "Pac-12", record: "14-1", status: "Runner-up", eliminated: true },
                    { name: "Texas", seed: 3, conference: "Big 12", record: "13-2", status: "Eliminated", eliminated: true },
                    { name: "Alabama", seed: 4, conference: "SEC", record: "12-2", status: "Eliminated", eliminated: true }
                ],
                rounds: ["Semifinals", "Championship"]
            },
            sec: {
                name: "SEC Baseball Tournament 2024",
                teams: [
                    { name: "Tennessee", seed: 1, conference: "SEC East", record: "52-11", status: "Champion", eliminated: false },
                    { name: "Texas A&M", seed: 4, conference: "SEC West", record: "43-17", status: "Runner-up", eliminated: true },
                    { name: "Kentucky", seed: 2, conference: "SEC East", record: "42-16", status: "Eliminated", eliminated: true },
                    { name: "Arkansas", seed: 3, conference: "SEC West", record: "44-15", status: "Eliminated", eliminated: true },
                    { name: "LSU", seed: 5, conference: "SEC West", record: "40-20", status: "Eliminated", eliminated: true },
                    { name: "Georgia", seed: 6, conference: "SEC East", record: "38-21", status: "Eliminated", eliminated: true },
                    { name: "Florida", seed: 7, conference: "SEC East", record: "36-24", status: "Eliminated", eliminated: true },
                    { name: "South Carolina", seed: 8, conference: "SEC East", record: "35-25", status: "Eliminated", eliminated: true }
                ],
                rounds: ["First Round", "Quarterfinals", "Semifinals", "Championship"]
            },
            big12: {
                name: "Big 12 Baseball Tournament 2024",
                teams: [
                    { name: "Texas Tech", seed: 1, conference: "Big 12", record: "42-18", status: "Champion", eliminated: false },
                    { name: "West Virginia", seed: 2, conference: "Big 12", record: "38-20", status: "Runner-up", eliminated: true },
                    { name: "Oklahoma State", seed: 3, conference: "Big 12", record: "36-22", status: "Eliminated", eliminated: true },
                    { name: "TCU", seed: 4, conference: "Big 12", record: "34-23", status: "Eliminated", eliminated: true },
                    { name: "Kansas State", seed: 5, conference: "Big 12", record: "32-26", status: "Eliminated", eliminated: true },
                    { name: "Baylor", seed: 6, conference: "Big 12", record: "30-27", status: "Eliminated", eliminated: true },
                    { name: "UCF", seed: 7, conference: "Big 12", record: "28-29", status: "Eliminated", eliminated: true },
                    { name: "Cincinnati", seed: 8, conference: "Big 12", record: "26-30", status: "Eliminated", eliminated: true }
                ],
                rounds: ["First Round", "Quarterfinals", "Semifinals", "Championship"]
            }
        };

        // Babylon.js setup
        const canvas = document.getElementById("bracketCanvas");
        const engine = new BABYLON.Engine(canvas, true);

        let scene, camera, currentTournament = "cws";
        let teamMeshes = [];
        let isAnimating = true;

        const roundColors = {
            0: new BABYLON.Color3(0.42, 0.44, 0.5),    // First Round - Gray
            1: new BABYLON.Color3(0.29, 0.56, 0.64),   // Quarters - Blue
            2: new BABYLON.Color3(0.79, 0.64, 0.15),   // Semis - Gold
            3: new BABYLON.Color3(0.75, 0.34, 0)       // Championship - Burnt Orange
        };

        function createScene() {
            scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color4(0.05, 0.05, 0.05, 1);

            // Camera
            camera = new BABYLON.ArcRotateCamera(
                "camera",
                Math.PI / 4,
                Math.PI / 3,
                25,
                new BABYLON.Vector3(0, 0, 0),
                scene
            );
            camera.attachControl(canvas, true);
            camera.lowerRadiusLimit = 10;
            camera.upperRadiusLimit = 50;
            camera.wheelPrecision = 50;

            // Lights
            const light1 = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(1, 1, 0), scene);
            light1.intensity = 0.7;

            const light2 = new BABYLON.PointLight("light2", new BABYLON.Vector3(0, 10, 0), scene);
            light2.intensity = 0.5;

            // Ground grid
            const gridMaterial = new BABYLON.GridMaterial("gridMat", scene);
            gridMaterial.majorUnitFrequency = 5;
            gridMaterial.minorUnitVisibility = 0.3;
            gridMaterial.gridRatio = 1;
            gridMaterial.backFaceCulling = false;
            gridMaterial.mainColor = new BABYLON.Color3(0.1, 0.1, 0.1);
            gridMaterial.lineColor = new BABYLON.Color3(0.3, 0.3, 0.3);
            gridMaterial.opacity = 0.8;

            const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 50, height: 50 }, scene);
            ground.material = gridMaterial;
            ground.position.y = -0.5;

            buildBracket(tournaments[currentTournament]);

            return scene;
        }

        function buildBracket(tournament) {
            // Clear existing meshes
            teamMeshes.forEach(mesh => mesh.dispose());
            teamMeshes = [];

            const teams = tournament.teams;
            const numTeams = teams.length;
            const numRounds = Math.ceil(Math.log2(numTeams)) + 1;

            let teamIndex = 0;
            const spacing = 4;
            const roundSpacing = 6;

            // Build bracket structure
            for (let round = 0; round < numRounds; round++) {
                const teamsInRound = Math.pow(2, numRounds - round - 1);
                const yOffset = round * 2;

                for (let i = 0; i < teamsInRound && teamIndex < numTeams; i++) {
                    const team = teams[teamIndex];

                    // Calculate position
                    const xSpread = (teamsInRound - 1) * spacing / 2;
                    const x = i * spacing - xSpread;
                    const z = round * roundSpacing - (numRounds - 1) * roundSpacing / 2;
                    const y = yOffset;

                    // Create team box
                    const box = BABYLON.MeshBuilder.CreateBox(
                        `team_${teamIndex}`,
                        { width: 3, height: 1.5, depth: 2 },
                        scene
                    );
                    box.position = new BABYLON.Vector3(x, y, z);

                    // Material
                    const material = new BABYLON.StandardMaterial(`mat_${teamIndex}`, scene);
                    const roundColorIndex = Math.min(round, 3);
                    material.diffuseColor = roundColors[roundColorIndex];

                    if (team.eliminated) {
                        material.alpha = 0.5;
                    }

                    if (team.status === "Champion") {
                        material.emissiveColor = new BABYLON.Color3(0.75, 0.34, 0);
                    }

                    box.material = material;
                    box.metadata = { team, teamIndex };

                    // Add team label using dynamic texture
                    const labelPlane = BABYLON.MeshBuilder.CreatePlane(
                        `label_${teamIndex}`,
                        { width: 2.8, height: 1.3 },
                        scene
                    );
                    labelPlane.parent = box;
                    labelPlane.position.y = 0.76;
                    labelPlane.rotation.x = -Math.PI / 2;

                    const labelTexture = new BABYLON.DynamicTexture(
                        `texture_${teamIndex}`,
                        { width: 256, height: 128 },
                        scene
                    );
                    const ctx = labelTexture.getContext();
                    ctx.fillStyle = "rgba(13, 13, 13, 0.9)";
                    ctx.fillRect(0, 0, 256, 128);
                    ctx.font = "bold 24px IBM Plex Sans";
                    ctx.fillStyle = "#FAF8F5";
                    ctx.textAlign = "center";
                    ctx.fillText(team.name, 128, 50);
                    ctx.font = "18px IBM Plex Sans";
                    ctx.fillStyle = "#C9A227";
                    ctx.fillText(`#${team.seed} - ${team.record}`, 128, 85);
                    labelTexture.update();

                    const labelMat = new BABYLON.StandardMaterial(`labelMat_${teamIndex}`, scene);
                    labelMat.diffuseTexture = labelTexture;
                    labelMat.emissiveTexture = labelTexture;
                    labelMat.backFaceCulling = false;
                    labelPlane.material = labelMat;

                    teamMeshes.push(box);
                    teamIndex++;
                }
            }

            // Create connection lines between rounds
            createBracketLines(tournament);

            // Update data stamp
            updateDataStamp();
        }

        function createBracketLines(tournament) {
            const teams = tournament.teams;
            const numTeams = teams.length;
            const numRounds = Math.ceil(Math.log2(numTeams)) + 1;
            const spacing = 4;
            const roundSpacing = 6;

            const lineMaterial = new BABYLON.StandardMaterial("lineMat", scene);
            lineMaterial.emissiveColor = new BABYLON.Color3(0.4, 0.4, 0.4);

            // Create lines connecting teams to next round
            let teamIndex = 0;
            for (let round = 0; round < numRounds - 1; round++) {
                const teamsInRound = Math.pow(2, numRounds - round - 1);
                const nextRoundTeams = Math.pow(2, numRounds - round - 2);
                const yOffset = round * 2;
                const nextYOffset = (round + 1) * 2;

                for (let i = 0; i < teamsInRound; i += 2) {
                    if (teamIndex + 1 >= numTeams) break;

                    const xSpread = (teamsInRound - 1) * spacing / 2;
                    const nextXSpread = (nextRoundTeams - 1) * spacing / 2;

                    const x1 = i * spacing - xSpread;
                    const x2 = (i + 1) * spacing - xSpread;
                    const nextX = (i / 2) * spacing - nextXSpread;

                    const z = round * roundSpacing - (numRounds - 1) * roundSpacing / 2;
                    const nextZ = (round + 1) * roundSpacing - (numRounds - 1) * roundSpacing / 2;

                    // Create tube from team 1 to next round
                    const path1 = [
                        new BABYLON.Vector3(x1, yOffset + 0.75, z + 1),
                        new BABYLON.Vector3(x1, yOffset + 1.5, (z + nextZ) / 2),
                        new BABYLON.Vector3(nextX, nextYOffset - 0.75, nextZ - 1)
                    ];

                    const path2 = [
                        new BABYLON.Vector3(x2, yOffset + 0.75, z + 1),
                        new BABYLON.Vector3(x2, yOffset + 1.5, (z + nextZ) / 2),
                        new BABYLON.Vector3(nextX, nextYOffset - 0.75, nextZ - 1)
                    ];

                    const tube1 = BABYLON.MeshBuilder.CreateTube(
                        `tube1_${round}_${i}`,
                        { path: path1, radius: 0.1, tessellation: 8 },
                        scene
                    );
                    tube1.material = lineMaterial;

                    const tube2 = BABYLON.MeshBuilder.CreateTube(
                        `tube2_${round}_${i}`,
                        { path: path2, radius: 0.1, tessellation: 8 },
                        scene
                    );
                    tube2.material = lineMaterial;
                }

                teamIndex += teamsInRound;
            }
        }

        function updateDataStamp() {
            const now = new Date();
            const cst = new Date(now.toLocaleString('en-US', { timeZone: 'America/Chicago' }));
            document.getElementById('dataStamp').textContent =
                `Data: BlazeSportsIntel.com | ${cst.toLocaleDateString()} ${cst.toLocaleTimeString()} CT`;
        }

        // Event handlers
        document.getElementById('tournamentSelect').addEventListener('change', (e) => {
            currentTournament = e.target.value;
            buildBracket(tournaments[currentTournament]);
        });

        document.getElementById('viewSelect').addEventListener('change', (e) => {
            const view = e.target.value;
            switch(view) {
                case '3d':
                    camera.alpha = Math.PI / 4;
                    camera.beta = Math.PI / 3;
                    break;
                case 'top':
                    camera.alpha = 0;
                    camera.beta = 0.1;
                    break;
                case 'side':
                    camera.alpha = Math.PI / 2;
                    camera.beta = Math.PI / 2;
                    break;
            }
        });

        document.getElementById('resetCamera').addEventListener('click', () => {
            camera.alpha = Math.PI / 4;
            camera.beta = Math.PI / 3;
            camera.radius = 25;
            camera.target = new BABYLON.Vector3(0, 0, 0);
        });

        document.getElementById('toggleAnimation').addEventListener('click', function() {
            isAnimating = !isAnimating;
            this.textContent = isAnimating ? 'Pause Animation' : 'Resume Animation';
        });

        // Click detection for teams
        canvas.addEventListener('click', () => {
            const pickResult = scene.pick(scene.pointerX, scene.pointerY);
            if (pickResult.hit && pickResult.pickedMesh.metadata?.team) {
                const team = pickResult.pickedMesh.metadata.team;
                const teamInfo = document.getElementById('teamInfo');

                document.getElementById('teamName').textContent = team.name;
                document.getElementById('teamSeed').textContent = `#${team.seed}`;
                document.getElementById('teamConference').textContent = team.conference;
                document.getElementById('teamRecord').textContent = `Record: ${team.record}`;
                document.getElementById('teamStatus').textContent = `Status: ${team.status}`;

                teamInfo.classList.add('visible');

                // Hide after 5 seconds
                setTimeout(() => teamInfo.classList.remove('visible'), 5000);
            }
        });

        // Create and run scene
        scene = createScene();

        engine.runRenderLoop(() => {
            if (isAnimating && camera) {
                camera.alpha += 0.001;
            }
            scene.render();
        });

        window.addEventListener('resize', () => {
            engine.resize();
        });
    </script>
  <script src="/js/bsi-components.js"></script>
</body>
</html>

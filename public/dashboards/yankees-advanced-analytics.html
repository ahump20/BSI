<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yankees Advanced Analytics | Blaze Sports Intel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="/css/bsi-tokens.css">
  <style>
        :root {
            --yankees-primary: #003087;
            --yankees-secondary: #E4002C;
            --yankees-accent: #C4CED4;
            --bg-dark: #0D0D0D;
            --bg-card: #1A1A1A;
            --bg-card-hover: #242424;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0A0;
            --text-muted: #666666;
            --border-color: #333333;
            --success: #22C55E;
            --danger: #EF4444;
            --warning: #F59E0B;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        .team-header {
            background: linear-gradient(135deg, var(--yankees-primary) 0%, #001F4D 100%);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .team-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(228, 0, 44, 0.1));
            pointer-events: none;
        }

        .team-title {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .team-logo {
            width: 72px;
            height: 72px;
            background: var(--text-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 700;
            color: var(--yankees-primary);
        }

        .team-name h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .team-name p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }

        .header-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
        }

        .header-stat {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .header-stat-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .header-stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            background: var(--bg-card-hover);
            border-color: var(--yankees-primary);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-badge {
            background: var(--yankees-primary);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .standings-table {
            width: 100%;
            border-collapse: collapse;
        }

        .standings-table th {
            text-align: left;
            padding: 12px 8px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border-color);
        }

        .standings-table td {
            padding: 12px 8px;
            font-size: 14px;
            border-bottom: 1px solid var(--border-color);
        }

        .standings-table tr:last-child td {
            border-bottom: none;
        }

        .standings-table tr.highlight {
            background: rgba(0, 48, 135, 0.2);
        }

        .standings-table tr.highlight td:first-child {
            border-left: 3px solid var(--yankees-primary);
            padding-left: 12px;
        }

        .team-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .team-abbr {
            width: 28px;
            height: 28px;
            background: var(--bg-card-hover);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .pythagorean-display {
            text-align: center;
            padding: 20px;
        }

        .pyth-value {
            font-size: 48px;
            font-weight: 700;
            color: var(--yankees-primary);
            margin-bottom: 8px;
        }

        .pyth-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .pyth-comparison {
            display: flex;
            justify-content: center;
            gap: 32px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .pyth-stat {
            text-align: center;
        }

        .pyth-stat-value {
            font-size: 24px;
            font-weight: 600;
        }

        .pyth-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        .neutral {
            color: var(--warning);
        }

        .schedule-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .game-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 10px;
            transition: all 0.2s ease;
        }

        .game-item:hover {
            background: var(--bg-card-hover);
        }

        .game-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .game-date {
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 80px;
        }

        .game-opponent {
            font-weight: 500;
        }

        .game-result {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .result-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .result-badge.win {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
        }

        .result-badge.loss {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .game-score {
            font-weight: 600;
            min-width: 60px;
            text-align: right;
        }

        .scoring-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .scoring-item {
            background: var(--bg-dark);
            border-radius: 10px;
            padding: 16px;
            text-align: center;
        }

        .scoring-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .scoring-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--yankees-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            text-align: center;
            padding: 40px;
            color: var(--danger);
        }

        .last-updated {
            text-align: center;
            padding: 16px;
            color: var(--text-muted);
            font-size: 12px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            margin-bottom: 16px;
            transition: color 0.2s ease;
        }

        .back-link:hover {
            color: var(--yankees-primary);
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 16px;
            }

            .team-header {
                padding: 20px;
            }

            .team-name h1 {
                font-size: 22px;
            }

            .header-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .scoring-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <a href="/dashboards" class="back-link">
            ← Back to Dashboards
        </a>

        <header class="team-header">
            <div class="team-title">
                <div class="team-logo">NYY</div>
                <div class="team-name">
                    <h1>New York Yankees</h1>
                    <p>AL East • 2025 Season (Final)</p>
                </div>
            </div>
            <div class="header-stats" id="headerStats">
                <div class="loading-spinner"><div class="spinner"></div></div>
            </div>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="card-header">
                    <span class="card-title">AL East Standings</span>
                    <span class="card-badge">Division</span>
                </div>
                <div id="standingsContent">
                    <div class="loading-spinner"><div class="spinner"></div></div>
                </div>
            </div>

            <div class="stat-card">
                <div class="card-header">
                    <span class="card-title">Pythagorean Win Expectancy</span>
                    <span class="card-badge">Analytics</span>
                </div>
                <div id="pythagoreanContent">
                    <div class="loading-spinner"><div class="spinner"></div></div>
                </div>
            </div>

            <div class="stat-card">
                <div class="card-header">
                    <span class="card-title">Recent Results</span>
                    <span class="card-badge">Schedule</span>
                </div>
                <div id="scheduleContent">
                    <div class="loading-spinner"><div class="spinner"></div></div>
                </div>
            </div>

            <div class="stat-card">
                <div class="card-header">
                    <span class="card-title">Scoring Analysis</span>
                    <span class="card-badge">Offense/Defense</span>
                </div>
                <div id="scoringContent">
                    <div class="loading-spinner"><div class="spinner"></div></div>
                </div>
            </div>
        </div>

        <div class="last-updated" id="lastUpdated">
            Loading data...
        </div>
    </div>

    <script>
        // ESPN API Configuration
        const ESPN_BASE = 'https://site.api.espn.com/apis/site/v2/sports/baseball/mlb';
        const ESPN_V2 = 'https://site.api.espn.com/apis/v2/sports/baseball/mlb';
        const YANKEES_ID = '10';
        const TEAM_NAME = 'New York Yankees';
        const TEAM_ABBR = 'NYY';
        const DIVISION = 'AL East';

        // MLB Pythagorean exponent (Bill James formula)
        const MLB_PYTHAGOREAN_EXP = 1.83;

        // Division team IDs for AL East
        const AL_EAST_TEAMS = ['10', '2', '30', '12', '14']; // NYY, BOS, TOR, TB, BAL

        let teamData = null;
        let standingsData = null;
        let scheduleData = null;

        async function fetchTeamData() {
            try {
                const response = await fetch(`${ESPN_BASE}/teams/${YANKEES_ID}`);
                if (!response.ok) throw new Error('Failed to fetch team data');
                const data = await response.json();
                teamData = data.team;
                return teamData;
            } catch (error) {
                console.error('Error fetching team data:', error);
                return null;
            }
        }

        async function fetchStandings() {
            try {
                const response = await fetch(`${ESPN_V2}/standings`);
                if (!response.ok) throw new Error('Failed to fetch standings');
                const data = await response.json();
                standingsData = data;
                return data;
            } catch (error) {
                console.error('Error fetching standings:', error);
                return null;
            }
        }

        async function fetchSchedule() {
            try {
                const response = await fetch(`${ESPN_BASE}/teams/${YANKEES_ID}/schedule`);
                if (!response.ok) throw new Error('Failed to fetch schedule');
                const data = await response.json();
                scheduleData = data;
                return data;
            } catch (error) {
                console.error('Error fetching schedule:', error);
                return null;
            }
        }

        function getTeamRecord(team) {
            if (team.record && team.record.items) {
                const overall = team.record.items.find(r => r.type === 'total') || team.record.items[0];
                if (overall && overall.stats) {
                    const wins = overall.stats.find(s => s.name === 'wins')?.value || 0;
                    const losses = overall.stats.find(s => s.name === 'losses')?.value || 0;
                    return { wins, losses };
                }
            }
            return { wins: 0, losses: 0 };
        }

        function renderHeaderStats() {
            const container = document.getElementById('headerStats');

            if (!teamData) {
                container.innerHTML = '<div class="error-message">Unable to load team stats</div>';
                return;
            }

            const record = getTeamRecord(teamData);
            const winPct = record.wins + record.losses > 0
                ? (record.wins / (record.wins + record.losses)).toFixed(3).substring(1)
                : '.000';

            // Find standings info
            let divisionRank = '-';
            let gamesBack = '-';

            if (standingsData && standingsData.standings) {
                standingsData.standings.forEach(conf => {
                    if (conf.entries) {
                        conf.entries.forEach(entry => {
                            if (entry.team && entry.team.id === YANKEES_ID) {
                                entry.stats?.forEach(stat => {
                                    if (stat.name === 'divisionRank' || stat.name === 'playoffSeed') {
                                        divisionRank = stat.displayValue || stat.value || '-';
                                    }
                                    if (stat.name === 'gamesBehind') {
                                        gamesBack = stat.displayValue || stat.value || '-';
                                    }
                                });
                            }
                        });
                    }
                });
            }

            container.innerHTML = `
                <div class="header-stat">
                    <div class="header-stat-value">${record.wins}-${record.losses}</div>
                    <div class="header-stat-label">Record</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value">${winPct}</div>
                    <div class="header-stat-label">Win %</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value">${divisionRank}</div>
                    <div class="header-stat-label">Division Rank</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value">${gamesBack}</div>
                    <div class="header-stat-label">Games Back</div>
                </div>
            `;
        }

        function renderStandings() {
            const container = document.getElementById('standingsContent');

            if (!standingsData || !standingsData.standings) {
                container.innerHTML = '<div class="error-message">Unable to load standings</div>';
                return;
            }

            // Find AL East division
            let divisionTeams = [];
            standingsData.standings.forEach(conf => {
                if (conf.entries) {
                    conf.entries.forEach(entry => {
                        if (entry.team && AL_EAST_TEAMS.includes(entry.team.id)) {
                            const stats = {};
                            entry.stats?.forEach(stat => {
                                stats[stat.name] = stat.displayValue || stat.value;
                            });
                            divisionTeams.push({
                                id: entry.team.id,
                                name: entry.team.displayName || entry.team.name,
                                abbr: entry.team.abbreviation,
                                wins: parseInt(stats.wins) || 0,
                                losses: parseInt(stats.losses) || 0,
                                pct: stats.winPercent || stats.winpercent || '.000',
                                gb: stats.gamesBehind || '-'
                            });
                        }
                    });
                }
            });

            // Sort by wins (descending)
            divisionTeams.sort((a, b) => b.wins - a.wins || a.losses - b.losses);

            if (divisionTeams.length === 0) {
                container.innerHTML = '<div class="error-message">No standings data available</div>';
                return;
            }

            let html = `
                <table class="standings-table">
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>W</th>
                            <th>L</th>
                            <th>PCT</th>
                            <th>GB</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            divisionTeams.forEach(team => {
                const isYankees = team.id === YANKEES_ID;
                html += `
                    <tr class="${isYankees ? 'highlight' : ''}">
                        <td>
                            <div class="team-cell">
                                <span class="team-abbr">${team.abbr}</span>
                                <span>${team.name}</span>
                            </div>
                        </td>
                        <td>${team.wins}</td>
                        <td>${team.losses}</td>
                        <td>${team.pct}</td>
                        <td>${team.gb}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function calculatePythagorean() {
            const container = document.getElementById('pythagoreanContent');

            if (!scheduleData || !scheduleData.events) {
                container.innerHTML = '<div class="error-message">Unable to calculate Pythagorean</div>';
                return;
            }

            let runsScored = 0;
            let runsAllowed = 0;
            let gamesPlayed = 0;

            scheduleData.events.forEach(event => {
                if (event.competitions && event.competitions[0]) {
                    const competition = event.competitions[0];
                    if (competition.status?.type?.completed) {
                        const competitors = competition.competitors || [];
                        let yankeeScore = 0;
                        let opponentScore = 0;

                        competitors.forEach(comp => {
                            if (comp.team?.id === YANKEES_ID) {
                                yankeeScore = parseInt(comp.score) || 0;
                            } else {
                                opponentScore = parseInt(comp.score) || 0;
                            }
                        });

                        if (yankeeScore > 0 || opponentScore > 0) {
                            runsScored += yankeeScore;
                            runsAllowed += opponentScore;
                            gamesPlayed++;
                        }
                    }
                }
            });

            if (gamesPlayed === 0 || runsScored === 0) {
                container.innerHTML = '<div class="error-message">Insufficient data for Pythagorean calculation</div>';
                return;
            }

            // Pythagorean expectation: RS^exp / (RS^exp + RA^exp)
            const rsExp = Math.pow(runsScored, MLB_PYTHAGOREAN_EXP);
            const raExp = Math.pow(runsAllowed, MLB_PYTHAGOREAN_EXP);
            const pythWinPct = rsExp / (rsExp + raExp);
            const expectedWins = Math.round(pythWinPct * gamesPlayed);

            const record = getTeamRecord(teamData);
            const actualWins = record.wins;
            const winDiff = actualWins - expectedWins;
            const diffClass = winDiff > 0 ? 'positive' : winDiff < 0 ? 'negative' : 'neutral';
            const diffSign = winDiff > 0 ? '+' : '';

            container.innerHTML = `
                <div class="pythagorean-display">
                    <div class="pyth-value">${(pythWinPct * 100).toFixed(1)}%</div>
                    <div class="pyth-label">Expected Win Percentage</div>
                    <div class="pyth-comparison">
                        <div class="pyth-stat">
                            <div class="pyth-stat-value">${expectedWins}</div>
                            <div class="pyth-stat-label">Expected Wins</div>
                        </div>
                        <div class="pyth-stat">
                            <div class="pyth-stat-value">${actualWins}</div>
                            <div class="pyth-stat-label">Actual Wins</div>
                        </div>
                        <div class="pyth-stat">
                            <div class="pyth-stat-value ${diffClass}">${diffSign}${winDiff}</div>
                            <div class="pyth-stat-label">Difference</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSchedule() {
            const container = document.getElementById('scheduleContent');

            if (!scheduleData || !scheduleData.events) {
                container.innerHTML = '<div class="error-message">Unable to load schedule</div>';
                return;
            }

            // Get completed games, sorted by date descending
            const completedGames = scheduleData.events
                .filter(event => {
                    const comp = event.competitions?.[0];
                    return comp?.status?.type?.completed;
                })
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 8);

            if (completedGames.length === 0) {
                container.innerHTML = '<div class="error-message">No recent games found</div>';
                return;
            }

            let html = '<div class="schedule-list">';

            completedGames.forEach(event => {
                const comp = event.competitions[0];
                const competitors = comp.competitors || [];

                let isHome = false;
                let opponentName = '';
                let yankeeScore = 0;
                let opponentScore = 0;

                competitors.forEach(c => {
                    if (c.team?.id === YANKEES_ID) {
                        isHome = c.homeAway === 'home';
                        yankeeScore = parseInt(c.score) || 0;
                    } else {
                        opponentName = c.team?.abbreviation || c.team?.displayName || 'OPP';
                        opponentScore = parseInt(c.score) || 0;
                    }
                });

                const isWin = yankeeScore > opponentScore;
                const gameDate = new Date(event.date);
                const dateStr = gameDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const prefix = isHome ? 'vs' : '@';

                html += `
                    <div class="game-item">
                        <div class="game-info">
                            <span class="game-date">${dateStr}</span>
                            <span class="game-opponent">${prefix} ${opponentName}</span>
                        </div>
                        <div class="game-result">
                            <span class="result-badge ${isWin ? 'win' : 'loss'}">${isWin ? 'W' : 'L'}</span>
                            <span class="game-score">${yankeeScore}-${opponentScore}</span>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function renderScoring() {
            const container = document.getElementById('scoringContent');

            if (!scheduleData || !scheduleData.events) {
                container.innerHTML = '<div class="error-message">Unable to load scoring data</div>';
                return;
            }

            let runsScored = 0;
            let runsAllowed = 0;
            let gamesPlayed = 0;

            scheduleData.events.forEach(event => {
                if (event.competitions && event.competitions[0]) {
                    const competition = event.competitions[0];
                    if (competition.status?.type?.completed) {
                        const competitors = competition.competitors || [];

                        competitors.forEach(comp => {
                            if (comp.team?.id === YANKEES_ID) {
                                runsScored += parseInt(comp.score) || 0;
                            } else {
                                runsAllowed += parseInt(comp.score) || 0;
                            }
                        });
                        gamesPlayed++;
                    }
                }
            });

            const avgScored = gamesPlayed > 0 ? (runsScored / gamesPlayed).toFixed(2) : '0.00';
            const avgAllowed = gamesPlayed > 0 ? (runsAllowed / gamesPlayed).toFixed(2) : '0.00';
            const runDiff = runsScored - runsAllowed;
            const diffClass = runDiff > 0 ? 'positive' : runDiff < 0 ? 'negative' : 'neutral';
            const diffSign = runDiff > 0 ? '+' : '';

            container.innerHTML = `
                <div class="scoring-grid">
                    <div class="scoring-item">
                        <div class="scoring-value">${avgScored}</div>
                        <div class="scoring-label">Runs/Game</div>
                    </div>
                    <div class="scoring-item">
                        <div class="scoring-value">${avgAllowed}</div>
                        <div class="scoring-label">Runs Allowed/Game</div>
                    </div>
                    <div class="scoring-item">
                        <div class="scoring-value">${runsScored}</div>
                        <div class="scoring-label">Total Runs Scored</div>
                    </div>
                    <div class="scoring-item">
                        <div class="scoring-value ${diffClass}">${diffSign}${runDiff}</div>
                        <div class="scoring-label">Run Differential</div>
                    </div>
                </div>
            `;
        }

        function updateLastUpdated() {
            const now = new Date();
            const options = {
                timeZone: 'America/Chicago',
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            };
            document.getElementById('lastUpdated').textContent =
                `Last updated: ${now.toLocaleString('en-US', options)} CT • Data from ESPN`;
        }

        async function initDashboard() {
            try {
                await Promise.all([
                    fetchTeamData(),
                    fetchStandings(),
                    fetchSchedule()
                ]);

                renderHeaderStats();
                renderStandings();
                calculatePythagorean();
                renderSchedule();
                renderScoring();
                updateLastUpdated();
            } catch (error) {
                console.error('Dashboard initialization error:', error);
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initDashboard);

        // Auto-refresh every 5 minutes (MLB games are longer)
        setInterval(initDashboard, 300000);
    </script>
</body>
</html>

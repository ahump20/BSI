# JSDoc Documentation Standards

## Overview

All Blaze Sports Intel API endpoints and utility functions must follow these JSDoc conventions for consistency, maintainability, and automatic documentation generation.

## File-Level Documentation

Every API file should start with a file-level JSDoc comment:

```typescript
/**
 * @file College Baseball Games API Endpoint
 * @module api/college-baseball/games
 * @description
 * Fetches complete game data including box scores, auto-generated recaps,
 * and play-by-play data. This is our core differentiator for college baseball.
 *
 * @see {@link https://blazesportsintel.com/docs/api/college-baseball}
 *
 * BSI ADVANTAGE: Complete box scores, player stats, and auto-generated recaps
 * for every college baseball gameâ€”comprehensive coverage fans deserve.
 *
 * @example
 * GET /api/college-baseball/games/401778104
 * GET /api/college-baseball/games/401778104?include=boxscore,recap
 * GET /api/college-baseball/games/401778104?format=compact
 */
```

## Function Documentation

### API Endpoint Functions

```typescript
/**
 * Handle GET request for college baseball game data
 *
 * @async
 * @function onRequest
 * @param {Object} context - Cloudflare Pages context
 * @param {Request} context.request - HTTP request object
 * @param {Object} context.params - URL parameters
 * @param {string|string[]} context.params.gameId - ESPN game ID
 * @param {Env} context.env - Environment bindings (KV, D1, Analytics)
 * @returns {Promise<Response>} JSON response with game data
 *
 * @throws {Error} When game ID is invalid or missing
 * @throws {Error} When adapter fails to fetch data
 *
 * @example
 * // Fetch complete game with recap
 * const response = await onRequest({
 *   request: new Request('https://api.example.com/games/401778104?include=recap'),
 *   params: { gameId: '401778104' },
 *   env: mockEnv
 * });
 */
export const onRequest: PagesFunction<Env> = async (context) => {
  // Implementation
};
```

### Helper Functions

```typescript
/**
 * Generate comprehensive game recap with narrative and statistics
 *
 * ESPN app shows ONLY score and inning - we provide the full story with:
 * - Headline based on context (championship, ranked matchup, etc.)
 * - Detailed summary with hitting/fielding statistics
 * - Key plays identified from scoring patterns
 * - Player performance highlights
 * - Turning point analysis
 *
 * @async
 * @function generateGameRecap
 * @param {Object} game - Game data (may contain competition directly or nested)
 * @param {Object} game.id - ESPN game ID
 * @param {Object} game.date - Game date (ISO 8601)
 * @param {Object} game.competitions - Competition data array
 * @param {Object} boxscore - Box score data with player statistics
 * @param {Env} env - Environment bindings
 * @returns {Promise<NCAAGameRecap>} Structured game recap
 *
 * @throws {Error} When competition data is missing
 * @throws {Error} When team data is incomplete
 *
 * @see {@link NCAAGameRecap} for return type structure
 *
 * @example
 * const recap = await generateGameRecap(game, boxscore, env);
 * // {
 * //   gameId: '401778104',
 * //   headline: '#1 Texas Defeats LSU, 7-3',
 * //   summary: 'Texas defeated LSU 7-3 at Alex Box Stadium...',
 * //   keyPlays: [...],
 * //   playerPerformances: [...],
 * //   turningPoint: {...}
 * // }
 */
async function generateGameRecap(
  game: any,
  boxscore: any,
  env: Env
): Promise<NCAAGameRecap> {
  // Implementation
}
```

### Utility Functions

```typescript
/**
 * Convert number to ordinal string (1st, 2nd, 3rd, etc.)
 *
 * @function ordinal
 * @param {number} n - Number to convert
 * @returns {string} Ordinal string
 *
 * @example
 * ordinal(1)   // '1st'
 * ordinal(2)   // '2nd'
 * ordinal(3)   // '3rd'
 * ordinal(11)  // '11th'
 * ordinal(21)  // '21st'
 */
function ordinal(n: number): string {
  const s = ['th', 'st', 'nd', 'rd'];
  const v = n % 100;
  return n + (s[(v - 20) % 10] || s[v] || s[0]);
}
```

## Type Definitions

Document all custom types and interfaces:

```typescript
/**
 * Environment bindings for Cloudflare Pages Functions
 *
 * @typedef {Object} Env
 * @property {KVNamespace} KV - KV namespace for caching
 * @property {D1Database} [DB] - D1 database for historical data
 * @property {AnalyticsEngineDataset} [ANALYTICS] - Analytics Engine binding
 * @property {any} [AI] - Cloudflare Workers AI binding
 */
interface Env {
  KV: KVNamespace;
  DB?: D1Database;
  ANALYTICS?: AnalyticsEngineDataset;
  AI?: any;
}

/**
 * Structured game recap generated by Blaze Intelligence
 *
 * @typedef {Object} NCAAGameRecap
 * @property {string} gameId - ESPN game ID
 * @property {string} headline - Contextual headline (championship, ranked, etc.)
 * @property {string} summary - Detailed narrative summary with statistics
 * @property {KeyPlay[]} keyPlays - Top 5 key plays from the game
 * @property {PlayerPerformance[]} playerPerformances - Top 5 player performances
 * @property {TurningPoint} [turningPoint] - Identified turning point
 * @property {Object} generated - Generation metadata
 * @property {string} generated.timestamp - Generation timestamp (ISO 8601)
 * @property {string} generated.model - Model identifier
 * @property {number} generated.confidence - Confidence score (0-1)
 */
interface NCAAGameRecap {
  gameId: string;
  headline: string;
  summary: string;
  keyPlays: KeyPlay[];
  playerPerformances: PlayerPerformance[];
  turningPoint?: TurningPoint;
  generated: {
    timestamp: string;
    model: string;
    confidence: number;
  };
}
```

## Parameter Documentation

### Required vs Optional

```typescript
/**
 * Fetch game summary with optional caching
 *
 * @param {string} gameId - ESPN game ID (required)
 * @param {Object} [options] - Optional configuration
 * @param {boolean} [options.useCache=true] - Whether to use KV cache
 * @param {number} [options.timeout=5000] - Request timeout in milliseconds
 * @returns {Promise<GameSummary>} Game summary data
 */
async function fetchGameSummary(
  gameId: string,
  options?: {
    useCache?: boolean;
    timeout?: number;
  }
): Promise<GameSummary> {
  // Implementation
}
```

## Error Documentation

Document all possible errors:

```typescript
/**
 * Validate Web Vitals payload structure
 *
 * @param {any} data - Data to validate
 * @returns {boolean} True if valid Web Vitals payload
 *
 * @throws {TypeError} When data is not an object
 * @throws {ValidationError} When required fields are missing
 * @throws {ValidationError} When field types are incorrect
 *
 * @example
 * try {
 *   const isValid = isValidWebVital(data);
 * } catch (error) {
 *   if (error instanceof ValidationError) {
 *     console.error('Validation failed:', error.message);
 *   }
 * }
 */
function isValidWebVital(data: any): data is WebVital {
  // Implementation
}
```

## Tags Reference

### Essential Tags

- `@file` - File description
- `@module` - Module name for organization
- `@description` - Detailed description (multi-line)
- `@param` - Function parameters
- `@returns` - Return value
- `@throws` - Possible errors
- `@example` - Usage examples
- `@see` - Related documentation
- `@deprecated` - Deprecated functions

### Type Tags

- `@typedef` - Type definition
- `@type` - Variable type
- `@template` - Generic type parameter

### Function Tags

- `@async` - Async function
- `@function` - Function name
- `@callback` - Callback function type
- `@private` - Private function
- `@public` - Public API

### Project-Specific Tags

- `@espn-gap` - Features that fill ESPN coverage gaps
- `@data-source` - Primary data source
- `@cache-ttl` - Cache time-to-live
- `@rate-limit` - Rate limiting info

## Example: Complete API Endpoint

```typescript
/**
 * @file Web Vitals Analytics Endpoint
 * @module api/analytics/vitals
 * @description
 * Receives and stores Core Web Vitals metrics for performance monitoring.
 * Implements rate limiting, validation, and dual storage (Analytics Engine + KV).
 *
 * @rate-limit 60 requests per minute per IP
 * @cache-ttl Rate limit: 60 seconds, KV storage: 7 days
 *
 * @see {@link https://web.dev/vitals/}
 */

import type { PagesFunction } from '@cloudflare/workers-types';

/**
 * Environment bindings for Web Vitals endpoint
 *
 * @typedef {Object} Env
 * @property {KVNamespace} KV - For rate limiting and sampled storage
 * @property {AnalyticsEngineDataset} [ANALYTICS] - For aggregated metrics
 */
interface Env {
  KV: KVNamespace;
  ANALYTICS?: AnalyticsEngineDataset;
}

/**
 * Handle POST request - Store Web Vitals data
 *
 * Validates payload, checks rate limits, and stores metrics in both
 * Analytics Engine (all requests) and KV (10% sample for detail analysis).
 *
 * @async
 * @function onRequestPost
 * @param {Object} context - Cloudflare Pages context
 * @param {Request} context.request - HTTP request with Web Vitals JSON payload
 * @param {Env} context.env - Environment bindings
 * @returns {Promise<Response>} Success/error response with rate limit headers
 *
 * @throws {400} When payload fails validation
 * @throws {429} When rate limit exceeded
 * @throws {500} When server error occurs
 *
 * @example
 * // Valid request
 * fetch('/api/analytics/vitals', {
 *   method: 'POST',
 *   headers: { 'Content-Type': 'application/json' },
 *   body: JSON.stringify({
 *     name: 'LCP',
 *     value: 2345,
 *     rating: 'good',
 *     // ... other fields
 *   })
 * });
 *
 * @example
 * // Rate limited response
 * {
 *   status: 429,
 *   headers: {
 *     'X-RateLimit-Remaining': '0',
 *     'Retry-After': '60'
 *   },
 *   body: {
 *     error: 'Rate limit exceeded',
 *     message: 'Too many requests. Please try again in a minute.'
 *   }
 * }
 */
export const onRequestPost: PagesFunction<Env> = async (context) => {
  // Implementation
};
```

## Best Practices

1. **Always document public APIs** - Every exported function needs JSDoc
2. **Include examples** - At least one example per function
3. **Document edge cases** - Note special behaviors and limitations
4. **Link related docs** - Use `@see` to connect related functions
5. **Keep descriptions concise** - First line should be < 100 characters
6. **Update when refactoring** - JSDoc should always match implementation
7. **Use Blaze terminology** - "ESPN Gap", "Data Source", etc.
8. **Include Blaze metadata** - Data sources, cache TTLs, rate limits

## Automation

Use JSDoc to generate documentation:

```bash
# Generate HTML documentation
npx jsdoc -c jsdoc.json

# Generate Markdown for GitHub
npx jsdoc2md lib/**/*.ts > docs/API.md

# Type checking with JSDoc
npx tsc --checkJs --allowJs
```

## ESLint Rules

Enable JSDoc linting in `.eslintrc.json`:

```json
{
  "plugins": ["jsdoc"],
  "extends": ["plugin:jsdoc/recommended"],
  "rules": {
    "jsdoc/require-jsdoc": ["error", {
      "require": {
        "FunctionDeclaration": true,
        "MethodDefinition": true,
        "ClassDeclaration": true,
        "ArrowFunctionExpression": true,
        "FunctionExpression": true
      }
    }],
    "jsdoc/require-description": "error",
    "jsdoc/require-param-description": "error",
    "jsdoc/require-returns-description": "error",
    "jsdoc/require-example": ["warn", {
      "exemptedBy": ["private", "abstract"]
    }]
  }
}
```

---

**Last Updated:** 2025-11-06
**Version:** 1.0.0
**Maintainer:** Blaze Sports Intel Development Team

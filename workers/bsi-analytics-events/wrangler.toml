# =============================================================================
# BSI Analytics Events Worker
# =============================================================================
# Dedicated Worker for behavioral analytics ingestion into D1.
# Isolated from the main API to keep analytics traffic separate.
#
# Deploy: wrangler deploy --config workers/bsi-analytics-events/wrangler.toml
# =============================================================================

name = "bsi-analytics-events"
main = "index.ts"
compatibility_date = "2025-12-01"

# ---------------------------------------------------------------------------
# Development (default — `wrangler dev`)
# ---------------------------------------------------------------------------

[[d1_databases]]
binding = "EVENTS_DB"
database_name = "bsi-events-db"
database_id = "964e9870-aef6-4f6c-b500-cf3244ba4316"

[vars]
ENVIRONMENT = "development"

[dev]
port = 8790
local_protocol = "http"

# ---------------------------------------------------------------------------
# Production — `wrangler deploy --env production`
# ---------------------------------------------------------------------------

[env.production]
name = "bsi-analytics-events"
routes = [
  { pattern = "blazesportsintel.com/api/events", zone_name = "blazesportsintel.com" },
  { pattern = "blazesportsintel.com/api/events/*", zone_name = "blazesportsintel.com" }
]

[env.production.vars]
ENVIRONMENT = "production"

[[env.production.d1_databases]]
binding = "EVENTS_DB"
database_name = "bsi-events-db"
database_id = "964e9870-aef6-4f6c-b500-cf3244ba4316"

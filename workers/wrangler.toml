# =============================================================================
# Blaze Sports Intel â€” Workers Configuration (Hybrid Router)
# =============================================================================
# This Worker is the apex entry-point for blazesportsintel.com.
# It handles dynamic routes (API, WebSocket, auth) and proxies static
# requests to the Cloudflare Pages project.
# =============================================================================

name = "blazesportsintel-worker"
main = "index.ts"
compatibility_date = "2024-08-23"

# Production environment
[env.production]
name = "blazesportsintel-worker-prod"
routes = [
  { pattern = "blazesportsintel.com/*", zone_name = "blazesportsintel.com" },
  { pattern = "www.blazesportsintel.com/*", zone_name = "blazesportsintel.com" }
]

# ---------------------------------------------------------------------------
# KV Namespaces
# ---------------------------------------------------------------------------
[[kv_namespaces]]
binding = "KV"
id = "e6cb68e815cd45babeee0e10460dbfee"
preview_id = "e6cb68e815cd45babeee0e10460dbfee"

# ---------------------------------------------------------------------------
# D1 Database
# ---------------------------------------------------------------------------
[[d1_databases]]
binding = "DB"
database_name = "bsi-prod-db"
database_id = "6921617f-5351-4df3-aeab-07425e72ec6b"

# ---------------------------------------------------------------------------
# R2 Buckets
# ---------------------------------------------------------------------------
[[r2_buckets]]
binding = "ASSETS_BUCKET"
bucket_name = "bsi-game-assets"

# ---------------------------------------------------------------------------
# Durable Objects
# ---------------------------------------------------------------------------
[[durable_objects.bindings]]
name = "CACHE"
class_name = "CacheObject"

[[durable_objects.bindings]]
name = "PORTAL_POLLER"
class_name = "PortalPoller"

[[migrations]]
tag = "v1"
new_classes = ["CacheObject"]

[[migrations]]
tag = "v2"
new_classes = ["PortalPoller"]

# ---------------------------------------------------------------------------
# Environment Variables
# ---------------------------------------------------------------------------
[vars]
ENVIRONMENT = "production"
API_VERSION = "1.0.0"
PAGES_ORIGIN = "https://blazesportsintel.pages.dev"

# ---------------------------------------------------------------------------
# Secrets (set via `wrangler secret put`)
# ---------------------------------------------------------------------------
# NOTION_TOKEN
# STRIPE_SECRET_KEY
# AMPLITUDE_API_KEY
# RAPIDAPI_KEY

# ---------------------------------------------------------------------------
# Development
# ---------------------------------------------------------------------------
[dev]
port = 8787
local_protocol = "http"

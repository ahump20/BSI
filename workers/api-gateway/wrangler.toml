# ============================================================================
# BSI API GATEWAY WORKER
# Central routing for all BSI API endpoints
# ============================================================================
name = "bsi-api-gateway"
main = "src/index.ts"
compatibility_date = "2025-03-07"
compatibility_flags = ["nodejs_compat"]

# ============================================================================
# Environment Variables
# ============================================================================
[vars]
ENVIRONMENT = "production"
API_VERSION = "v1"
RATE_LIMIT_REQUESTS = "100"
RATE_LIMIT_WINDOW_SECONDS = "3600"

# ============================================================================
# KV Namespaces
# ============================================================================
# Primary cache for live scores
[[kv_namespaces]]
binding = "CACHE_SCORES"
id = "BSI_CACHE_SCORES_ID"  # Replace with actual ID after creation

# Odds cache (5-min TTL for real-time access)
[[kv_namespaces]]
binding = "CACHE_ODDS"
id = "BSI_CACHE_ODDS_ID"    # Replace with actual ID after creation

# Session data storage
[[kv_namespaces]]
binding = "SESSION_DATA"
id = "BSI_SESSION_DATA_ID"  # Replace with actual ID after creation

# Legacy unified cache (for backwards compatibility)
[[kv_namespaces]]
binding = "KV"
id = "a53c3726fc3044be82e79d2d1e371d26"

# ============================================================================
# D1 Databases
# ============================================================================
# Core database with predictions
[[d1_databases]]
binding = "DB"
database_name = "bsi-core-db"
database_id = "BSI_CORE_DB_ID"  # Replace with actual ID after creation

# Historical database for backwards compatibility
[[d1_databases]]
binding = "HISTORICAL_DB"
database_name = "bsi-historical-db"
database_id = "9cecff0f-a3ab-433f-bf10-d2664d9542b0"

# ============================================================================
# R2 Buckets
# ============================================================================
# Primary assets bucket
[[r2_buckets]]
binding = "ASSETS"
bucket_name = "bsi-assets"

# Sports data lake
[[r2_buckets]]
binding = "SPORTS_DATA"
bucket_name = "blaze-sports-data-lake"

# ============================================================================
# AI Services
# ============================================================================
[ai]
binding = "AI"

# Vectorize for semantic search
[[vectorize]]
binding = "VECTORIZE"
index_name = "sports-scouting-index"

# ============================================================================
# Analytics
# ============================================================================
[[analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "bsi_sports_metrics"

# ============================================================================
# Routes (Production)
# ============================================================================
# Uncomment and configure for production deployment
# routes = [
#   { pattern = "api.blazesportsintel.com/*", zone_name = "blazesportsintel.com" },
#   { pattern = "blazesportsintel.com/api/*", zone_name = "blazesportsintel.com" }
# ]

# ============================================================================
# Secrets (Set via wrangler secret put)
# ============================================================================
# Required secrets:
# - THEODDSAPI_KEY: The Odds API key
# - SPORTSDATAIO_KEY: SportsDataIO API key
# - SPORTSRADAR_KEY: SportsRadar API key
# - OPENAI_API_KEY: OpenAI for AI analysis
# - ANTHROPIC_API_KEY: Claude for research
# - STRIPE_SECRET_KEY: Stripe payments
# - JWT_SECRET: Session management

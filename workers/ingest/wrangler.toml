# Cloudflare Workers Configuration - Ingest Worker
# Purpose: Scheduled data ingestion with provider failover
# Deployment: wrangler deploy (from workers/ingest/)

name = "blazesports-ingest"
compatibility_date = "2025-01-01"
main = "index.ts"

# Worker Type
workers_dev = true

# Triggers
[[triggers.crons]]
# Live games - every 5 minutes
crons = ["*/5 * * * *"]

[[triggers.crons]]
# Team stats refresh - hourly
crons = ["0 * * * *"]

[[triggers.crons]]
# Historical aggregations - daily at 2am CST
crons = ["0 2 * * *"]

# Environment Variables
[vars]
# These will be set via wrangler secret put
# SPORTSDATA_API_KEY = ""
# NCAA_API_KEY = ""
# ESPN_API_KEY = ""
# INGEST_SECRET = ""
# DATABASE_URL = ""

# KV Namespace (Cache)
[[kv_namespaces]]
binding = "CACHE"
id = "a53c3726fc3044be82e79d2d1e371d26"  # Production KV namespace

# R2 Bucket (Archives)
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "blazesports-archives"

# Analytics Engine
[[analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "bsi_ingest_analytics"

# Build Configuration
[build]
command = "npm run build"

[build.upload]
format = "service-worker"

# Compatibility Flags
[compatibility_flags]
nodejs_compat = true

name = "bsi-cbb-sync"
main = "index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]
account_id = "a12cb329d84130460eed99b816e4d0d3"

[observability]
enabled = true
head_sampling_rate = 1

[vars]
ENVIRONMENT = "production"

# D1 Database (college baseball tables)
[[d1_databases]]
binding = "BSI_DB"
database_name = "bsi-game-db"
database_id = "88eb676f-af0f-470c-a46a-b9429f5b51f3"

# KV namespace for caching and rate limiting
[[kv_namespaces]]
binding = "BSI_CACHE"
id = "a53c3726fc3044be82e79d2d1e371d26"

# R2 bucket for NIL data imports
[[r2_buckets]]
binding = "BSI_NIL_BUCKET"
bucket_name = "blaze-nil-archive"

# Analytics Engine for sync event logging
[[analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "bsi_cbb_sync_analytics"

# Cron triggers for scheduled sync
# Every 5 minutes for live scores during season (Feb-Jun)
# Every 6 hours for standings/stats
[triggers]
crons = [
  "*/5 * * 2-6 *",   # Live scores - every 5 min, Feb-Jun only
  "0 */6 * * *",     # Teams/standings - every 6 hours
  "0 3 * * *"        # Full refresh - daily at 3am CST
]

# Route for manual sync triggers
[[routes]]
pattern = "api.blazesportsintel.com/sync/cbb/*"
zone_name = "blazesportsintel.com"

# Development configuration
[dev]
port = 8792
local_protocol = "http"

# Staging environment
[env.staging]
name = "bsi-cbb-sync-staging"
[env.staging.vars]
ENVIRONMENT = "staging"

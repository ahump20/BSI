name = "college-baseball-tracker"
pages_build_output_dir = "out"
compatibility_date = "2025-03-07"
compatibility_flags = ["nodejs_compat"]

# ============================================
# Resource Bindings
# ============================================

# KV namespace for unified caching
# Use key prefixes to separate concerns:
#   - cache:* for general caching
#   - cache:nil:* for NIL API caching
#   - query:* for query results
#   - rate_limit:* for rate limiting
#   - vitals:* for Web Vitals storage
#   - scores:* for live scores
#   - odds:* for betting odds
#   - session:* for user sessions
kv_namespaces = [
  { binding = "KV", id = "a53c3726fc3044be82e79d2d1e371d26" },
  { binding = "NIL_CACHE", id = "a53c3726fc3044be82e79d2d1e371d26", preview_id = "a53c3726fc3044be82e79d2d1e371d26" },
  { binding = "BSI_CACHE", id = "429e580ad8aa4a189af2513490d8790d", preview_id = "f2dc8c57c641403481809db1a4962822" },
  { binding = "BSI_FANBASE_CACHE", id = "88ada3ae7b2849349c260adabf209760" },
  { binding = "SPORTS_DATA_KV", id = "59cef06483214198b85a6946af5ad8c2" },
  { binding = "BSI_SESSIONS", id = "bbd57107270f485cb105adde9bcab727" },
]

# New dedicated KV namespaces (IDs populated by setup script)
# Run scripts/setup-cloudflare-infrastructure.sh to create these
# [[kv_namespaces]]
# binding = "CACHE_SCORES"
# id = "BSI_CACHE_SCORES_ID"  # Live scores cache (60s TTL)
#
# [[kv_namespaces]]
# binding = "CACHE_ODDS"
# id = "BSI_CACHE_ODDS_ID"    # Betting odds cache (5min TTL)
#
# [[kv_namespaces]]
# binding = "SESSION_DATA"
# id = "BSI_SESSION_DATA_ID"  # User session storage

# Environment variables
[vars]
ENVIRONMENT = "production"

# D1 database for storing historical sports data
[[d1_databases]]
binding = "DB"
database_name = "bsi-historical-db"
database_id = "9cecff0f-a3ab-433f-bf10-d2664d9542b0"

# D1 database for NIL valuations (uses same DB with nil_ prefixed tables)
[[d1_databases]]
binding = "NIL_DB"
database_name = "bsi-historical-db"
database_id = "9cecff0f-a3ab-433f-bf10-d2664d9542b0"

# D1 database for game data (transfer portal, rosters, player headshots)
[[d1_databases]]
binding = "GAME_DB"
database_name = "bsi-game-db"
database_id = "88eb676f-af0f-470c-a46a-b9429f5b51f3"

# D1 database for fanbase sentiment tracking
# Create with: wrangler d1 create bsi-fanbase-db
# Then run migration: wrangler d1 execute bsi-fanbase-db --file=./migrations/011_fanbase_sentiment.sql
[[d1_databases]]
binding = "FANBASE_DB"
database_name = "bsi-fanbase-db"
database_id = "955e3dc2-4ea1-4b46-8464-0340f1cf3fc5"

# Core database with predictions (created by setup script)
# Run scripts/setup-cloudflare-infrastructure.sh to create
# [[d1_databases]]
# binding = "CORE_DB"
# database_name = "bsi-core-db"
# database_id = "BSI_CORE_DB_ID"  # Multi-sport with predictions

# Note: Durable Objects deployed separately as a Worker
# See wrangler.worker.toml for GAME_MONITOR configuration

# ============================================
# Stripe Payment Integration (REQUIRED for payments)
# ============================================
# Set these secrets via Cloudflare Dashboard or CLI:
#
#   wrangler secret put STRIPE_SECRET_KEY
#   wrangler secret put STRIPE_WEBHOOK_SECRET
#   wrangler secret put STRIPE_PRO_PRICE_ID
#   wrangler secret put STRIPE_ENTERPRISE_PRICE_ID
#   wrangler secret put JWT_SECRET
#
# Required secrets:
# - STRIPE_SECRET_KEY: Stripe secret key (sk_live_... or sk_test_...)
# - STRIPE_WEBHOOK_SECRET: Webhook signing secret (whsec_...)
# - STRIPE_PRO_PRICE_ID: Pro tier price ID (price_1SX9voLvpRBk20R2pW0AjUIv)
# - STRIPE_ENTERPRISE_PRICE_ID: Enterprise tier price ID (price_1SX9w7LvpRBk20R2DJkKAH3y)
# - JWT_SECRET: For session management
#
# Stripe Products (Test Mode):
# - Pro: $29/month (prod_TU8BMcfS4eKWPR)
# - Enterprise: $199/month (prod_TU8CTVQzZyiZFs)

# ============================================
# AI Services Configuration
# ============================================

# Workers AI - enables AI inference at the edge
[ai]
binding = "AI"

# Vectorize - semantic search for sports data
[[vectorize]]
binding = "VECTORIZE"
index_name = "sports-scouting-index"

# R2 bucket for sports data storage (used by AI Search)
[[r2_buckets]]
binding = "SPORTS_DATA"
bucket_name = "blaze-sports-data-lake"

# R2 bucket for NIL historical data archives
[[r2_buckets]]
binding = "NIL_ARCHIVE"
bucket_name = "blaze-nil-archive"

# Primary assets bucket (created by setup script)
# Run scripts/setup-cloudflare-infrastructure.sh to create
# [[r2_buckets]]
# binding = "ASSETS"
# bucket_name = "bsi-assets"  # Images, PDFs, static files

# Analytics Engine for time-series sports metrics
[[analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "bsi_sports_metrics"

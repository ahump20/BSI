# BLAZE INTELLIGENCE - CLOUDFLARE PAGES CONFIGURATION
# Championship Sports Intelligence Platform - blazesportsintel.com
# Transform Data Into Championships

name = "blazesportsintel"
compatibility_date = "2024-09-26"
compatibility_flags = ["nodejs_compat", "streams_enable_constructors"]
pages_build_output_dir = "."

# Account & Zone Configuration
account_id = "a12cb329d84130460eed99b816e4d0d3"
zone_id = "blazesportsintel.com"

# ==================== PRODUCTION ENVIRONMENT ====================
[env.production]
name = "blazesportsintel"
route = "blazesportsintel.com/*"

# R2 Storage Buckets - Media & Data Storage
[[env.production.r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "blazesportsintel-media"

[[env.production.r2_buckets]]
binding = "DATA_BUCKET"
bucket_name = "blazesportsintel-data"

[[env.production.r2_buckets]]
binding = "ANALYTICS_BUCKET"
bucket_name = "blazesportsintel-analytics"

# KV Namespaces - High-Performance Caching
[[env.production.kv_namespaces]]
binding = "CACHE"
id = "blazesportsintel_cache_prod"

[[env.production.kv_namespaces]]
binding = "ANALYTICS_KV"
id = "blazesportsintel_analytics_prod"

[[env.production.kv_namespaces]]
binding = "CONFIG"
id = "blazesportsintel_config_prod"

[[env.production.kv_namespaces]]
binding = "DRIFT_KV"
id = "blazesportsintel_drift_prod"

# D1 Database - Structured Data Storage
[[env.production.d1_databases]]
binding = "DB"
database_name = "blazesportsintel-production"
database_id = "blazesportsintel-prod-db"

# Durable Objects - Stateful Edge Computing
[[env.production.durable_objects.bindings]]
name = "MONTE_CARLO_ENGINE"
class_name = "MonteCarloEngine"
script_name = "monte-carlo-engine"

[[env.production.durable_objects.bindings]]
name = "CHAMPIONSHIP_ANALYTICS"
class_name = "ChampionshipAnalytics"
script_name = "championship-analytics"

# Production Environment Variables
[env.production.vars]
ENVIRONMENT = "production"
API_VERSION = "v1"
CDN_URL = "https://cdn.blazesportsintel.com"
ANALYTICS_ENDPOINT = "https://analytics.blazesportsintel.com"
MONITORING_ENDPOINT = "https://monitoring.blazesportsintel.com"
SPORTS_DATA_REFRESH_INTERVAL = "300"
CACHE_TTL = "3600"

# ==================== PREVIEW ENVIRONMENT ====================
[env.preview]
name = "blazesportsintel-preview"
route = "preview.blazesportsintel.com/*"

# Preview R2 Buckets
[[env.preview.r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "blazesportsintel-media-preview"

[[env.preview.r2_buckets]]
binding = "DATA_BUCKET"
bucket_name = "blazesportsintel-data-preview"

[[env.preview.r2_buckets]]
binding = "ANALYTICS_BUCKET"
bucket_name = "blazesportsintel-analytics-preview"

# Preview KV Namespaces
[[env.preview.kv_namespaces]]
binding = "CACHE"
id = "blazesportsintel_cache_preview"

[[env.preview.kv_namespaces]]
binding = "ANALYTICS_KV"
id = "blazesportsintel_analytics_preview"

[[env.preview.kv_namespaces]]
binding = "CONFIG"
id = "blazesportsintel_config_preview"

# Preview Environment Variables
[env.preview.vars]
ENVIRONMENT = "preview"
API_VERSION = "v1-preview"
CDN_URL = "https://preview-cdn.blazesportsintel.com"
ANALYTICS_ENDPOINT = "https://preview-analytics.blazesportsintel.com"
MONITORING_ENDPOINT = "https://preview-monitoring.blazesportsintel.com"
SPORTS_DATA_REFRESH_INTERVAL = "60"
CACHE_TTL = "300"

# ==================== DEVELOPMENT ENVIRONMENT ====================
[env.development]
name = "blazesportsintel-dev"
route = "dev.blazesportsintel.com/*"

[env.development.vars]
ENVIRONMENT = "development"
API_VERSION = "v1-dev"
DEBUG = "true"
SPORTS_DATA_REFRESH_INTERVAL = "30"
CACHE_TTL = "60"

# ==================== QUEUE CONFIGURATION ====================
[[queues.producers]]
binding = "SPORTS_DATA_QUEUE"
queue = "sports-data-processing"

[[queues.producers]]
binding = "ANALYTICS_QUEUE"
queue = "analytics-processing"

[[queues.producers]]
binding = "CHAMPIONSHIP_QUEUE"
queue = "championship-processing"

# ==================== BUILD & DEPLOYMENT ====================
[build]
command = ""  # No build command needed for static site
cwd = "."
watch_paths = ["*.html", "*.js", "*.css", "js/**/*", "css/**/*", "data/**/*"]

# Upload Configuration
[site]
bucket = "."
include = ["*.html", "*.js", "*.css", "*.json", "*.xml", "*.txt", "*.ico"]
exclude = ["node_modules", "*.md", "*.sh", ".git", ".env*", "*.log", "*.pyc", "__pycache__"]

# ==================== TRIGGERS & AUTOMATION ====================
[[triggers]]
crons = ["*/30 * * * *"]  # Every 30 minutes for data refresh

[[triggers]]
crons = ["0 8 * * *"]  # 2 AM CT daily for drift monitoring

[[triggers]]
crons = ["*/15 * * * *"]  # Every 15 minutes for real-time drift checks

# ==================== OBSERVABILITY ====================
[observability]
enabled = true

logpush = true

[tail]
enabled = true
sample_rate = 0.1

# ==================== RULES & REDIRECTS ====================
# Rules are handled in _redirects file for Cloudflare Pages
# See _redirects for www to non-www and clean URL handling

# ==================== ADVANCED FEATURES ====================
# WebAssembly Support
[wasm_modules]
SPORTS_ANALYTICS_WASM = "./wasm/sports-analytics.wasm"
MONTE_CARLO_WASM = "./wasm/monte-carlo.wasm"

# Analytics Engine Datasets
[[analytics_engine_datasets]]
binding = "SPORTS_ANALYTICS"
dataset = "sports_performance"

[[analytics_engine_datasets]]
binding = "USER_ANALYTICS"
dataset = "user_behavior"

[[analytics_engine_datasets]]
binding = "DRIFT_ANALYTICS"
dataset = "drift_metrics"

# Rate Limiting
[[ratelimit]]
binding = "API_LIMITER"
namespace_id = "blazesportsintel_ratelimit"
simple = { limit = 100, period = 60 }

# Browser Rendering for Dynamic Content
[browser]
binding = "BROWSER"

# Vectorize for ML Models
[[vectorize]]
binding = "EMBEDDINGS"
index_name = "sports-intelligence-vectors"

# AI Gateway
[ai]
binding = "AI"

# Email Routing
[[send_email]]
name = "CONTACT_EMAIL"
destination_address = "contact@blazesportsintel.com"

# Hyperdrive for Database Connections
[[hyperdrive]]
binding = "HYPERDRIVE"
id = "blazesportsintel-hyperdrive"

# Service Bindings for Microservices
[[services]]
binding = "AUTH_SERVICE"
service = "blazesportsintel-auth"
environment = "production"

[[services]]
binding = "DATA_SERVICE"
service = "blazesportsintel-data"
environment = "production"

# Mtls Certificates for Secure Communications
[[mtls_certificates]]
binding = "CLIENT_CERT"
certificate_id = "blazesportsintel-client-cert"

# Custom Error Pages
[error_pages]
404 = "404.html"
500 = "500.html"

# ==================== DEPLOYMENT NOTES ====================
# Deploy with: wrangler pages deploy . --project-name=blazesportsintel
# Preview with: wrangler pages dev .
# Production URL: https://blazesportsintel.com
# Preview URL: https://blazesportsintel.pages.dev
# API Endpoint: https://api.blazesportsintel.com
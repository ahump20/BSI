---
description: Zod validation schema conventions
globs:
  - lib/validation/**/*.ts
  - "**/*.schema.ts"
---

# Validation Schemas (BSI)

Use Zod for all input validation at system boundaries.

## Location
Primary schemas live in `lib/validation/schemas/`

## Naming conventions
- Schema files: `{domain}.schema.ts`
- Schema exports: `{Entity}Schema` (e.g., `GameSchema`, `PlayerSchema`)
- Inferred types: `type {Entity} = z.infer<typeof {Entity}Schema>`

## Schema patterns

### Basic entity
```typescript
import { z } from 'zod';

export const GameSchema = z.object({
  id: z.string().uuid(),
  homeTeam: z.string().min(1),
  awayTeam: z.string().min(1),
  date: z.string().datetime(),
  status: z.enum(['scheduled', 'in_progress', 'final']),
});

export type Game = z.infer<typeof GameSchema>;
```

### API response validation
```typescript
export const APIResponseSchema = z.object({
  success: z.boolean(),
  data: GameSchema.optional(),
  error: z.object({
    code: z.string(),
    message: z.string(),
  }).optional(),
});
```

### Partial schemas for updates
```typescript
export const GameUpdateSchema = GameSchema.partial().omit({ id: true });
```

## Validation placement
- **API routes:** Validate request body/params at handler entry
- **Adapters:** Validate external API responses before processing
- **Forms:** Validate user input before submission

## Error handling
```typescript
const result = GameSchema.safeParse(data);
if (!result.success) {
  // Log validation errors with context
  console.error('Validation failed:', result.error.flatten());
  throw new ValidationError(result.error);
}
```

## Sports-specific schemas
- Include `source` field for data provenance
- Include `fetchedAt` for cache freshness
- Use enums for known value sets (teams, conferences, etc.)

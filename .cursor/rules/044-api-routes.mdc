---
description: API route conventions
globs:
  - app/api/**/*.ts
  - app/api/**/*.js
  - lib/api/**/*.ts
---

# API Routes (BSI)

## Response format
All API responses should follow this structure:
```typescript
{
  success: boolean;
  data?: T;
  error?: {
    code: string;
    message: string;
  };
  meta?: {
    source: string;
    fetchedAt: string;  // ISO 8601, America/Chicago
    cached: boolean;
  };
}
```

## Error handling
- Return appropriate HTTP status codes
- Include actionable error messages
- Log errors with context (endpoint, params, timing)
- Never expose internal errors to clients

## Caching
- Set appropriate `Cache-Control` headers
- Use KV for frequently accessed data
- Include `stale-while-revalidate` where appropriate

## Rate limiting
- Implement rate limiting for public endpoints
- Return `429` with `Retry-After` header when limited

## Validation
- Validate all inputs (query params, body, headers)
- Use Zod schemas for consistent validation
- Return `400` for validation failures with details

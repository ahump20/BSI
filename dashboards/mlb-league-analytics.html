<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MLB League Analytics | Blaze Intelligence</title>
    <meta
      name="description"
      content="Complete MLB league analytics for all 30 teams - Pythagorean win expectancy, power rankings, statistical leaders, and playoff probability analysis"
    />

    <!-- Chart.js for Data Visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      /* === GLOBAL RESET & BASE === */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        /* Blaze Intelligence System Colors (Neutral - No Team Bias) */
        --blaze-burnt-orange: #bf5700;
        --blaze-ember: #cc6600;
        --blaze-background: #0a0a0a;
        --blaze-surface: rgba(26, 26, 26, 0.6);
        --blaze-text: #e0e0e0;
        --blaze-text-secondary: #a0a0a0;
        --blaze-border: rgba(191, 87, 0, 0.3);

        /* Glassmorphism */
        --glass-bg: rgba(26, 26, 26, 0.4);
        --glass-border: rgba(191, 87, 0, 0.2);
        --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);

        /* Typography */
        --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        --font-mono: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
      }

      body {
        font-family: var(--font-primary);
        background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
        color: var(--blaze-text);
        min-height: 100vh;
        padding: 2rem;
        line-height: 1.6;
      }

      /* === HEADER === */
      .header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 2rem;
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 16px;
        box-shadow: var(--glass-shadow);
      }

      .header h1 {
        font-size: 3rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--blaze-burnt-orange), var(--blaze-ember));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.5rem;
        letter-spacing: -0.02em;
      }

      .header .subtitle {
        font-size: 1.1rem;
        color: var(--blaze-text-secondary);
        font-weight: 500;
        margin-bottom: 1rem;
      }

      .header .tagline {
        font-size: 0.9rem;
        color: var(--blaze-burnt-orange);
        font-family: var(--font-mono);
        text-transform: uppercase;
        letter-spacing: 0.1em;
      }

      .league-badges {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 1.5rem;
        flex-wrap: wrap;
      }

      .league-badge {
        display: inline-block;
        padding: 0.5rem 1rem;
        background: rgba(191, 87, 0, 0.2);
        border: 1px solid var(--blaze-burnt-orange);
        border-radius: 8px;
        font-size: 0.85rem;
        color: var(--blaze-burnt-orange);
        font-family: var(--font-mono);
      }

      /* === FILTER BAR === */
      .filter-bar {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .filter-btn {
        padding: 0.75rem 1.5rem;
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 8px;
        color: var(--blaze-text);
        font-family: var(--font-primary);
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s;
        backdrop-filter: blur(10px);
      }

      .filter-btn:hover {
        border-color: var(--blaze-burnt-orange);
        background: rgba(191, 87, 0, 0.1);
      }

      .filter-btn.active {
        background: var(--blaze-burnt-orange);
        border-color: var(--blaze-burnt-orange);
        color: #ffffff;
      }

      /* === DASHBOARD GRID === */
      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 2rem;
        max-width: 1600px;
        margin: 0 auto;
      }

      .analytics-card {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: var(--glass-shadow);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .analytics-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--blaze-burnt-orange), var(--blaze-ember));
        opacity: 0;
        transition: opacity 0.3s;
      }

      .analytics-card:hover {
        transform: translateY(-4px);
        border-color: var(--blaze-burnt-orange);
        box-shadow: 0 12px 48px rgba(191, 87, 0, 0.3);
      }

      .analytics-card:hover::before {
        opacity: 1;
      }

      .analytics-card.wide {
        grid-column: 1 / -1;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--glass-border);
      }

      .card-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--blaze-burnt-orange);
      }

      .card-icon {
        font-size: 1.5rem;
        opacity: 0.6;
      }

      /* === STANDINGS TABLE === */
      .standings-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85rem;
      }

      .standings-table thead {
        background: rgba(191, 87, 0, 0.2);
      }

      .standings-table th {
        padding: 0.75rem 0.5rem;
        text-align: left;
        font-weight: 600;
        color: var(--blaze-burnt-orange);
        border-bottom: 2px solid var(--blaze-burnt-orange);
      }

      .standings-table th.text-center {
        text-align: center;
      }

      .standings-table td {
        padding: 0.75rem 0.5rem;
        border-bottom: 1px solid rgba(191, 87, 0, 0.1);
      }

      .standings-table td.text-center {
        text-align: center;
      }

      .standings-table tr:hover {
        background: rgba(191, 87, 0, 0.1);
        cursor: pointer;
      }

      .team-name {
        font-weight: 600;
        color: var(--blaze-text);
      }

      .rank-badge {
        display: inline-block;
        width: 24px;
        height: 24px;
        line-height: 24px;
        text-align: center;
        border-radius: 4px;
        font-weight: 700;
        font-size: 0.75rem;
        background: rgba(191, 87, 0, 0.2);
        color: var(--blaze-burnt-orange);
      }

      .stat-positive {
        color: #4ade80;
      }

      .stat-negative {
        color: #f87171;
      }

      .stat-neutral {
        color: var(--blaze-text);
      }

      /* === CHART CONTAINERS === */
      .chart-container {
        position: relative;
        height: 350px;
        margin: 1.5rem 0;
      }

      .chart-container canvas {
        max-height: 350px;
      }

      /* === LOADING STATE === */
      .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 200px;
        color: var(--blaze-text-secondary);
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(191, 87, 0, 0.2);
        border-top-color: var(--blaze-burnt-orange);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 1rem;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* === RESPONSIVE === */
      @media (max-width: 768px) {
        body {
          padding: 1rem;
        }

        .header h1 {
          font-size: 2rem;
        }

        .dashboard-grid {
          grid-template-columns: 1fr;
          gap: 1.5rem;
        }

        .standings-table {
          font-size: 0.75rem;
        }

        .standings-table th,
        .standings-table td {
          padding: 0.5rem 0.25rem;
        }

        .chart-container {
          height: 250px;
        }
      }
    </style>
  </head>
  <body>
    <!-- HEADER -->
    <header class="header">
      <h1>‚öæ MLB League Analytics</h1>
      <p class="subtitle">
        Complete Major League Baseball Intelligence ‚Ä¢ All 30 Teams ‚Ä¢ 2025 Season
      </p>
      <p class="tagline">Objective Analytics ‚Ä¢ Zero Bias ‚Ä¢ Pure Data</p>
      <div class="league-badges">
        <span class="league-badge">üìä 30 Teams ‚Ä¢ 162 Games</span>
        <span class="league-badge">üî¢ Pythagorean Exponent: 1.83</span>
        <span class="league-badge">üì° SportsDataIO API</span>
      </div>
    </header>

    <!-- FILTER BAR -->
    <div class="filter-bar">
      <button class="filter-btn active" data-filter="all">All Teams</button>
      <button class="filter-btn" data-filter="AL">American League</button>
      <button class="filter-btn" data-filter="NL">National League</button>
      <button class="filter-btn" data-filter="AL East">AL East</button>
      <button class="filter-btn" data-filter="AL Central">AL Central</button>
      <button class="filter-btn" data-filter="AL West">AL West</button>
      <button class="filter-btn" data-filter="NL East">NL East</button>
      <button class="filter-btn" data-filter="NL Central">NL Central</button>
      <button class="filter-btn" data-filter="NL West">NL West</button>
    </div>

    <!-- DASHBOARD GRID -->
    <div class="dashboard-grid">
      <!-- CARD 1: League Standings -->
      <div class="analytics-card wide" id="standings-card">
        <div class="card-header">
          <h2 class="card-title">üìä 2025 MLB Standings</h2>
          <span class="card-icon">‚öæ</span>
        </div>
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading MLB standings for all 30 teams...</p>
        </div>
      </div>

      <!-- CARD 2: Pythagorean Win Expectancy -->
      <div class="analytics-card wide" id="pythagorean-card">
        <div class="card-header">
          <h2 class="card-title">üéØ Pythagorean Win Expectancy (All Teams)</h2>
          <span class="card-icon">üìà</span>
        </div>
        <div class="loading">
          <div class="spinner"></div>
          <p>Calculating expected wins vs actual wins for all teams...</p>
        </div>
      </div>

      <!-- CARD 3: Run Differential Analysis -->
      <div class="analytics-card wide" id="rundiff-card">
        <div class="card-header">
          <h2 class="card-title">‚öñÔ∏è Run Differential Rankings</h2>
          <span class="card-icon">üìä</span>
        </div>
        <div class="loading">
          <div class="spinner"></div>
          <p>Analyzing offensive vs defensive performance...</p>
        </div>
      </div>

      <!-- CARD 4: Playoff Probability Heat Map -->
      <div class="analytics-card wide" id="playoff-card">
        <div class="card-header">
          <h2 class="card-title">üèÜ Playoff Probability Rankings</h2>
          <span class="card-icon">üéüÔ∏è</span>
        </div>
        <div class="loading">
          <div class="spinner"></div>
          <p>Calculating playoff probability for all 30 teams...</p>
        </div>
      </div>
    </div>

    <script type="module">
      // ========================================
      // MLB LEAGUE-WIDE ANALYTICS DASHBOARD
      // ========================================

      // Import analytics libraries
      import {
        calculatePythagorean,
        projectSeason,
        compareTeams,
        MLB_CONFIG,
      } from '../lib/analytics/baseball/pythagorean-mlb.js';

      import { getMLBStandings, SPORTSDATAIO_CONFIG } from '../lib/api/mlb-data.js';

      // ========================================
      // STATE MANAGEMENT
      // ========================================

      let currentFilter = 'all';
      let standingsData = null;

      // ========================================
      // MAIN INITIALIZATION
      // ========================================

      async function initializeDashboard() {
        try {
          console.log('‚öæ Initializing MLB League Analytics Dashboard...');

          // Fetch standings for all 30 teams
          standingsData = await getMLBStandings('2025');

          console.log('‚úÖ Data fetched successfully:', standingsData);

          // Render all cards
          renderStandingsCard(standingsData);
          renderPythagoreanCard(standingsData);
          renderRunDifferentialCard(standingsData);
          renderPlayoffCard(standingsData);

          // Setup filter buttons
          setupFilters();
        } catch (error) {
          console.error('‚ùå Dashboard initialization error:', error);
          showError('Failed to load MLB data. Please check API configuration.');
        }
      }

      // ========================================
      // FILTER SYSTEM
      // ========================================

      function setupFilters() {
        const filterBtns = document.querySelectorAll('.filter-btn');

        filterBtns.forEach((btn) => {
          btn.addEventListener('click', () => {
            // Update active state
            filterBtns.forEach((b) => b.classList.remove('active'));
            btn.classList.add('active');

            // Update filter
            currentFilter = btn.dataset.filter;

            // Re-render cards with filter
            renderStandingsCard(standingsData);
          });
        });
      }

      function filterTeams(standings) {
        if (currentFilter === 'all') return standings;

        if (currentFilter === 'AL' || currentFilter === 'NL') {
          return standings.filter((team) => team.league === currentFilter);
        }

        return standings.filter((team) => `${team.league} ${team.division}` === currentFilter);
      }

      // ========================================
      // CARD RENDERERS
      // ========================================

      function renderStandingsCard(data) {
        const card = document.getElementById('standings-card');

        try {
          const filteredTeams = filterTeams(data.standings);

          // Sort by wins
          filteredTeams.sort((a, b) => b.record.wins - a.record.wins);

          let tableHTML = `
          <div class="card-header">
            <h2 class="card-title">üìä 2025 MLB Standings (${filteredTeams.length} Teams)</h2>
            <span class="card-icon">‚öæ</span>
          </div>

          <table class="standings-table">
            <thead>
              <tr>
                <th class="text-center">Rank</th>
                <th>Team</th>
                <th class="text-center">League</th>
                <th class="text-center">Division</th>
                <th class="text-center">W</th>
                <th class="text-center">L</th>
                <th class="text-center">Win%</th>
                <th class="text-center">GB</th>
                <th class="text-center">RS</th>
                <th class="text-center">RA</th>
                <th class="text-center">Diff</th>
                <th class="text-center">Streak</th>
              </tr>
            </thead>
            <tbody>
              ${filteredTeams
                .map((team, index) => {
                  const diff = (team.runsScored || 0) - (team.runsAllowed || 0);
                  const diffClass =
                    diff > 0 ? 'stat-positive' : diff < 0 ? 'stat-negative' : 'stat-neutral';

                  return `
                  <tr>
                    <td class="text-center"><span class="rank-badge">${index + 1}</span></td>
                    <td><span class="team-name">${team.team.name}</span></td>
                    <td class="text-center">${team.league}</td>
                    <td class="text-center">${team.division}</td>
                    <td class="text-center stat-positive"><strong>${team.record.wins}</strong></td>
                    <td class="text-center stat-negative">${team.record.losses}</td>
                    <td class="text-center">${(team.record.winPercentage * 100).toFixed(1)}%</td>
                    <td class="text-center">${team.gamesBack || '-'}</td>
                    <td class="text-center">${team.runsScored || 0}</td>
                    <td class="text-center">${team.runsAllowed || 0}</td>
                    <td class="text-center ${diffClass}"><strong>${diff > 0 ? '+' : ''}${diff}</strong></td>
                    <td class="text-center">${team.streak?.type || ''}${team.streak?.count || 0}</td>
                  </tr>
                `;
                })
                .join('')}
            </tbody>
          </table>
        `;

          card.innerHTML = tableHTML;
        } catch (error) {
          card.innerHTML = `
          <div class="card-header">
            <h2 class="card-title">üìä 2025 MLB Standings</h2>
            <span class="card-icon">‚öæ</span>
          </div>
          <div class="error-message">Error loading standings: ${error.message}</div>
        `;
        }
      }

      function renderPythagoreanCard(data) {
        const card = document.getElementById('pythagorean-card');

        try {
          const teams = data.standings.map((team) => {
            const gamesPlayed = team.record.wins + team.record.losses;
            const pythag = calculatePythagorean(
              team.runsScored || 0,
              team.runsAllowed || 0,
              gamesPlayed,
              team.record.wins
            );

            return {
              name: team.team.name,
              actualWins: team.record.wins,
              expectedWins: pythag.expectedWins,
              luckFactor: pythag.luckFactor,
            };
          });

          // Sort by expected wins
          teams.sort((a, b) => b.expectedWins - a.expectedWins);

          card.innerHTML = `
          <div class="card-header">
            <h2 class="card-title">üéØ Pythagorean Win Expectancy (All Teams)</h2>
            <span class="card-icon">üìà</span>
          </div>

          <div class="chart-container">
            <canvas id="pythagorean-chart"></canvas>
          </div>
        `;

          // Create Chart.js visualization
          setTimeout(() => {
            const ctx = document.getElementById('pythagorean-chart');
            if (ctx) {
              new Chart(ctx, {
                type: 'scatter',
                data: {
                  datasets: [
                    {
                      label: 'Actual vs Expected Wins',
                      data: teams.map((t) => ({
                        x: t.expectedWins,
                        y: t.actualWins,
                        team: t.name,
                      })),
                      backgroundColor: 'rgba(191, 87, 0, 0.6)',
                      borderColor: 'rgba(191, 87, 0, 1)',
                      borderWidth: 2,
                      pointRadius: 6,
                      pointHoverRadius: 8,
                    },
                    {
                      label: 'Expected = Actual Line',
                      data: [
                        { x: 0, y: 0 },
                        { x: 162, y: 162 },
                      ],
                      type: 'line',
                      borderColor: 'rgba(74, 222, 128, 0.5)',
                      borderDash: [10, 5],
                      borderWidth: 2,
                      fill: false,
                      pointRadius: 0,
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    legend: {
                      labels: {
                        color: 'rgba(224, 224, 224, 0.8)',
                        font: { size: 12, family: 'Inter, sans-serif' },
                      },
                    },
                    tooltip: {
                      backgroundColor: 'rgba(26, 26, 26, 0.9)',
                      titleColor: '#BF5700',
                      bodyColor: '#e0e0e0',
                      borderColor: 'rgba(191, 87, 0, 0.5)',
                      borderWidth: 1,
                      callbacks: {
                        label: (context) => {
                          if (context.dataset.label === 'Actual vs Expected Wins') {
                            const point = context.raw;
                            const luck = point.y - point.x;
                            return [
                              `${point.team}`,
                              `Expected: ${point.x} wins`,
                              `Actual: ${point.y} wins`,
                              `Luck: ${luck > 0 ? '+' : ''}${luck.toFixed(1)}`,
                            ];
                          }
                          return '';
                        },
                      },
                    },
                  },
                  scales: {
                    x: {
                      title: {
                        display: true,
                        text: 'Expected Wins (Pythagorean)',
                        color: 'rgba(160, 160, 160, 1)',
                        font: { size: 12 },
                      },
                      grid: { color: 'rgba(191, 87, 0, 0.1)' },
                      ticks: { color: 'rgba(160, 160, 160, 1)' },
                      min: 0,
                      max: 162,
                    },
                    y: {
                      title: {
                        display: true,
                        text: 'Actual Wins',
                        color: 'rgba(160, 160, 160, 1)',
                        font: { size: 12 },
                      },
                      grid: { color: 'rgba(191, 87, 0, 0.1)' },
                      ticks: { color: 'rgba(160, 160, 160, 1)' },
                      min: 0,
                      max: 162,
                    },
                  },
                },
              });
            }
          }, 100);
        } catch (error) {
          card.innerHTML = `
          <div class="card-header">
            <h2 class="card-title">üéØ Pythagorean Win Expectancy</h2>
            <span class="card-icon">üìà</span>
          </div>
          <div class="error-message">Error calculating Pythagorean analysis: ${error.message}</div>
        `;
        }
      }

      function renderRunDifferentialCard(data) {
        const card = document.getElementById('rundiff-card');

        try {
          const teams = data.standings.map((team) => ({
            name: team.team.name.replace(/^.*\s/, ''), // Short name
            diff: (team.runsScored || 0) - (team.runsAllowed || 0),
          }));

          // Sort by run differential
          teams.sort((a, b) => b.diff - a.diff);

          card.innerHTML = `
          <div class="card-header">
            <h2 class="card-title">‚öñÔ∏è Run Differential Rankings</h2>
            <span class="card-icon">üìä</span>
          </div>

          <div class="chart-container">
            <canvas id="rundiff-chart"></canvas>
          </div>
        `;

          // Create Chart.js bar chart
          setTimeout(() => {
            const ctx = document.getElementById('rundiff-chart');
            if (ctx) {
              new Chart(ctx, {
                type: 'bar',
                data: {
                  labels: teams.map((t) => t.name),
                  datasets: [
                    {
                      label: 'Run Differential',
                      data: teams.map((t) => t.diff),
                      backgroundColor: teams.map((t) =>
                        t.diff > 0 ? 'rgba(74, 222, 128, 0.6)' : 'rgba(248, 113, 113, 0.6)'
                      ),
                      borderColor: teams.map((t) =>
                        t.diff > 0 ? 'rgba(74, 222, 128, 1)' : 'rgba(248, 113, 113, 1)'
                      ),
                      borderWidth: 2,
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  indexAxis: 'y',
                  plugins: {
                    legend: { display: false },
                    tooltip: {
                      backgroundColor: 'rgba(26, 26, 26, 0.9)',
                      titleColor: '#BF5700',
                      bodyColor: '#e0e0e0',
                      callbacks: {
                        label: (context) =>
                          `${context.parsed.x > 0 ? '+' : ''}${context.parsed.x} runs`,
                      },
                    },
                  },
                  scales: {
                    x: {
                      grid: { color: 'rgba(191, 87, 0, 0.1)' },
                      ticks: { color: 'rgba(160, 160, 160, 1)' },
                    },
                    y: {
                      grid: { display: false },
                      ticks: {
                        color: 'rgba(160, 160, 160, 1)',
                        font: { size: 9 },
                      },
                    },
                  },
                },
              });
            }
          }, 100);
        } catch (error) {
          card.innerHTML = `
          <div class="card-header">
            <h2 class="card-title">‚öñÔ∏è Run Differential Rankings</h2>
            <span class="card-icon">üìä</span>
          </div>
          <div class="error-message">Error calculating run differential: ${error.message}</div>
        `;
        }
      }

      function renderPlayoffCard(data) {
        const card = document.getElementById('playoff-card');

        try {
          const teams = data.standings.map((team) => {
            const gamesPlayed = team.record.wins + team.record.losses;
            const projection = projectSeason(
              {
                runsScored: team.runsScored || 0,
                runsAllowed: team.runsAllowed || 0,
                wins: team.record.wins,
                losses: team.record.losses,
                gamesPlayed,
              },
              162
            );

            return {
              name: team.team.name.replace(/^.*\s/, ''),
              league: team.league,
              playoffProb: parseFloat(projection.playoffLikelihood),
              projWins: projection.projectedFinalRecord.wins,
            };
          });

          // Sort by playoff probability
          teams.sort((a, b) => b.playoffProb - a.playoffProb);

          card.innerHTML = `
          <div class="card-header">
            <h2 class="card-title">üèÜ Playoff Probability Rankings</h2>
            <span class="card-icon">üéüÔ∏è</span>
          </div>

          <div class="chart-container">
            <canvas id="playoff-chart"></canvas>
          </div>
        `;

          // Create Chart.js horizontal bar chart
          setTimeout(() => {
            const ctx = document.getElementById('playoff-chart');
            if (ctx) {
              new Chart(ctx, {
                type: 'bar',
                data: {
                  labels: teams.map((t) => t.name),
                  datasets: [
                    {
                      label: 'Playoff Probability (%)',
                      data: teams.map((t) => t.playoffProb),
                      backgroundColor: teams.map((t) =>
                        t.playoffProb > 75
                          ? 'rgba(74, 222, 128, 0.6)'
                          : t.playoffProb > 50
                            ? 'rgba(191, 87, 0, 0.6)'
                            : t.playoffProb > 25
                              ? 'rgba(204, 102, 0, 0.6)'
                              : 'rgba(248, 113, 113, 0.6)'
                      ),
                      borderColor: teams.map((t) =>
                        t.playoffProb > 75
                          ? 'rgba(74, 222, 128, 1)'
                          : t.playoffProb > 50
                            ? 'rgba(191, 87, 0, 1)'
                            : t.playoffProb > 25
                              ? 'rgba(204, 102, 0, 1)'
                              : 'rgba(248, 113, 113, 1)'
                      ),
                      borderWidth: 2,
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  indexAxis: 'y',
                  plugins: {
                    legend: { display: false },
                    tooltip: {
                      backgroundColor: 'rgba(26, 26, 26, 0.9)',
                      titleColor: '#BF5700',
                      bodyColor: '#e0e0e0',
                      callbacks: {
                        label: (context) => {
                          const team = teams[context.dataIndex];
                          return [
                            `Playoff Prob: ${context.parsed.x.toFixed(1)}%`,
                            `Projected Wins: ${team.projWins}`,
                            `League: ${team.league}`,
                          ];
                        },
                      },
                    },
                  },
                  scales: {
                    x: {
                      grid: { color: 'rgba(191, 87, 0, 0.1)' },
                      ticks: { color: 'rgba(160, 160, 160, 1)' },
                      max: 100,
                    },
                    y: {
                      grid: { display: false },
                      ticks: {
                        color: 'rgba(160, 160, 160, 1)',
                        font: { size: 9 },
                      },
                    },
                  },
                },
              });
            }
          }, 100);
        } catch (error) {
          card.innerHTML = `
          <div class="card-header">
            <h2 class="card-title">üèÜ Playoff Probability Rankings</h2>
            <span class="card-icon">üéüÔ∏è</span>
          </div>
          <div class="error-message">Error calculating playoff probabilities: ${error.message}</div>
        `;
        }
      }

      // ========================================
      // ERROR HANDLING
      // ========================================

      function showError(message) {
        document.querySelectorAll('.analytics-card').forEach((card) => {
          card.innerHTML = `
          <div class="error-message">
            <strong>‚ö†Ô∏è Error:</strong> ${message}
            <br><br>
            Please verify your SportsDataIO API key is configured correctly.
          </div>
        `;
        });
      }

      // ========================================
      // EXECUTE
      // ========================================

      initializeDashboard();
    </script>
  </body>
</html>

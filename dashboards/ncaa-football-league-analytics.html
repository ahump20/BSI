<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üèà NCAA Football League Analytics | Blaze Intelligence</title>
    <meta
      name="description"
      content="Comprehensive NCAA FBS Football analytics for all conferences - objective data, zero bias, powered by Blaze Intelligence"
    />

    <!-- Chart.js for Data Visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        /* Blaze Intelligence System Colors (Neutral - No Team Bias) */
        --blaze-burnt-orange: #bf5700;
        --blaze-ember: #cc6600;
        --blaze-background: #0a0a0a;
        --blaze-surface: rgba(26, 26, 26, 0.6);
        --blaze-text: #e0e0e0;
        --blaze-text-dim: #a0a0a0;
        --blaze-success: #4ade80;
        --blaze-warning: #f59e0b;
        --blaze-danger: #f87171;
        --blaze-info: #60a5fa;

        /* Glass Morphism Effects */
        --glass-light: rgba(191, 87, 0, 0.08);
        --glass-medium: rgba(191, 87, 0, 0.12);
        --glass-heavy: rgba(191, 87, 0, 0.18);
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%);
        color: var(--blaze-text);
        min-height: 100vh;
        padding: 2rem;
        line-height: 1.6;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      /* Header Styling */
      header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 2rem;
        background: var(--glass-medium);
        backdrop-filter: blur(16px) saturate(180%);
        border-radius: 20px;
        border: 1px solid rgba(191, 87, 0, 0.2);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      }

      h1 {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, var(--blaze-burnt-orange) 0%, var(--blaze-ember) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.5rem;
      }

      .subtitle {
        font-size: 1.1rem;
        color: var(--blaze-text-dim);
        margin-bottom: 0.5rem;
      }

      .tagline {
        font-size: 0.9rem;
        color: var(--blaze-burnt-orange);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 0.5rem;
      }

      .league-badges {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: 1rem;
      }

      .league-badge {
        background: var(--glass-light);
        padding: 0.5rem 1rem;
        border-radius: 12px;
        font-size: 0.85rem;
        border: 1px solid rgba(191, 87, 0, 0.15);
      }

      /* Filter Bar */
      .filter-bar {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 2rem;
        padding: 1rem;
        background: var(--glass-medium);
        backdrop-filter: blur(16px) saturate(180%);
        border-radius: 16px;
        border: 1px solid rgba(191, 87, 0, 0.2);
      }

      .filter-section {
        width: 100%;
        text-align: center;
        margin-bottom: 1rem;
      }

      .filter-section-title {
        font-size: 0.75rem;
        color: var(--blaze-burnt-orange);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 0.5rem;
      }

      .filter-btn {
        padding: 0.6rem 1.2rem;
        background: var(--glass-light);
        border: 1px solid rgba(191, 87, 0, 0.2);
        color: var(--blaze-text);
        border-radius: 10px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .filter-btn:hover {
        background: var(--glass-medium);
        border-color: var(--blaze-burnt-orange);
        transform: translateY(-2px);
      }

      .filter-btn.active {
        background: linear-gradient(135deg, var(--blaze-burnt-orange) 0%, var(--blaze-ember) 100%);
        border-color: var(--blaze-burnt-orange);
        color: white;
        box-shadow: 0 4px 16px rgba(191, 87, 0, 0.4);
      }

      /* Cards Grid */
      .cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
      }

      .analytics-card {
        background: var(--glass-medium);
        backdrop-filter: blur(16px) saturate(180%);
        border-radius: 20px;
        padding: 2rem;
        border: 1px solid rgba(191, 87, 0, 0.2);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        transition: all 0.3s ease;
      }

      .analytics-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 48px 0 rgba(191, 87, 0, 0.3);
        border-color: var(--blaze-burnt-orange);
      }

      .card-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid rgba(191, 87, 0, 0.2);
      }

      .card-icon {
        font-size: 1.5rem;
        color: var(--blaze-burnt-orange);
      }

      .card-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--blaze-text);
      }

      /* Table Styling */
      .standings-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
      }

      .standings-table thead {
        background: var(--glass-heavy);
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .standings-table th {
        padding: 0.75rem;
        text-align: left;
        font-weight: 600;
        color: var(--blaze-burnt-orange);
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.5px;
        border-bottom: 2px solid rgba(191, 87, 0, 0.3);
      }

      .standings-table td {
        padding: 0.75rem;
        border-bottom: 1px solid rgba(191, 87, 0, 0.1);
      }

      .standings-table tbody tr {
        transition: all 0.2s ease;
      }

      .standings-table tbody tr:hover {
        background: var(--glass-light);
        transform: scale(1.01);
      }

      .text-center {
        text-align: center !important;
      }

      .text-success {
        color: var(--blaze-success) !important;
      }

      .text-danger {
        color: var(--blaze-danger) !important;
      }

      .text-warning {
        color: var(--blaze-warning) !important;
      }

      .text-info {
        color: var(--blaze-info) !important;
      }

      .rank-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .rank-cfp {
        background: rgba(74, 222, 128, 0.2);
        color: var(--blaze-success);
        border: 1px solid var(--blaze-success);
      }

      .rank-ny6 {
        background: rgba(245, 158, 11, 0.2);
        color: var(--blaze-warning);
        border: 1px solid var(--blaze-warning);
      }

      .rank-top25 {
        background: rgba(96, 165, 250, 0.2);
        color: var(--blaze-info);
        border: 1px solid var(--blaze-info);
      }

      /* Chart Container */
      .chart-container {
        position: relative;
        height: 400px;
        margin: 1.5rem 0;
      }

      /* Loading State */
      .loading {
        text-align: center;
        padding: 3rem;
        font-size: 1.1rem;
        color: var(--blaze-text-dim);
      }

      .spinner {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 4px solid rgba(191, 87, 0, 0.3);
        border-top-color: var(--blaze-burnt-orange);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 1rem;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Error State */
      .error-message {
        background: rgba(248, 113, 113, 0.1);
        border: 1px solid var(--blaze-danger);
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1rem 0;
        color: var(--blaze-danger);
      }

      /* Footer */
      footer {
        text-align: center;
        padding: 2rem;
        margin-top: 3rem;
        color: var(--blaze-text-dim);
        font-size: 0.9rem;
        border-top: 1px solid rgba(191, 87, 0, 0.2);
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        body {
          padding: 1rem;
        }

        h1 {
          font-size: 1.8rem;
        }

        .cards-grid {
          grid-template-columns: 1fr;
        }

        .filter-bar {
          padding: 0.5rem;
        }

        .filter-btn {
          padding: 0.4rem 0.8rem;
          font-size: 0.8rem;
        }

        .standings-table {
          font-size: 0.75rem;
        }

        .standings-table th,
        .standings-table td {
          padding: 0.5rem 0.25rem;
        }

        .chart-container {
          height: 300px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üèà NCAA Football League Analytics</h1>
        <p class="subtitle">
          Complete FBS College Football Intelligence ‚Ä¢ All Conferences ‚Ä¢ 2025-26 Season
        </p>
        <p class="tagline">Objective Analytics ‚Ä¢ Zero Bias ‚Ä¢ Pure Data</p>
        <div class="league-badges">
          <span class="league-badge">üìä 130+ FBS Teams ‚Ä¢ 12 Games + Bowls</span>
          <span class="league-badge">üèÜ CFP Rankings & Projections</span>
          <span class="league-badge">üì° ESPN API</span>
        </div>
      </header>

      <!-- Filter Bar -->
      <div class="filter-bar">
        <div class="filter-section">
          <div class="filter-section-title">All Conferences</div>
          <button class="filter-btn active" data-filter="all">All FBS Teams</button>
        </div>

        <div class="filter-section">
          <div class="filter-section-title">Power 5 Conferences</div>
          <button class="filter-btn" data-filter="SEC">SEC</button>
          <button class="filter-btn" data-filter="Big Ten">Big Ten</button>
          <button class="filter-btn" data-filter="Big 12">Big 12</button>
          <button class="filter-btn" data-filter="ACC">ACC</button>
          <button class="filter-btn" data-filter="Pac-12">Pac-12</button>
        </div>

        <div class="filter-section">
          <div class="filter-section-title">Group of 5 Conferences</div>
          <button class="filter-btn" data-filter="American Athletic">American (AAC)</button>
          <button class="filter-btn" data-filter="Conference USA">Conference USA</button>
          <button class="filter-btn" data-filter="Mid-American">MAC</button>
          <button class="filter-btn" data-filter="Mountain West">Mountain West</button>
          <button class="filter-btn" data-filter="Sun Belt">Sun Belt</button>
        </div>
      </div>

      <!-- Analytics Cards -->
      <div class="cards-grid">
        <!-- Card 1: Conference Standings -->
        <div class="analytics-card" style="grid-column: 1 / -1">
          <div class="card-header">
            <i class="fas fa-table card-icon"></i>
            <h2 class="card-title">Conference Standings</h2>
          </div>
          <div id="standings-container">
            <div class="loading">
              <div class="spinner"></div>
              <p>Loading NCAA Football standings data...</p>
            </div>
          </div>
        </div>

        <!-- Card 2: Pythagorean Expectation Scatter Plot -->
        <div class="analytics-card">
          <div class="card-header">
            <i class="fas fa-chart-scatter card-icon"></i>
            <h2 class="card-title">Pythagorean Analysis</h2>
          </div>
          <div class="chart-container">
            <canvas id="pythagorean-chart"></canvas>
          </div>
          <p style="font-size: 0.85rem; color: var(--blaze-text-dim); margin-top: 1rem">
            Teams above the line are winning more than expected, below are underperforming based on
            point differential.
          </p>
        </div>

        <!-- Card 3: Point Differential Bar Chart -->
        <div class="analytics-card">
          <div class="card-header">
            <i class="fas fa-chart-bar card-icon"></i>
            <h2 class="card-title">Point Differential Analysis</h2>
          </div>
          <div class="chart-container">
            <canvas id="differential-chart"></canvas>
          </div>
          <p style="font-size: 0.85rem; color: var(--blaze-text-dim); margin-top: 1rem">
            Average point differential per game (offensive - defensive scoring).
          </p>
        </div>

        <!-- Card 4: CFP Playoff Probability -->
        <div class="analytics-card" style="grid-column: 1 / -1">
          <div class="card-header">
            <i class="fas fa-trophy card-icon"></i>
            <h2 class="card-title">College Football Playoff Probability</h2>
          </div>
          <div class="chart-container" style="height: 600px">
            <canvas id="cfp-chart"></canvas>
          </div>
          <p style="font-size: 0.85rem; color: var(--blaze-text-dim); margin-top: 1rem">
            Probability based on current record, strength of schedule, conference standing, and
            remaining games. Top 4 teams make CFP.
          </p>
        </div>
      </div>

      <footer>
        <p>&copy; 2025 Blaze Intelligence ‚Ä¢ NCAA Football Analytics Platform</p>
        <p style="margin-top: 0.5rem">Data powered by ESPN API ‚Ä¢ Updated in real-time</p>
      </footer>
    </div>

    <script type="module">
      // Configuration
      const ESPN_BASE = 'https://site.api.espn.com/apis/site/v2/sports/football/college-football';
      const CURRENT_SEASON = '2024';

      // Filter state
      let currentFilter = 'all';
      let allStandingsData = null;

      // Initialize
      document.addEventListener('DOMContentLoaded', () => {
        setupFilterButtons();
        loadStandingsData();
      });

      // Filter button handlers
      function setupFilterButtons() {
        const buttons = document.querySelectorAll('.filter-btn');
        buttons.forEach((btn) => {
          btn.addEventListener('click', () => {
            buttons.forEach((b) => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilter = btn.dataset.filter;
            if (allStandingsData) {
              renderAllVisualizations(allStandingsData);
            }
          });
        });
      }

      // Load standings data from ESPN API
      async function loadStandingsData() {
        try {
          const response = await fetch(`${ESPN_BASE}/standings`);

          if (!response.ok) {
            throw new Error(`API error: ${response.statusText}`);
          }

          const data = await response.json();
          allStandingsData = processStandingsData(data);
          renderAllVisualizations(allStandingsData);
        } catch (error) {
          console.error('Error loading standings:', error);
          showError(
            'Failed to load NCAA Football standings data. Using demo data for visualization.'
          );
          // Fallback to demo data
          allStandingsData = generateDemoData();
          renderAllVisualizations(allStandingsData);
        }
      }

      // Process ESPN API response into our format
      function processStandingsData(apiData) {
        const allTeams = [];

        // ESPN returns standings by conference
        apiData.children?.forEach((conference) => {
          const confName = conference.name;
          const confAbbr = conference.abbreviation;

          conference.standings?.entries?.forEach((entry) => {
            const team = entry.team;
            const stats = entry.stats || [];

            const wins = stats.find((s) => s.name === 'wins')?.value || 0;
            const losses = stats.find((s) => s.name === 'losses')?.value || 0;
            const gamesPlayed = wins + losses;

            const pointsFor = stats.find((s) => s.name === 'pointsFor')?.value || 0;
            const pointsAgainst = stats.find((s) => s.name === 'pointsAgainst')?.value || 0;

            const pythag = calculatePythagorean(pointsFor, pointsAgainst, gamesPlayed, wins);

            allTeams.push({
              rank: stats.find((s) => s.name === 'rank')?.value || 999,
              team: {
                id: team.id,
                name: team.displayName,
                abbreviation: team.abbreviation,
                logo: team.logos?.[0]?.href,
              },
              conference: confName,
              conferenceAbbr: confAbbr,
              record: {
                wins,
                losses,
                winPercentage: gamesPlayed > 0 ? wins / gamesPlayed : 0,
              },
              confRecord: stats.find((s) => s.name === 'vsConf')?.displayValue || '0-0',
              homeRecord: stats.find((s) => s.name === 'home')?.displayValue || '0-0',
              awayRecord: stats.find((s) => s.name === 'road')?.displayValue || '0-0',
              streak: stats.find((s) => s.name === 'streak')?.displayValue || '-',
              pointsFor,
              pointsAgainst,
              differential: pointsFor - pointsAgainst,
              avgDifferential: gamesPlayed > 0 ? (pointsFor - pointsAgainst) / gamesPlayed : 0,
              pythag,
            });
          });
        });

        // Sort by wins, then win percentage
        allTeams.sort((a, b) => {
          if (b.record.wins !== a.record.wins) {
            return b.record.wins - a.record.wins;
          }
          return b.record.winPercentage - a.record.winPercentage;
        });

        return allTeams;
      }

      // Calculate Pythagorean expectation (Football uses exponent 2.37)
      function calculatePythagorean(pointsFor, pointsAgainst, gamesPlayed, actualWins) {
        if (pointsFor === 0 && pointsAgainst === 0) {
          return { expectedWins: 0, luckFactor: 0 };
        }

        const exponent = 2.37;
        const pythagPercent =
          Math.pow(pointsFor, exponent) /
          (Math.pow(pointsFor, exponent) + Math.pow(pointsAgainst, exponent));

        const expectedWins = pythagPercent * gamesPlayed;
        const luckFactor = actualWins - expectedWins;

        return {
          expectedWins: parseFloat(expectedWins.toFixed(1)),
          luckFactor: parseFloat(luckFactor.toFixed(1)),
        };
      }

      // Filter teams based on current filter
      function filterTeams(teams) {
        if (currentFilter === 'all') {
          return teams;
        }

        return teams.filter((team) => team.conference === currentFilter);
      }

      // Render all visualizations
      function renderAllVisualizations(teams) {
        const filteredTeams = filterTeams(teams);
        renderStandingsTable(filteredTeams);
        renderPythagoreanChart(filteredTeams);
        renderDifferentialChart(filteredTeams);
        renderCFPProbabilityChart(filteredTeams);
      }

      // Render standings table
      function renderStandingsTable(teams) {
        const container = document.getElementById('standings-container');

        if (teams.length === 0) {
          container.innerHTML = '<p class="loading">No teams found for selected filter.</p>';
          return;
        }

        const html = `
        <div style="overflow-x: auto;">
          <table class="standings-table">
            <thead>
              <tr>
                <th class="text-center">Rank</th>
                <th>Team</th>
                <th class="text-center">Conference</th>
                <th class="text-center">W</th>
                <th class="text-center">L</th>
                <th class="text-center">Win%</th>
                <th class="text-center">Conf</th>
                <th class="text-center">PF</th>
                <th class="text-center">PA</th>
                <th class="text-center">Diff</th>
                <th class="text-center">Avg Diff</th>
                <th class="text-center">Streak</th>
              </tr>
            </thead>
            <tbody>
              ${teams
                .map((team, index) => {
                  const diffClass = team.differential > 0 ? 'text-success' : 'text-danger';
                  const rankClass =
                    team.rank <= 4
                      ? 'rank-cfp'
                      : team.rank <= 12
                        ? 'rank-ny6'
                        : team.rank <= 25
                          ? 'rank-top25'
                          : '';

                  return `
                  <tr>
                    <td class="text-center">
                      ${team.rank < 999 ? `<span class="rank-badge ${rankClass}">#${team.rank}</span>` : '-'}
                    </td>
                    <td><strong>${team.team.name}</strong></td>
                    <td class="text-center">${team.conferenceAbbr}</td>
                    <td class="text-center"><strong>${team.record.wins}</strong></td>
                    <td class="text-center">${team.record.losses}</td>
                    <td class="text-center">${(team.record.winPercentage * 100).toFixed(1)}%</td>
                    <td class="text-center">${team.confRecord}</td>
                    <td class="text-center">${Math.round(team.pointsFor)}</td>
                    <td class="text-center">${Math.round(team.pointsAgainst)}</td>
                    <td class="text-center ${diffClass}"><strong>${team.differential > 0 ? '+' : ''}${Math.round(team.differential)}</strong></td>
                    <td class="text-center ${diffClass}">${team.avgDifferential > 0 ? '+' : ''}${team.avgDifferential.toFixed(1)}</td>
                    <td class="text-center">${team.streak}</td>
                  </tr>
                `;
                })
                .join('')}
            </tbody>
          </table>
        </div>
      `;

        container.innerHTML = html;
      }

      // Render Pythagorean expectation scatter plot
      function renderPythagoreanChart(teams) {
        const ctx = document.getElementById('pythagorean-chart');
        if (!ctx) return;

        // Destroy existing chart if it exists
        const existingChart = Chart.getChart(ctx);
        if (existingChart) {
          existingChart.destroy();
        }

        const data = teams.map((t) => ({
          x: t.pythag.expectedWins,
          y: t.record.wins,
          team: t.team.name,
        }));

        const maxWins = Math.max(...teams.map((t) => t.record.wins + t.record.losses), 12);

        new Chart(ctx, {
          type: 'scatter',
          data: {
            datasets: [
              {
                label: 'Actual vs Expected Wins',
                data: data,
                backgroundColor: 'rgba(191, 87, 0, 0.6)',
                borderColor: 'rgba(191, 87, 0, 1)',
                borderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8,
              },
              {
                label: 'Expected = Actual Line',
                data: [
                  { x: 0, y: 0 },
                  { x: maxWins, y: maxWins },
                ],
                type: 'line',
                borderColor: 'rgba(74, 222, 128, 0.5)',
                borderWidth: 2,
                borderDash: [10, 5],
                pointRadius: 0,
                fill: false,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  color: '#e0e0e0',
                  font: { size: 12 },
                },
              },
              tooltip: {
                backgroundColor: 'rgba(26, 26, 26, 0.95)',
                titleColor: '#BF5700',
                bodyColor: '#e0e0e0',
                borderColor: '#BF5700',
                borderWidth: 1,
                padding: 12,
                displayColors: false,
                callbacks: {
                  label: function (context) {
                    if (context.datasetIndex === 0) {
                      const point = context.raw;
                      const luck = (point.y - point.x).toFixed(1);
                      return [
                        `Team: ${point.team}`,
                        `Actual Wins: ${point.y}`,
                        `Expected Wins: ${point.x.toFixed(1)}`,
                        `Luck Factor: ${luck > 0 ? '+' : ''}${luck}`,
                      ];
                    }
                    return '';
                  },
                },
              },
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: 'Expected Wins (Pythagorean)',
                  color: '#BF5700',
                  font: { size: 14, weight: 'bold' },
                },
                min: 0,
                max: maxWins,
                grid: {
                  color: 'rgba(191, 87, 0, 0.1)',
                },
                ticks: {
                  color: '#a0a0a0',
                },
              },
              y: {
                title: {
                  display: true,
                  text: 'Actual Wins',
                  color: '#BF5700',
                  font: { size: 14, weight: 'bold' },
                },
                min: 0,
                max: maxWins,
                grid: {
                  color: 'rgba(191, 87, 0, 0.1)',
                },
                ticks: {
                  color: '#a0a0a0',
                },
              },
            },
          },
        });
      }

      // Render point differential bar chart
      function renderDifferentialChart(teams) {
        const ctx = document.getElementById('differential-chart');
        if (!ctx) return;

        // Destroy existing chart if it exists
        const existingChart = Chart.getChart(ctx);
        if (existingChart) {
          existingChart.destroy();
        }

        // Sort by average differential
        const sortedTeams = [...teams].sort((a, b) => b.avgDifferential - a.avgDifferential);
        const topTeams = sortedTeams.slice(0, 20); // Show top 20

        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: topTeams.map((t) => t.team.name),
            datasets: [
              {
                label: 'Avg Point Differential',
                data: topTeams.map((t) => t.avgDifferential),
                backgroundColor: topTeams.map((t) =>
                  t.avgDifferential > 0 ? 'rgba(74, 222, 128, 0.6)' : 'rgba(248, 113, 113, 0.6)'
                ),
                borderColor: topTeams.map((t) =>
                  t.avgDifferential > 0 ? 'rgba(74, 222, 128, 1)' : 'rgba(248, 113, 113, 1)'
                ),
                borderWidth: 2,
              },
            ],
          },
          options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                backgroundColor: 'rgba(26, 26, 26, 0.95)',
                titleColor: '#BF5700',
                bodyColor: '#e0e0e0',
                borderColor: '#BF5700',
                borderWidth: 1,
                padding: 12,
                callbacks: {
                  label: function (context) {
                    return `Avg Differential: ${context.parsed.x > 0 ? '+' : ''}${context.parsed.x.toFixed(1)} pts/game`;
                  },
                },
              },
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: 'Average Point Differential per Game',
                  color: '#BF5700',
                  font: { size: 14, weight: 'bold' },
                },
                grid: {
                  color: 'rgba(191, 87, 0, 0.1)',
                },
                ticks: {
                  color: '#a0a0a0',
                  callback: function (value) {
                    return value > 0 ? '+' + value : value;
                  },
                },
              },
              y: {
                grid: {
                  display: false,
                },
                ticks: {
                  color: '#a0a0a0',
                  font: { size: 10 },
                },
              },
            },
          },
        });
      }

      // Render CFP playoff probability chart
      function renderCFPProbabilityChart(teams) {
        const ctx = document.getElementById('cfp-chart');
        if (!ctx) return;

        // Destroy existing chart if it exists
        const existingChart = Chart.getChart(ctx);
        if (existingChart) {
          existingChart.destroy();
        }

        // Calculate CFP playoff probability
        const teamsWithProb = teams.map((t) => {
          const gamesPlayed = t.record.wins + t.record.losses;
          const gamesRemaining = 12 - gamesPlayed;
          const currentPace = gamesPlayed > 0 ? t.record.wins / gamesPlayed : 0;
          const projectedWins = t.record.wins + currentPace * gamesRemaining;

          // CFP probability factors:
          // - Record (50%)
          // - Conference strength (25%)
          // - Point differential (15%)
          // - Quality wins (10%)

          let cfpProb = 0;

          // Record factor (undefeated or 1-loss teams heavily favored)
          if (t.record.losses === 0) {
            cfpProb += 60;
          } else if (t.record.losses === 1 && projectedWins >= 11) {
            cfpProb += 40;
          } else if (projectedWins >= 10) {
            cfpProb += 20;
          } else if (projectedWins >= 9) {
            cfpProb += 5;
          }

          // Conference strength (Power 5 bonus)
          const power5 = ['SEC', 'Big Ten', 'Big 12', 'ACC', 'Pac-12'];
          if (power5.includes(t.conference)) {
            cfpProb += 25;
          } else {
            // Group of 5 needs perfect or near-perfect record
            if (t.record.losses === 0 && projectedWins >= 12) {
              cfpProb += 15;
            } else {
              cfpProb += 2;
            }
          }

          // Point differential factor
          if (t.avgDifferential > 20) {
            cfpProb += 10;
          } else if (t.avgDifferential > 15) {
            cfpProb += 7;
          } else if (t.avgDifferential > 10) {
            cfpProb += 5;
          }

          // Rank bonus
          if (t.rank <= 4) {
            cfpProb += 10;
          } else if (t.rank <= 10) {
            cfpProb += 5;
          }

          // Cap at 99%
          cfpProb = Math.min(99, Math.max(1, cfpProb));

          return {
            name: t.team.name,
            cfpProb,
            projectedWins: projectedWins.toFixed(1),
            currentRecord: `${t.record.wins}-${t.record.losses}`,
            conference: t.conferenceAbbr,
            rank: t.rank,
          };
        });

        // Sort by CFP probability and take top 25
        const sortedTeams = teamsWithProb.sort((a, b) => b.cfpProb - a.cfpProb).slice(0, 25);

        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: sortedTeams.map((t) => `${t.name} (${t.conference})`),
            datasets: [
              {
                label: 'CFP Probability (%)',
                data: sortedTeams.map((t) => t.cfpProb),
                backgroundColor: sortedTeams.map((t) =>
                  t.cfpProb > 75
                    ? 'rgba(74, 222, 128, 0.6)'
                    : t.cfpProb > 50
                      ? 'rgba(191, 87, 0, 0.6)'
                      : t.cfpProb > 25
                        ? 'rgba(204, 102, 0, 0.6)'
                        : 'rgba(248, 113, 113, 0.6)'
                ),
                borderColor: sortedTeams.map((t) =>
                  t.cfpProb > 75
                    ? 'rgba(74, 222, 128, 1)'
                    : t.cfpProb > 50
                      ? 'rgba(191, 87, 0, 1)'
                      : t.cfpProb > 25
                        ? 'rgba(204, 102, 0, 1)'
                        : 'rgba(248, 113, 113, 1)'
                ),
                borderWidth: 2,
              },
            ],
          },
          options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                backgroundColor: 'rgba(26, 26, 26, 0.95)',
                titleColor: '#BF5700',
                bodyColor: '#e0e0e0',
                borderColor: '#BF5700',
                borderWidth: 1,
                padding: 12,
                callbacks: {
                  label: function (context) {
                    const team = sortedTeams[context.dataIndex];
                    return [
                      `CFP Probability: ${team.cfpProb}%`,
                      `Current Record: ${team.currentRecord}`,
                      `Projected Final: ${team.projectedWins} wins`,
                      `Rank: ${team.rank < 999 ? '#' + team.rank : 'Unranked'}`,
                    ];
                  },
                },
              },
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: 'College Football Playoff Probability (%)',
                  color: '#BF5700',
                  font: { size: 14, weight: 'bold' },
                },
                min: 0,
                max: 100,
                grid: {
                  color: 'rgba(191, 87, 0, 0.1)',
                },
                ticks: {
                  color: '#a0a0a0',
                  callback: function (value) {
                    return value + '%';
                  },
                },
              },
              y: {
                grid: {
                  display: false,
                },
                ticks: {
                  color: '#a0a0a0',
                  font: { size: 9 },
                },
              },
            },
          },
        });
      }

      // Show error message
      function showError(message) {
        const container = document.getElementById('standings-container');
        container.innerHTML = `
        <div class="error-message">
          <p><strong>‚ö†Ô∏è Error</strong></p>
          <p>${message}</p>
        </div>
      `;
      }

      // Generate demo data for testing
      function generateDemoData() {
        const conferences = [
          {
            name: 'SEC',
            abbr: 'SEC',
            teams: [
              'Alabama',
              'Georgia',
              'LSU',
              'Florida',
              'Texas A&M',
              'Auburn',
              'Tennessee',
              'Ole Miss',
              'Mississippi State',
              'Arkansas',
              'Kentucky',
              'Missouri',
              'South Carolina',
              'Vanderbilt',
            ],
          },
          {
            name: 'Big Ten',
            abbr: 'B1G',
            teams: [
              'Ohio State',
              'Michigan',
              'Penn State',
              'Wisconsin',
              'Iowa',
              'Nebraska',
              'Minnesota',
              'Michigan State',
              'Northwestern',
              'Purdue',
              'Indiana',
              'Illinois',
              'Maryland',
              'Rutgers',
            ],
          },
          {
            name: 'Big 12',
            abbr: 'B12',
            teams: [
              'Oklahoma',
              'Texas',
              'Baylor',
              'Oklahoma State',
              'Kansas State',
              'TCU',
              'Iowa State',
              'West Virginia',
              'Texas Tech',
              'Kansas',
            ],
          },
          {
            name: 'ACC',
            abbr: 'ACC',
            teams: [
              'Clemson',
              'Miami',
              'Florida State',
              'NC State',
              'Wake Forest',
              'Pittsburgh',
              'Virginia Tech',
              'Virginia',
              'North Carolina',
              'Duke',
              'Georgia Tech',
              'Boston College',
              'Syracuse',
              'Louisville',
            ],
          },
          {
            name: 'Pac-12',
            abbr: 'P12',
            teams: [
              'USC',
              'Oregon',
              'Washington',
              'Utah',
              'UCLA',
              'Stanford',
              'Arizona State',
              'Oregon State',
              'Washington State',
              'California',
              'Colorado',
              'Arizona',
            ],
          },
        ];

        const allTeams = [];
        let rankCounter = 1;

        conferences.forEach((conf) => {
          conf.teams.forEach((teamName, idx) => {
            const wins = Math.floor(Math.random() * 8) + 4;
            const losses = 12 - wins;
            const gamesPlayed = wins + losses;
            const pointsFor = (wins * 35 + losses * 20) * (0.9 + Math.random() * 0.2);
            const pointsAgainst = pointsFor - (Math.random() * 30 - 15) * gamesPlayed;

            allTeams.push({
              rank: idx < 3 ? rankCounter++ : 999,
              team: {
                id: teamName.toLowerCase().replace(/\s+/g, '-'),
                name: teamName,
                abbreviation: teamName.substring(0, 3).toUpperCase(),
              },
              conference: conf.name,
              conferenceAbbr: conf.abbr,
              record: {
                wins,
                losses,
                winPercentage: wins / gamesPlayed,
              },
              confRecord: `${Math.floor(wins * 0.6)}-${Math.floor(losses * 0.6)}`,
              homeRecord: `${Math.floor(wins * 0.6)}-${Math.floor(losses * 0.4)}`,
              awayRecord: `${Math.floor(wins * 0.4)}-${Math.floor(losses * 0.6)}`,
              streak: `${Math.random() > 0.5 ? 'W' : 'L'}${Math.floor(Math.random() * 4) + 1}`,
              pointsFor,
              pointsAgainst,
              differential: pointsFor - pointsAgainst,
              avgDifferential: (pointsFor - pointsAgainst) / gamesPlayed,
              pythag: calculatePythagorean(pointsFor, pointsAgainst, gamesPlayed, wins),
            });
          });
        });

        return allTeams.sort((a, b) => b.record.wins - a.record.wins);
      }
    </script>
  </body>
</html>
